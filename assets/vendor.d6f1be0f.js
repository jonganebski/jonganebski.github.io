var OI=Object.defineProperty,BI=Object.defineProperties;var UI=Object.getOwnPropertyDescriptors;var rb=Object.getOwnPropertySymbols;var NI=Object.prototype.hasOwnProperty,jI=Object.prototype.propertyIsEnumerable;var nb=(t,i,o)=>i in t?OI(t,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[i]=o,jg=(t,i)=>{for(var o in i||(i={}))NI.call(i,o)&&nb(t,o,i[o]);if(rb)for(var o of rb(i))jI.call(i,o)&&nb(t,o,i[o]);return t},sb=(t,i)=>BI(t,UI(i));/*!
  * shared v9.2.0-beta.30
  * (c) 2022 kazuya kawaguchi
  * Released under the MIT License.
  */const VI=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",rl=t=>VI?Symbol(t):t,$I=(t,i,o)=>GI({l:t,k:i,s:o}),GI=t=>JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/\u0027/g,"\\u0027"),Yr=t=>typeof t=="number"&&isFinite(t),qI=t=>jy(t)==="[object Date]",rm=t=>jy(t)==="[object RegExp]",Zm=t=>Ai(t)&&Object.keys(t).length===0;function ZI(t,i){typeof console!="undefined"&&(console.warn("[intlify] "+t),i&&console.warn(i.stack))}const wn=Object.assign;let ob;const Uy=()=>ob||(ob=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});function ab(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}const WI=Object.prototype.hasOwnProperty;function Ny(t,i){return WI.call(t,i)}const Nr=Array.isArray,Kr=t=>typeof t=="function",Ut=t=>typeof t=="string",Dr=t=>typeof t=="boolean",mr=t=>t!==null&&typeof t=="object",M2=Object.prototype.toString,jy=t=>M2.call(t),Ai=t=>jy(t)==="[object Object]",HI=t=>t==null?"":Nr(t)||Ai(t)&&t.toString===M2?JSON.stringify(t,null,2):String(t);/*!
  * message-compiler v9.2.0-beta.30
  * (c) 2022 kazuya kawaguchi
  * Released under the MIT License.
  */const k2={EXPECTED_TOKEN:1,INVALID_TOKEN_IN_PLACEHOLDER:2,UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER:3,UNKNOWN_ESCAPE_SEQUENCE:4,INVALID_UNICODE_ESCAPE_SEQUENCE:5,UNBALANCED_CLOSING_BRACE:6,UNTERMINATED_CLOSING_BRACE:7,EMPTY_PLACEHOLDER:8,NOT_ALLOW_NEST_PLACEHOLDER:9,INVALID_LINKED_FORMAT:10,MUST_HAVE_MESSAGES_IN_PLURAL:11,UNEXPECTED_EMPTY_LINKED_MODIFIER:12,UNEXPECTED_EMPTY_LINKED_KEY:13,UNEXPECTED_LEXICAL_ANALYSIS:14,__EXTEND_POINT__:15};function P2(t,i,o={}){const{domain:l,messages:u,args:d}=o,g=t,a=new SyntaxError(String(g));return a.code=t,i&&(a.location=i),a.domain=l,a}/*!
  * devtools-if v9.2.0-beta.30
  * (c) 2022 kazuya kawaguchi
  * Released under the MIT License.
  */const D2={I18nInit:"i18n:init",FunctionTranslate:"function:translate"};/*!
  * core-base v9.2.0-beta.30
  * (c) 2022 kazuya kawaguchi
  * Released under the MIT License.
  */const nl=[];nl[0]={w:[0],i:[3,0],["["]:[4],o:[7]};nl[1]={w:[1],["."]:[2],["["]:[4],o:[7]};nl[2]={w:[2],i:[3,0],["0"]:[3,0]};nl[3]={i:[3,0],["0"]:[3,0],w:[1,1],["."]:[2,1],["["]:[4,1],o:[7,1]};nl[4]={["'"]:[5,0],['"']:[6,0],["["]:[4,2],["]"]:[1,3],o:8,l:[4,0]};nl[5]={["'"]:[4,0],o:8,l:[5,0]};nl[6]={['"']:[4,0],o:8,l:[6,0]};const XI=/^\s?(?:true|false|-?[\d.]+|'[^']*'|"[^"]*")\s?$/;function KI(t){return XI.test(t)}function YI(t){const i=t.charCodeAt(0),o=t.charCodeAt(t.length-1);return i===o&&(i===34||i===39)?t.slice(1,-1):t}function QI(t){if(t==null)return"o";switch(t.charCodeAt(0)){case 91:case 93:case 46:case 34:case 39:return t;case 95:case 36:case 45:return"i";case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"w"}return"i"}function JI(t){const i=t.trim();return t.charAt(0)==="0"&&isNaN(parseInt(t))?!1:KI(i)?YI(i):"*"+i}function eM(t){const i=[];let o=-1,l=0,u=0,d,g,a,w,S,C,k;const F=[];F[0]=()=>{g===void 0?g=a:g+=a},F[1]=()=>{g!==void 0&&(i.push(g),g=void 0)},F[2]=()=>{F[0](),u++},F[3]=()=>{if(u>0)u--,l=4,F[0]();else{if(u=0,g===void 0||(g=JI(g),g===!1))return!1;F[1]()}};function R(){const W=t[o+1];if(l===5&&W==="'"||l===6&&W==='"')return o++,a="\\"+W,F[0](),!0}for(;l!==null;)if(o++,d=t[o],!(d==="\\"&&R())){if(w=QI(d),k=nl[l],S=k[w]||k.l||8,S===8||(l=S[0],S[1]!==void 0&&(C=F[S[1]],C&&(a=d,C()===!1))))return;if(l===7)return i}}const lb=new Map;function tM(t,i){return mr(t)?t[i]:null}function iM(t,i){if(!mr(t))return null;let o=lb.get(i);if(o||(o=eM(i),o&&lb.set(i,o)),!o)return null;const l=o.length;let u=t,d=0;for(;d<l;){const g=u[o[d]];if(g===void 0)return null;u=g,d++}return u}const rM=t=>t,nM=t=>"",sM="text",oM=t=>t.length===0?"":t.join(""),aM=HI;function cb(t,i){return t=Math.abs(t),i===2?t?t>1?1:0:1:t?Math.min(t,2):0}function lM(t){const i=Yr(t.pluralIndex)?t.pluralIndex:-1;return t.named&&(Yr(t.named.count)||Yr(t.named.n))?Yr(t.named.count)?t.named.count:Yr(t.named.n)?t.named.n:i:i}function cM(t,i){i.count||(i.count=t),i.n||(i.n=t)}function uM(t={}){const i=t.locale,o=lM(t),l=mr(t.pluralRules)&&Ut(i)&&Kr(t.pluralRules[i])?t.pluralRules[i]:cb,u=mr(t.pluralRules)&&Ut(i)&&Kr(t.pluralRules[i])?cb:void 0,d=X=>X[l(o,X.length,u)],g=t.list||[],a=X=>g[X],w=t.named||{};Yr(t.pluralIndex)&&cM(o,w);const S=X=>w[X];function C(X){const q=Kr(t.messages)?t.messages(X):mr(t.messages)?t.messages[X]:!1;return q||(t.parent?t.parent.message(X):nM)}const k=X=>t.modifiers?t.modifiers[X]:rM,F=Ai(t.processor)&&Kr(t.processor.normalize)?t.processor.normalize:oM,R=Ai(t.processor)&&Kr(t.processor.interpolate)?t.processor.interpolate:aM,W=Ai(t.processor)&&Ut(t.processor.type)?t.processor.type:sM,Z={list:a,named:S,plural:d,linked:(X,q)=>{const ue=C(X)(Z);return Ut(q)?k(q)(ue):ue},message:C,type:W,interpolate:R,normalize:F};return Z}let Bf=null;function hM(t){Bf=t}function fM(t,i,o){Bf&&Bf.emit(D2.I18nInit,{timestamp:Date.now(),i18n:t,version:i,meta:o})}const dM=pM(D2.FunctionTranslate);function pM(t){return i=>Bf&&Bf.emit(t,i)}const mM={NOT_FOUND_KEY:1,FALLBACK_TO_TRANSLATE:2,CANNOT_FORMAT_NUMBER:3,FALLBACK_TO_NUMBER_FORMAT:4,CANNOT_FORMAT_DATE:5,FALLBACK_TO_DATE_FORMAT:6,__EXTEND_POINT__:7};function _M(t,i,o){return[...new Set([o,...Nr(i)?i:mr(i)?Object.keys(i):Ut(i)?[i]:[o]])]}function z2(t,i,o){const l=Ut(o)?o:Vy,u=t;u.__localeChainCache||(u.__localeChainCache=new Map);let d=u.__localeChainCache.get(l);if(!d){d=[];let g=[o];for(;Nr(g);)g=ub(d,g,i);const a=Nr(i)||!Ai(i)?i:i.default?i.default:null;g=Ut(a)?[a]:a,Nr(g)&&ub(d,g,!1),u.__localeChainCache.set(l,d)}return d}function ub(t,i,o){let l=!0;for(let u=0;u<i.length&&Dr(l);u++){const d=i[u];Ut(d)&&(l=gM(t,i[u],o))}return l}function gM(t,i,o){let l;const u=i.split("-");do{const d=u.join("-");l=yM(t,d,o),u.splice(-1,1)}while(u.length&&l===!0);return l}function yM(t,i,o){let l=!1;if(!t.includes(i)&&(l=!0,i)){l=i[i.length-1]!=="!";const u=i.replace(/!/g,"");t.push(u),(Nr(o)||Ai(o))&&o[u]&&(l=o[u])}return l}const xM="9.2.0-beta.30",Wm=-1,Vy="en-US",hb="";function vM(){return{upper:t=>Ut(t)?t.toUpperCase():t,lower:t=>Ut(t)?t.toLowerCase():t,capitalize:t=>Ut(t)?`${t.charAt(0).toLocaleUpperCase()}${t.substr(1)}`:t}}let bM,R2;function wM(t){R2=t}let F2;function TM(t){F2=t}let L2=null;const fb=t=>{L2=t},EM=()=>L2;let db=0;function SM(t={}){const i=Ut(t.version)?t.version:xM,o=Ut(t.locale)?t.locale:Vy,l=Nr(t.fallbackLocale)||Ai(t.fallbackLocale)||Ut(t.fallbackLocale)||t.fallbackLocale===!1?t.fallbackLocale:o,u=Ai(t.messages)?t.messages:{[o]:{}},d=Ai(t.datetimeFormats)?t.datetimeFormats:{[o]:{}},g=Ai(t.numberFormats)?t.numberFormats:{[o]:{}},a=wn({},t.modifiers||{},vM()),w=t.pluralRules||{},S=Kr(t.missing)?t.missing:null,C=Dr(t.missingWarn)||rm(t.missingWarn)?t.missingWarn:!0,k=Dr(t.fallbackWarn)||rm(t.fallbackWarn)?t.fallbackWarn:!0,F=!!t.fallbackFormat,R=!!t.unresolving,W=Kr(t.postTranslation)?t.postTranslation:null,Z=Ai(t.processor)?t.processor:null,X=Dr(t.warnHtmlMessage)?t.warnHtmlMessage:!0,q=!!t.escapeParameter,ue=Kr(t.messageCompiler)?t.messageCompiler:bM,pe=Kr(t.messageResolver)?t.messageResolver:R2||tM,xe=Kr(t.localeFallbacker)?t.localeFallbacker:F2||_M,fe=Kr(t.onWarn)?t.onWarn:ZI,Te=t,Ie=mr(Te.__datetimeFormatters)?Te.__datetimeFormatters:new Map,Le=mr(Te.__numberFormatters)?Te.__numberFormatters:new Map,Pe=mr(Te.__meta)?Te.__meta:{};db++;const qe={version:i,cid:db,locale:o,fallbackLocale:l,messages:u,modifiers:a,pluralRules:w,missing:S,missingWarn:C,fallbackWarn:k,fallbackFormat:F,unresolving:R,postTranslation:W,processor:Z,warnHtmlMessage:X,escapeParameter:q,messageCompiler:ue,messageResolver:pe,localeFallbacker:xe,onWarn:fe,__meta:Pe};return qe.datetimeFormats=d,qe.numberFormats=g,qe.__datetimeFormatters=Ie,qe.__numberFormatters=Le,__INTLIFY_PROD_DEVTOOLS__&&fM(qe,i,Pe),qe}function $y(t,i,o,l,u){const{missing:d,onWarn:g}=t;if(d!==null){const a=d(t,o,i,u);return Ut(a)?a:i}else return i}function af(t,i,o){const l=t;l.__localeChainCache=new Map,t.localeFallbacker(t,o,i)}let O2=k2.__EXTEND_POINT__;const Vg=()=>++O2,Su={INVALID_ARGUMENT:O2,INVALID_DATE_ARGUMENT:Vg(),INVALID_ISO_DATE_ARGUMENT:Vg(),__EXTEND_POINT__:Vg()};function Au(t){return P2(t,null,void 0)}const pb=()=>"",vo=t=>Kr(t);function mb(t,...i){const{fallbackFormat:o,postTranslation:l,unresolving:u,messageCompiler:d,fallbackLocale:g,messages:a}=t,[w,S]=b0(...i),C=Dr(S.missingWarn)?S.missingWarn:t.missingWarn,k=Dr(S.fallbackWarn)?S.fallbackWarn:t.fallbackWarn,F=Dr(S.escapeParameter)?S.escapeParameter:t.escapeParameter,R=!!S.resolvedMessage,W=Ut(S.default)||Dr(S.default)?Dr(S.default)?w:S.default:o?d?w:()=>w:"",Z=o||W!=="",X=Ut(S.locale)?S.locale:t.locale;F&&AM(S);let[q,ue,pe]=R?[w,X,a[X]||{}]:CM(t,w,X,g,k,C),xe=q,fe=w;if(!R&&!(Ut(xe)||vo(xe))&&Z&&(xe=W,fe=xe),!R&&(!(Ut(xe)||vo(xe))||!Ut(ue)))return u?Wm:w;let Te=!1;const Ie=()=>{Te=!0},Le=vo(xe)?xe:B2(t,w,ue,xe,fe,Ie);if(Te)return xe;const Pe=kM(t,ue,pe,S),qe=uM(Pe),ze=IM(t,Le,qe),lt=l?l(ze):ze;if(__INTLIFY_PROD_DEVTOOLS__){const ct={timestamp:Date.now(),key:Ut(w)?w:vo(xe)?xe.key:"",locale:ue||(vo(xe)?xe.locale:""),format:Ut(xe)?xe:vo(xe)?xe.source:"",message:lt};ct.meta=wn({},t.__meta,EM()||{}),dM(ct)}return lt}function AM(t){Nr(t.list)?t.list=t.list.map(i=>Ut(i)?ab(i):i):mr(t.named)&&Object.keys(t.named).forEach(i=>{Ut(t.named[i])&&(t.named[i]=ab(t.named[i]))})}function CM(t,i,o,l,u,d){const{messages:g,onWarn:a,messageResolver:w,localeFallbacker:S}=t,C=S(t,l,o);let k={},F,R=null;const W="translate";for(let Z=0;Z<C.length&&(F=C[Z],k=g[F]||{},(R=w(k,i))===null&&(R=k[i]),!(Ut(R)||Kr(R)));Z++){const X=$y(t,i,F,d,W);X!==i&&(R=X)}return[R,F,k]}function B2(t,i,o,l,u,d){const{messageCompiler:g,warnHtmlMessage:a}=t;if(vo(l)){const S=l;return S.locale=S.locale||o,S.key=S.key||i,S}const w=g(l,MM(t,o,u,l,a,d));return w.locale=o,w.key=i,w.source=l,w}function IM(t,i,o){return i(o)}function b0(...t){const[i,o,l]=t,u={};if(!Ut(i)&&!Yr(i)&&!vo(i))throw Au(Su.INVALID_ARGUMENT);const d=Yr(i)?String(i):(vo(i),i);return Yr(o)?u.plural=o:Ut(o)?u.default=o:Ai(o)&&!Zm(o)?u.named=o:Nr(o)&&(u.list=o),Yr(l)?u.plural=l:Ut(l)?u.default=l:Ai(l)&&wn(u,l),[d,u]}function MM(t,i,o,l,u,d){return{warnHtmlMessage:u,onError:g=>{throw d&&d(g),g},onCacheKey:g=>$I(i,o,g)}}function kM(t,i,o,l){const{modifiers:u,pluralRules:d,messageResolver:g}=t,w={locale:i,modifiers:u,pluralRules:d,messages:S=>{const C=g(o,S);if(Ut(C)){let k=!1;const R=B2(t,S,i,C,S,()=>{k=!0});return k?pb:R}else return vo(C)?C:pb}};return t.processor&&(w.processor=t.processor),l.list&&(w.list=l.list),l.named&&(w.named=l.named),Yr(l.plural)&&(w.pluralIndex=l.plural),w}function _b(t,...i){const{datetimeFormats:o,unresolving:l,fallbackLocale:u,onWarn:d,localeFallbacker:g}=t,{__datetimeFormatters:a}=t,[w,S,C,k]=w0(...i),F=Dr(C.missingWarn)?C.missingWarn:t.missingWarn;Dr(C.fallbackWarn)?C.fallbackWarn:t.fallbackWarn;const R=!!C.part,W=Ut(C.locale)?C.locale:t.locale,Z=g(t,u,W);if(!Ut(w)||w==="")return new Intl.DateTimeFormat(W).format(S);let X={},q,ue=null;const pe="datetime format";for(let Te=0;Te<Z.length&&(q=Z[Te],X=o[q]||{},ue=X[w],!Ai(ue));Te++)$y(t,w,q,F,pe);if(!Ai(ue)||!Ut(q))return l?Wm:w;let xe=`${q}__${w}`;Zm(k)||(xe=`${xe}__${JSON.stringify(k)}`);let fe=a.get(xe);return fe||(fe=new Intl.DateTimeFormat(q,wn({},ue,k)),a.set(xe,fe)),R?fe.formatToParts(S):fe.format(S)}function w0(...t){const[i,o,l,u]=t;let d={},g={},a;if(Ut(i)){const w=i.match(/(\d{4}-\d{2}-\d{2})(T|\s)?(.*)/);if(!w)throw Au(Su.INVALID_ISO_DATE_ARGUMENT);const S=w[3]?w[3].trim().startsWith("T")?`${w[1].trim()}${w[3].trim()}`:`${w[1].trim()}T${w[3].trim()}`:w[1].trim();a=new Date(S);try{a.toISOString()}catch{throw Au(Su.INVALID_ISO_DATE_ARGUMENT)}}else if(qI(i)){if(isNaN(i.getTime()))throw Au(Su.INVALID_DATE_ARGUMENT);a=i}else if(Yr(i))a=i;else throw Au(Su.INVALID_ARGUMENT);return Ut(o)?d.key=o:Ai(o)&&(d=o),Ut(l)?d.locale=l:Ai(l)&&(g=l),Ai(u)&&(g=u),[d.key||"",a,d,g]}function gb(t,i,o){const l=t;for(const u in o){const d=`${i}__${u}`;!l.__datetimeFormatters.has(d)||l.__datetimeFormatters.delete(d)}}function yb(t,...i){const{numberFormats:o,unresolving:l,fallbackLocale:u,onWarn:d,localeFallbacker:g}=t,{__numberFormatters:a}=t,[w,S,C,k]=T0(...i),F=Dr(C.missingWarn)?C.missingWarn:t.missingWarn;Dr(C.fallbackWarn)?C.fallbackWarn:t.fallbackWarn;const R=!!C.part,W=Ut(C.locale)?C.locale:t.locale,Z=g(t,u,W);if(!Ut(w)||w==="")return new Intl.NumberFormat(W).format(S);let X={},q,ue=null;const pe="number format";for(let Te=0;Te<Z.length&&(q=Z[Te],X=o[q]||{},ue=X[w],!Ai(ue));Te++)$y(t,w,q,F,pe);if(!Ai(ue)||!Ut(q))return l?Wm:w;let xe=`${q}__${w}`;Zm(k)||(xe=`${xe}__${JSON.stringify(k)}`);let fe=a.get(xe);return fe||(fe=new Intl.NumberFormat(q,wn({},ue,k)),a.set(xe,fe)),R?fe.formatToParts(S):fe.format(S)}function T0(...t){const[i,o,l,u]=t;let d={},g={};if(!Yr(i))throw Au(Su.INVALID_ARGUMENT);const a=i;return Ut(o)?d.key=o:Ai(o)&&(d=o),Ut(l)?d.locale=l:Ai(l)&&(g=l),Ai(u)&&(g=u),[d.key||"",a,d,g]}function xb(t,i,o){const l=t;for(const u in o){const d=`${i}__${u}`;!l.__numberFormatters.has(d)||l.__numberFormatters.delete(d)}}typeof __INTLIFY_PROD_DEVTOOLS__!="boolean"&&(Uy().__INTLIFY_PROD_DEVTOOLS__=!1);function Gy(t,i){const o=Object.create(null),l=t.split(",");for(let u=0;u<l.length;u++)o[l[u]]=!0;return i?u=>!!o[u.toLowerCase()]:u=>!!o[u]}const PM="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",DM=Gy(PM);function U2(t){return!!t||t===""}function qy(t){if(ei(t)){const i={};for(let o=0;o<t.length;o++){const l=t[o],u=zr(l)?FM(l):qy(l);if(u)for(const d in u)i[d]=u[d]}return i}else{if(zr(t))return t;if(Rr(t))return t}}const zM=/;(?![^(]*\))/g,RM=/:(.+)/;function FM(t){const i={};return t.split(zM).forEach(o=>{if(o){const l=o.split(RM);l.length>1&&(i[l[0].trim()]=l[1].trim())}}),i}function Zy(t){let i="";if(zr(t))i=t;else if(ei(t))for(let o=0;o<t.length;o++){const l=Zy(t[o]);l&&(i+=l+" ")}else if(Rr(t))for(const o in t)t[o]&&(i+=o+" ");return i.trim()}const Y4=t=>zr(t)?t:t==null?"":ei(t)||Rr(t)&&(t.toString===$2||!ai(t.toString))?JSON.stringify(t,N2,2):String(t),N2=(t,i)=>i&&i.__v_isRef?N2(t,i.value):Du(i)?{[`Map(${i.size})`]:[...i.entries()].reduce((o,[l,u])=>(o[`${l} =>`]=u,o),{})}:j2(i)?{[`Set(${i.size})`]:[...i.values()]}:Rr(i)&&!ei(i)&&!G2(i)?String(i):i,Hi={},Pu=[],Xs=()=>{},LM=()=>!1,OM=/^on[^a-z]/,td=t=>OM.test(t),Wy=t=>t.startsWith("onUpdate:"),un=Object.assign,Hy=(t,i)=>{const o=t.indexOf(i);o>-1&&t.splice(o,1)},BM=Object.prototype.hasOwnProperty,Mi=(t,i)=>BM.call(t,i),ei=Array.isArray,Du=t=>Hm(t)==="[object Map]",j2=t=>Hm(t)==="[object Set]",ai=t=>typeof t=="function",zr=t=>typeof t=="string",Xy=t=>typeof t=="symbol",Rr=t=>t!==null&&typeof t=="object",V2=t=>Rr(t)&&ai(t.then)&&ai(t.catch),$2=Object.prototype.toString,Hm=t=>$2.call(t),UM=t=>Hm(t).slice(8,-1),G2=t=>Hm(t)==="[object Object]",Ky=t=>zr(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Sf=Gy(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Xm=t=>{const i=Object.create(null);return o=>i[o]||(i[o]=t(o))},NM=/-(\w)/g,Io=Xm(t=>t.replace(NM,(i,o)=>o?o.toUpperCase():"")),jM=/\B([A-Z])/g,th=Xm(t=>t.replace(jM,"-$1").toLowerCase()),Km=Xm(t=>t.charAt(0).toUpperCase()+t.slice(1)),$g=Xm(t=>t?`on${Km(t)}`:""),Uf=(t,i)=>!Object.is(t,i),Gg=(t,i)=>{for(let o=0;o<t.length;o++)t[o](i)},nm=(t,i,o)=>{Object.defineProperty(t,i,{configurable:!0,enumerable:!1,value:o})},VM=t=>{const i=parseFloat(t);return isNaN(i)?t:i};let vb;const $M=()=>vb||(vb=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let Ts;class GM{constructor(i=!1){this.active=!0,this.effects=[],this.cleanups=[],!i&&Ts&&(this.parent=Ts,this.index=(Ts.scopes||(Ts.scopes=[])).push(this)-1)}run(i){if(this.active)try{return Ts=this,i()}finally{Ts=this.parent}}on(){Ts=this}off(){Ts=this.parent}stop(i){if(this.active){let o,l;for(o=0,l=this.effects.length;o<l;o++)this.effects[o].stop();for(o=0,l=this.cleanups.length;o<l;o++)this.cleanups[o]();if(this.scopes)for(o=0,l=this.scopes.length;o<l;o++)this.scopes[o].stop(!0);if(this.parent&&!i){const u=this.parent.scopes.pop();u&&u!==this&&(this.parent.scopes[this.index]=u,u.index=this.index)}this.active=!1}}}function qM(t,i=Ts){i&&i.active&&i.effects.push(t)}function ZM(){return Ts}function WM(t){Ts&&Ts.cleanups.push(t)}const Yy=t=>{const i=new Set(t);return i.w=0,i.n=0,i},q2=t=>(t.w&Ja)>0,Z2=t=>(t.n&Ja)>0,HM=({deps:t})=>{if(t.length)for(let i=0;i<t.length;i++)t[i].w|=Ja},XM=t=>{const{deps:i}=t;if(i.length){let o=0;for(let l=0;l<i.length;l++){const u=i[l];q2(u)&&!Z2(u)?u.delete(t):i[o++]=u,u.w&=~Ja,u.n&=~Ja}i.length=o}},E0=new WeakMap;let pf=0,Ja=1;const S0=30;let So;const rc=Symbol(""),A0=Symbol("");class Qy{constructor(i,o=null,l){this.fn=i,this.scheduler=o,this.active=!0,this.deps=[],this.parent=void 0,qM(this,l)}run(){if(!this.active)return this.fn();let i=So,o=Ha;for(;i;){if(i===this)return;i=i.parent}try{return this.parent=So,So=this,Ha=!0,Ja=1<<++pf,pf<=S0?HM(this):bb(this),this.fn()}finally{pf<=S0&&XM(this),Ja=1<<--pf,So=this.parent,Ha=o,this.parent=void 0}}stop(){this.active&&(bb(this),this.onStop&&this.onStop(),this.active=!1)}}function bb(t){const{deps:i}=t;if(i.length){for(let o=0;o<i.length;o++)i[o].delete(t);i.length=0}}let Ha=!0;const W2=[];function ih(){W2.push(Ha),Ha=!1}function rh(){const t=W2.pop();Ha=t===void 0?!0:t}function ss(t,i,o){if(Ha&&So){let l=E0.get(t);l||E0.set(t,l=new Map);let u=l.get(o);u||l.set(o,u=Yy()),H2(u)}}function H2(t,i){let o=!1;pf<=S0?Z2(t)||(t.n|=Ja,o=!q2(t)):o=!t.has(So),o&&(t.add(So),So.deps.push(t))}function Ko(t,i,o,l,u,d){const g=E0.get(t);if(!g)return;let a=[];if(i==="clear")a=[...g.values()];else if(o==="length"&&ei(t))g.forEach((w,S)=>{(S==="length"||S>=l)&&a.push(w)});else switch(o!==void 0&&a.push(g.get(o)),i){case"add":ei(t)?Ky(o)&&a.push(g.get("length")):(a.push(g.get(rc)),Du(t)&&a.push(g.get(A0)));break;case"delete":ei(t)||(a.push(g.get(rc)),Du(t)&&a.push(g.get(A0)));break;case"set":Du(t)&&a.push(g.get(rc));break}if(a.length===1)a[0]&&C0(a[0]);else{const w=[];for(const S of a)S&&w.push(...S);C0(Yy(w))}}function C0(t,i){for(const o of ei(t)?t:[...t])(o!==So||o.allowRecurse)&&(o.scheduler?o.scheduler():o.run())}const KM=Gy("__proto__,__v_isRef,__isVue"),X2=new Set(Object.getOwnPropertyNames(Symbol).map(t=>Symbol[t]).filter(Xy)),YM=Jy(),QM=Jy(!1,!0),JM=Jy(!0),wb=ek();function ek(){const t={};return["includes","indexOf","lastIndexOf"].forEach(i=>{t[i]=function(...o){const l=Fi(this);for(let d=0,g=this.length;d<g;d++)ss(l,"get",d+"");const u=l[i](...o);return u===-1||u===!1?l[i](...o.map(Fi)):u}}),["push","pop","shift","unshift","splice"].forEach(i=>{t[i]=function(...o){ih();const l=Fi(this)[i].apply(this,o);return rh(),l}}),t}function Jy(t=!1,i=!1){return function(l,u,d){if(u==="__v_isReactive")return!t;if(u==="__v_isReadonly")return t;if(u==="__v_isShallow")return i;if(u==="__v_raw"&&d===(t?i?_k:eT:i?J2:Q2).get(l))return l;const g=ei(l);if(!t&&g&&Mi(wb,u))return Reflect.get(wb,u,d);const a=Reflect.get(l,u,d);return(Xy(u)?X2.has(u):KM(u))||(t||ss(l,"get",u),i)?a:Ar(a)?!g||!Ky(u)?a.value:a:Rr(a)?t?ix(a):nh(a):a}}const tk=K2(),ik=K2(!0);function K2(t=!1){return function(o,l,u,d){let g=o[l];if(Nf(g)&&Ar(g)&&!Ar(u))return!1;if(!t&&!Nf(u)&&(tT(u)||(u=Fi(u),g=Fi(g)),!ei(o)&&Ar(g)&&!Ar(u)))return g.value=u,!0;const a=ei(o)&&Ky(l)?Number(l)<o.length:Mi(o,l),w=Reflect.set(o,l,u,d);return o===Fi(d)&&(a?Uf(u,g)&&Ko(o,"set",l,u):Ko(o,"add",l,u)),w}}function rk(t,i){const o=Mi(t,i);t[i];const l=Reflect.deleteProperty(t,i);return l&&o&&Ko(t,"delete",i,void 0),l}function nk(t,i){const o=Reflect.has(t,i);return(!Xy(i)||!X2.has(i))&&ss(t,"has",i),o}function sk(t){return ss(t,"iterate",ei(t)?"length":rc),Reflect.ownKeys(t)}const Y2={get:YM,set:tk,deleteProperty:rk,has:nk,ownKeys:sk},ok={get:JM,set(t,i){return!0},deleteProperty(t,i){return!0}},ak=un({},Y2,{get:QM,set:ik}),ex=t=>t,Ym=t=>Reflect.getPrototypeOf(t);function Lp(t,i,o=!1,l=!1){t=t.__v_raw;const u=Fi(t),d=Fi(i);i!==d&&!o&&ss(u,"get",i),!o&&ss(u,"get",d);const{has:g}=Ym(u),a=l?ex:o?nx:jf;if(g.call(u,i))return a(t.get(i));if(g.call(u,d))return a(t.get(d));t!==u&&t.get(i)}function Op(t,i=!1){const o=this.__v_raw,l=Fi(o),u=Fi(t);return t!==u&&!i&&ss(l,"has",t),!i&&ss(l,"has",u),t===u?o.has(t):o.has(t)||o.has(u)}function Bp(t,i=!1){return t=t.__v_raw,!i&&ss(Fi(t),"iterate",rc),Reflect.get(t,"size",t)}function Tb(t){t=Fi(t);const i=Fi(this);return Ym(i).has.call(i,t)||(i.add(t),Ko(i,"add",t,t)),this}function Eb(t,i){i=Fi(i);const o=Fi(this),{has:l,get:u}=Ym(o);let d=l.call(o,t);d||(t=Fi(t),d=l.call(o,t));const g=u.call(o,t);return o.set(t,i),d?Uf(i,g)&&Ko(o,"set",t,i):Ko(o,"add",t,i),this}function Sb(t){const i=Fi(this),{has:o,get:l}=Ym(i);let u=o.call(i,t);u||(t=Fi(t),u=o.call(i,t)),l&&l.call(i,t);const d=i.delete(t);return u&&Ko(i,"delete",t,void 0),d}function Ab(){const t=Fi(this),i=t.size!==0,o=t.clear();return i&&Ko(t,"clear",void 0,void 0),o}function Up(t,i){return function(l,u){const d=this,g=d.__v_raw,a=Fi(g),w=i?ex:t?nx:jf;return!t&&ss(a,"iterate",rc),g.forEach((S,C)=>l.call(u,w(S),w(C),d))}}function Np(t,i,o){return function(...l){const u=this.__v_raw,d=Fi(u),g=Du(d),a=t==="entries"||t===Symbol.iterator&&g,w=t==="keys"&&g,S=u[t](...l),C=o?ex:i?nx:jf;return!i&&ss(d,"iterate",w?A0:rc),{next(){const{value:k,done:F}=S.next();return F?{value:k,done:F}:{value:a?[C(k[0]),C(k[1])]:C(k),done:F}},[Symbol.iterator](){return this}}}}function Pa(t){return function(...i){return t==="delete"?!1:this}}function lk(){const t={get(d){return Lp(this,d)},get size(){return Bp(this)},has:Op,add:Tb,set:Eb,delete:Sb,clear:Ab,forEach:Up(!1,!1)},i={get(d){return Lp(this,d,!1,!0)},get size(){return Bp(this)},has:Op,add:Tb,set:Eb,delete:Sb,clear:Ab,forEach:Up(!1,!0)},o={get(d){return Lp(this,d,!0)},get size(){return Bp(this,!0)},has(d){return Op.call(this,d,!0)},add:Pa("add"),set:Pa("set"),delete:Pa("delete"),clear:Pa("clear"),forEach:Up(!0,!1)},l={get(d){return Lp(this,d,!0,!0)},get size(){return Bp(this,!0)},has(d){return Op.call(this,d,!0)},add:Pa("add"),set:Pa("set"),delete:Pa("delete"),clear:Pa("clear"),forEach:Up(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(d=>{t[d]=Np(d,!1,!1),o[d]=Np(d,!0,!1),i[d]=Np(d,!1,!0),l[d]=Np(d,!0,!0)}),[t,o,i,l]}const[ck,uk,hk,fk]=lk();function tx(t,i){const o=i?t?fk:hk:t?uk:ck;return(l,u,d)=>u==="__v_isReactive"?!t:u==="__v_isReadonly"?t:u==="__v_raw"?l:Reflect.get(Mi(o,u)&&u in l?o:l,u,d)}const dk={get:tx(!1,!1)},pk={get:tx(!1,!0)},mk={get:tx(!0,!1)},Q2=new WeakMap,J2=new WeakMap,eT=new WeakMap,_k=new WeakMap;function gk(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function yk(t){return t.__v_skip||!Object.isExtensible(t)?0:gk(UM(t))}function nh(t){return Nf(t)?t:rx(t,!1,Y2,dk,Q2)}function xk(t){return rx(t,!1,ak,pk,J2)}function ix(t){return rx(t,!0,ok,mk,eT)}function rx(t,i,o,l,u){if(!Rr(t)||t.__v_raw&&!(i&&t.__v_isReactive))return t;const d=u.get(t);if(d)return d;const g=yk(t);if(g===0)return t;const a=new Proxy(t,g===2?l:o);return u.set(t,a),a}function zu(t){return Nf(t)?zu(t.__v_raw):!!(t&&t.__v_isReactive)}function Nf(t){return!!(t&&t.__v_isReadonly)}function tT(t){return!!(t&&t.__v_isShallow)}function iT(t){return zu(t)||Nf(t)}function Fi(t){const i=t&&t.__v_raw;return i?Fi(i):t}function rT(t){return nm(t,"__v_skip",!0),t}const jf=t=>Rr(t)?nh(t):t,nx=t=>Rr(t)?ix(t):t;function nT(t){Ha&&So&&(t=Fi(t),H2(t.dep||(t.dep=Yy())))}function sT(t,i){t=Fi(t),t.dep&&C0(t.dep)}function Ar(t){return!!(t&&t.__v_isRef===!0)}function Pr(t){return oT(t,!1)}function vk(t){return oT(t,!0)}function oT(t,i){return Ar(t)?t:new bk(t,i)}class bk{constructor(i,o){this.__v_isShallow=o,this.dep=void 0,this.__v_isRef=!0,this._rawValue=o?i:Fi(i),this._value=o?i:jf(i)}get value(){return nT(this),this._value}set value(i){i=this.__v_isShallow?i:Fi(i),Uf(i,this._rawValue)&&(this._rawValue=i,this._value=this.__v_isShallow?i:jf(i),sT(this))}}function Xa(t){return Ar(t)?t.value:t}const wk={get:(t,i,o)=>Xa(Reflect.get(t,i,o)),set:(t,i,o,l)=>{const u=t[i];return Ar(u)&&!Ar(o)?(u.value=o,!0):Reflect.set(t,i,o,l)}};function aT(t){return zu(t)?t:new Proxy(t,wk)}function Tk(t){const i=ei(t)?new Array(t.length):{};for(const o in t)i[o]=Sk(t,o);return i}class Ek{constructor(i,o,l){this._object=i,this._key=o,this._defaultValue=l,this.__v_isRef=!0}get value(){const i=this._object[this._key];return i===void 0?this._defaultValue:i}set value(i){this._object[this._key]=i}}function Sk(t,i,o){const l=t[i];return Ar(l)?l:new Ek(t,i,o)}class Ak{constructor(i,o,l,u){this._setter=o,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new Qy(i,()=>{this._dirty||(this._dirty=!0,sT(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!u,this.__v_isReadonly=l}get value(){const i=Fi(this);return nT(i),(i._dirty||!i._cacheable)&&(i._dirty=!1,i._value=i.effect.run()),i._value}set value(i){this._setter(i)}}function Ck(t,i,o=!1){let l,u;const d=ai(t);return d?(l=t,u=Xs):(l=t.get,u=t.set),new Ak(l,u,d||!u,o)}Promise.resolve();function Ka(t,i,o,l){let u;try{u=l?t(...l):t()}catch(d){Qm(d,i,o)}return u}function Is(t,i,o,l){if(ai(t)){const d=Ka(t,i,o,l);return d&&V2(d)&&d.catch(g=>{Qm(g,i,o)}),d}const u=[];for(let d=0;d<t.length;d++)u.push(Is(t[d],i,o,l));return u}function Qm(t,i,o,l=!0){const u=i?i.vnode:null;if(i){let d=i.parent;const g=i.proxy,a=o;for(;d;){const S=d.ec;if(S){for(let C=0;C<S.length;C++)if(S[C](t,g,a)===!1)return}d=d.parent}const w=i.appContext.config.errorHandler;if(w){Ka(w,null,10,[t,g,a]);return}}Ik(t,o,u,l)}function Ik(t,i,o,l=!0){console.error(t)}let sm=!1,I0=!1;const Jn=[];let Wo=0;const Af=[];let mf=null,bu=0;const Cf=[];let Oa=null,wu=0;const lT=Promise.resolve();let sx=null,M0=null;function ox(t){const i=sx||lT;return t?i.then(this?t.bind(this):t):i}function Mk(t){let i=Wo+1,o=Jn.length;for(;i<o;){const l=i+o>>>1;Vf(Jn[l])<t?i=l+1:o=l}return i}function cT(t){(!Jn.length||!Jn.includes(t,sm&&t.allowRecurse?Wo+1:Wo))&&t!==M0&&(t.id==null?Jn.push(t):Jn.splice(Mk(t.id),0,t),uT())}function uT(){!sm&&!I0&&(I0=!0,sx=lT.then(fT))}function kk(t){const i=Jn.indexOf(t);i>Wo&&Jn.splice(i,1)}function hT(t,i,o,l){ei(t)?o.push(...t):(!i||!i.includes(t,t.allowRecurse?l+1:l))&&o.push(t),uT()}function Pk(t){hT(t,mf,Af,bu)}function Dk(t){hT(t,Oa,Cf,wu)}function ax(t,i=null){if(Af.length){for(M0=i,mf=[...new Set(Af)],Af.length=0,bu=0;bu<mf.length;bu++)mf[bu]();mf=null,bu=0,M0=null,ax(t,i)}}function om(t){if(Cf.length){const i=[...new Set(Cf)];if(Cf.length=0,Oa){Oa.push(...i);return}for(Oa=i,Oa.sort((o,l)=>Vf(o)-Vf(l)),wu=0;wu<Oa.length;wu++)Oa[wu]();Oa=null,wu=0}}const Vf=t=>t.id==null?1/0:t.id;function fT(t){I0=!1,sm=!0,ax(t),Jn.sort((o,l)=>Vf(o)-Vf(l));const i=Xs;try{for(Wo=0;Wo<Jn.length;Wo++){const o=Jn[Wo];o&&o.active!==!1&&Ka(o,null,14)}}finally{Wo=0,Jn.length=0,om(),sm=!1,sx=null,(Jn.length||Af.length||Cf.length)&&fT(t)}}function zk(t,i,...o){const l=t.vnode.props||Hi;let u=o;const d=i.startsWith("update:"),g=d&&i.slice(7);if(g&&g in l){const C=`${g==="modelValue"?"model":g}Modifiers`,{number:k,trim:F}=l[C]||Hi;F?u=o.map(R=>R.trim()):k&&(u=o.map(VM))}let a,w=l[a=$g(i)]||l[a=$g(Io(i))];!w&&d&&(w=l[a=$g(th(i))]),w&&Is(w,t,6,u);const S=l[a+"Once"];if(S){if(!t.emitted)t.emitted={};else if(t.emitted[a])return;t.emitted[a]=!0,Is(S,t,6,u)}}function dT(t,i,o=!1){const l=i.emitsCache,u=l.get(t);if(u!==void 0)return u;const d=t.emits;let g={},a=!1;if(!ai(t)){const w=S=>{const C=dT(S,i,!0);C&&(a=!0,un(g,C))};!o&&i.mixins.length&&i.mixins.forEach(w),t.extends&&w(t.extends),t.mixins&&t.mixins.forEach(w)}return!d&&!a?(l.set(t,null),null):(ei(d)?d.forEach(w=>g[w]=null):un(g,d),l.set(t,g),g)}function lx(t,i){return!t||!td(i)?!1:(i=i.slice(2).replace(/Once$/,""),Mi(t,i[0].toLowerCase()+i.slice(1))||Mi(t,th(i))||Mi(t,i))}let es=null,Jm=null;function am(t){const i=es;return es=t,Jm=t&&t.type.__scopeId||null,i}function Q4(t){Jm=t}function J4(){Jm=null}const e6=t=>pT;function pT(t,i=es,o){if(!i||t._n)return t;const l=(...u)=>{l._d&&Ob(-1);const d=am(i),g=t(...u);return am(d),l._d&&Ob(1),g};return l._n=!0,l._c=!0,l._d=!0,l}function qg(t){const{type:i,vnode:o,proxy:l,withProxy:u,props:d,propsOptions:[g],slots:a,attrs:w,emit:S,render:C,renderCache:k,data:F,setupState:R,ctx:W,inheritAttrs:Z}=t;let X,q;const ue=am(t);try{if(o.shapeFlag&4){const xe=u||l;X=qs(C.call(xe,xe,k,d,R,F,W)),q=w}else{const xe=i;X=qs(xe.length>1?xe(d,{attrs:w,slots:a,emit:S}):xe(d,null)),q=i.props?w:Rk(w)}}catch(xe){If.length=0,Qm(xe,t,1),X=Jr(ks)}let pe=X;if(q&&Z!==!1){const xe=Object.keys(q),{shapeFlag:fe}=pe;xe.length&&fe&7&&(g&&xe.some(Wy)&&(q=Fk(q,g)),pe=Uu(pe,q))}return o.dirs&&(pe.dirs=pe.dirs?pe.dirs.concat(o.dirs):o.dirs),o.transition&&(pe.transition=o.transition),X=pe,am(ue),X}const Rk=t=>{let i;for(const o in t)(o==="class"||o==="style"||td(o))&&((i||(i={}))[o]=t[o]);return i},Fk=(t,i)=>{const o={};for(const l in t)(!Wy(l)||!(l.slice(9)in i))&&(o[l]=t[l]);return o};function Lk(t,i,o){const{props:l,children:u,component:d}=t,{props:g,children:a,patchFlag:w}=i,S=d.emitsOptions;if(i.dirs||i.transition)return!0;if(o&&w>=0){if(w&1024)return!0;if(w&16)return l?Cb(l,g,S):!!g;if(w&8){const C=i.dynamicProps;for(let k=0;k<C.length;k++){const F=C[k];if(g[F]!==l[F]&&!lx(S,F))return!0}}}else return(u||a)&&(!a||!a.$stable)?!0:l===g?!1:l?g?Cb(l,g,S):!0:!!g;return!1}function Cb(t,i,o){const l=Object.keys(i);if(l.length!==Object.keys(t).length)return!0;for(let u=0;u<l.length;u++){const d=l[u];if(i[d]!==t[d]&&!lx(o,d))return!0}return!1}function Ok({vnode:t,parent:i},o){for(;i&&i.subTree===t;)(t=i.vnode).el=o,i=i.parent}const Bk=t=>t.__isSuspense;function mT(t,i){i&&i.pendingBranch?ei(t)?i.effects.push(...t):i.effects.push(t):Dk(t)}function Hp(t,i){if(Ur){let o=Ur.provides;const l=Ur.parent&&Ur.parent.provides;l===o&&(o=Ur.provides=Object.create(l)),o[t]=i}}function is(t,i,o=!1){const l=Ur||es;if(l){const u=l.parent==null?l.vnode.appContext&&l.vnode.appContext.provides:l.parent.provides;if(u&&t in u)return u[t];if(arguments.length>1)return o&&ai(i)?i.call(l.proxy):i}}function Uk(t,i){return cx(t,null,i)}const Ib={};function Ao(t,i,o){return cx(t,i,o)}function cx(t,i,{immediate:o,deep:l,flush:u,onTrack:d,onTrigger:g}=Hi){const a=Ur;let w,S=!1,C=!1;if(Ar(t)?(w=()=>t.value,S=tT(t)):zu(t)?(w=()=>t,l=!0):ei(t)?(C=!0,S=t.some(zu),w=()=>t.map(q=>{if(Ar(q))return q.value;if(zu(q))return ec(q);if(ai(q))return Ka(q,a,2)})):ai(t)?i?w=()=>Ka(t,a,2):w=()=>{if(!(a&&a.isUnmounted))return k&&k(),Is(t,a,3,[F])}:w=Xs,i&&l){const q=w;w=()=>ec(q())}let k,F=q=>{k=X.onStop=()=>{Ka(q,a,4)}};if($f)return F=Xs,i?o&&Is(i,a,3,[w(),C?[]:void 0,F]):w(),Xs;let R=C?[]:Ib;const W=()=>{if(!!X.active)if(i){const q=X.run();(l||S||(C?q.some((ue,pe)=>Uf(ue,R[pe])):Uf(q,R)))&&(k&&k(),Is(i,a,3,[q,R===Ib?void 0:R,F]),R=q)}else X.run()};W.allowRecurse=!!i;let Z;u==="sync"?Z=W:u==="post"?Z=()=>Ln(W,a&&a.suspense):Z=()=>{!a||a.isMounted?Pk(W):W()};const X=new Qy(w,Z);return i?o?W():R=X.run():u==="post"?Ln(X.run.bind(X),a&&a.suspense):X.run(),()=>{X.stop(),a&&a.scope&&Hy(a.scope.effects,X)}}function Nk(t,i,o){const l=this.proxy,u=zr(t)?t.includes(".")?_T(l,t):()=>l[t]:t.bind(l,l);let d;ai(i)?d=i:(d=i.handler,o=i);const g=Ur;Nu(this);const a=cx(u,d.bind(l),o);return g?Nu(g):sc(),a}function _T(t,i){const o=i.split(".");return()=>{let l=t;for(let u=0;u<o.length&&l;u++)l=l[o[u]];return l}}function ec(t,i){if(!Rr(t)||t.__v_skip||(i=i||new Set,i.has(t)))return t;if(i.add(t),Ar(t))ec(t.value,i);else if(ei(t))for(let o=0;o<t.length;o++)ec(t[o],i);else if(j2(t)||Du(t))t.forEach(o=>{ec(o,i)});else if(G2(t))for(const o in t)ec(t[o],i);return t}function jk(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return id(()=>{t.isMounted=!0}),ux(()=>{t.isUnmounting=!0}),t}const xs=[Function,Array],Vk={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:xs,onEnter:xs,onAfterEnter:xs,onEnterCancelled:xs,onBeforeLeave:xs,onLeave:xs,onAfterLeave:xs,onLeaveCancelled:xs,onBeforeAppear:xs,onAppear:xs,onAfterAppear:xs,onAppearCancelled:xs},setup(t,{slots:i}){const o=sh(),l=jk();let u;return()=>{const d=i.default&&yT(i.default(),!0);if(!d||!d.length)return;const g=Fi(t),{mode:a}=g,w=d[0];if(l.isLeaving)return Zg(w);const S=Mb(w);if(!S)return Zg(w);const C=k0(S,g,l,o);P0(S,C);const k=o.subTree,F=k&&Mb(k);let R=!1;const{getTransitionKey:W}=S.type;if(W){const Z=W();u===void 0?u=Z:Z!==u&&(u=Z,R=!0)}if(F&&F.type!==ks&&(!Yl(S,F)||R)){const Z=k0(F,g,l,o);if(P0(F,Z),a==="out-in")return l.isLeaving=!0,Z.afterLeave=()=>{l.isLeaving=!1,o.update()},Zg(w);a==="in-out"&&S.type!==ks&&(Z.delayLeave=(X,q,ue)=>{const pe=gT(l,F);pe[String(F.key)]=F,X._leaveCb=()=>{q(),X._leaveCb=void 0,delete C.delayedLeave},C.delayedLeave=ue})}return w}}},$k=Vk;function gT(t,i){const{leavingVNodes:o}=t;let l=o.get(i.type);return l||(l=Object.create(null),o.set(i.type,l)),l}function k0(t,i,o,l){const{appear:u,mode:d,persisted:g=!1,onBeforeEnter:a,onEnter:w,onAfterEnter:S,onEnterCancelled:C,onBeforeLeave:k,onLeave:F,onAfterLeave:R,onLeaveCancelled:W,onBeforeAppear:Z,onAppear:X,onAfterAppear:q,onAppearCancelled:ue}=i,pe=String(t.key),xe=gT(o,t),fe=(Ie,Le)=>{Ie&&Is(Ie,l,9,Le)},Te={mode:d,persisted:g,beforeEnter(Ie){let Le=a;if(!o.isMounted)if(u)Le=Z||a;else return;Ie._leaveCb&&Ie._leaveCb(!0);const Pe=xe[pe];Pe&&Yl(t,Pe)&&Pe.el._leaveCb&&Pe.el._leaveCb(),fe(Le,[Ie])},enter(Ie){let Le=w,Pe=S,qe=C;if(!o.isMounted)if(u)Le=X||w,Pe=q||S,qe=ue||C;else return;let ze=!1;const lt=Ie._enterCb=ct=>{ze||(ze=!0,ct?fe(qe,[Ie]):fe(Pe,[Ie]),Te.delayedLeave&&Te.delayedLeave(),Ie._enterCb=void 0)};Le?(Le(Ie,lt),Le.length<=1&&lt()):lt()},leave(Ie,Le){const Pe=String(t.key);if(Ie._enterCb&&Ie._enterCb(!0),o.isUnmounting)return Le();fe(k,[Ie]);let qe=!1;const ze=Ie._leaveCb=lt=>{qe||(qe=!0,Le(),lt?fe(W,[Ie]):fe(R,[Ie]),Ie._leaveCb=void 0,xe[Pe]===t&&delete xe[Pe])};xe[Pe]=t,F?(F(Ie,ze),F.length<=1&&ze()):ze()},clone(Ie){return k0(Ie,i,o,l)}};return Te}function Zg(t){if(t_(t))return t=Uu(t),t.children=null,t}function Mb(t){return t_(t)?t.children?t.children[0]:void 0:t}function P0(t,i){t.shapeFlag&6&&t.component?P0(t.component.subTree,i):t.shapeFlag&128?(t.ssContent.transition=i.clone(t.ssContent),t.ssFallback.transition=i.clone(t.ssFallback)):t.transition=i}function yT(t,i=!1){let o=[],l=0;for(let u=0;u<t.length;u++){const d=t[u];d.type===vn?(d.patchFlag&128&&l++,o=o.concat(yT(d.children,i))):(i||d.type!==ks)&&o.push(d)}if(l>1)for(let u=0;u<o.length;u++)o[u].patchFlag=-2;return o}function e_(t){return ai(t)?{setup:t,name:t.name}:t}const lm=t=>!!t.type.__asyncLoader,t_=t=>t.type.__isKeepAlive;function Gk(t,i){xT(t,"a",i)}function qk(t,i){xT(t,"da",i)}function xT(t,i,o=Ur){const l=t.__wdc||(t.__wdc=()=>{let u=o;for(;u;){if(u.isDeactivated)return;u=u.parent}return t()});if(i_(i,l,o),o){let u=o.parent;for(;u&&u.parent;)t_(u.parent.vnode)&&Zk(l,i,o,u),u=u.parent}}function Zk(t,i,o,l){const u=i_(i,t,l,!0);r_(()=>{Hy(l[i],u)},o)}function i_(t,i,o=Ur,l=!1){if(o){const u=o[t]||(o[t]=[]),d=i.__weh||(i.__weh=(...g)=>{if(o.isUnmounted)return;ih(),Nu(o);const a=Is(i,o,t,g);return sc(),rh(),a});return l?u.unshift(d):u.push(d),d}}const ea=t=>(i,o=Ur)=>(!$f||t==="sp")&&i_(t,i,o),Wk=ea("bm"),id=ea("m"),Hk=ea("bu"),Xk=ea("u"),ux=ea("bum"),r_=ea("um"),Kk=ea("sp"),Yk=ea("rtg"),Qk=ea("rtc");function Jk(t,i=Ur){i_("ec",t,i)}let D0=!0;function eP(t){const i=bT(t),o=t.proxy,l=t.ctx;D0=!1,i.beforeCreate&&kb(i.beforeCreate,t,"bc");const{data:u,computed:d,methods:g,watch:a,provide:w,inject:S,created:C,beforeMount:k,mounted:F,beforeUpdate:R,updated:W,activated:Z,deactivated:X,beforeDestroy:q,beforeUnmount:ue,destroyed:pe,unmounted:xe,render:fe,renderTracked:Te,renderTriggered:Ie,errorCaptured:Le,serverPrefetch:Pe,expose:qe,inheritAttrs:ze,components:lt,directives:ct,filters:be}=i;if(S&&tP(S,l,null,t.appContext.config.unwrapInjectedRef),g)for(const gt in g){const St=g[gt];ai(St)&&(l[gt]=St.bind(o))}if(u){const gt=u.call(o,o);Rr(gt)&&(t.data=nh(gt))}if(D0=!0,d)for(const gt in d){const St=d[gt],bt=ai(St)?St.bind(o,o):ai(St.get)?St.get.bind(o,o):Xs,Ti=!ai(St)&&ai(St.set)?St.set.bind(o):Xs,Pt=bn({get:bt,set:Ti});Object.defineProperty(l,gt,{enumerable:!0,configurable:!0,get:()=>Pt.value,set:Bi=>Pt.value=Bi})}if(a)for(const gt in a)vT(a[gt],l,o,gt);if(w){const gt=ai(w)?w.call(o):w;Reflect.ownKeys(gt).forEach(St=>{Hp(St,gt[St])})}C&&kb(C,t,"c");function Qe(gt,St){ei(St)?St.forEach(bt=>gt(bt.bind(o))):St&&gt(St.bind(o))}if(Qe(Wk,k),Qe(id,F),Qe(Hk,R),Qe(Xk,W),Qe(Gk,Z),Qe(qk,X),Qe(Jk,Le),Qe(Qk,Te),Qe(Yk,Ie),Qe(ux,ue),Qe(r_,xe),Qe(Kk,Pe),ei(qe))if(qe.length){const gt=t.exposed||(t.exposed={});qe.forEach(St=>{Object.defineProperty(gt,St,{get:()=>o[St],set:bt=>o[St]=bt})})}else t.exposed||(t.exposed={});fe&&t.render===Xs&&(t.render=fe),ze!=null&&(t.inheritAttrs=ze),lt&&(t.components=lt),ct&&(t.directives=ct)}function tP(t,i,o=Xs,l=!1){ei(t)&&(t=z0(t));for(const u in t){const d=t[u];let g;Rr(d)?"default"in d?g=is(d.from||u,d.default,!0):g=is(d.from||u):g=is(d),Ar(g)&&l?Object.defineProperty(i,u,{enumerable:!0,configurable:!0,get:()=>g.value,set:a=>g.value=a}):i[u]=g}}function kb(t,i,o){Is(ei(t)?t.map(l=>l.bind(i.proxy)):t.bind(i.proxy),i,o)}function vT(t,i,o,l){const u=l.includes(".")?_T(o,l):()=>o[l];if(zr(t)){const d=i[t];ai(d)&&Ao(u,d)}else if(ai(t))Ao(u,t.bind(o));else if(Rr(t))if(ei(t))t.forEach(d=>vT(d,i,o,l));else{const d=ai(t.handler)?t.handler.bind(o):i[t.handler];ai(d)&&Ao(u,d,t)}}function bT(t){const i=t.type,{mixins:o,extends:l}=i,{mixins:u,optionsCache:d,config:{optionMergeStrategies:g}}=t.appContext,a=d.get(i);let w;return a?w=a:!u.length&&!o&&!l?w=i:(w={},u.length&&u.forEach(S=>cm(w,S,g,!0)),cm(w,i,g)),d.set(i,w),w}function cm(t,i,o,l=!1){const{mixins:u,extends:d}=i;d&&cm(t,d,o,!0),u&&u.forEach(g=>cm(t,g,o,!0));for(const g in i)if(!(l&&g==="expose")){const a=iP[g]||o&&o[g];t[g]=a?a(t[g],i[g]):i[g]}return t}const iP={data:Pb,props:Wl,emits:Wl,methods:Wl,computed:Wl,beforeCreate:xn,created:xn,beforeMount:xn,mounted:xn,beforeUpdate:xn,updated:xn,beforeDestroy:xn,beforeUnmount:xn,destroyed:xn,unmounted:xn,activated:xn,deactivated:xn,errorCaptured:xn,serverPrefetch:xn,components:Wl,directives:Wl,watch:nP,provide:Pb,inject:rP};function Pb(t,i){return i?t?function(){return un(ai(t)?t.call(this,this):t,ai(i)?i.call(this,this):i)}:i:t}function rP(t,i){return Wl(z0(t),z0(i))}function z0(t){if(ei(t)){const i={};for(let o=0;o<t.length;o++)i[t[o]]=t[o];return i}return t}function xn(t,i){return t?[...new Set([].concat(t,i))]:i}function Wl(t,i){return t?un(un(Object.create(null),t),i):i}function nP(t,i){if(!t)return i;if(!i)return t;const o=un(Object.create(null),t);for(const l in i)o[l]=xn(t[l],i[l]);return o}function sP(t,i,o,l=!1){const u={},d={};nm(d,n_,1),t.propsDefaults=Object.create(null),wT(t,i,u,d);for(const g in t.propsOptions[0])g in u||(u[g]=void 0);o?t.props=l?u:xk(u):t.type.props?t.props=u:t.props=d,t.attrs=d}function oP(t,i,o,l){const{props:u,attrs:d,vnode:{patchFlag:g}}=t,a=Fi(u),[w]=t.propsOptions;let S=!1;if((l||g>0)&&!(g&16)){if(g&8){const C=t.vnode.dynamicProps;for(let k=0;k<C.length;k++){let F=C[k];const R=i[F];if(w)if(Mi(d,F))R!==d[F]&&(d[F]=R,S=!0);else{const W=Io(F);u[W]=R0(w,a,W,R,t,!1)}else R!==d[F]&&(d[F]=R,S=!0)}}}else{wT(t,i,u,d)&&(S=!0);let C;for(const k in a)(!i||!Mi(i,k)&&((C=th(k))===k||!Mi(i,C)))&&(w?o&&(o[k]!==void 0||o[C]!==void 0)&&(u[k]=R0(w,a,k,void 0,t,!0)):delete u[k]);if(d!==a)for(const k in d)(!i||!Mi(i,k)&&!0)&&(delete d[k],S=!0)}S&&Ko(t,"set","$attrs")}function wT(t,i,o,l){const[u,d]=t.propsOptions;let g=!1,a;if(i)for(let w in i){if(Sf(w))continue;const S=i[w];let C;u&&Mi(u,C=Io(w))?!d||!d.includes(C)?o[C]=S:(a||(a={}))[C]=S:lx(t.emitsOptions,w)||(!(w in l)||S!==l[w])&&(l[w]=S,g=!0)}if(d){const w=Fi(o),S=a||Hi;for(let C=0;C<d.length;C++){const k=d[C];o[k]=R0(u,w,k,S[k],t,!Mi(S,k))}}return g}function R0(t,i,o,l,u,d){const g=t[o];if(g!=null){const a=Mi(g,"default");if(a&&l===void 0){const w=g.default;if(g.type!==Function&&ai(w)){const{propsDefaults:S}=u;o in S?l=S[o]:(Nu(u),l=S[o]=w.call(null,i),sc())}else l=w}g[0]&&(d&&!a?l=!1:g[1]&&(l===""||l===th(o))&&(l=!0))}return l}function TT(t,i,o=!1){const l=i.propsCache,u=l.get(t);if(u)return u;const d=t.props,g={},a=[];let w=!1;if(!ai(t)){const C=k=>{w=!0;const[F,R]=TT(k,i,!0);un(g,F),R&&a.push(...R)};!o&&i.mixins.length&&i.mixins.forEach(C),t.extends&&C(t.extends),t.mixins&&t.mixins.forEach(C)}if(!d&&!w)return l.set(t,Pu),Pu;if(ei(d))for(let C=0;C<d.length;C++){const k=Io(d[C]);Db(k)&&(g[k]=Hi)}else if(d)for(const C in d){const k=Io(C);if(Db(k)){const F=d[C],R=g[k]=ei(F)||ai(F)?{type:F}:F;if(R){const W=Fb(Boolean,R.type),Z=Fb(String,R.type);R[0]=W>-1,R[1]=Z<0||W<Z,(W>-1||Mi(R,"default"))&&a.push(k)}}}const S=[g,a];return l.set(t,S),S}function Db(t){return t[0]!=="$"}function zb(t){const i=t&&t.toString().match(/^\s*function (\w+)/);return i?i[1]:t===null?"null":""}function Rb(t,i){return zb(t)===zb(i)}function Fb(t,i){return ei(i)?i.findIndex(o=>Rb(o,t)):ai(i)&&Rb(i,t)?0:-1}const ET=t=>t[0]==="_"||t==="$stable",hx=t=>ei(t)?t.map(qs):[qs(t)],aP=(t,i,o)=>{const l=pT((...u)=>hx(i(...u)),o);return l._c=!1,l},ST=(t,i,o)=>{const l=t._ctx;for(const u in t){if(ET(u))continue;const d=t[u];if(ai(d))i[u]=aP(u,d,l);else if(d!=null){const g=hx(d);i[u]=()=>g}}},AT=(t,i)=>{const o=hx(i);t.slots.default=()=>o},lP=(t,i)=>{if(t.vnode.shapeFlag&32){const o=i._;o?(t.slots=Fi(i),nm(i,"_",o)):ST(i,t.slots={})}else t.slots={},i&&AT(t,i);nm(t.slots,n_,1)},cP=(t,i,o)=>{const{vnode:l,slots:u}=t;let d=!0,g=Hi;if(l.shapeFlag&32){const a=i._;a?o&&a===1?d=!1:(un(u,i),!o&&a===1&&delete u._):(d=!i.$stable,ST(i,u)),g=i}else i&&(AT(t,i),g={default:1});if(d)for(const a in u)!ET(a)&&!(a in g)&&delete u[a]};function t6(t,i){const o=es;if(o===null)return t;const l=o.proxy,u=t.dirs||(t.dirs=[]);for(let d=0;d<i.length;d++){let[g,a,w,S=Hi]=i[d];ai(g)&&(g={mounted:g,updated:g}),g.deep&&ec(a),u.push({dir:g,instance:l,value:a,oldValue:void 0,arg:w,modifiers:S})}return t}function xo(t,i,o,l){const u=t.dirs,d=i&&i.dirs;for(let g=0;g<u.length;g++){const a=u[g];d&&(a.oldValue=d[g].value);let w=a.dir[l];w&&(ih(),Is(w,o,8,[t.el,a,t,i]),rh())}}function CT(){return{app:null,config:{isNativeTag:LM,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uP=0;function hP(t,i){return function(l,u=null){u!=null&&!Rr(u)&&(u=null);const d=CT(),g=new Set;let a=!1;const w=d.app={_uid:uP++,_component:l,_props:u,_container:null,_context:d,_instance:null,version:PP,get config(){return d.config},set config(S){},use(S,...C){return g.has(S)||(S&&ai(S.install)?(g.add(S),S.install(w,...C)):ai(S)&&(g.add(S),S(w,...C))),w},mixin(S){return d.mixins.includes(S)||d.mixins.push(S),w},component(S,C){return C?(d.components[S]=C,w):d.components[S]},directive(S,C){return C?(d.directives[S]=C,w):d.directives[S]},mount(S,C,k){if(!a){const F=Jr(l,u);return F.appContext=d,C&&i?i(F,S):t(F,S,k),a=!0,w._container=S,S.__vue_app__=w,px(F.component)||F.component.proxy}},unmount(){a&&(t(null,w._container),delete w._container.__vue_app__)},provide(S,C){return d.provides[S]=C,w}};return w}}function um(t,i,o,l,u=!1){if(ei(t)){t.forEach((F,R)=>um(F,i&&(ei(i)?i[R]:i),o,l,u));return}if(lm(l)&&!u)return;const d=l.shapeFlag&4?px(l.component)||l.component.proxy:l.el,g=u?null:d,{i:a,r:w}=t,S=i&&i.r,C=a.refs===Hi?a.refs={}:a.refs,k=a.setupState;if(S!=null&&S!==w&&(zr(S)?(C[S]=null,Mi(k,S)&&(k[S]=null)):Ar(S)&&(S.value=null)),ai(w))Ka(w,a,12,[g,C]);else{const F=zr(w),R=Ar(w);if(F||R){const W=()=>{if(t.f){const Z=F?C[w]:w.value;u?ei(Z)&&Hy(Z,d):ei(Z)?Z.includes(d)||Z.push(d):F?C[w]=[d]:(w.value=[d],t.k&&(C[t.k]=w.value))}else F?(C[w]=g,Mi(k,w)&&(k[w]=g)):Ar(w)&&(w.value=g,t.k&&(C[t.k]=g))};g?(W.id=-1,Ln(W,o)):W()}}}let Da=!1;const jp=t=>/svg/.test(t.namespaceURI)&&t.tagName!=="foreignObject",Wg=t=>t.nodeType===8;function fP(t){const{mt:i,p:o,o:{patchProp:l,nextSibling:u,parentNode:d,remove:g,insert:a,createComment:w}}=t,S=(X,q)=>{if(!q.hasChildNodes()){o(null,X,q),om();return}Da=!1,C(q.firstChild,X,null,null,null),om(),Da&&console.error("Hydration completed but contains mismatches.")},C=(X,q,ue,pe,xe,fe=!1)=>{const Te=Wg(X)&&X.data==="[",Ie=()=>W(X,q,ue,pe,xe,Te),{type:Le,ref:Pe,shapeFlag:qe}=q,ze=X.nodeType;q.el=X;let lt=null;switch(Le){case Bu:ze!==3?lt=Ie():(X.data!==q.children&&(Da=!0,X.data=q.children),lt=u(X));break;case ks:ze!==8||Te?lt=Ie():lt=u(X);break;case Xp:if(ze!==1)lt=Ie();else{lt=X;const ct=!q.children.length;for(let be=0;be<q.staticCount;be++)ct&&(q.children+=lt.outerHTML),be===q.staticCount-1&&(q.anchor=lt),lt=u(lt);return lt}break;case vn:Te?lt=R(X,q,ue,pe,xe,fe):lt=Ie();break;default:if(qe&1)ze!==1||q.type.toLowerCase()!==X.tagName.toLowerCase()?lt=Ie():lt=k(X,q,ue,pe,xe,fe);else if(qe&6){q.slotScopeIds=xe;const ct=d(X);if(i(q,ct,null,ue,pe,jp(ct),fe),lt=Te?Z(X):u(X),lm(q)){let be;Te?(be=Jr(vn),be.anchor=lt?lt.previousSibling:ct.lastChild):be=X.nodeType===3?OT(""):Jr("div"),be.el=X,q.component.subTree=be}}else qe&64?ze!==8?lt=Ie():lt=q.type.hydrate(X,q,ue,pe,xe,fe,t,F):qe&128&&(lt=q.type.hydrate(X,q,ue,pe,jp(d(X)),xe,fe,t,C))}return Pe!=null&&um(Pe,null,pe,q),lt},k=(X,q,ue,pe,xe,fe)=>{fe=fe||!!q.dynamicChildren;const{type:Te,props:Ie,patchFlag:Le,shapeFlag:Pe,dirs:qe}=q,ze=Te==="input"&&qe||Te==="option";if(ze||Le!==-1){if(qe&&xo(q,null,ue,"created"),Ie)if(ze||!fe||Le&48)for(const ct in Ie)(ze&&ct.endsWith("value")||td(ct)&&!Sf(ct))&&l(X,ct,null,Ie[ct],!1,void 0,ue);else Ie.onClick&&l(X,"onClick",null,Ie.onClick,!1,void 0,ue);let lt;if((lt=Ie&&Ie.onVnodeBeforeMount)&&bs(lt,ue,q),qe&&xo(q,null,ue,"beforeMount"),((lt=Ie&&Ie.onVnodeMounted)||qe)&&mT(()=>{lt&&bs(lt,ue,q),qe&&xo(q,null,ue,"mounted")},pe),Pe&16&&!(Ie&&(Ie.innerHTML||Ie.textContent))){let ct=F(X.firstChild,q,X,ue,pe,xe,fe);for(;ct;){Da=!0;const be=ct;ct=ct.nextSibling,g(be)}}else Pe&8&&X.textContent!==q.children&&(Da=!0,X.textContent=q.children)}return X.nextSibling},F=(X,q,ue,pe,xe,fe,Te)=>{Te=Te||!!q.dynamicChildren;const Ie=q.children,Le=Ie.length;for(let Pe=0;Pe<Le;Pe++){const qe=Te?Ie[Pe]:Ie[Pe]=qs(Ie[Pe]);if(X)X=C(X,qe,pe,xe,fe,Te);else{if(qe.type===Bu&&!qe.children)continue;Da=!0,o(null,qe,ue,null,pe,xe,jp(ue),fe)}}return X},R=(X,q,ue,pe,xe,fe)=>{const{slotScopeIds:Te}=q;Te&&(xe=xe?xe.concat(Te):Te);const Ie=d(X),Le=F(u(X),q,Ie,ue,pe,xe,fe);return Le&&Wg(Le)&&Le.data==="]"?u(q.anchor=Le):(Da=!0,a(q.anchor=w("]"),Ie,Le),Le)},W=(X,q,ue,pe,xe,fe)=>{if(Da=!0,q.el=null,fe){const Le=Z(X);for(;;){const Pe=u(X);if(Pe&&Pe!==Le)g(Pe);else break}}const Te=u(X),Ie=d(X);return g(X),o(null,q,Ie,Te,ue,pe,jp(Ie),xe),Te},Z=X=>{let q=0;for(;X;)if(X=u(X),X&&Wg(X)&&(X.data==="["&&q++,X.data==="]")){if(q===0)return u(X);q--}return X};return[S,C]}const Ln=mT;function dP(t){return IT(t)}function pP(t){return IT(t,fP)}function IT(t,i){const o=$M();o.__VUE__=!0;const{insert:l,remove:u,patchProp:d,createElement:g,createText:a,createComment:w,setText:S,setElementText:C,parentNode:k,nextSibling:F,setScopeId:R=Xs,cloneNode:W,insertStaticContent:Z}=t,X=(ce,me,Re,tt=null,rt=null,_t=null,wt=!1,Xe=null,st=!!me.dynamicChildren)=>{if(ce===me)return;ce&&!Yl(ce,me)&&(tt=Dt(ce),Ei(ce,rt,_t,!0),ce=null),me.patchFlag===-2&&(st=!1,me.dynamicChildren=null);const{type:ve,ref:Oe,shapeFlag:Tt}=me;switch(ve){case Bu:q(ce,me,Re,tt);break;case ks:ue(ce,me,Re,tt);break;case Xp:ce==null&&pe(me,Re,tt,wt);break;case vn:ct(ce,me,Re,tt,rt,_t,wt,Xe,st);break;default:Tt&1?Te(ce,me,Re,tt,rt,_t,wt,Xe,st):Tt&6?be(ce,me,Re,tt,rt,_t,wt,Xe,st):(Tt&64||Tt&128)&&ve.process(ce,me,Re,tt,rt,_t,wt,Xe,st,xi)}Oe!=null&&rt&&um(Oe,ce&&ce.ref,_t,me||ce,!me)},q=(ce,me,Re,tt)=>{if(ce==null)l(me.el=a(me.children),Re,tt);else{const rt=me.el=ce.el;me.children!==ce.children&&S(rt,me.children)}},ue=(ce,me,Re,tt)=>{ce==null?l(me.el=w(me.children||""),Re,tt):me.el=ce.el},pe=(ce,me,Re,tt)=>{[ce.el,ce.anchor]=Z(ce.children,me,Re,tt,ce.el,ce.anchor)},xe=({el:ce,anchor:me},Re,tt)=>{let rt;for(;ce&&ce!==me;)rt=F(ce),l(ce,Re,tt),ce=rt;l(me,Re,tt)},fe=({el:ce,anchor:me})=>{let Re;for(;ce&&ce!==me;)Re=F(ce),u(ce),ce=Re;u(me)},Te=(ce,me,Re,tt,rt,_t,wt,Xe,st)=>{wt=wt||me.type==="svg",ce==null?Ie(me,Re,tt,rt,_t,wt,Xe,st):qe(ce,me,rt,_t,wt,Xe,st)},Ie=(ce,me,Re,tt,rt,_t,wt,Xe)=>{let st,ve;const{type:Oe,props:Tt,shapeFlag:dt,transition:Nt,patchFlag:Wt,dirs:li}=ce;if(ce.el&&W!==void 0&&Wt===-1)st=ce.el=W(ce.el);else{if(st=ce.el=g(ce.type,_t,Tt&&Tt.is,Tt),dt&8?C(st,ce.children):dt&16&&Pe(ce.children,st,null,tt,rt,_t&&Oe!=="foreignObject",wt,Xe),li&&xo(ce,null,tt,"created"),Tt){for(const Si in Tt)Si!=="value"&&!Sf(Si)&&d(st,Si,null,Tt[Si],_t,ce.children,tt,rt,mt);"value"in Tt&&d(st,"value",null,Tt.value),(ve=Tt.onVnodeBeforeMount)&&bs(ve,tt,ce)}Le(st,ce,ce.scopeId,wt,tt)}li&&xo(ce,null,tt,"beforeMount");const Xt=(!rt||rt&&!rt.pendingBranch)&&Nt&&!Nt.persisted;Xt&&Nt.beforeEnter(st),l(st,me,Re),((ve=Tt&&Tt.onVnodeMounted)||Xt||li)&&Ln(()=>{ve&&bs(ve,tt,ce),Xt&&Nt.enter(st),li&&xo(ce,null,tt,"mounted")},rt)},Le=(ce,me,Re,tt,rt)=>{if(Re&&R(ce,Re),tt)for(let _t=0;_t<tt.length;_t++)R(ce,tt[_t]);if(rt){let _t=rt.subTree;if(me===_t){const wt=rt.vnode;Le(ce,wt,wt.scopeId,wt.slotScopeIds,rt.parent)}}},Pe=(ce,me,Re,tt,rt,_t,wt,Xe,st=0)=>{for(let ve=st;ve<ce.length;ve++){const Oe=ce[ve]=Xe?Ba(ce[ve]):qs(ce[ve]);X(null,Oe,me,Re,tt,rt,_t,wt,Xe)}},qe=(ce,me,Re,tt,rt,_t,wt)=>{const Xe=me.el=ce.el;let{patchFlag:st,dynamicChildren:ve,dirs:Oe}=me;st|=ce.patchFlag&16;const Tt=ce.props||Hi,dt=me.props||Hi;let Nt;Re&&$l(Re,!1),(Nt=dt.onVnodeBeforeUpdate)&&bs(Nt,Re,me,ce),Oe&&xo(me,ce,Re,"beforeUpdate"),Re&&$l(Re,!0);const Wt=rt&&me.type!=="foreignObject";if(ve?ze(ce.dynamicChildren,ve,Xe,Re,tt,Wt,_t):wt||bt(ce,me,Xe,null,Re,tt,Wt,_t,!1),st>0){if(st&16)lt(Xe,me,Tt,dt,Re,tt,rt);else if(st&2&&Tt.class!==dt.class&&d(Xe,"class",null,dt.class,rt),st&4&&d(Xe,"style",Tt.style,dt.style,rt),st&8){const li=me.dynamicProps;for(let Xt=0;Xt<li.length;Xt++){const Si=li[Xt],_r=Tt[Si],hn=dt[Si];(hn!==_r||Si==="value")&&d(Xe,Si,_r,hn,rt,ce.children,Re,tt,mt)}}st&1&&ce.children!==me.children&&C(Xe,me.children)}else!wt&&ve==null&&lt(Xe,me,Tt,dt,Re,tt,rt);((Nt=dt.onVnodeUpdated)||Oe)&&Ln(()=>{Nt&&bs(Nt,Re,me,ce),Oe&&xo(me,ce,Re,"updated")},tt)},ze=(ce,me,Re,tt,rt,_t,wt)=>{for(let Xe=0;Xe<me.length;Xe++){const st=ce[Xe],ve=me[Xe],Oe=st.el&&(st.type===vn||!Yl(st,ve)||st.shapeFlag&70)?k(st.el):Re;X(st,ve,Oe,null,tt,rt,_t,wt,!0)}},lt=(ce,me,Re,tt,rt,_t,wt)=>{if(Re!==tt){for(const Xe in tt){if(Sf(Xe))continue;const st=tt[Xe],ve=Re[Xe];st!==ve&&Xe!=="value"&&d(ce,Xe,ve,st,wt,me.children,rt,_t,mt)}if(Re!==Hi)for(const Xe in Re)!Sf(Xe)&&!(Xe in tt)&&d(ce,Xe,Re[Xe],null,wt,me.children,rt,_t,mt);"value"in tt&&d(ce,"value",Re.value,tt.value)}},ct=(ce,me,Re,tt,rt,_t,wt,Xe,st)=>{const ve=me.el=ce?ce.el:a(""),Oe=me.anchor=ce?ce.anchor:a("");let{patchFlag:Tt,dynamicChildren:dt,slotScopeIds:Nt}=me;Nt&&(Xe=Xe?Xe.concat(Nt):Nt),ce==null?(l(ve,Re,tt),l(Oe,Re,tt),Pe(me.children,Re,Oe,rt,_t,wt,Xe,st)):Tt>0&&Tt&64&&dt&&ce.dynamicChildren?(ze(ce.dynamicChildren,dt,Re,rt,_t,wt,Xe),(me.key!=null||rt&&me===rt.subTree)&&MT(ce,me,!0)):bt(ce,me,Re,Oe,rt,_t,wt,Xe,st)},be=(ce,me,Re,tt,rt,_t,wt,Xe,st)=>{me.slotScopeIds=Xe,ce==null?me.shapeFlag&512?rt.ctx.activate(me,Re,tt,wt,st):Ze(me,Re,tt,rt,_t,wt,st):Qe(ce,me,st)},Ze=(ce,me,Re,tt,rt,_t,wt)=>{const Xe=ce.component=EP(ce,tt,rt);if(t_(ce)&&(Xe.ctx.renderer=xi),SP(Xe),Xe.asyncDep){if(rt&&rt.registerDep(Xe,gt),!ce.el){const st=Xe.subTree=Jr(ks);ue(null,st,me,Re)}return}gt(Xe,ce,me,Re,rt,_t,wt)},Qe=(ce,me,Re)=>{const tt=me.component=ce.component;if(Lk(ce,me,Re))if(tt.asyncDep&&!tt.asyncResolved){St(tt,me,Re);return}else tt.next=me,kk(tt.update),tt.update();else me.component=ce.component,me.el=ce.el,tt.vnode=me},gt=(ce,me,Re,tt,rt,_t,wt)=>{const Xe=()=>{if(ce.isMounted){let{next:Oe,bu:Tt,u:dt,parent:Nt,vnode:Wt}=ce,li=Oe,Xt;$l(ce,!1),Oe?(Oe.el=Wt.el,St(ce,Oe,wt)):Oe=Wt,Tt&&Gg(Tt),(Xt=Oe.props&&Oe.props.onVnodeBeforeUpdate)&&bs(Xt,Nt,Oe,Wt),$l(ce,!0);const Si=qg(ce),_r=ce.subTree;ce.subTree=Si,X(_r,Si,k(_r.el),Dt(_r),ce,rt,_t),Oe.el=Si.el,li===null&&Ok(ce,Si.el),dt&&Ln(dt,rt),(Xt=Oe.props&&Oe.props.onVnodeUpdated)&&Ln(()=>bs(Xt,Nt,Oe,Wt),rt)}else{let Oe;const{el:Tt,props:dt}=me,{bm:Nt,m:Wt,parent:li}=ce,Xt=lm(me);if($l(ce,!1),Nt&&Gg(Nt),!Xt&&(Oe=dt&&dt.onVnodeBeforeMount)&&bs(Oe,li,me),$l(ce,!0),Tt&&Gt){const Si=()=>{ce.subTree=qg(ce),Gt(Tt,ce.subTree,ce,rt,null)};Xt?me.type.__asyncLoader().then(()=>!ce.isUnmounted&&Si()):Si()}else{const Si=ce.subTree=qg(ce);X(null,Si,Re,tt,ce,rt,_t),me.el=Si.el}if(Wt&&Ln(Wt,rt),!Xt&&(Oe=dt&&dt.onVnodeMounted)){const Si=me;Ln(()=>bs(Oe,li,Si),rt)}me.shapeFlag&256&&ce.a&&Ln(ce.a,rt),ce.isMounted=!0,me=Re=tt=null}},st=ce.effect=new Qy(Xe,()=>cT(ce.update),ce.scope),ve=ce.update=st.run.bind(st);ve.id=ce.uid,$l(ce,!0),ve()},St=(ce,me,Re)=>{me.component=ce;const tt=ce.vnode.props;ce.vnode=me,ce.next=null,oP(ce,me.props,tt,Re),cP(ce,me.children,Re),ih(),ax(void 0,ce.update),rh()},bt=(ce,me,Re,tt,rt,_t,wt,Xe,st=!1)=>{const ve=ce&&ce.children,Oe=ce?ce.shapeFlag:0,Tt=me.children,{patchFlag:dt,shapeFlag:Nt}=me;if(dt>0){if(dt&128){Pt(ve,Tt,Re,tt,rt,_t,wt,Xe,st);return}else if(dt&256){Ti(ve,Tt,Re,tt,rt,_t,wt,Xe,st);return}}Nt&8?(Oe&16&&mt(ve,rt,_t),Tt!==ve&&C(Re,Tt)):Oe&16?Nt&16?Pt(ve,Tt,Re,tt,rt,_t,wt,Xe,st):mt(ve,rt,_t,!0):(Oe&8&&C(Re,""),Nt&16&&Pe(Tt,Re,tt,rt,_t,wt,Xe,st))},Ti=(ce,me,Re,tt,rt,_t,wt,Xe,st)=>{ce=ce||Pu,me=me||Pu;const ve=ce.length,Oe=me.length,Tt=Math.min(ve,Oe);let dt;for(dt=0;dt<Tt;dt++){const Nt=me[dt]=st?Ba(me[dt]):qs(me[dt]);X(ce[dt],Nt,Re,null,rt,_t,wt,Xe,st)}ve>Oe?mt(ce,rt,_t,!0,!1,Tt):Pe(me,Re,tt,rt,_t,wt,Xe,st,Tt)},Pt=(ce,me,Re,tt,rt,_t,wt,Xe,st)=>{let ve=0;const Oe=me.length;let Tt=ce.length-1,dt=Oe-1;for(;ve<=Tt&&ve<=dt;){const Nt=ce[ve],Wt=me[ve]=st?Ba(me[ve]):qs(me[ve]);if(Yl(Nt,Wt))X(Nt,Wt,Re,null,rt,_t,wt,Xe,st);else break;ve++}for(;ve<=Tt&&ve<=dt;){const Nt=ce[Tt],Wt=me[dt]=st?Ba(me[dt]):qs(me[dt]);if(Yl(Nt,Wt))X(Nt,Wt,Re,null,rt,_t,wt,Xe,st);else break;Tt--,dt--}if(ve>Tt){if(ve<=dt){const Nt=dt+1,Wt=Nt<Oe?me[Nt].el:tt;for(;ve<=dt;)X(null,me[ve]=st?Ba(me[ve]):qs(me[ve]),Re,Wt,rt,_t,wt,Xe,st),ve++}}else if(ve>dt)for(;ve<=Tt;)Ei(ce[ve],rt,_t,!0),ve++;else{const Nt=ve,Wt=ve,li=new Map;for(ve=Wt;ve<=dt;ve++){const gr=me[ve]=st?Ba(me[ve]):qs(me[ve]);gr.key!=null&&li.set(gr.key,ve)}let Xt,Si=0;const _r=dt-Wt+1;let hn=!1,Vn=0;const Tn=new Array(_r);for(ve=0;ve<_r;ve++)Tn[ve]=0;for(ve=Nt;ve<=Tt;ve++){const gr=ce[ve];if(Si>=_r){Ei(gr,rt,_t,!0);continue}let pi;if(gr.key!=null)pi=li.get(gr.key);else for(Xt=Wt;Xt<=dt;Xt++)if(Tn[Xt-Wt]===0&&Yl(gr,me[Xt])){pi=Xt;break}pi===void 0?Ei(gr,rt,_t,!0):(Tn[pi-Wt]=ve+1,pi>=Vn?Vn=pi:hn=!0,X(gr,me[pi],Re,null,rt,_t,wt,Xe,st),Si++)}const $r=hn?mP(Tn):Pu;for(Xt=$r.length-1,ve=_r-1;ve>=0;ve--){const gr=Wt+ve,pi=me[gr],Gr=gr+1<Oe?me[gr+1].el:tt;Tn[ve]===0?X(null,pi,Re,Gr,rt,_t,wt,Xe,st):hn&&(Xt<0||ve!==$r[Xt]?Bi(pi,Re,Gr,2):Xt--)}}},Bi=(ce,me,Re,tt,rt=null)=>{const{el:_t,type:wt,transition:Xe,children:st,shapeFlag:ve}=ce;if(ve&6){Bi(ce.component.subTree,me,Re,tt);return}if(ve&128){ce.suspense.move(me,Re,tt);return}if(ve&64){wt.move(ce,me,Re,xi);return}if(wt===vn){l(_t,me,Re);for(let Tt=0;Tt<st.length;Tt++)Bi(st[Tt],me,Re,tt);l(ce.anchor,me,Re);return}if(wt===Xp){xe(ce,me,Re);return}if(tt!==2&&ve&1&&Xe)if(tt===0)Xe.beforeEnter(_t),l(_t,me,Re),Ln(()=>Xe.enter(_t),rt);else{const{leave:Tt,delayLeave:dt,afterLeave:Nt}=Xe,Wt=()=>l(_t,me,Re),li=()=>{Tt(_t,()=>{Wt(),Nt&&Nt()})};dt?dt(_t,Wt,li):li()}else l(_t,me,Re)},Ei=(ce,me,Re,tt=!1,rt=!1)=>{const{type:_t,props:wt,ref:Xe,children:st,dynamicChildren:ve,shapeFlag:Oe,patchFlag:Tt,dirs:dt}=ce;if(Xe!=null&&um(Xe,null,Re,ce,!0),Oe&256){me.ctx.deactivate(ce);return}const Nt=Oe&1&&dt,Wt=!lm(ce);let li;if(Wt&&(li=wt&&wt.onVnodeBeforeUnmount)&&bs(li,me,ce),Oe&6)It(ce.component,Re,tt);else{if(Oe&128){ce.suspense.unmount(Re,tt);return}Nt&&xo(ce,null,me,"beforeUnmount"),Oe&64?ce.type.remove(ce,me,Re,rt,xi,tt):ve&&(_t!==vn||Tt>0&&Tt&64)?mt(ve,me,Re,!1,!0):(_t===vn&&Tt&384||!rt&&Oe&16)&&mt(st,me,Re),tt&&rr(ce)}(Wt&&(li=wt&&wt.onVnodeUnmounted)||Nt)&&Ln(()=>{li&&bs(li,me,ce),Nt&&xo(ce,null,me,"unmounted")},Re)},rr=ce=>{const{type:me,el:Re,anchor:tt,transition:rt}=ce;if(me===vn){it(Re,tt);return}if(me===Xp){fe(ce);return}const _t=()=>{u(Re),rt&&!rt.persisted&&rt.afterLeave&&rt.afterLeave()};if(ce.shapeFlag&1&&rt&&!rt.persisted){const{leave:wt,delayLeave:Xe}=rt,st=()=>wt(Re,_t);Xe?Xe(ce.el,_t,st):st()}else _t()},it=(ce,me)=>{let Re;for(;ce!==me;)Re=F(ce),u(ce),ce=Re;u(me)},It=(ce,me,Re)=>{const{bum:tt,scope:rt,update:_t,subTree:wt,um:Xe}=ce;tt&&Gg(tt),rt.stop(),_t&&(_t.active=!1,Ei(wt,ce,me,Re)),Xe&&Ln(Xe,me),Ln(()=>{ce.isUnmounted=!0},me),me&&me.pendingBranch&&!me.isUnmounted&&ce.asyncDep&&!ce.asyncResolved&&ce.suspenseId===me.pendingId&&(me.deps--,me.deps===0&&me.resolve())},mt=(ce,me,Re,tt=!1,rt=!1,_t=0)=>{for(let wt=_t;wt<ce.length;wt++)Ei(ce[wt],me,Re,tt,rt)},Dt=ce=>ce.shapeFlag&6?Dt(ce.component.subTree):ce.shapeFlag&128?ce.suspense.next():F(ce.anchor||ce.el),mi=(ce,me,Re)=>{ce==null?me._vnode&&Ei(me._vnode,null,null,!0):X(me._vnode||null,ce,me,null,null,null,Re),om(),me._vnode=ce},xi={p:X,um:Ei,m:Bi,r:rr,mt:Ze,mc:Pe,pc:bt,pbc:ze,n:Dt,o:t};let Zt,Gt;return i&&([Zt,Gt]=i(xi)),{render:mi,hydrate:Zt,createApp:hP(mi,Zt)}}function $l({effect:t,update:i},o){t.allowRecurse=i.allowRecurse=o}function MT(t,i,o=!1){const l=t.children,u=i.children;if(ei(l)&&ei(u))for(let d=0;d<l.length;d++){const g=l[d];let a=u[d];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=u[d]=Ba(u[d]),a.el=g.el),o||MT(g,a))}}function mP(t){const i=t.slice(),o=[0];let l,u,d,g,a;const w=t.length;for(l=0;l<w;l++){const S=t[l];if(S!==0){if(u=o[o.length-1],t[u]<S){i[l]=u,o.push(l);continue}for(d=0,g=o.length-1;d<g;)a=d+g>>1,t[o[a]]<S?d=a+1:g=a;S<t[o[d]]&&(d>0&&(i[l]=o[d-1]),o[d]=l)}}for(d=o.length,g=o[d-1];d-- >0;)o[d]=g,g=i[g];return o}const _P=t=>t.__isTeleport,fx="components";function i6(t,i){return PT(fx,t,!0,i)||t}const kT=Symbol();function r6(t){return zr(t)?PT(fx,t,!1)||t:t||kT}function PT(t,i,o=!0,l=!1){const u=es||Ur;if(u){const d=u.type;if(t===fx){const a=MP(d);if(a&&(a===i||a===Io(i)||a===Km(Io(i))))return d}const g=Lb(u[t]||d[t],i)||Lb(u.appContext[t],i);return!g&&l?d:g}}function Lb(t,i){return t&&(t[i]||t[Io(i)]||t[Km(Io(i))])}const vn=Symbol(void 0),Bu=Symbol(void 0),ks=Symbol(void 0),Xp=Symbol(void 0),If=[];let nc=null;function DT(t=!1){If.push(nc=t?null:[])}function gP(){If.pop(),nc=If[If.length-1]||null}let hm=1;function Ob(t){hm+=t}function zT(t){return t.dynamicChildren=hm>0?nc||Pu:null,gP(),hm>0&&nc&&nc.push(t),t}function n6(t,i,o,l,u,d){return zT(LT(t,i,o,l,u,d,!0))}function RT(t,i,o,l,u){return zT(Jr(t,i,o,l,u,!0))}function fm(t){return t?t.__v_isVNode===!0:!1}function Yl(t,i){return t.type===i.type&&t.key===i.key}const n_="__vInternal",FT=({key:t})=>t!=null?t:null,Kp=({ref:t,ref_key:i,ref_for:o})=>t!=null?zr(t)||Ar(t)||ai(t)?{i:es,r:t,k:i,f:!!o}:t:null;function LT(t,i=null,o=null,l=0,u=null,d=t===vn?0:1,g=!1,a=!1){const w={__v_isVNode:!0,__v_skip:!0,type:t,props:i,key:i&&FT(i),ref:i&&Kp(i),scopeId:Jm,slotScopeIds:null,children:o,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:d,patchFlag:l,dynamicProps:u,dynamicChildren:null,appContext:null};return a?(dx(w,o),d&128&&t.normalize(w)):o&&(w.shapeFlag|=zr(o)?8:16),hm>0&&!g&&nc&&(w.patchFlag>0||d&6)&&w.patchFlag!==32&&nc.push(w),w}const Jr=yP;function yP(t,i=null,o=null,l=0,u=null,d=!1){if((!t||t===kT)&&(t=ks),fm(t)){const a=Uu(t,i,!0);return o&&dx(a,o),a}if(kP(t)&&(t=t.__vccOpts),i){i=xP(i);let{class:a,style:w}=i;a&&!zr(a)&&(i.class=Zy(a)),Rr(w)&&(iT(w)&&!ei(w)&&(w=un({},w)),i.style=qy(w))}const g=zr(t)?1:Bk(t)?128:_P(t)?64:Rr(t)?4:ai(t)?2:0;return LT(t,i,o,l,u,g,d,!0)}function xP(t){return t?iT(t)||n_ in t?un({},t):t:null}function Uu(t,i,o=!1){const{props:l,ref:u,patchFlag:d,children:g}=t,a=i?vP(l||{},i):l;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:a,key:a&&FT(a),ref:i&&i.ref?o&&u?ei(u)?u.concat(Kp(i)):[u,Kp(i)]:Kp(i):u,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:g,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:i&&t.type!==vn?d===-1?16:d|16:d,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Uu(t.ssContent),ssFallback:t.ssFallback&&Uu(t.ssFallback),el:t.el,anchor:t.anchor}}function OT(t=" ",i=0){return Jr(Bu,null,t,i)}function s6(t="",i=!1){return i?(DT(),RT(ks,null,t)):Jr(ks,null,t)}function qs(t){return t==null||typeof t=="boolean"?Jr(ks):ei(t)?Jr(vn,null,t.slice()):typeof t=="object"?Ba(t):Jr(Bu,null,String(t))}function Ba(t){return t.el===null||t.memo?t:Uu(t)}function dx(t,i){let o=0;const{shapeFlag:l}=t;if(i==null)i=null;else if(ei(i))o=16;else if(typeof i=="object")if(l&65){const u=i.default;u&&(u._c&&(u._d=!1),dx(t,u()),u._c&&(u._d=!0));return}else{o=32;const u=i._;!u&&!(n_ in i)?i._ctx=es:u===3&&es&&(es.slots._===1?i._=1:(i._=2,t.patchFlag|=1024))}else ai(i)?(i={default:i,_ctx:es},o=32):(i=String(i),l&64?(o=16,i=[OT(i)]):o=8);t.children=i,t.shapeFlag|=o}function vP(...t){const i={};for(let o=0;o<t.length;o++){const l=t[o];for(const u in l)if(u==="class")i.class!==l.class&&(i.class=Zy([i.class,l.class]));else if(u==="style")i.style=qy([i.style,l.style]);else if(td(u)){const d=i[u],g=l[u];g&&d!==g&&!(ei(d)&&d.includes(g))&&(i[u]=d?[].concat(d,g):g)}else u!==""&&(i[u]=l[u])}return i}function bs(t,i,o,l=null){Is(t,i,7,[o,l])}function o6(t,i,o,l){let u;const d=o&&o[l];if(ei(t)||zr(t)){u=new Array(t.length);for(let g=0,a=t.length;g<a;g++)u[g]=i(t[g],g,void 0,d&&d[g])}else if(typeof t=="number"){u=new Array(t);for(let g=0;g<t;g++)u[g]=i(g+1,g,void 0,d&&d[g])}else if(Rr(t))if(t[Symbol.iterator])u=Array.from(t,(g,a)=>i(g,a,void 0,d&&d[a]));else{const g=Object.keys(t);u=new Array(g.length);for(let a=0,w=g.length;a<w;a++){const S=g[a];u[a]=i(t[S],S,a,d&&d[a])}}else u=[];return o&&(o[l]=u),u}function a6(t,i,o={},l,u){if(es.isCE)return Jr("slot",i==="default"?null:{name:i},l&&l());let d=t[i];d&&d._c&&(d._d=!1),DT();const g=d&&BT(d(o)),a=RT(vn,{key:o.key||`_${i}`},g||(l?l():[]),g&&t._===1?64:-2);return!u&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),d&&d._c&&(d._d=!0),a}function BT(t){return t.some(i=>fm(i)?!(i.type===ks||i.type===vn&&!BT(i.children)):!0)?t:null}const F0=t=>t?UT(t)?px(t)||t.proxy:F0(t.parent):null,dm=un(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>F0(t.parent),$root:t=>F0(t.root),$emit:t=>t.emit,$options:t=>bT(t),$forceUpdate:t=>()=>cT(t.update),$nextTick:t=>ox.bind(t.proxy),$watch:t=>Nk.bind(t)}),bP={get({_:t},i){const{ctx:o,setupState:l,data:u,props:d,accessCache:g,type:a,appContext:w}=t;let S;if(i[0]!=="$"){const R=g[i];if(R!==void 0)switch(R){case 1:return l[i];case 2:return u[i];case 4:return o[i];case 3:return d[i]}else{if(l!==Hi&&Mi(l,i))return g[i]=1,l[i];if(u!==Hi&&Mi(u,i))return g[i]=2,u[i];if((S=t.propsOptions[0])&&Mi(S,i))return g[i]=3,d[i];if(o!==Hi&&Mi(o,i))return g[i]=4,o[i];D0&&(g[i]=0)}}const C=dm[i];let k,F;if(C)return i==="$attrs"&&ss(t,"get",i),C(t);if((k=a.__cssModules)&&(k=k[i]))return k;if(o!==Hi&&Mi(o,i))return g[i]=4,o[i];if(F=w.config.globalProperties,Mi(F,i))return F[i]},set({_:t},i,o){const{data:l,setupState:u,ctx:d}=t;return u!==Hi&&Mi(u,i)?(u[i]=o,!0):l!==Hi&&Mi(l,i)?(l[i]=o,!0):Mi(t.props,i)||i[0]==="$"&&i.slice(1)in t?!1:(d[i]=o,!0)},has({_:{data:t,setupState:i,accessCache:o,ctx:l,appContext:u,propsOptions:d}},g){let a;return!!o[g]||t!==Hi&&Mi(t,g)||i!==Hi&&Mi(i,g)||(a=d[0])&&Mi(a,g)||Mi(l,g)||Mi(dm,g)||Mi(u.config.globalProperties,g)},defineProperty(t,i,o){return o.get!=null?this.set(t,i,o.get(),null):o.value!=null&&this.set(t,i,o.value,null),Reflect.defineProperty(t,i,o)}},wP=CT();let TP=0;function EP(t,i,o){const l=t.type,u=(i?i.appContext:t.appContext)||wP,d={uid:TP++,vnode:t,type:l,parent:i,appContext:u,root:null,next:null,subTree:null,effect:null,update:null,scope:new GM(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:i?i.provides:Object.create(u.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:TT(l,u),emitsOptions:dT(l,u),emit:null,emitted:null,propsDefaults:Hi,inheritAttrs:l.inheritAttrs,ctx:Hi,data:Hi,props:Hi,attrs:Hi,slots:Hi,refs:Hi,setupState:Hi,setupContext:null,suspense:o,suspenseId:o?o.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return d.ctx={_:d},d.root=i?i.root:d,d.emit=zk.bind(null,d),t.ce&&t.ce(d),d}let Ur=null;const sh=()=>Ur||es,Nu=t=>{Ur=t,t.scope.on()},sc=()=>{Ur&&Ur.scope.off(),Ur=null};function UT(t){return t.vnode.shapeFlag&4}let $f=!1;function SP(t,i=!1){$f=i;const{props:o,children:l}=t.vnode,u=UT(t);sP(t,o,u,i),lP(t,l);const d=u?AP(t,i):void 0;return $f=!1,d}function AP(t,i){const o=t.type;t.accessCache=Object.create(null),t.proxy=rT(new Proxy(t.ctx,bP));const{setup:l}=o;if(l){const u=t.setupContext=l.length>1?IP(t):null;Nu(t),ih();const d=Ka(l,t,0,[t.props,u]);if(rh(),sc(),V2(d)){if(d.then(sc,sc),i)return d.then(g=>{Bb(t,g,i)}).catch(g=>{Qm(g,t,0)});t.asyncDep=d}else Bb(t,d,i)}else NT(t,i)}function Bb(t,i,o){ai(i)?t.type.__ssrInlineRender?t.ssrRender=i:t.render=i:Rr(i)&&(t.setupState=aT(i)),NT(t,o)}let Ub;function NT(t,i,o){const l=t.type;if(!t.render){if(!i&&Ub&&!l.render){const u=l.template;if(u){const{isCustomElement:d,compilerOptions:g}=t.appContext.config,{delimiters:a,compilerOptions:w}=l,S=un(un({isCustomElement:d,delimiters:a},g),w);l.render=Ub(u,S)}}t.render=l.render||Xs}Nu(t),ih(),eP(t),rh(),sc()}function CP(t){return new Proxy(t.attrs,{get(i,o){return ss(t,"get","$attrs"),i[o]}})}function IP(t){const i=l=>{t.exposed=l||{}};let o;return{get attrs(){return o||(o=CP(t))},slots:t.slots,emit:t.emit,expose:i}}function px(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(aT(rT(t.exposed)),{get(i,o){if(o in i)return i[o];if(o in dm)return dm[o](t)}}))}function MP(t){return ai(t)&&t.displayName||t.name}function kP(t){return ai(t)&&"__vccOpts"in t}const bn=(t,i)=>Ck(t,i,$f);function s_(t,i,o){const l=arguments.length;return l===2?Rr(i)&&!ei(i)?fm(i)?Jr(t,null,[i]):Jr(t,i):Jr(t,null,i):(l>3?o=Array.prototype.slice.call(arguments,2):l===3&&fm(o)&&(o=[o]),Jr(t,i,o))}const PP="3.2.31",DP="http://www.w3.org/2000/svg",Ql=typeof document!="undefined"?document:null,Nb=Ql&&Ql.createElement("template"),zP={insert:(t,i,o)=>{i.insertBefore(t,o||null)},remove:t=>{const i=t.parentNode;i&&i.removeChild(t)},createElement:(t,i,o,l)=>{const u=i?Ql.createElementNS(DP,t):Ql.createElement(t,o?{is:o}:void 0);return t==="select"&&l&&l.multiple!=null&&u.setAttribute("multiple",l.multiple),u},createText:t=>Ql.createTextNode(t),createComment:t=>Ql.createComment(t),setText:(t,i)=>{t.nodeValue=i},setElementText:(t,i)=>{t.textContent=i},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Ql.querySelector(t),setScopeId(t,i){t.setAttribute(i,"")},cloneNode(t){const i=t.cloneNode(!0);return"_value"in t&&(i._value=t._value),i},insertStaticContent(t,i,o,l,u,d){const g=o?o.previousSibling:i.lastChild;if(u&&(u===d||u.nextSibling))for(;i.insertBefore(u.cloneNode(!0),o),!(u===d||!(u=u.nextSibling)););else{Nb.innerHTML=l?`<svg>${t}</svg>`:t;const a=Nb.content;if(l){const w=a.firstChild;for(;w.firstChild;)a.appendChild(w.firstChild);a.removeChild(w)}i.insertBefore(a,o)}return[g?g.nextSibling:i.firstChild,o?o.previousSibling:i.lastChild]}};function RP(t,i,o){const l=t._vtc;l&&(i=(i?[i,...l]:[...l]).join(" ")),i==null?t.removeAttribute("class"):o?t.setAttribute("class",i):t.className=i}function FP(t,i,o){const l=t.style,u=zr(o);if(o&&!u){for(const d in o)L0(l,d,o[d]);if(i&&!zr(i))for(const d in i)o[d]==null&&L0(l,d,"")}else{const d=l.display;u?i!==o&&(l.cssText=o):i&&t.removeAttribute("style"),"_vod"in t&&(l.display=d)}}const jb=/\s*!important$/;function L0(t,i,o){if(ei(o))o.forEach(l=>L0(t,i,l));else if(i.startsWith("--"))t.setProperty(i,o);else{const l=LP(t,i);jb.test(o)?t.setProperty(th(l),o.replace(jb,""),"important"):t[l]=o}}const Vb=["Webkit","Moz","ms"],Hg={};function LP(t,i){const o=Hg[i];if(o)return o;let l=Io(i);if(l!=="filter"&&l in t)return Hg[i]=l;l=Km(l);for(let u=0;u<Vb.length;u++){const d=Vb[u]+l;if(d in t)return Hg[i]=d}return i}const $b="http://www.w3.org/1999/xlink";function OP(t,i,o,l,u){if(l&&i.startsWith("xlink:"))o==null?t.removeAttributeNS($b,i.slice(6,i.length)):t.setAttributeNS($b,i,o);else{const d=DM(i);o==null||d&&!U2(o)?t.removeAttribute(i):t.setAttribute(i,d?"":o)}}function BP(t,i,o,l,u,d,g){if(i==="innerHTML"||i==="textContent"){l&&g(l,u,d),t[i]=o==null?"":o;return}if(i==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=o;const a=o==null?"":o;(t.value!==a||t.tagName==="OPTION")&&(t.value=a),o==null&&t.removeAttribute(i);return}if(o===""||o==null){const a=typeof t[i];if(a==="boolean"){t[i]=U2(o);return}else if(o==null&&a==="string"){t[i]="",t.removeAttribute(i);return}else if(a==="number"){try{t[i]=0}catch{}t.removeAttribute(i);return}}try{t[i]=o}catch{}}let pm=Date.now,jT=!1;if(typeof window!="undefined"){pm()>document.createEvent("Event").timeStamp&&(pm=()=>performance.now());const t=navigator.userAgent.match(/firefox\/(\d+)/i);jT=!!(t&&Number(t[1])<=53)}let O0=0;const UP=Promise.resolve(),NP=()=>{O0=0},jP=()=>O0||(UP.then(NP),O0=pm());function VP(t,i,o,l){t.addEventListener(i,o,l)}function $P(t,i,o,l){t.removeEventListener(i,o,l)}function GP(t,i,o,l,u=null){const d=t._vei||(t._vei={}),g=d[i];if(l&&g)g.value=l;else{const[a,w]=qP(i);if(l){const S=d[i]=ZP(l,u);VP(t,a,S,w)}else g&&($P(t,a,g,w),d[i]=void 0)}}const Gb=/(?:Once|Passive|Capture)$/;function qP(t){let i;if(Gb.test(t)){i={};let o;for(;o=t.match(Gb);)t=t.slice(0,t.length-o[0].length),i[o[0].toLowerCase()]=!0}return[th(t.slice(2)),i]}function ZP(t,i){const o=l=>{const u=l.timeStamp||pm();(jT||u>=o.attached-1)&&Is(WP(l,o.value),i,5,[l])};return o.value=t,o.attached=jP(),o}function WP(t,i){if(ei(i)){const o=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{o.call(t),t._stopped=!0},i.map(l=>u=>!u._stopped&&l&&l(u))}else return i}const qb=/^on[a-z]/,HP=(t,i,o,l,u=!1,d,g,a,w)=>{i==="class"?RP(t,l,u):i==="style"?FP(t,o,l):td(i)?Wy(i)||GP(t,i,o,l,g):(i[0]==="."?(i=i.slice(1),!0):i[0]==="^"?(i=i.slice(1),!1):XP(t,i,l,u))?BP(t,i,l,d,g,a,w):(i==="true-value"?t._trueValue=l:i==="false-value"&&(t._falseValue=l),OP(t,i,l,u))};function XP(t,i,o,l){return l?!!(i==="innerHTML"||i==="textContent"||i in t&&qb.test(i)&&ai(o)):i==="spellcheck"||i==="draggable"||i==="form"||i==="list"&&t.tagName==="INPUT"||i==="type"&&t.tagName==="TEXTAREA"||qb.test(i)&&zr(o)?!1:i in t}const KP={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};$k.props;const l6={beforeMount(t,{value:i},{transition:o}){t._vod=t.style.display==="none"?"":t.style.display,o&&i?o.beforeEnter(t):lf(t,i)},mounted(t,{value:i},{transition:o}){o&&i&&o.enter(t)},updated(t,{value:i,oldValue:o},{transition:l}){!i!=!o&&(l?i?(l.beforeEnter(t),lf(t,!0),l.enter(t)):l.leave(t,()=>{lf(t,!1)}):lf(t,i))},beforeUnmount(t,{value:i}){lf(t,i)}};function lf(t,i){t.style.display=i?t._vod:"none"}const VT=un({patchProp:HP},zP);let Mf,Zb=!1;function YP(){return Mf||(Mf=dP(VT))}function QP(){return Mf=Zb?Mf:pP(VT),Zb=!0,Mf}const JP=(...t)=>{const i=YP().createApp(...t),{mount:o}=i;return i.mount=l=>{const u=$T(l);if(!u)return;const d=i._component;!ai(d)&&!d.render&&!d.template&&(d.template=u.innerHTML),u.innerHTML="";const g=o(u,!1,u instanceof SVGElement);return u instanceof Element&&(u.removeAttribute("v-cloak"),u.setAttribute("data-v-app","")),g},i},e3=(...t)=>{const i=QP().createApp(...t),{mount:o}=i;return i.mount=l=>{const u=$T(l);if(u)return o(u,!0,u instanceof SVGElement)},i};function $T(t){return zr(t)?document.querySelector(t):t}/*!
  * vue-i18n v9.2.0-beta.30
  * (c) 2022 kazuya kawaguchi
  * Released under the MIT License.
  */const t3="9.2.0-beta.30";function i3(){typeof __INTLIFY_PROD_DEVTOOLS__!="boolean"&&(Uy().__INTLIFY_PROD_DEVTOOLS__=!1)}mM.__EXTEND_POINT__;let GT=k2.__EXTEND_POINT__;const vs=()=>++GT,rs={UNEXPECTED_RETURN_TYPE:GT,INVALID_ARGUMENT:vs(),MUST_BE_CALL_SETUP_TOP:vs(),NOT_INSLALLED:vs(),NOT_AVAILABLE_IN_LEGACY_MODE:vs(),REQUIRED_VALUE:vs(),INVALID_VALUE:vs(),CANNOT_SETUP_VUE_DEVTOOLS_PLUGIN:vs(),NOT_INSLALLED_WITH_PROVIDE:vs(),UNEXPECTED_ERROR:vs(),NOT_COMPATIBLE_LEGACY_VUE_I18N:vs(),BRIDGE_SUPPORT_VUE_2_ONLY:vs(),__EXTEND_POINT__:vs()};function Ms(t,...i){return P2(t,null,void 0)}const B0=rl("__transrateVNode"),U0=rl("__datetimeParts"),N0=rl("__numberParts"),r3=rl("__setPluralRules");rl("__intlifyMeta");const n3=rl("__injectWithOption");function j0(t){if(!mr(t))return t;for(const i in t)if(!!Ny(t,i))if(!i.includes("."))mr(t[i])&&j0(t[i]);else{const o=i.split("."),l=o.length-1;let u=t;for(let d=0;d<l;d++)o[d]in u||(u[o[d]]={}),u=u[o[d]];u[o[l]]=t[i],delete t[i],mr(u[o[l]])&&j0(u[o[l]])}return t}function qT(t,i){const{messages:o,__i18n:l,messageResolver:u,flatJson:d}=i,g=Ai(o)?o:Nr(l)?{}:{[t]:{}};if(Nr(l)&&l.forEach(a=>{if("locale"in a&&"resource"in a){const{locale:w,resource:S}=a;w?(g[w]=g[w]||{},kf(S,g[w])):kf(S,g)}else Ut(a)&&kf(JSON.parse(a),g)}),u==null&&d)for(const a in g)Ny(g,a)&&j0(g[a]);return g}const Vp=t=>!mr(t)||Nr(t);function kf(t,i){if(Vp(t)||Vp(i))throw Ms(rs.INVALID_VALUE);for(const o in t)Ny(t,o)&&(Vp(t[o])||Vp(i[o])?i[o]=t[o]:kf(t[o],i[o]))}function ZT(t){return t.type}function s3(t,i,o){let l=mr(i.messages)?i.messages:{};"__i18nGlobal"in o&&(l=qT(t.locale.value,{messages:l,__i18n:o.__i18nGlobal}));const u=Object.keys(l);u.length&&u.forEach(d=>{t.mergeLocaleMessage(d,l[d])});{if(mr(i.datetimeFormats)){const d=Object.keys(i.datetimeFormats);d.length&&d.forEach(g=>{t.mergeDateTimeFormat(g,i.datetimeFormats[g])})}if(mr(i.numberFormats)){const d=Object.keys(i.numberFormats);d.length&&d.forEach(g=>{t.mergeNumberFormat(g,i.numberFormats[g])})}}}function Wb(t){return Jr(Bu,null,t,0)}const Hb="__INTLIFY_META__";let Xb=0;function Kb(t){return(i,o,l,u)=>t(o,l,sh()||void 0,u)}const o3=()=>{const t=sh();let i=null;return t&&(i=ZT(t)[Hb])?{[Hb]:i}:null};function WT(t={},i){const{__root:o}=t,l=o===void 0;let u=Dr(t.inheritLocale)?t.inheritLocale:!0;const d=Pr(o&&u?o.locale.value:Ut(t.locale)?t.locale:Vy),g=Pr(o&&u?o.fallbackLocale.value:Ut(t.fallbackLocale)||Nr(t.fallbackLocale)||Ai(t.fallbackLocale)||t.fallbackLocale===!1?t.fallbackLocale:d.value),a=Pr(qT(d.value,t)),w=Pr(Ai(t.datetimeFormats)?t.datetimeFormats:{[d.value]:{}}),S=Pr(Ai(t.numberFormats)?t.numberFormats:{[d.value]:{}});let C=o?o.missingWarn:Dr(t.missingWarn)||rm(t.missingWarn)?t.missingWarn:!0,k=o?o.fallbackWarn:Dr(t.fallbackWarn)||rm(t.fallbackWarn)?t.fallbackWarn:!0,F=o?o.fallbackRoot:Dr(t.fallbackRoot)?t.fallbackRoot:!0,R=!!t.fallbackFormat,W=Kr(t.missing)?t.missing:null,Z=Kr(t.missing)?Kb(t.missing):null,X=Kr(t.postTranslation)?t.postTranslation:null,q=o?o.warnHtmlMessage:Dr(t.warnHtmlMessage)?t.warnHtmlMessage:!0,ue=!!t.escapeParameter;const pe=o?o.modifiers:Ai(t.modifiers)?t.modifiers:{};let xe=t.pluralRules||o&&o.pluralRules,fe;function Te(){const ve={version:t3,locale:d.value,fallbackLocale:g.value,messages:a.value,modifiers:pe,pluralRules:xe,missing:Z===null?void 0:Z,missingWarn:C,fallbackWarn:k,fallbackFormat:R,unresolving:!0,postTranslation:X===null?void 0:X,warnHtmlMessage:q,escapeParameter:ue,messageResolver:t.messageResolver,__meta:{framework:"vue"}};return ve.datetimeFormats=w.value,ve.numberFormats=S.value,ve.__datetimeFormatters=Ai(fe)?fe.__datetimeFormatters:void 0,ve.__numberFormatters=Ai(fe)?fe.__numberFormatters:void 0,SM(ve)}fe=Te(),af(fe,d.value,g.value);function Ie(){return[d.value,g.value,a.value,w.value,S.value]}const Le=bn({get:()=>d.value,set:ve=>{d.value=ve,fe.locale=d.value}}),Pe=bn({get:()=>g.value,set:ve=>{g.value=ve,fe.fallbackLocale=g.value,af(fe,d.value,ve)}}),qe=bn(()=>a.value),ze=bn(()=>w.value),lt=bn(()=>S.value);function ct(){return Kr(X)?X:null}function be(ve){X=ve,fe.postTranslation=ve}function Ze(){return W}function Qe(ve){ve!==null&&(Z=Kb(ve)),W=ve,fe.missing=Z}function gt(ve,Oe,Tt,dt,Nt,Wt){Ie();let li;if(__INTLIFY_PROD_DEVTOOLS__)try{fb(o3()),li=ve(fe)}finally{fb(null)}else li=ve(fe);if(Yr(li)&&li===Wm){const[Xt,Si]=Oe();return o&&F?dt(o):Nt(Xt)}else{if(Wt(li))return li;throw Ms(rs.UNEXPECTED_RETURN_TYPE)}}function St(...ve){return gt(Oe=>Reflect.apply(mb,null,[Oe,...ve]),()=>b0(...ve),"translate",Oe=>Reflect.apply(Oe.t,Oe,[...ve]),Oe=>Oe,Oe=>Ut(Oe))}function bt(...ve){const[Oe,Tt,dt]=ve;if(dt&&!mr(dt))throw Ms(rs.INVALID_ARGUMENT);return St(Oe,Tt,wn({resolvedMessage:!0},dt||{}))}function Ti(...ve){return gt(Oe=>Reflect.apply(_b,null,[Oe,...ve]),()=>w0(...ve),"datetime format",Oe=>Reflect.apply(Oe.d,Oe,[...ve]),()=>hb,Oe=>Ut(Oe))}function Pt(...ve){return gt(Oe=>Reflect.apply(yb,null,[Oe,...ve]),()=>T0(...ve),"number format",Oe=>Reflect.apply(Oe.n,Oe,[...ve]),()=>hb,Oe=>Ut(Oe))}function Bi(ve){return ve.map(Oe=>Ut(Oe)?Wb(Oe):Oe)}const rr={normalize:Bi,interpolate:ve=>ve,type:"vnode"};function it(...ve){return gt(Oe=>{let Tt;const dt=Oe;try{dt.processor=rr,Tt=Reflect.apply(mb,null,[dt,...ve])}finally{dt.processor=null}return Tt},()=>b0(...ve),"translate",Oe=>Oe[B0](...ve),Oe=>[Wb(Oe)],Oe=>Nr(Oe))}function It(...ve){return gt(Oe=>Reflect.apply(yb,null,[Oe,...ve]),()=>T0(...ve),"number format",Oe=>Oe[N0](...ve),()=>[],Oe=>Ut(Oe)||Nr(Oe))}function mt(...ve){return gt(Oe=>Reflect.apply(_b,null,[Oe,...ve]),()=>w0(...ve),"datetime format",Oe=>Oe[U0](...ve),()=>[],Oe=>Ut(Oe)||Nr(Oe))}function Dt(ve){xe=ve,fe.pluralRules=xe}function mi(ve,Oe){const Tt=Ut(Oe)?Oe:d.value,dt=Gt(Tt);return fe.messageResolver(dt,ve)!==null}function xi(ve){let Oe=null;const Tt=z2(fe,g.value,d.value);for(let dt=0;dt<Tt.length;dt++){const Nt=a.value[Tt[dt]]||{},Wt=fe.messageResolver(Nt,ve);if(Wt!=null){Oe=Wt;break}}return Oe}function Zt(ve){const Oe=xi(ve);return Oe!=null?Oe:o?o.tm(ve)||{}:{}}function Gt(ve){return a.value[ve]||{}}function ce(ve,Oe){a.value[ve]=Oe,fe.messages=a.value}function me(ve,Oe){a.value[ve]=a.value[ve]||{},kf(Oe,a.value[ve]),fe.messages=a.value}function Re(ve){return w.value[ve]||{}}function tt(ve,Oe){w.value[ve]=Oe,fe.datetimeFormats=w.value,gb(fe,ve,Oe)}function rt(ve,Oe){w.value[ve]=wn(w.value[ve]||{},Oe),fe.datetimeFormats=w.value,gb(fe,ve,Oe)}function _t(ve){return S.value[ve]||{}}function wt(ve,Oe){S.value[ve]=Oe,fe.numberFormats=S.value,xb(fe,ve,Oe)}function Xe(ve,Oe){S.value[ve]=wn(S.value[ve]||{},Oe),fe.numberFormats=S.value,xb(fe,ve,Oe)}Xb++,o&&(Ao(o.locale,ve=>{u&&(d.value=ve,fe.locale=ve,af(fe,d.value,g.value))}),Ao(o.fallbackLocale,ve=>{u&&(g.value=ve,fe.fallbackLocale=ve,af(fe,d.value,g.value))}));const st={id:Xb,locale:Le,fallbackLocale:Pe,get inheritLocale(){return u},set inheritLocale(ve){u=ve,ve&&o&&(d.value=o.locale.value,g.value=o.fallbackLocale.value,af(fe,d.value,g.value))},get availableLocales(){return Object.keys(a.value).sort()},messages:qe,get modifiers(){return pe},get pluralRules(){return xe||{}},get isGlobal(){return l},get missingWarn(){return C},set missingWarn(ve){C=ve,fe.missingWarn=C},get fallbackWarn(){return k},set fallbackWarn(ve){k=ve,fe.fallbackWarn=k},get fallbackRoot(){return F},set fallbackRoot(ve){F=ve},get fallbackFormat(){return R},set fallbackFormat(ve){R=ve,fe.fallbackFormat=R},get warnHtmlMessage(){return q},set warnHtmlMessage(ve){q=ve,fe.warnHtmlMessage=ve},get escapeParameter(){return ue},set escapeParameter(ve){ue=ve,fe.escapeParameter=ve},t:St,getLocaleMessage:Gt,setLocaleMessage:ce,mergeLocaleMessage:me,getPostTranslationHandler:ct,setPostTranslationHandler:be,getMissingHandler:Ze,setMissingHandler:Qe,[r3]:Dt};return st.datetimeFormats=ze,st.numberFormats=lt,st.rt=bt,st.te=mi,st.tm=Zt,st.d=Ti,st.n=Pt,st.getDateTimeFormat=Re,st.setDateTimeFormat=tt,st.mergeDateTimeFormat=rt,st.getNumberFormat=_t,st.setNumberFormat=wt,st.mergeNumberFormat=Xe,st[n3]=t.__injectWithOption,st[B0]=it,st[U0]=mt,st[N0]=It,st}const mx={tag:{type:[String,Object]},locale:{type:String},scope:{type:String,validator:t=>t==="parent"||t==="global",default:"parent"},i18n:{type:Object}};function a3({slots:t},i){return i.length===1&&i[0]==="default"?(t.default?t.default():[]).reduce((l,u)=>l=[...l,...Nr(u.children)?u.children:[u]],[]):i.reduce((o,l)=>{const u=t[l];return u&&(o[l]=u()),o},{})}function HT(t){return vn}const Yb={name:"i18n-t",props:wn({keypath:{type:String,required:!0},plural:{type:[Number,String],validator:t=>Yr(t)||!isNaN(t)}},mx),setup(t,i){const{slots:o,attrs:l}=i,u=t.i18n||_x({useScope:t.scope,__useComponent:!0}),d=Object.keys(o).filter(g=>g!=="_");return()=>{const g={};t.locale&&(g.locale=t.locale),t.plural!==void 0&&(g.plural=Ut(t.plural)?+t.plural:t.plural);const a=a3(i,d),w=u[B0](t.keypath,a,g),S=wn({},l),C=Ut(t.tag)||mr(t.tag)?t.tag:HT();return s_(C,S,w)}}};function XT(t,i,o,l){const{slots:u,attrs:d}=i;return()=>{const g={part:!0};let a={};t.locale&&(g.locale=t.locale),Ut(t.format)?g.key=t.format:mr(t.format)&&(Ut(t.format.key)&&(g.key=t.format.key),a=Object.keys(t.format).reduce((F,R)=>o.includes(R)?wn({},F,{[R]:t.format[R]}):F,{}));const w=l(t.value,g,a);let S=[g.key];Nr(w)?S=w.map((F,R)=>{const W=u[F.type];return W?W({[F.type]:F.value,index:R,parts:w}):[F.value]}):Ut(w)&&(S=[w]);const C=wn({},d),k=Ut(t.tag)||mr(t.tag)?t.tag:HT();return s_(k,C,S)}}const l3=["localeMatcher","style","unit","unitDisplay","currency","currencyDisplay","useGrouping","numberingSystem","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits","notation","formatMatcher"],Qb={name:"i18n-n",props:wn({value:{type:Number,required:!0},format:{type:[String,Object]}},mx),setup(t,i){const o=t.i18n||_x({useScope:"parent",__useComponent:!0});return XT(t,i,l3,(...l)=>o[N0](...l))}},c3=["dateStyle","timeStyle","fractionalSecondDigits","calendar","dayPeriod","numberingSystem","localeMatcher","timeZone","hour12","hourCycle","formatMatcher","weekday","era","year","month","day","hour","minute","second","timeZoneName"],Jb={name:"i18n-d",props:wn({value:{type:[Number,Date],required:!0},format:{type:[String,Object]}},mx),setup(t,i){const o=t.i18n||_x({useScope:"parent",__useComponent:!0});return XT(t,i,c3,(...l)=>o[U0](...l))}};function u3(t,i){const o=t;if(t.mode==="composition")return o.__getInstance(i)||t.global;{const l=o.__getInstance(i);return l!=null?l.__composer:t.global.__composer}}function h3(t){const i=(o,{instance:l,value:u,modifiers:d})=>{if(!l||!l.$)throw Ms(rs.UNEXPECTED_ERROR);const g=u3(t,l.$),a=f3(u);o.textContent=Reflect.apply(g.t,g,[...d3(a)])};return{beforeMount:i,beforeUpdate:i}}function f3(t){if(Ut(t))return{path:t};if(Ai(t)){if(!("path"in t))throw Ms(rs.REQUIRED_VALUE,"path");return t}else throw Ms(rs.INVALID_VALUE)}function d3(t){const{path:i,locale:o,args:l,choice:u,plural:d}=t,g={},a=l||{};return Ut(o)&&(g.locale=o),Yr(u)&&(g.plural=u),Yr(d)&&(g.plural=d),[i,a,g]}function p3(t,i,...o){const l=Ai(o[0])?o[0]:{},u=!!l.useI18nComponentName;(Dr(l.globalInstall)?l.globalInstall:!0)&&(t.component(u?"i18n":Yb.name,Yb),t.component(Qb.name,Qb),t.component(Jb.name,Jb)),t.directive("t",h3(i))}const m3=rl("global-vue-i18n");function c6(t={},i){const o=!!t.globalInjection,l=new Map,u=_3(t),d=rl("");function g(S){return l.get(S)||null}function a(S,C){l.set(S,C)}function w(S){l.delete(S)}{const S={get mode(){return"composition"},async install(C,...k){C.__VUE_I18N_SYMBOL__=d,C.provide(C.__VUE_I18N_SYMBOL__,S),o&&E3(C,S.global),p3(C,S,...k)},get global(){return u},__instances:l,__getInstance:g,__setInstance:a,__deleteInstance:w};return S}}function _x(t={}){const i=sh();if(i==null)throw Ms(rs.MUST_BE_CALL_SETUP_TOP);if(!i.isCE&&i.appContext.app!=null&&!i.appContext.app.__VUE_I18N_SYMBOL__)throw Ms(rs.NOT_INSLALLED);const o=g3(i),l=x3(o),u=ZT(i),d=y3(t,u);if(d==="global")return s3(l,t,u),l;if(d==="parent"){let w=v3(o,i,t.__useComponent);return w==null&&(w=l),w}if(o.mode==="legacy")throw Ms(rs.NOT_AVAILABLE_IN_LEGACY_MODE);const g=o;let a=g.__getInstance(i);if(a==null){const w=wn({},t);"__i18n"in u&&(w.__i18n=u.__i18n),l&&(w.__root=l),a=WT(w),b3(g,i),g.__setInstance(i,a)}return a}function _3(t,i,o){return WT(t)}function g3(t){{const i=is(t.isCE?m3:t.appContext.app.__VUE_I18N_SYMBOL__);if(!i)throw Ms(t.isCE?rs.NOT_INSLALLED_WITH_PROVIDE:rs.UNEXPECTED_ERROR);return i}}function y3(t,i){return Zm(t)?"__i18n"in i?"local":"global":t.useScope?t.useScope:"local"}function x3(t){return t.mode==="composition"?t.global:t.global.__composer}function v3(t,i,o=!1){let l=null;const u=i.root;let d=i.parent;for(;d!=null;){const g=t;if(t.mode==="composition"&&(l=g.__getInstance(d)),l!=null||u===d)break;d=d.parent}return l}function b3(t,i,o){id(()=>{},i),r_(()=>{t.__deleteInstance(i)},i)}const w3=["locale","fallbackLocale","availableLocales"],T3=["t","rt","d","n","tm"];function E3(t,i){const o=Object.create(null);w3.forEach(l=>{const u=Object.getOwnPropertyDescriptor(i,l);if(!u)throw Ms(rs.UNEXPECTED_ERROR);const d=Ar(u.value)?{get(){return u.value.value},set(g){u.value.value=g}}:{get(){return u.get&&u.get()}};Object.defineProperty(o,l,d)}),t.config.globalProperties.$i18n=o,T3.forEach(l=>{const u=Object.getOwnPropertyDescriptor(i,l);if(!u||!u.value)throw Ms(rs.UNEXPECTED_ERROR);Object.defineProperty(t.config.globalProperties,`$${l}`,u)})}wM(iM);TM(z2);i3();if(__INTLIFY_PROD_DEVTOOLS__){const t=Uy();t.__INTLIFY__=!0,hM(t.__INTLIFY_DEVTOOLS_GLOBAL_HOOK__)}function V0(t,i){return V0=Object.setPrototypeOf||function(l,u){return l.__proto__=u,l},V0(t,i)}function rd(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,V0(t,i)}var nd=function(){function t(){this.listeners=[]}var i=t.prototype;return i.subscribe=function(l){var u=this,d=l||function(){};return this.listeners.push(d),this.onSubscribe(),function(){u.listeners=u.listeners.filter(function(g){return g!==d}),u.onUnsubscribe()}},i.hasListeners=function(){return this.listeners.length>0},i.onSubscribe=function(){},i.onUnsubscribe=function(){},t}();function Ri(){return Ri=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var o=arguments[i];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(t[l]=o[l])}return t},Ri.apply(this,arguments)}var mm=typeof window=="undefined";function an(){}function S3(t,i){return typeof t=="function"?t(i):t}function $0(t){return typeof t=="number"&&t>=0&&t!==1/0}function _m(t){return Array.isArray(t)?t:[t]}function KT(t,i){return Math.max(t+(i||0)-Date.now(),0)}function Xg(t,i,o){return o_(t)?typeof i=="function"?Ri({},o,{queryKey:t,queryFn:i}):Ri({},i,{queryKey:t}):t}function Ua(t,i,o){return o_(t)?[Ri({},i,{queryKey:t}),o]:[t||{},i]}function A3(t,i){if(t===!0&&i===!0||t==null&&i==null)return"all";if(t===!1&&i===!1)return"none";var o=t!=null?t:!i;return o?"active":"inactive"}function ew(t,i){var o=t.active,l=t.exact,u=t.fetching,d=t.inactive,g=t.predicate,a=t.queryKey,w=t.stale;if(o_(a)){if(l){if(i.queryHash!==gx(a,i.options))return!1}else if(!gm(i.queryKey,a))return!1}var S=A3(o,d);if(S==="none")return!1;if(S!=="all"){var C=i.isActive();if(S==="active"&&!C||S==="inactive"&&C)return!1}return!(typeof w=="boolean"&&i.isStale()!==w||typeof u=="boolean"&&i.isFetching()!==u||g&&!g(i))}function tw(t,i){var o=t.exact,l=t.fetching,u=t.predicate,d=t.mutationKey;if(o_(d)){if(!i.options.mutationKey)return!1;if(o){if(tc(i.options.mutationKey)!==tc(d))return!1}else if(!gm(i.options.mutationKey,d))return!1}return!(typeof l=="boolean"&&i.state.status==="loading"!==l||u&&!u(i))}function gx(t,i){var o=(i==null?void 0:i.queryKeyHashFn)||tc;return o(t)}function tc(t){var i=_m(t);return C3(i)}function C3(t){return JSON.stringify(t,function(i,o){return G0(o)?Object.keys(o).sort().reduce(function(l,u){return l[u]=o[u],l},{}):o})}function gm(t,i){return YT(_m(t),_m(i))}function YT(t,i){return t===i?!0:typeof t!=typeof i?!1:t&&i&&typeof t=="object"&&typeof i=="object"?!Object.keys(i).some(function(o){return!YT(t[o],i[o])}):!1}function ym(t,i){if(t===i)return t;var o=Array.isArray(t)&&Array.isArray(i);if(o||G0(t)&&G0(i)){for(var l=o?t.length:Object.keys(t).length,u=o?i:Object.keys(i),d=u.length,g=o?[]:{},a=0,w=0;w<d;w++){var S=o?w:u[w];g[S]=ym(t[S],i[S]),g[S]===t[S]&&a++}return l===d&&a===l?t:g}return i}function I3(t,i){if(t&&!i||i&&!t)return!1;for(var o in t)if(t[o]!==i[o])return!1;return!0}function G0(t){if(!iw(t))return!1;var i=t.constructor;if(typeof i=="undefined")return!0;var o=i.prototype;return!(!iw(o)||!o.hasOwnProperty("isPrototypeOf"))}function iw(t){return Object.prototype.toString.call(t)==="[object Object]"}function o_(t){return typeof t=="string"||Array.isArray(t)}function M3(t){return new Promise(function(i){setTimeout(i,t)})}function rw(t){Promise.resolve().then(t).catch(function(i){return setTimeout(function(){throw i})})}function QT(){if(typeof AbortController=="function")return new AbortController}var k3=function(t){rd(i,t);function i(){var l;return l=t.call(this)||this,l.setup=function(u){var d;if(!mm&&((d=window)==null?void 0:d.addEventListener)){var g=function(){return u()};return window.addEventListener("visibilitychange",g,!1),window.addEventListener("focus",g,!1),function(){window.removeEventListener("visibilitychange",g),window.removeEventListener("focus",g)}}},l}var o=i.prototype;return o.onSubscribe=function(){this.cleanup||this.setEventListener(this.setup)},o.onUnsubscribe=function(){if(!this.hasListeners()){var u;(u=this.cleanup)==null||u.call(this),this.cleanup=void 0}},o.setEventListener=function(u){var d,g=this;this.setup=u,(d=this.cleanup)==null||d.call(this),this.cleanup=u(function(a){typeof a=="boolean"?g.setFocused(a):g.onFocus()})},o.setFocused=function(u){this.focused=u,u&&this.onFocus()},o.onFocus=function(){this.listeners.forEach(function(u){u()})},o.isFocused=function(){return typeof this.focused=="boolean"?this.focused:typeof document=="undefined"?!0:[void 0,"visible","prerender"].includes(document.visibilityState)},i}(nd),Pf=new k3,P3=function(t){rd(i,t);function i(){var l;return l=t.call(this)||this,l.setup=function(u){var d;if(!mm&&((d=window)==null?void 0:d.addEventListener)){var g=function(){return u()};return window.addEventListener("online",g,!1),window.addEventListener("offline",g,!1),function(){window.removeEventListener("online",g),window.removeEventListener("offline",g)}}},l}var o=i.prototype;return o.onSubscribe=function(){this.cleanup||this.setEventListener(this.setup)},o.onUnsubscribe=function(){if(!this.hasListeners()){var u;(u=this.cleanup)==null||u.call(this),this.cleanup=void 0}},o.setEventListener=function(u){var d,g=this;this.setup=u,(d=this.cleanup)==null||d.call(this),this.cleanup=u(function(a){typeof a=="boolean"?g.setOnline(a):g.onOnline()})},o.setOnline=function(u){this.online=u,u&&this.onOnline()},o.onOnline=function(){this.listeners.forEach(function(u){u()})},o.isOnline=function(){return typeof this.online=="boolean"?this.online:typeof navigator=="undefined"||typeof navigator.onLine=="undefined"?!0:navigator.onLine},i}(nd),Yp=new P3;function D3(t){return Math.min(1e3*Math.pow(2,t),3e4)}function xm(t){return typeof(t==null?void 0:t.cancel)=="function"}var JT=function(i){this.revert=i==null?void 0:i.revert,this.silent=i==null?void 0:i.silent};function Qp(t){return t instanceof JT}var eE=function(i){var o=this,l=!1,u,d,g,a;this.abort=i.abort,this.cancel=function(F){return u==null?void 0:u(F)},this.cancelRetry=function(){l=!0},this.continueRetry=function(){l=!1},this.continue=function(){return d==null?void 0:d()},this.failureCount=0,this.isPaused=!1,this.isResolved=!1,this.isTransportCancelable=!1,this.promise=new Promise(function(F,R){g=F,a=R});var w=function(R){o.isResolved||(o.isResolved=!0,i.onSuccess==null||i.onSuccess(R),d==null||d(),g(R))},S=function(R){o.isResolved||(o.isResolved=!0,i.onError==null||i.onError(R),d==null||d(),a(R))},C=function(){return new Promise(function(R){d=R,o.isPaused=!0,i.onPause==null||i.onPause()}).then(function(){d=void 0,o.isPaused=!1,i.onContinue==null||i.onContinue()})},k=function F(){if(!o.isResolved){var R;try{R=i.fn()}catch(W){R=Promise.reject(W)}u=function(Z){if(!o.isResolved&&(S(new JT(Z)),o.abort==null||o.abort(),xm(R)))try{R.cancel()}catch{}},o.isTransportCancelable=xm(R),Promise.resolve(R).then(w).catch(function(W){var Z,X;if(!o.isResolved){var q=(Z=i.retry)!=null?Z:3,ue=(X=i.retryDelay)!=null?X:D3,pe=typeof ue=="function"?ue(o.failureCount,W):ue,xe=q===!0||typeof q=="number"&&o.failureCount<q||typeof q=="function"&&q(o.failureCount,W);if(l||!xe){S(W);return}o.failureCount++,i.onFail==null||i.onFail(o.failureCount,W),M3(pe).then(function(){if(!Pf.isFocused()||!Yp.isOnline())return C()}).then(function(){l?S(W):F()})}})}};k()},z3=function(){function t(){this.queue=[],this.transactions=0,this.notifyFn=function(o){o()},this.batchNotifyFn=function(o){o()}}var i=t.prototype;return i.batch=function(l){var u;this.transactions++;try{u=l()}finally{this.transactions--,this.transactions||this.flush()}return u},i.schedule=function(l){var u=this;this.transactions?this.queue.push(l):rw(function(){u.notifyFn(l)})},i.batchCalls=function(l){var u=this;return function(){for(var d=arguments.length,g=new Array(d),a=0;a<d;a++)g[a]=arguments[a];u.schedule(function(){l.apply(void 0,g)})}},i.flush=function(){var l=this,u=this.queue;this.queue=[],u.length&&rw(function(){l.batchNotifyFn(function(){u.forEach(function(d){l.notifyFn(d)})})})},i.setNotifyFunction=function(l){this.notifyFn=l},i.setBatchNotifyFunction=function(l){this.batchNotifyFn=l},t}(),Xr=new z3,R3=console;function vm(){return R3}var F3=function(){function t(o){this.abortSignalConsumed=!1,this.hadObservers=!1,this.defaultOptions=o.defaultOptions,this.setOptions(o.options),this.observers=[],this.cache=o.cache,this.queryKey=o.queryKey,this.queryHash=o.queryHash,this.initialState=o.state||this.getDefaultState(this.options),this.state=this.initialState,this.meta=o.meta,this.scheduleGc()}var i=t.prototype;return i.setOptions=function(l){var u;this.options=Ri({},this.defaultOptions,l),this.meta=l==null?void 0:l.meta,this.cacheTime=Math.max(this.cacheTime||0,(u=this.options.cacheTime)!=null?u:5*60*1e3)},i.setDefaultOptions=function(l){this.defaultOptions=l},i.scheduleGc=function(){var l=this;this.clearGcTimeout(),$0(this.cacheTime)&&(this.gcTimeout=setTimeout(function(){l.optionalRemove()},this.cacheTime))},i.clearGcTimeout=function(){clearTimeout(this.gcTimeout),this.gcTimeout=void 0},i.optionalRemove=function(){this.observers.length||(this.state.isFetching?this.hadObservers&&this.scheduleGc():this.cache.remove(this))},i.setData=function(l,u){var d,g,a=this.state.data,w=S3(l,a);return((d=(g=this.options).isDataEqual)==null?void 0:d.call(g,a,w))?w=a:this.options.structuralSharing!==!1&&(w=ym(a,w)),this.dispatch({data:w,type:"success",dataUpdatedAt:u==null?void 0:u.updatedAt}),w},i.setState=function(l,u){this.dispatch({type:"setState",state:l,setStateOptions:u})},i.cancel=function(l){var u,d=this.promise;return(u=this.retryer)==null||u.cancel(l),d?d.then(an).catch(an):Promise.resolve()},i.destroy=function(){this.clearGcTimeout(),this.cancel({silent:!0})},i.reset=function(){this.destroy(),this.setState(this.initialState)},i.isActive=function(){return this.observers.some(function(l){return l.options.enabled!==!1})},i.isFetching=function(){return this.state.isFetching},i.isStale=function(){return this.state.isInvalidated||!this.state.dataUpdatedAt||this.observers.some(function(l){return l.getCurrentResult().isStale})},i.isStaleByTime=function(l){return l===void 0&&(l=0),this.state.isInvalidated||!this.state.dataUpdatedAt||!KT(this.state.dataUpdatedAt,l)},i.onFocus=function(){var l,u=this.observers.find(function(d){return d.shouldFetchOnWindowFocus()});u&&u.refetch(),(l=this.retryer)==null||l.continue()},i.onOnline=function(){var l,u=this.observers.find(function(d){return d.shouldFetchOnReconnect()});u&&u.refetch(),(l=this.retryer)==null||l.continue()},i.addObserver=function(l){this.observers.indexOf(l)===-1&&(this.observers.push(l),this.hadObservers=!0,this.clearGcTimeout(),this.cache.notify({type:"observerAdded",query:this,observer:l}))},i.removeObserver=function(l){this.observers.indexOf(l)!==-1&&(this.observers=this.observers.filter(function(u){return u!==l}),this.observers.length||(this.retryer&&(this.retryer.isTransportCancelable||this.abortSignalConsumed?this.retryer.cancel({revert:!0}):this.retryer.cancelRetry()),this.cacheTime?this.scheduleGc():this.cache.remove(this)),this.cache.notify({type:"observerRemoved",query:this,observer:l}))},i.getObserversCount=function(){return this.observers.length},i.invalidate=function(){this.state.isInvalidated||this.dispatch({type:"invalidate"})},i.fetch=function(l,u){var d=this,g,a,w;if(this.state.isFetching){if(this.state.dataUpdatedAt&&(u==null?void 0:u.cancelRefetch))this.cancel({silent:!0});else if(this.promise){var S;return(S=this.retryer)==null||S.continueRetry(),this.promise}}if(l&&this.setOptions(l),!this.options.queryFn){var C=this.observers.find(function(ue){return ue.options.queryFn});C&&this.setOptions(C.options)}var k=_m(this.queryKey),F=QT(),R={queryKey:k,pageParam:void 0,meta:this.meta};Object.defineProperty(R,"signal",{enumerable:!0,get:function(){if(F)return d.abortSignalConsumed=!0,F.signal}});var W=function(){return d.options.queryFn?(d.abortSignalConsumed=!1,d.options.queryFn(R)):Promise.reject("Missing queryFn")},Z={fetchOptions:u,options:this.options,queryKey:k,state:this.state,fetchFn:W,meta:this.meta};if((g=this.options.behavior)==null?void 0:g.onFetch){var X;(X=this.options.behavior)==null||X.onFetch(Z)}if(this.revertState=this.state,!this.state.isFetching||this.state.fetchMeta!==((a=Z.fetchOptions)==null?void 0:a.meta)){var q;this.dispatch({type:"fetch",meta:(q=Z.fetchOptions)==null?void 0:q.meta})}return this.retryer=new eE({fn:Z.fetchFn,abort:F==null||(w=F.abort)==null?void 0:w.bind(F),onSuccess:function(pe){d.setData(pe),d.cache.config.onSuccess==null||d.cache.config.onSuccess(pe,d),d.cacheTime===0&&d.optionalRemove()},onError:function(pe){Qp(pe)&&pe.silent||d.dispatch({type:"error",error:pe}),Qp(pe)||(d.cache.config.onError==null||d.cache.config.onError(pe,d),vm().error(pe)),d.cacheTime===0&&d.optionalRemove()},onFail:function(){d.dispatch({type:"failed"})},onPause:function(){d.dispatch({type:"pause"})},onContinue:function(){d.dispatch({type:"continue"})},retry:Z.options.retry,retryDelay:Z.options.retryDelay}),this.promise=this.retryer.promise,this.promise},i.dispatch=function(l){var u=this;this.state=this.reducer(this.state,l),Xr.batch(function(){u.observers.forEach(function(d){d.onQueryUpdate(l)}),u.cache.notify({query:u,type:"queryUpdated",action:l})})},i.getDefaultState=function(l){var u=typeof l.initialData=="function"?l.initialData():l.initialData,d=typeof l.initialData!="undefined",g=d?typeof l.initialDataUpdatedAt=="function"?l.initialDataUpdatedAt():l.initialDataUpdatedAt:0,a=typeof u!="undefined";return{data:u,dataUpdateCount:0,dataUpdatedAt:a?g!=null?g:Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchMeta:null,isFetching:!1,isInvalidated:!1,isPaused:!1,status:a?"success":"idle"}},i.reducer=function(l,u){var d,g;switch(u.type){case"failed":return Ri({},l,{fetchFailureCount:l.fetchFailureCount+1});case"pause":return Ri({},l,{isPaused:!0});case"continue":return Ri({},l,{isPaused:!1});case"fetch":return Ri({},l,{fetchFailureCount:0,fetchMeta:(d=u.meta)!=null?d:null,isFetching:!0,isPaused:!1},!l.dataUpdatedAt&&{error:null,status:"loading"});case"success":return Ri({},l,{data:u.data,dataUpdateCount:l.dataUpdateCount+1,dataUpdatedAt:(g=u.dataUpdatedAt)!=null?g:Date.now(),error:null,fetchFailureCount:0,isFetching:!1,isInvalidated:!1,isPaused:!1,status:"success"});case"error":var a=u.error;return Qp(a)&&a.revert&&this.revertState?Ri({},this.revertState):Ri({},l,{error:a,errorUpdateCount:l.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:l.fetchFailureCount+1,isFetching:!1,isPaused:!1,status:"error"});case"invalidate":return Ri({},l,{isInvalidated:!0});case"setState":return Ri({},l,u.state);default:return l}},t}(),L3=function(t){rd(i,t);function i(l){var u;return u=t.call(this)||this,u.config=l||{},u.queries=[],u.queriesMap={},u}var o=i.prototype;return o.build=function(u,d,g){var a,w=d.queryKey,S=(a=d.queryHash)!=null?a:gx(w,d),C=this.get(S);return C||(C=new F3({cache:this,queryKey:w,queryHash:S,options:u.defaultQueryOptions(d),state:g,defaultOptions:u.getQueryDefaults(w),meta:d.meta}),this.add(C)),C},o.add=function(u){this.queriesMap[u.queryHash]||(this.queriesMap[u.queryHash]=u,this.queries.push(u),this.notify({type:"queryAdded",query:u}))},o.remove=function(u){var d=this.queriesMap[u.queryHash];d&&(u.destroy(),this.queries=this.queries.filter(function(g){return g!==u}),d===u&&delete this.queriesMap[u.queryHash],this.notify({type:"queryRemoved",query:u}))},o.clear=function(){var u=this;Xr.batch(function(){u.queries.forEach(function(d){u.remove(d)})})},o.get=function(u){return this.queriesMap[u]},o.getAll=function(){return this.queries},o.find=function(u,d){var g=Ua(u,d),a=g[0];return typeof a.exact=="undefined"&&(a.exact=!0),this.queries.find(function(w){return ew(a,w)})},o.findAll=function(u,d){var g=Ua(u,d),a=g[0];return Object.keys(a).length>0?this.queries.filter(function(w){return ew(a,w)}):this.queries},o.notify=function(u){var d=this;Xr.batch(function(){d.listeners.forEach(function(g){g(u)})})},o.onFocus=function(){var u=this;Xr.batch(function(){u.queries.forEach(function(d){d.onFocus()})})},o.onOnline=function(){var u=this;Xr.batch(function(){u.queries.forEach(function(d){d.onOnline()})})},i}(nd),O3=function(){function t(o){this.options=Ri({},o.defaultOptions,o.options),this.mutationId=o.mutationId,this.mutationCache=o.mutationCache,this.observers=[],this.state=o.state||B3(),this.meta=o.meta}var i=t.prototype;return i.setState=function(l){this.dispatch({type:"setState",state:l})},i.addObserver=function(l){this.observers.indexOf(l)===-1&&this.observers.push(l)},i.removeObserver=function(l){this.observers=this.observers.filter(function(u){return u!==l})},i.cancel=function(){return this.retryer?(this.retryer.cancel(),this.retryer.promise.then(an).catch(an)):Promise.resolve()},i.continue=function(){return this.retryer?(this.retryer.continue(),this.retryer.promise):this.execute()},i.execute=function(){var l=this,u,d=this.state.status==="loading",g=Promise.resolve();return d||(this.dispatch({type:"loading",variables:this.options.variables}),g=g.then(function(){l.mutationCache.config.onMutate==null||l.mutationCache.config.onMutate(l.state.variables,l)}).then(function(){return l.options.onMutate==null?void 0:l.options.onMutate(l.state.variables)}).then(function(a){a!==l.state.context&&l.dispatch({type:"loading",context:a,variables:l.state.variables})})),g.then(function(){return l.executeMutation()}).then(function(a){u=a,l.mutationCache.config.onSuccess==null||l.mutationCache.config.onSuccess(u,l.state.variables,l.state.context,l)}).then(function(){return l.options.onSuccess==null?void 0:l.options.onSuccess(u,l.state.variables,l.state.context)}).then(function(){return l.options.onSettled==null?void 0:l.options.onSettled(u,null,l.state.variables,l.state.context)}).then(function(){return l.dispatch({type:"success",data:u}),u}).catch(function(a){return l.mutationCache.config.onError==null||l.mutationCache.config.onError(a,l.state.variables,l.state.context,l),vm().error(a),Promise.resolve().then(function(){return l.options.onError==null?void 0:l.options.onError(a,l.state.variables,l.state.context)}).then(function(){return l.options.onSettled==null?void 0:l.options.onSettled(void 0,a,l.state.variables,l.state.context)}).then(function(){throw l.dispatch({type:"error",error:a}),a})})},i.executeMutation=function(){var l=this,u;return this.retryer=new eE({fn:function(){return l.options.mutationFn?l.options.mutationFn(l.state.variables):Promise.reject("No mutationFn found")},onFail:function(){l.dispatch({type:"failed"})},onPause:function(){l.dispatch({type:"pause"})},onContinue:function(){l.dispatch({type:"continue"})},retry:(u=this.options.retry)!=null?u:0,retryDelay:this.options.retryDelay}),this.retryer.promise},i.dispatch=function(l){var u=this;this.state=U3(this.state,l),Xr.batch(function(){u.observers.forEach(function(d){d.onMutationUpdate(l)}),u.mutationCache.notify(u)})},t}();function B3(){return{context:void 0,data:void 0,error:null,failureCount:0,isPaused:!1,status:"idle",variables:void 0}}function U3(t,i){switch(i.type){case"failed":return Ri({},t,{failureCount:t.failureCount+1});case"pause":return Ri({},t,{isPaused:!0});case"continue":return Ri({},t,{isPaused:!1});case"loading":return Ri({},t,{context:i.context,data:void 0,error:null,isPaused:!1,status:"loading",variables:i.variables});case"success":return Ri({},t,{data:i.data,error:null,status:"success",isPaused:!1});case"error":return Ri({},t,{data:void 0,error:i.error,failureCount:t.failureCount+1,isPaused:!1,status:"error"});case"setState":return Ri({},t,i.state);default:return t}}var N3=function(t){rd(i,t);function i(l){var u;return u=t.call(this)||this,u.config=l||{},u.mutations=[],u.mutationId=0,u}var o=i.prototype;return o.build=function(u,d,g){var a=new O3({mutationCache:this,mutationId:++this.mutationId,options:u.defaultMutationOptions(d),state:g,defaultOptions:d.mutationKey?u.getMutationDefaults(d.mutationKey):void 0,meta:d.meta});return this.add(a),a},o.add=function(u){this.mutations.push(u),this.notify(u)},o.remove=function(u){this.mutations=this.mutations.filter(function(d){return d!==u}),u.cancel(),this.notify(u)},o.clear=function(){var u=this;Xr.batch(function(){u.mutations.forEach(function(d){u.remove(d)})})},o.getAll=function(){return this.mutations},o.find=function(u){return typeof u.exact=="undefined"&&(u.exact=!0),this.mutations.find(function(d){return tw(u,d)})},o.findAll=function(u){return this.mutations.filter(function(d){return tw(u,d)})},o.notify=function(u){var d=this;Xr.batch(function(){d.listeners.forEach(function(g){g(u)})})},o.onFocus=function(){this.resumePausedMutations()},o.onOnline=function(){this.resumePausedMutations()},o.resumePausedMutations=function(){var u=this.mutations.filter(function(d){return d.state.isPaused});return Xr.batch(function(){return u.reduce(function(d,g){return d.then(function(){return g.continue().catch(an)})},Promise.resolve())})},i}(nd);function j3(){return{onFetch:function(i){i.fetchFn=function(){var o,l,u,d,g,a,w=(o=i.fetchOptions)==null||(l=o.meta)==null?void 0:l.refetchPage,S=(u=i.fetchOptions)==null||(d=u.meta)==null?void 0:d.fetchMore,C=S==null?void 0:S.pageParam,k=(S==null?void 0:S.direction)==="forward",F=(S==null?void 0:S.direction)==="backward",R=((g=i.state.data)==null?void 0:g.pages)||[],W=((a=i.state.data)==null?void 0:a.pageParams)||[],Z=QT(),X=Z==null?void 0:Z.signal,q=W,ue=!1,pe=i.options.queryFn||function(){return Promise.reject("Missing queryFn")},xe=function(be,Ze,Qe,gt){return q=gt?[Ze].concat(q):[].concat(q,[Ze]),gt?[Qe].concat(be):[].concat(be,[Qe])},fe=function(be,Ze,Qe,gt){if(ue)return Promise.reject("Cancelled");if(typeof Qe=="undefined"&&!Ze&&be.length)return Promise.resolve(be);var St={queryKey:i.queryKey,signal:X,pageParam:Qe,meta:i.meta},bt=pe(St),Ti=Promise.resolve(bt).then(function(Bi){return xe(be,Qe,Bi,gt)});if(xm(bt)){var Pt=Ti;Pt.cancel=bt.cancel}return Ti},Te;if(!R.length)Te=fe([]);else if(k){var Ie=typeof C!="undefined",Le=Ie?C:nw(i.options,R);Te=fe(R,Ie,Le)}else if(F){var Pe=typeof C!="undefined",qe=Pe?C:V3(i.options,R);Te=fe(R,Pe,qe,!0)}else(function(){q=[];var ct=typeof i.options.getNextPageParam=="undefined",be=w&&R[0]?w(R[0],0,R):!0;Te=be?fe([],ct,W[0]):Promise.resolve(xe([],W[0],R[0]));for(var Ze=function(St){Te=Te.then(function(bt){var Ti=w&&R[St]?w(R[St],St,R):!0;if(Ti){var Pt=ct?W[St]:nw(i.options,bt);return fe(bt,ct,Pt)}return Promise.resolve(xe(bt,W[St],R[St]))})},Qe=1;Qe<R.length;Qe++)Ze(Qe)})();var ze=Te.then(function(ct){return{pages:ct,pageParams:q}}),lt=ze;return lt.cancel=function(){ue=!0,Z==null||Z.abort(),xm(Te)&&Te.cancel()},ze}}}}function nw(t,i){return t.getNextPageParam==null?void 0:t.getNextPageParam(i[i.length-1],i)}function V3(t,i){return t.getPreviousPageParam==null?void 0:t.getPreviousPageParam(i[0],i)}var $3=function(){function t(o){o===void 0&&(o={}),this.queryCache=o.queryCache||new L3,this.mutationCache=o.mutationCache||new N3,this.defaultOptions=o.defaultOptions||{},this.queryDefaults=[],this.mutationDefaults=[]}var i=t.prototype;return i.mount=function(){var l=this;this.unsubscribeFocus=Pf.subscribe(function(){Pf.isFocused()&&Yp.isOnline()&&(l.mutationCache.onFocus(),l.queryCache.onFocus())}),this.unsubscribeOnline=Yp.subscribe(function(){Pf.isFocused()&&Yp.isOnline()&&(l.mutationCache.onOnline(),l.queryCache.onOnline())})},i.unmount=function(){var l,u;(l=this.unsubscribeFocus)==null||l.call(this),(u=this.unsubscribeOnline)==null||u.call(this)},i.isFetching=function(l,u){var d=Ua(l,u),g=d[0];return g.fetching=!0,this.queryCache.findAll(g).length},i.isMutating=function(l){return this.mutationCache.findAll(Ri({},l,{fetching:!0})).length},i.getQueryData=function(l,u){var d;return(d=this.queryCache.find(l,u))==null?void 0:d.state.data},i.getQueriesData=function(l){return this.getQueryCache().findAll(l).map(function(u){var d=u.queryKey,g=u.state,a=g.data;return[d,a]})},i.setQueryData=function(l,u,d){var g=Xg(l),a=this.defaultQueryOptions(g);return this.queryCache.build(this,a).setData(u,d)},i.setQueriesData=function(l,u,d){var g=this;return Xr.batch(function(){return g.getQueryCache().findAll(l).map(function(a){var w=a.queryKey;return[w,g.setQueryData(w,u,d)]})})},i.getQueryState=function(l,u){var d;return(d=this.queryCache.find(l,u))==null?void 0:d.state},i.removeQueries=function(l,u){var d=Ua(l,u),g=d[0],a=this.queryCache;Xr.batch(function(){a.findAll(g).forEach(function(w){a.remove(w)})})},i.resetQueries=function(l,u,d){var g=this,a=Ua(l,u,d),w=a[0],S=a[1],C=this.queryCache,k=Ri({},w,{active:!0});return Xr.batch(function(){return C.findAll(w).forEach(function(F){F.reset()}),g.refetchQueries(k,S)})},i.cancelQueries=function(l,u,d){var g=this,a=Ua(l,u,d),w=a[0],S=a[1],C=S===void 0?{}:S;typeof C.revert=="undefined"&&(C.revert=!0);var k=Xr.batch(function(){return g.queryCache.findAll(w).map(function(F){return F.cancel(C)})});return Promise.all(k).then(an).catch(an)},i.invalidateQueries=function(l,u,d){var g,a,w,S=this,C=Ua(l,u,d),k=C[0],F=C[1],R=Ri({},k,{active:(g=(a=k.refetchActive)!=null?a:k.active)!=null?g:!0,inactive:(w=k.refetchInactive)!=null?w:!1});return Xr.batch(function(){return S.queryCache.findAll(k).forEach(function(W){W.invalidate()}),S.refetchQueries(R,F)})},i.refetchQueries=function(l,u,d){var g=this,a=Ua(l,u,d),w=a[0],S=a[1],C=Xr.batch(function(){return g.queryCache.findAll(w).map(function(F){return F.fetch(void 0,Ri({},S,{meta:{refetchPage:w==null?void 0:w.refetchPage}}))})}),k=Promise.all(C).then(an);return(S==null?void 0:S.throwOnError)||(k=k.catch(an)),k},i.fetchQuery=function(l,u,d){var g=Xg(l,u,d),a=this.defaultQueryOptions(g);typeof a.retry=="undefined"&&(a.retry=!1);var w=this.queryCache.build(this,a);return w.isStaleByTime(a.staleTime)?w.fetch(a):Promise.resolve(w.state.data)},i.prefetchQuery=function(l,u,d){return this.fetchQuery(l,u,d).then(an).catch(an)},i.fetchInfiniteQuery=function(l,u,d){var g=Xg(l,u,d);return g.behavior=j3(),this.fetchQuery(g)},i.prefetchInfiniteQuery=function(l,u,d){return this.fetchInfiniteQuery(l,u,d).then(an).catch(an)},i.cancelMutations=function(){var l=this,u=Xr.batch(function(){return l.mutationCache.getAll().map(function(d){return d.cancel()})});return Promise.all(u).then(an).catch(an)},i.resumePausedMutations=function(){return this.getMutationCache().resumePausedMutations()},i.executeMutation=function(l){return this.mutationCache.build(this,l).execute()},i.getQueryCache=function(){return this.queryCache},i.getMutationCache=function(){return this.mutationCache},i.getDefaultOptions=function(){return this.defaultOptions},i.setDefaultOptions=function(l){this.defaultOptions=l},i.setQueryDefaults=function(l,u){var d=this.queryDefaults.find(function(g){return tc(l)===tc(g.queryKey)});d?d.defaultOptions=u:this.queryDefaults.push({queryKey:l,defaultOptions:u})},i.getQueryDefaults=function(l){var u;return l?(u=this.queryDefaults.find(function(d){return gm(l,d.queryKey)}))==null?void 0:u.defaultOptions:void 0},i.setMutationDefaults=function(l,u){var d=this.mutationDefaults.find(function(g){return tc(l)===tc(g.mutationKey)});d?d.defaultOptions=u:this.mutationDefaults.push({mutationKey:l,defaultOptions:u})},i.getMutationDefaults=function(l){var u;return l?(u=this.mutationDefaults.find(function(d){return gm(l,d.mutationKey)}))==null?void 0:u.defaultOptions:void 0},i.defaultQueryOptions=function(l){if(l==null?void 0:l._defaulted)return l;var u=Ri({},this.defaultOptions.queries,this.getQueryDefaults(l==null?void 0:l.queryKey),l,{_defaulted:!0});return!u.queryHash&&u.queryKey&&(u.queryHash=gx(u.queryKey,u)),u},i.defaultQueryObserverOptions=function(l){return this.defaultQueryOptions(l)},i.defaultMutationOptions=function(l){return(l==null?void 0:l._defaulted)?l:Ri({},this.defaultOptions.mutations,this.getMutationDefaults(l==null?void 0:l.mutationKey),l,{_defaulted:!0})},i.clear=function(){this.queryCache.clear(),this.mutationCache.clear()},t}(),G3=function(t){rd(i,t);function i(l,u){var d;return d=t.call(this)||this,d.client=l,d.options=u,d.trackedProps=[],d.previousSelectError=null,d.bindMethods(),d.setOptions(u),d}var o=i.prototype;return o.bindMethods=function(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)},o.onSubscribe=function(){this.listeners.length===1&&(this.currentQuery.addObserver(this),sw(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())},o.onUnsubscribe=function(){this.listeners.length||this.destroy()},o.shouldFetchOnReconnect=function(){return W3(this.currentQuery,this.options)},o.shouldFetchOnWindowFocus=function(){return H3(this.currentQuery,this.options)},o.destroy=function(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)},o.setOptions=function(u,d){var g=this.options,a=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(u),typeof this.options.enabled!="undefined"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=g.queryKey),this.updateQuery();var w=this.hasListeners();w&&ow(this.currentQuery,a,this.options,g)&&this.executeFetch(),this.updateResult(d),w&&(this.currentQuery!==a||this.options.enabled!==g.enabled||this.options.staleTime!==g.staleTime)&&this.updateStaleTimeout();var S=this.computeRefetchInterval();w&&(this.currentQuery!==a||this.options.enabled!==g.enabled||S!==this.currentRefetchInterval)&&this.updateRefetchInterval(S)},o.getOptimisticResult=function(u){var d=this.client.defaultQueryObserverOptions(u),g=this.client.getQueryCache().build(this.client,d);return this.createResult(g,d)},o.getCurrentResult=function(){return this.currentResult},o.trackResult=function(u,d){var g=this,a={},w=function(C){g.trackedProps.includes(C)||g.trackedProps.push(C)};return Object.keys(u).forEach(function(S){Object.defineProperty(a,S,{configurable:!1,enumerable:!0,get:function(){return w(S),u[S]}})}),(d.useErrorBoundary||d.suspense)&&w("error"),a},o.getNextResult=function(u){var d=this;return new Promise(function(g,a){var w=d.subscribe(function(S){S.isFetching||(w(),S.isError&&(u==null?void 0:u.throwOnError)?a(S.error):g(S))})})},o.getCurrentQuery=function(){return this.currentQuery},o.remove=function(){this.client.getQueryCache().remove(this.currentQuery)},o.refetch=function(u){return this.fetch(Ri({},u,{meta:{refetchPage:u==null?void 0:u.refetchPage}}))},o.fetchOptimistic=function(u){var d=this,g=this.client.defaultQueryObserverOptions(u),a=this.client.getQueryCache().build(this.client,g);return a.fetch().then(function(){return d.createResult(a,g)})},o.fetch=function(u){var d=this;return this.executeFetch(u).then(function(){return d.updateResult(),d.currentResult})},o.executeFetch=function(u){this.updateQuery();var d=this.currentQuery.fetch(this.options,u);return(u==null?void 0:u.throwOnError)||(d=d.catch(an)),d},o.updateStaleTimeout=function(){var u=this;if(this.clearStaleTimeout(),!(mm||this.currentResult.isStale||!$0(this.options.staleTime))){var d=KT(this.currentResult.dataUpdatedAt,this.options.staleTime),g=d+1;this.staleTimeoutId=setTimeout(function(){u.currentResult.isStale||u.updateResult()},g)}},o.computeRefetchInterval=function(){var u;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(u=this.options.refetchInterval)!=null?u:!1},o.updateRefetchInterval=function(u){var d=this;this.clearRefetchInterval(),this.currentRefetchInterval=u,!(mm||this.options.enabled===!1||!$0(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(function(){(d.options.refetchIntervalInBackground||Pf.isFocused())&&d.executeFetch()},this.currentRefetchInterval))},o.updateTimers=function(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())},o.clearTimers=function(){this.clearStaleTimeout(),this.clearRefetchInterval()},o.clearStaleTimeout=function(){clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0},o.clearRefetchInterval=function(){clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0},o.createResult=function(u,d){var g=this.currentQuery,a=this.options,w=this.currentResult,S=this.currentResultState,C=this.currentResultOptions,k=u!==g,F=k?u.state:this.currentQueryInitialState,R=k?this.currentResult:this.previousQueryResult,W=u.state,Z=W.dataUpdatedAt,X=W.error,q=W.errorUpdatedAt,ue=W.isFetching,pe=W.status,xe=!1,fe=!1,Te;if(d.optimisticResults){var Ie=this.hasListeners(),Le=!Ie&&sw(u,d),Pe=Ie&&ow(u,g,d,a);(Le||Pe)&&(ue=!0,Z||(pe="loading"))}if(d.keepPreviousData&&!W.dataUpdateCount&&(R==null?void 0:R.isSuccess)&&pe!=="error")Te=R.data,Z=R.dataUpdatedAt,pe=R.status,xe=!0;else if(d.select&&typeof W.data!="undefined"){var qe;if(w&&W.data===(S==null?void 0:S.data)&&d.select===((qe=this.previousSelect)==null?void 0:qe.fn)&&!this.previousSelectError)Te=this.previousSelect.result;else try{Te=d.select(W.data),d.structuralSharing!==!1&&(Te=ym(w==null?void 0:w.data,Te)),this.previousSelect={fn:d.select,result:Te},this.previousSelectError=null}catch(ct){vm().error(ct),X=ct,this.previousSelectError=ct,q=Date.now(),pe="error"}}else Te=W.data;if(typeof d.placeholderData!="undefined"&&typeof Te=="undefined"&&(pe==="loading"||pe==="idle")){var ze;if((w==null?void 0:w.isPlaceholderData)&&d.placeholderData===(C==null?void 0:C.placeholderData))ze=w.data;else if(ze=typeof d.placeholderData=="function"?d.placeholderData():d.placeholderData,d.select&&typeof ze!="undefined")try{ze=d.select(ze),d.structuralSharing!==!1&&(ze=ym(w==null?void 0:w.data,ze)),this.previousSelectError=null}catch(ct){vm().error(ct),X=ct,this.previousSelectError=ct,q=Date.now(),pe="error"}typeof ze!="undefined"&&(pe="success",Te=ze,fe=!0)}var lt={status:pe,isLoading:pe==="loading",isSuccess:pe==="success",isError:pe==="error",isIdle:pe==="idle",data:Te,dataUpdatedAt:Z,error:X,errorUpdatedAt:q,failureCount:W.fetchFailureCount,isFetched:W.dataUpdateCount>0||W.errorUpdateCount>0,isFetchedAfterMount:W.dataUpdateCount>F.dataUpdateCount||W.errorUpdateCount>F.errorUpdateCount,isFetching:ue,isRefetching:ue&&pe!=="loading",isLoadingError:pe==="error"&&W.dataUpdatedAt===0,isPlaceholderData:fe,isPreviousData:xe,isRefetchError:pe==="error"&&W.dataUpdatedAt!==0,isStale:sd(u,d),refetch:this.refetch,remove:this.remove};return lt},o.shouldNotifyListeners=function(u,d){if(!d)return!0;var g=this.options,a=g.notifyOnChangeProps,w=g.notifyOnChangePropsExclusions;if(!a&&!w||a==="tracked"&&!this.trackedProps.length)return!0;var S=a==="tracked"?this.trackedProps:a;return Object.keys(u).some(function(C){var k=C,F=u[k]!==d[k],R=S==null?void 0:S.some(function(Z){return Z===C}),W=w==null?void 0:w.some(function(Z){return Z===C});return F&&!W&&(!S||R)})},o.updateResult=function(u){var d=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,!I3(this.currentResult,d)){var g={cache:!0};(u==null?void 0:u.listeners)!==!1&&this.shouldNotifyListeners(this.currentResult,d)&&(g.listeners=!0),this.notify(Ri({},g,u))}},o.updateQuery=function(){var u=this.client.getQueryCache().build(this.client,this.options);if(u!==this.currentQuery){var d=this.currentQuery;this.currentQuery=u,this.currentQueryInitialState=u.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(d==null||d.removeObserver(this),u.addObserver(this))}},o.onQueryUpdate=function(u){var d={};u.type==="success"?d.onSuccess=!0:u.type==="error"&&!Qp(u.error)&&(d.onError=!0),this.updateResult(d),this.hasListeners()&&this.updateTimers()},o.notify=function(u){var d=this;Xr.batch(function(){u.onSuccess?(d.options.onSuccess==null||d.options.onSuccess(d.currentResult.data),d.options.onSettled==null||d.options.onSettled(d.currentResult.data,null)):u.onError&&(d.options.onError==null||d.options.onError(d.currentResult.error),d.options.onSettled==null||d.options.onSettled(void 0,d.currentResult.error)),u.listeners&&d.listeners.forEach(function(g){g(d.currentResult)}),u.cache&&d.client.getQueryCache().notify({query:d.currentQuery,type:"observerResultsUpdated"})})},i}(nd);function q3(t,i){return i.enabled!==!1&&!t.state.dataUpdatedAt&&!(t.state.status==="error"&&i.retryOnMount===!1)}function Z3(t,i){return i.enabled!==!1&&t.state.dataUpdatedAt>0&&(i.refetchOnMount==="always"||i.refetchOnMount!==!1&&sd(t,i))}function sw(t,i){return q3(t,i)||Z3(t,i)}function W3(t,i){return i.enabled!==!1&&(i.refetchOnReconnect==="always"||i.refetchOnReconnect!==!1&&sd(t,i))}function H3(t,i){return i.enabled!==!1&&(i.refetchOnWindowFocus==="always"||i.refetchOnWindowFocus!==!1&&sd(t,i))}function ow(t,i,o,l){return o.enabled!==!1&&(t!==i||l.enabled===!1)&&(!o.suspense||t.state.status!=="error")&&sd(t,o)}function sd(t,i){return t.isStaleByTime(i.staleTime)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Na=function(){return Na=Object.assign||function(i){for(var o,l=1,u=arguments.length;l<u;l++){o=arguments[l];for(var d in o)Object.prototype.hasOwnProperty.call(o,d)&&(i[d]=o[d])}return i},Na.apply(this,arguments)},X3="VUE_QUERY_CLIENT";function q0(t){var i=t?":".concat(t):"";return"".concat(X3).concat(i)}function K3(t){return typeof t=="string"||Array.isArray(t)}function Y3(t,i){Object.keys(t).forEach(function(o){t[o]=i[o]})}function Z0(t,i){if(i){var o=i(t);if(o!==void 0)return o}if(Array.isArray(t))return t.map(function(u){return Z0(u,i)});if(typeof t=="object"&&Q3(t)){var l=Object.entries(t).map(function(u){var d=u[0],g=u[1];return[d,Z0(g,i)]});return Object.fromEntries(l)}return t}function tE(t){return Z0(t,function(i){if(Ar(i))return tE(Xa(i))})}function Q3(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;var i=Object.getPrototypeOf(t);return i===null||i===Object.prototype}function J3(t){var i;t===void 0&&(t="");var o=(i=sh())===null||i===void 0?void 0:i.proxy;if(!o)throw new Error("vue-query hooks can only be used inside setup() function.");var l=q0(t),u=is(l);if(!u)throw new Error("No 'queryClient' found in Vue context, use 'VueQueryPlugin' to properly initialize the library.");return u}var u6={install:function(t,i){var o;i===void 0&&(i={});var l=q0(i.queryClientKey),u;if("queryClient"in i&&i.queryClient)u=i.queryClient;else{var d="queryClientConfig"in i?i.queryClientConfig:void 0;u=new $3(d)}u.mount();var g=function(){var w;u.unmount(),(w=i.additionalClients)===null||w===void 0||w.forEach(function(S){S.queryClient.unmount()})};if(t.onUnmount)t.onUnmount(g);else{var a=t.unmount;t.unmount=function(){g(),a()}}t.provide(l,u),(o=i.additionalClients)===null||o===void 0||o.forEach(function(w){var S=q0(w.queryClientKey);t.provide(S,w.queryClient),w.queryClient.mount()})}};function eD(t,i,o,l){o===void 0&&(o={}),l===void 0&&(l={});var u=C(),d=J3(u.queryClientKey),g=d.defaultQueryObserverOptions(u),a=new t(d,g),w=nh(a.getCurrentResult()),S=a.subscribe(function(k){Y3(w,k)});return Ao([function(){return i},function(){return o},function(){return l}],function(){a.setOptions(d.defaultQueryObserverOptions(C()))},{deep:!0}),r_(function(){S()}),Na(Na({},Tk(ix(w))),{suspense:function(){return a.fetchOptimistic(g)}});function C(){var k;return K3(i)?typeof o=="function"?k=Na(Na({},l),{queryKey:i,queryFn:o}):k=Na(Na({},o),{queryKey:i}):k=i,tE(k)}}function h6(t,i,o){return eD(G3,t,i,o)}/*!
  * vue-router v4.0.12
  * (c) 2021 Eduardo San Martin Morote
  * @license MIT
  */const iE=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",oh=t=>iE?Symbol(t):"_vr_"+t,tD=oh("rvlm"),aw=oh("rvd"),a_=oh("r"),yx=oh("rl"),W0=oh("rvl"),Tu=typeof window!="undefined";function iD(t){return t.__esModule||iE&&t[Symbol.toStringTag]==="Module"}const Wi=Object.assign;function Kg(t,i){const o={};for(const l in i){const u=i[l];o[l]=Array.isArray(u)?u.map(t):t(u)}return o}const Df=()=>{},rD=/\/$/,nD=t=>t.replace(rD,"");function Yg(t,i,o="/"){let l,u={},d="",g="";const a=i.indexOf("?"),w=i.indexOf("#",a>-1?a:0);return a>-1&&(l=i.slice(0,a),d=i.slice(a+1,w>-1?w:i.length),u=t(d)),w>-1&&(l=l||i.slice(0,w),g=i.slice(w,i.length)),l=lD(l!=null?l:i,o),{fullPath:l+(d&&"?")+d+g,path:l,query:u,hash:g}}function sD(t,i){const o=i.query?t(i.query):"";return i.path+(o&&"?")+o+(i.hash||"")}function lw(t,i){return!i||!t.toLowerCase().startsWith(i.toLowerCase())?t:t.slice(i.length)||"/"}function oD(t,i,o){const l=i.matched.length-1,u=o.matched.length-1;return l>-1&&l===u&&ju(i.matched[l],o.matched[u])&&rE(i.params,o.params)&&t(i.query)===t(o.query)&&i.hash===o.hash}function ju(t,i){return(t.aliasOf||t)===(i.aliasOf||i)}function rE(t,i){if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const o in t)if(!aD(t[o],i[o]))return!1;return!0}function aD(t,i){return Array.isArray(t)?cw(t,i):Array.isArray(i)?cw(i,t):t===i}function cw(t,i){return Array.isArray(i)?t.length===i.length&&t.every((o,l)=>o===i[l]):t.length===1&&t[0]===i}function lD(t,i){if(t.startsWith("/"))return t;if(!t)return i;const o=i.split("/"),l=t.split("/");let u=o.length-1,d,g;for(d=0;d<l.length;d++)if(g=l[d],!(u===1||g==="."))if(g==="..")u--;else break;return o.slice(0,u).join("/")+"/"+l.slice(d-(d===l.length?1:0)).join("/")}var Vu;(function(t){t.pop="pop",t.push="push"})(Vu||(Vu={}));var oc;(function(t){t.back="back",t.forward="forward",t.unknown=""})(oc||(oc={}));const Qg="";function nE(t){if(!t)if(Tu){const i=document.querySelector("base");t=i&&i.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),nD(t)}const cD=/^[^#]+#/;function sE(t,i){return t.replace(cD,"#")+i}function uD(t,i){const o=document.documentElement.getBoundingClientRect(),l=t.getBoundingClientRect();return{behavior:i.behavior,left:l.left-o.left-(i.left||0),top:l.top-o.top-(i.top||0)}}const l_=()=>({left:window.pageXOffset,top:window.pageYOffset});function hD(t){let i;if("el"in t){const o=t.el,l=typeof o=="string"&&o.startsWith("#"),u=typeof o=="string"?l?document.getElementById(o.slice(1)):document.querySelector(o):o;if(!u)return;i=uD(u,t)}else i=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(i):window.scrollTo(i.left!=null?i.left:window.pageXOffset,i.top!=null?i.top:window.pageYOffset)}function uw(t,i){return(history.state?history.state.position-i:-1)+t}const H0=new Map;function fD(t,i){H0.set(t,i)}function dD(t){const i=H0.get(t);return H0.delete(t),i}let pD=()=>location.protocol+"//"+location.host;function oE(t,i){const{pathname:o,search:l,hash:u}=i,d=t.indexOf("#");if(d>-1){let a=u.includes(t.slice(d))?t.slice(d).length:1,w=u.slice(a);return w[0]!=="/"&&(w="/"+w),lw(w,"")}return lw(o,t)+l+u}function mD(t,i,o,l){let u=[],d=[],g=null;const a=({state:F})=>{const R=oE(t,location),W=o.value,Z=i.value;let X=0;if(F){if(o.value=R,i.value=F,g&&g===W){g=null;return}X=Z?F.position-Z.position:0}else l(R);u.forEach(q=>{q(o.value,W,{delta:X,type:Vu.pop,direction:X?X>0?oc.forward:oc.back:oc.unknown})})};function w(){g=o.value}function S(F){u.push(F);const R=()=>{const W=u.indexOf(F);W>-1&&u.splice(W,1)};return d.push(R),R}function C(){const{history:F}=window;!F.state||F.replaceState(Wi({},F.state,{scroll:l_()}),"")}function k(){for(const F of d)F();d=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",C)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",C),{pauseListeners:w,listen:S,destroy:k}}function hw(t,i,o,l=!1,u=!1){return{back:t,current:i,forward:o,replaced:l,position:window.history.length,scroll:u?l_():null}}function _D(t){const{history:i,location:o}=window,l={value:oE(t,o)},u={value:i.state};u.value||d(l.value,{back:null,current:l.value,forward:null,position:i.length-1,replaced:!0,scroll:null},!0);function d(w,S,C){const k=t.indexOf("#"),F=k>-1?(o.host&&document.querySelector("base")?t:t.slice(k))+w:pD()+t+w;try{i[C?"replaceState":"pushState"](S,"",F),u.value=S}catch(R){console.error(R),o[C?"replace":"assign"](F)}}function g(w,S){const C=Wi({},i.state,hw(u.value.back,w,u.value.forward,!0),S,{position:u.value.position});d(w,C,!0),l.value=w}function a(w,S){const C=Wi({},u.value,i.state,{forward:w,scroll:l_()});d(C.current,C,!0);const k=Wi({},hw(l.value,w,null),{position:C.position+1},S);d(w,k,!1),l.value=w}return{location:l,state:u,push:a,replace:g}}function gD(t){t=nE(t);const i=_D(t),o=mD(t,i.state,i.location,i.replace);function l(d,g=!0){g||o.pauseListeners(),history.go(d)}const u=Wi({location:"",base:t,go:l,createHref:sE.bind(null,t)},i,o);return Object.defineProperty(u,"location",{enumerable:!0,get:()=>i.location.value}),Object.defineProperty(u,"state",{enumerable:!0,get:()=>i.state.value}),u}function yD(t=""){let i=[],o=[Qg],l=0;t=nE(t);function u(a){l++,l===o.length||o.splice(l),o.push(a)}function d(a,w,{direction:S,delta:C}){const k={direction:S,delta:C,type:Vu.pop};for(const F of i)F(a,w,k)}const g={location:Qg,state:{},base:t,createHref:sE.bind(null,t),replace(a){o.splice(l--,1),u(a)},push(a,w){u(a)},listen(a){return i.push(a),()=>{const w=i.indexOf(a);w>-1&&i.splice(w,1)}},destroy(){i=[],o=[Qg],l=0},go(a,w=!0){const S=this.location,C=a<0?oc.back:oc.forward;l=Math.max(0,Math.min(l+a,o.length-1)),w&&d(this.location,S,{direction:C,delta:a})}};return Object.defineProperty(g,"location",{enumerable:!0,get:()=>o[l]}),g}function xD(t){return typeof t=="string"||t&&typeof t=="object"}function aE(t){return typeof t=="string"||typeof t=="symbol"}const za={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},lE=oh("nf");var fw;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(fw||(fw={}));function $u(t,i){return Wi(new Error,{type:t,[lE]:!0},i)}function Gl(t,i){return t instanceof Error&&lE in t&&(i==null||!!(t.type&i))}const dw="[^/]+?",vD={sensitive:!1,strict:!1,start:!0,end:!0},bD=/[.+*?^${}()[\]/\\]/g;function wD(t,i){const o=Wi({},vD,i),l=[];let u=o.start?"^":"";const d=[];for(const S of t){const C=S.length?[]:[90];o.strict&&!S.length&&(u+="/");for(let k=0;k<S.length;k++){const F=S[k];let R=40+(o.sensitive?.25:0);if(F.type===0)k||(u+="/"),u+=F.value.replace(bD,"\\$&"),R+=40;else if(F.type===1){const{value:W,repeatable:Z,optional:X,regexp:q}=F;d.push({name:W,repeatable:Z,optional:X});const ue=q||dw;if(ue!==dw){R+=10;try{new RegExp(`(${ue})`)}catch(xe){throw new Error(`Invalid custom RegExp for param "${W}" (${ue}): `+xe.message)}}let pe=Z?`((?:${ue})(?:/(?:${ue}))*)`:`(${ue})`;k||(pe=X&&S.length<2?`(?:/${pe})`:"/"+pe),X&&(pe+="?"),u+=pe,R+=20,X&&(R+=-8),Z&&(R+=-20),ue===".*"&&(R+=-50)}C.push(R)}l.push(C)}if(o.strict&&o.end){const S=l.length-1;l[S][l[S].length-1]+=.7000000000000001}o.strict||(u+="/?"),o.end?u+="$":o.strict&&(u+="(?:/|$)");const g=new RegExp(u,o.sensitive?"":"i");function a(S){const C=S.match(g),k={};if(!C)return null;for(let F=1;F<C.length;F++){const R=C[F]||"",W=d[F-1];k[W.name]=R&&W.repeatable?R.split("/"):R}return k}function w(S){let C="",k=!1;for(const F of t){(!k||!C.endsWith("/"))&&(C+="/"),k=!1;for(const R of F)if(R.type===0)C+=R.value;else if(R.type===1){const{value:W,repeatable:Z,optional:X}=R,q=W in S?S[W]:"";if(Array.isArray(q)&&!Z)throw new Error(`Provided param "${W}" is an array but it is not repeatable (* or + modifiers)`);const ue=Array.isArray(q)?q.join("/"):q;if(!ue)if(X)F.length<2&&(C.endsWith("/")?C=C.slice(0,-1):k=!0);else throw new Error(`Missing required param "${W}"`);C+=ue}}return C}return{re:g,score:l,keys:d,parse:a,stringify:w}}function TD(t,i){let o=0;for(;o<t.length&&o<i.length;){const l=i[o]-t[o];if(l)return l;o++}return t.length<i.length?t.length===1&&t[0]===40+40?-1:1:t.length>i.length?i.length===1&&i[0]===40+40?1:-1:0}function ED(t,i){let o=0;const l=t.score,u=i.score;for(;o<l.length&&o<u.length;){const d=TD(l[o],u[o]);if(d)return d;o++}return u.length-l.length}const SD={type:0,value:""},AD=/[a-zA-Z0-9_]/;function CD(t){if(!t)return[[]];if(t==="/")return[[SD]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function i(R){throw new Error(`ERR (${o})/"${S}": ${R}`)}let o=0,l=o;const u=[];let d;function g(){d&&u.push(d),d=[]}let a=0,w,S="",C="";function k(){!S||(o===0?d.push({type:0,value:S}):o===1||o===2||o===3?(d.length>1&&(w==="*"||w==="+")&&i(`A repeatable param (${S}) must be alone in its segment. eg: '/:ids+.`),d.push({type:1,value:S,regexp:C,repeatable:w==="*"||w==="+",optional:w==="*"||w==="?"})):i("Invalid state to consume buffer"),S="")}function F(){S+=w}for(;a<t.length;){if(w=t[a++],w==="\\"&&o!==2){l=o,o=4;continue}switch(o){case 0:w==="/"?(S&&k(),g()):w===":"?(k(),o=1):F();break;case 4:F(),o=l;break;case 1:w==="("?o=2:AD.test(w)?F():(k(),o=0,w!=="*"&&w!=="?"&&w!=="+"&&a--);break;case 2:w===")"?C[C.length-1]=="\\"?C=C.slice(0,-1)+w:o=3:C+=w;break;case 3:k(),o=0,w!=="*"&&w!=="?"&&w!=="+"&&a--,C="";break;default:i("Unknown state");break}}return o===2&&i(`Unfinished custom RegExp for param "${S}"`),k(),g(),u}function ID(t,i,o){const l=wD(CD(t.path),o),u=Wi(l,{record:t,parent:i,children:[],alias:[]});return i&&!u.record.aliasOf==!i.record.aliasOf&&i.children.push(u),u}function MD(t,i){const o=[],l=new Map;i=mw({strict:!1,end:!0,sensitive:!1},i);function u(C){return l.get(C)}function d(C,k,F){const R=!F,W=PD(C);W.aliasOf=F&&F.record;const Z=mw(i,C),X=[W];if("alias"in C){const pe=typeof C.alias=="string"?[C.alias]:C.alias;for(const xe of pe)X.push(Wi({},W,{components:F?F.record.components:W.components,path:xe,aliasOf:F?F.record:W}))}let q,ue;for(const pe of X){const{path:xe}=pe;if(k&&xe[0]!=="/"){const fe=k.record.path,Te=fe[fe.length-1]==="/"?"":"/";pe.path=k.record.path+(xe&&Te+xe)}if(q=ID(pe,k,Z),F?F.alias.push(q):(ue=ue||q,ue!==q&&ue.alias.push(q),R&&C.name&&!pw(q)&&g(C.name)),"children"in W){const fe=W.children;for(let Te=0;Te<fe.length;Te++)d(fe[Te],q,F&&F.children[Te])}F=F||q,w(q)}return ue?()=>{g(ue)}:Df}function g(C){if(aE(C)){const k=l.get(C);k&&(l.delete(C),o.splice(o.indexOf(k),1),k.children.forEach(g),k.alias.forEach(g))}else{const k=o.indexOf(C);k>-1&&(o.splice(k,1),C.record.name&&l.delete(C.record.name),C.children.forEach(g),C.alias.forEach(g))}}function a(){return o}function w(C){let k=0;for(;k<o.length&&ED(C,o[k])>=0;)k++;o.splice(k,0,C),C.record.name&&!pw(C)&&l.set(C.record.name,C)}function S(C,k){let F,R={},W,Z;if("name"in C&&C.name){if(F=l.get(C.name),!F)throw $u(1,{location:C});Z=F.record.name,R=Wi(kD(k.params,F.keys.filter(ue=>!ue.optional).map(ue=>ue.name)),C.params),W=F.stringify(R)}else if("path"in C)W=C.path,F=o.find(ue=>ue.re.test(W)),F&&(R=F.parse(W),Z=F.record.name);else{if(F=k.name?l.get(k.name):o.find(ue=>ue.re.test(k.path)),!F)throw $u(1,{location:C,currentLocation:k});Z=F.record.name,R=Wi({},k.params,C.params),W=F.stringify(R)}const X=[];let q=F;for(;q;)X.unshift(q.record),q=q.parent;return{name:Z,path:W,params:R,matched:X,meta:zD(X)}}return t.forEach(C=>d(C)),{addRoute:d,resolve:S,removeRoute:g,getRoutes:a,getRecordMatcher:u}}function kD(t,i){const o={};for(const l of i)l in t&&(o[l]=t[l]);return o}function PD(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:DD(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||{}:{default:t.component}}}function DD(t){const i={},o=t.props||!1;if("component"in t)i.default=o;else for(const l in t.components)i[l]=typeof o=="boolean"?o:o[l];return i}function pw(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function zD(t){return t.reduce((i,o)=>Wi(i,o.meta),{})}function mw(t,i){const o={};for(const l in t)o[l]=l in i?i[l]:t[l];return o}const cE=/#/g,RD=/&/g,FD=/\//g,LD=/=/g,OD=/\?/g,uE=/\+/g,BD=/%5B/g,UD=/%5D/g,hE=/%5E/g,ND=/%60/g,fE=/%7B/g,jD=/%7C/g,dE=/%7D/g,VD=/%20/g;function xx(t){return encodeURI(""+t).replace(jD,"|").replace(BD,"[").replace(UD,"]")}function $D(t){return xx(t).replace(fE,"{").replace(dE,"}").replace(hE,"^")}function X0(t){return xx(t).replace(uE,"%2B").replace(VD,"+").replace(cE,"%23").replace(RD,"%26").replace(ND,"`").replace(fE,"{").replace(dE,"}").replace(hE,"^")}function GD(t){return X0(t).replace(LD,"%3D")}function qD(t){return xx(t).replace(cE,"%23").replace(OD,"%3F")}function ZD(t){return t==null?"":qD(t).replace(FD,"%2F")}function bm(t){try{return decodeURIComponent(""+t)}catch{}return""+t}function WD(t){const i={};if(t===""||t==="?")return i;const l=(t[0]==="?"?t.slice(1):t).split("&");for(let u=0;u<l.length;++u){const d=l[u].replace(uE," "),g=d.indexOf("="),a=bm(g<0?d:d.slice(0,g)),w=g<0?null:bm(d.slice(g+1));if(a in i){let S=i[a];Array.isArray(S)||(S=i[a]=[S]),S.push(w)}else i[a]=w}return i}function _w(t){let i="";for(let o in t){const l=t[o];if(o=GD(o),l==null){l!==void 0&&(i+=(i.length?"&":"")+o);continue}(Array.isArray(l)?l.map(d=>d&&X0(d)):[l&&X0(l)]).forEach(d=>{d!==void 0&&(i+=(i.length?"&":"")+o,d!=null&&(i+="="+d))})}return i}function HD(t){const i={};for(const o in t){const l=t[o];l!==void 0&&(i[o]=Array.isArray(l)?l.map(u=>u==null?null:""+u):l==null?l:""+l)}return i}function cf(){let t=[];function i(l){return t.push(l),()=>{const u=t.indexOf(l);u>-1&&t.splice(u,1)}}function o(){t=[]}return{add:i,list:()=>t,reset:o}}function ja(t,i,o,l,u){const d=l&&(l.enterCallbacks[u]=l.enterCallbacks[u]||[]);return()=>new Promise((g,a)=>{const w=k=>{k===!1?a($u(4,{from:o,to:i})):k instanceof Error?a(k):xD(k)?a($u(2,{from:i,to:k})):(d&&l.enterCallbacks[u]===d&&typeof k=="function"&&d.push(k),g())},S=t.call(l&&l.instances[u],i,o,w);let C=Promise.resolve(S);t.length<3&&(C=C.then(w)),C.catch(k=>a(k))})}function Jg(t,i,o,l){const u=[];for(const d of t)for(const g in d.components){let a=d.components[g];if(!(i!=="beforeRouteEnter"&&!d.instances[g]))if(XD(a)){const S=(a.__vccOpts||a)[i];S&&u.push(ja(S,o,l,d,g))}else{let w=a();u.push(()=>w.then(S=>{if(!S)return Promise.reject(new Error(`Couldn't resolve component "${g}" at "${d.path}"`));const C=iD(S)?S.default:S;d.components[g]=C;const F=(C.__vccOpts||C)[i];return F&&ja(F,o,l,d,g)()}))}}return u}function XD(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function gw(t){const i=is(a_),o=is(yx),l=bn(()=>i.resolve(Xa(t.to))),u=bn(()=>{const{matched:w}=l.value,{length:S}=w,C=w[S-1],k=o.matched;if(!C||!k.length)return-1;const F=k.findIndex(ju.bind(null,C));if(F>-1)return F;const R=yw(w[S-2]);return S>1&&yw(C)===R&&k[k.length-1].path!==R?k.findIndex(ju.bind(null,w[S-2])):F}),d=bn(()=>u.value>-1&&JD(o.params,l.value.params)),g=bn(()=>u.value>-1&&u.value===o.matched.length-1&&rE(o.params,l.value.params));function a(w={}){return QD(w)?i[Xa(t.replace)?"replace":"push"](Xa(t.to)).catch(Df):Promise.resolve()}return{route:l,href:bn(()=>l.value.href),isActive:d,isExactActive:g,navigate:a}}const KD=e_({name:"RouterLink",props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:gw,setup(t,{slots:i}){const o=nh(gw(t)),{options:l}=is(a_),u=bn(()=>({[xw(t.activeClass,l.linkActiveClass,"router-link-active")]:o.isActive,[xw(t.exactActiveClass,l.linkExactActiveClass,"router-link-exact-active")]:o.isExactActive}));return()=>{const d=i.default&&i.default(o);return t.custom?d:s_("a",{"aria-current":o.isExactActive?t.ariaCurrentValue:null,href:o.href,onClick:o.navigate,class:u.value},d)}}}),YD=KD;function QD(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const i=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(i))return}return t.preventDefault&&t.preventDefault(),!0}}function JD(t,i){for(const o in i){const l=i[o],u=t[o];if(typeof l=="string"){if(l!==u)return!1}else if(!Array.isArray(u)||u.length!==l.length||l.some((d,g)=>d!==u[g]))return!1}return!0}function yw(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const xw=(t,i,o)=>t!=null?t:i!=null?i:o,ez=e_({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},setup(t,{attrs:i,slots:o}){const l=is(W0),u=bn(()=>t.route||l.value),d=is(aw,0),g=bn(()=>u.value.matched[d]);Hp(aw,d+1),Hp(tD,g),Hp(W0,u);const a=Pr();return Ao(()=>[a.value,g.value,t.name],([w,S,C],[k,F,R])=>{S&&(S.instances[C]=w,F&&F!==S&&w&&w===k&&(S.leaveGuards.size||(S.leaveGuards=F.leaveGuards),S.updateGuards.size||(S.updateGuards=F.updateGuards))),w&&S&&(!F||!ju(S,F)||!k)&&(S.enterCallbacks[C]||[]).forEach(W=>W(w))},{flush:"post"}),()=>{const w=u.value,S=g.value,C=S&&S.components[t.name],k=t.name;if(!C)return vw(o.default,{Component:C,route:w});const F=S.props[t.name],R=F?F===!0?w.params:typeof F=="function"?F(w):F:null,Z=s_(C,Wi({},R,i,{onVnodeUnmounted:X=>{X.component.isUnmounted&&(S.instances[k]=null)},ref:a}));return vw(o.default,{Component:Z,route:w})||Z}}});function vw(t,i){if(!t)return null;const o=t(i);return o.length===1?o[0]:o}const tz=ez;function iz(t){const i=MD(t.routes,t),o=t.parseQuery||WD,l=t.stringifyQuery||_w,u=t.history,d=cf(),g=cf(),a=cf(),w=vk(za);let S=za;Tu&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const C=Kg.bind(null,it=>""+it),k=Kg.bind(null,ZD),F=Kg.bind(null,bm);function R(it,It){let mt,Dt;return aE(it)?(mt=i.getRecordMatcher(it),Dt=It):Dt=it,i.addRoute(Dt,mt)}function W(it){const It=i.getRecordMatcher(it);It&&i.removeRoute(It)}function Z(){return i.getRoutes().map(it=>it.record)}function X(it){return!!i.getRecordMatcher(it)}function q(it,It){if(It=Wi({},It||w.value),typeof it=="string"){const Gt=Yg(o,it,It.path),ce=i.resolve({path:Gt.path},It),me=u.createHref(Gt.fullPath);return Wi(Gt,ce,{params:F(ce.params),hash:bm(Gt.hash),redirectedFrom:void 0,href:me})}let mt;if("path"in it)mt=Wi({},it,{path:Yg(o,it.path,It.path).path});else{const Gt=Wi({},it.params);for(const ce in Gt)Gt[ce]==null&&delete Gt[ce];mt=Wi({},it,{params:k(it.params)}),It.params=k(It.params)}const Dt=i.resolve(mt,It),mi=it.hash||"";Dt.params=C(F(Dt.params));const xi=sD(l,Wi({},it,{hash:$D(mi),path:Dt.path})),Zt=u.createHref(xi);return Wi({fullPath:xi,hash:mi,query:l===_w?HD(it.query):it.query||{}},Dt,{redirectedFrom:void 0,href:Zt})}function ue(it){return typeof it=="string"?Yg(o,it,w.value.path):Wi({},it)}function pe(it,It){if(S!==it)return $u(8,{from:It,to:it})}function xe(it){return Ie(it)}function fe(it){return xe(Wi(ue(it),{replace:!0}))}function Te(it){const It=it.matched[it.matched.length-1];if(It&&It.redirect){const{redirect:mt}=It;let Dt=typeof mt=="function"?mt(it):mt;return typeof Dt=="string"&&(Dt=Dt.includes("?")||Dt.includes("#")?Dt=ue(Dt):{path:Dt},Dt.params={}),Wi({query:it.query,hash:it.hash,params:it.params},Dt)}}function Ie(it,It){const mt=S=q(it),Dt=w.value,mi=it.state,xi=it.force,Zt=it.replace===!0,Gt=Te(mt);if(Gt)return Ie(Wi(ue(Gt),{state:mi,force:xi,replace:Zt}),It||mt);const ce=mt;ce.redirectedFrom=It;let me;return!xi&&oD(l,Dt,mt)&&(me=$u(16,{to:ce,from:Dt}),Ti(Dt,Dt,!0,!1)),(me?Promise.resolve(me):Pe(ce,Dt)).catch(Re=>Gl(Re)?Re:gt(Re,ce,Dt)).then(Re=>{if(Re){if(Gl(Re,2))return Ie(Wi(ue(Re.to),{state:mi,force:xi,replace:Zt}),It||ce)}else Re=ze(ce,Dt,!0,Zt,mi);return qe(ce,Dt,Re),Re})}function Le(it,It){const mt=pe(it,It);return mt?Promise.reject(mt):Promise.resolve()}function Pe(it,It){let mt;const[Dt,mi,xi]=rz(it,It);mt=Jg(Dt.reverse(),"beforeRouteLeave",it,It);for(const Gt of Dt)Gt.leaveGuards.forEach(ce=>{mt.push(ja(ce,it,It))});const Zt=Le.bind(null,it,It);return mt.push(Zt),_u(mt).then(()=>{mt=[];for(const Gt of d.list())mt.push(ja(Gt,it,It));return mt.push(Zt),_u(mt)}).then(()=>{mt=Jg(mi,"beforeRouteUpdate",it,It);for(const Gt of mi)Gt.updateGuards.forEach(ce=>{mt.push(ja(ce,it,It))});return mt.push(Zt),_u(mt)}).then(()=>{mt=[];for(const Gt of it.matched)if(Gt.beforeEnter&&!It.matched.includes(Gt))if(Array.isArray(Gt.beforeEnter))for(const ce of Gt.beforeEnter)mt.push(ja(ce,it,It));else mt.push(ja(Gt.beforeEnter,it,It));return mt.push(Zt),_u(mt)}).then(()=>(it.matched.forEach(Gt=>Gt.enterCallbacks={}),mt=Jg(xi,"beforeRouteEnter",it,It),mt.push(Zt),_u(mt))).then(()=>{mt=[];for(const Gt of g.list())mt.push(ja(Gt,it,It));return mt.push(Zt),_u(mt)}).catch(Gt=>Gl(Gt,8)?Gt:Promise.reject(Gt))}function qe(it,It,mt){for(const Dt of a.list())Dt(it,It,mt)}function ze(it,It,mt,Dt,mi){const xi=pe(it,It);if(xi)return xi;const Zt=It===za,Gt=Tu?history.state:{};mt&&(Dt||Zt?u.replace(it.fullPath,Wi({scroll:Zt&&Gt&&Gt.scroll},mi)):u.push(it.fullPath,mi)),w.value=it,Ti(it,It,mt,Zt),bt()}let lt;function ct(){lt=u.listen((it,It,mt)=>{const Dt=q(it),mi=Te(Dt);if(mi){Ie(Wi(mi,{replace:!0}),Dt).catch(Df);return}S=Dt;const xi=w.value;Tu&&fD(uw(xi.fullPath,mt.delta),l_()),Pe(Dt,xi).catch(Zt=>Gl(Zt,12)?Zt:Gl(Zt,2)?(Ie(Zt.to,Dt).then(Gt=>{Gl(Gt,20)&&!mt.delta&&mt.type===Vu.pop&&u.go(-1,!1)}).catch(Df),Promise.reject()):(mt.delta&&u.go(-mt.delta,!1),gt(Zt,Dt,xi))).then(Zt=>{Zt=Zt||ze(Dt,xi,!1),Zt&&(mt.delta?u.go(-mt.delta,!1):mt.type===Vu.pop&&Gl(Zt,20)&&u.go(-1,!1)),qe(Dt,xi,Zt)}).catch(Df)})}let be=cf(),Ze=cf(),Qe;function gt(it,It,mt){bt(it);const Dt=Ze.list();return Dt.length?Dt.forEach(mi=>mi(it,It,mt)):console.error(it),Promise.reject(it)}function St(){return Qe&&w.value!==za?Promise.resolve():new Promise((it,It)=>{be.add([it,It])})}function bt(it){Qe||(Qe=!0,ct(),be.list().forEach(([It,mt])=>it?mt(it):It()),be.reset())}function Ti(it,It,mt,Dt){const{scrollBehavior:mi}=t;if(!Tu||!mi)return Promise.resolve();const xi=!mt&&dD(uw(it.fullPath,0))||(Dt||!mt)&&history.state&&history.state.scroll||null;return ox().then(()=>mi(it,It,xi)).then(Zt=>Zt&&hD(Zt)).catch(Zt=>gt(Zt,it,It))}const Pt=it=>u.go(it);let Bi;const Ei=new Set;return{currentRoute:w,addRoute:R,removeRoute:W,hasRoute:X,getRoutes:Z,resolve:q,options:t,push:xe,replace:fe,go:Pt,back:()=>Pt(-1),forward:()=>Pt(1),beforeEach:d.add,beforeResolve:g.add,afterEach:a.add,onError:Ze.add,isReady:St,install(it){const It=this;it.component("RouterLink",YD),it.component("RouterView",tz),it.config.globalProperties.$router=It,Object.defineProperty(it.config.globalProperties,"$route",{enumerable:!0,get:()=>Xa(w)}),Tu&&!Bi&&w.value===za&&(Bi=!0,xe(u.location).catch(mi=>{}));const mt={};for(const mi in za)mt[mi]=bn(()=>w.value[mi]);it.provide(a_,It),it.provide(yx,nh(mt)),it.provide(W0,w);const Dt=it.unmount;Ei.add(it),it.unmount=function(){Ei.delete(it),Ei.size<1&&(S=za,lt&&lt(),w.value=za,Bi=!1,Qe=!1),Dt()}}}}function _u(t){return t.reduce((i,o)=>i.then(()=>o()),Promise.resolve())}function rz(t,i){const o=[],l=[],u=[],d=Math.max(i.matched.length,t.matched.length);for(let g=0;g<d;g++){const a=i.matched[g];a&&(t.matched.find(S=>ju(S,a))?l.push(a):o.push(a));const w=t.matched[g];w&&(i.matched.find(S=>ju(S,w))||u.push(w))}return[o,l,u]}function f6(){return is(a_)}function d6(){return is(yx)}var nz=Object.defineProperty,sz=Object.defineProperties,oz=Object.getOwnPropertyDescriptors,bw=Object.getOwnPropertySymbols,az=Object.prototype.hasOwnProperty,lz=Object.prototype.propertyIsEnumerable,ww=(t,i,o)=>i in t?nz(t,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[i]=o,pE=(t,i)=>{for(var o in i||(i={}))az.call(i,o)&&ww(t,o,i[o]);if(bw)for(var o of bw(i))lz.call(i,o)&&ww(t,o,i[o]);return t},cz=(t,i)=>sz(t,oz(i)),mE="usehead",Tw="head:count",e0="data-head-attrs",uz=(t,i,o)=>{const l=o.createElement(t);for(const u of Object.keys(i)){let d=i[u];u==="key"||d===!1||(u==="children"?l.textContent=d:l.setAttribute(u,d))}return l};function hz(t,i){if(t instanceof HTMLElement&&i instanceof HTMLElement){const o=i.getAttribute("nonce");if(o&&!t.getAttribute("nonce")){const l=i.cloneNode(!0);return l.setAttribute("nonce",""),l.nonce=o,o===t.nonce&&t.isEqualNode(l)}}return t.isEqualNode(i)}var fz=t=>{const i=["key","id","name","property"];for(const o of i){const l=typeof t.getAttribute=="function"?t.hasAttribute(o)?t.getAttribute(o):void 0:t[o];if(l!==void 0)return{name:o,value:l}}},dz=()=>{const t=is(mE);if(!t)throw new Error("You may forget to apply app.use(head)");return t},pz=["title","meta","link","base","style","script","htmlAttrs","bodyAttrs"],mz=t=>{const i=[];for(const o of Object.keys(t))if(t[o]!=null){if(o==="title")i.push({tag:o,props:{children:t[o]}});else if(o==="base")i.push({tag:o,props:pE({key:"default"},t[o])});else if(pz.includes(o)){const l=t[o];Array.isArray(l)?l.forEach(u=>{i.push({tag:o,props:u})}):l&&i.push({tag:o,props:l})}}return i},Ew=(t,i)=>{const o=t.getAttribute(e0);if(o)for(const u of o.split(","))u in i||t.removeAttribute(u);const l=[];for(const u in i){const d=i[u];d!=null&&(d===!1?t.removeAttribute(u):t.setAttribute(u,d),l.push(u))}l.length?t.setAttribute(e0,l.join(",")):t.removeAttribute(e0)},_z=(t=window.document,i,o)=>{var l;const u=t.head;let d=u.querySelector(`meta[name="${Tw}"]`);const g=d?Number(d.getAttribute("content")):0,a=[];if(d)for(let S=0,C=d.previousElementSibling;S<g;S++,C=(C==null?void 0:C.previousElementSibling)||null)((l=C==null?void 0:C.tagName)==null?void 0:l.toLowerCase())===i&&a.push(C);else d=t.createElement("meta"),d.setAttribute("name",Tw),d.setAttribute("content","0"),u.append(d);let w=o.map(S=>uz(S.tag,S.props,t));w=w.filter(S=>{for(let C=0;C<a.length;C++){const k=a[C];if(hz(k,S))return a.splice(C,1),!1}return!0}),a.forEach(S=>{var C;return(C=S.parentNode)==null?void 0:C.removeChild(S)}),w.forEach(S=>{u.insertBefore(S,d)}),d.setAttribute("content",""+(g-a.length+w.length))},gz=()=>{let t=[];const i={install(o){o.config.globalProperties.$head=i,o.provide(mE,i)},get headTags(){const o=[];return t.forEach(l=>{mz(l.value).forEach(d=>{if(d.tag==="meta"||d.tag==="base"||d.tag==="script"){const g=fz(d.props);if(g){let a=-1;for(let w=0;w<o.length;w++){const S=o[w],C=S.props[g.name],k=d.props[g.name];if(S.tag===d.tag&&C===k){a=w;break}}a!==-1&&o.splice(a,1)}}o.push(d)})}),o},addHeadObjs(o){t.push(o)},removeHeadObjs(o){t=t.filter(l=>l!==o)},updateDOM(o=window.document){let l,u={},d={};const g={};for(const a of i.headTags){if(a.tag==="title"){l=a.props.children;continue}if(a.tag==="htmlAttrs"){Object.assign(u,a.props);continue}if(a.tag==="bodyAttrs"){Object.assign(d,a.props);continue}g[a.tag]=g[a.tag]||[],g[a.tag].push(a)}l!==void 0&&(o.title=l),Ew(o.documentElement,u),Ew(o.body,d);for(const a of Object.keys(g))_z(o,a,g[a])}};return i},yz=typeof window!="undefined",xz=t=>{const i={title:void 0,htmlAttrs:void 0,bodyAttrs:void 0,base:void 0,meta:[],link:[],style:[],script:[]};for(const o of t){const l=o.type==="html"?"htmlAttrs":o.type==="body"?"bodyAttrs":o.type;if(typeof l!="string"||!(l in i))continue;const u=cz(pE({},o.props),{children:Array.isArray(o.children)?o.children[0].children:o.children});Array.isArray(i[l])?i[l].push(u):l==="title"?i.title=u.children:i[l]=u}return i},p6=e_({name:"Head",setup(t,{slots:i}){const o=dz();let l;return ux(()=>{l&&(o.removeHeadObjs(l),o.updateDOM())}),()=>(Uk(()=>{!i.default||(l&&o.removeHeadObjs(l),l=Pr(xz(i.default())),o.addHeadObjs(l),yz&&o.updateDOM())}),null)}});function vz(t){try{return JSON.parse(t||"{}")}catch(i){return console.error("[SSG] On state deserialization -",i,t),{}}}function bz(t){return document.readyState==="loading"?new Promise(i=>{document.addEventListener("DOMContentLoaded",()=>i(t))}):Promise.resolve(t)}const wz=e_({setup(t,{slots:i}){const o=Pr(!1);return id(()=>o.value=!0),()=>o.value&&i.default&&i.default({})}});function m6(t,i,o,l={}){const{transformState:u,registerComponents:d=!0,useHead:g=!0,rootContainer:a="#app"}=l,w=typeof window!="undefined";async function S(C=!1,k){var Ie,Le;const F=C?JP(t):e3(t);let R;g&&(R=gz(),F.use(R));const W=iz(jg({history:C?gD(i.base):yD(i.base)},i)),{routes:Z}=i;d&&F.component("ClientOnly",C?wz:{render:()=>null});const X=[],pe={app:F,head:R,isClient:w,router:W,routes:Z,onSSRAppRendered:C?()=>{}:Pe=>X.push(Pe),triggerOnSSRAppRendered:()=>Promise.all(X.map(Pe=>Pe())),initialState:{},transformState:u,routePath:k};C&&(await bz(),pe.initialState=(u==null?void 0:u(window.__INITIAL_STATE__||{}))||vz(window.__INITIAL_STATE__)),await(o==null?void 0:o(pe)),F.use(W);let xe,fe=!0;if(W.beforeEach((Pe,qe,ze)=>{(fe||xe&&xe===Pe.path)&&(fe=!1,xe=Pe.path,Pe.meta.state=pe.initialState),ze()}),!C){const Pe=(Le=(Ie=pe.routePath)!=null?Ie:i.base)!=null?Le:"/";W.push(Pe),await W.isReady(),pe.initialState=W.currentRoute.value.meta.state||{}}const Te=pe.initialState;return sb(jg({},pe),{initialState:Te})}return w&&(async()=>{const{app:C,router:k}=await S(!0);await k.isReady(),C.mount(a,!0)})(),S}function K0(t,i){return t==null||i==null?NaN:t<i?-1:t>i?1:t>=i?0:NaN}function _E(t){let i=t,o=t,l=t;t.length!==2&&(i=(a,w)=>t(a)-w,o=K0,l=(a,w)=>K0(t(a),w));function u(a,w,S=0,C=a.length){if(S<C){if(o(w,w)!==0)return C;do{const k=S+C>>>1;l(a[k],w)<0?S=k+1:C=k}while(S<C)}return S}function d(a,w,S=0,C=a.length){if(S<C){if(o(w,w)!==0)return C;do{const k=S+C>>>1;l(a[k],w)<=0?S=k+1:C=k}while(S<C)}return S}function g(a,w,S=0,C=a.length){const k=u(a,w,S,C-1);return k>S&&i(a[k-1],w)>-i(a[k],w)?k-1:k}return{left:u,center:g,right:d}}function Tz(t){return t===null?NaN:+t}const Ez=_E(K0),Sz=Ez.right;_E(Tz).center;var Az=Sz;function Cz(t,i){let o=0;if(i===void 0)for(let l of t)l!=null&&(l=+l)>=l&&++o;else{let l=-1;for(let u of t)(u=i(u,++l,t))!=null&&(u=+u)>=u&&++o}return o}function Iz(t,i){let o,l;if(i===void 0)for(const u of t)u!=null&&(o===void 0?u>=u&&(o=l=u):(o>u&&(o=u),l<u&&(l=u)));else{let u=-1;for(let d of t)(d=i(d,++u,t))!=null&&(o===void 0?d>=d&&(o=l=d):(o>d&&(o=d),l<d&&(l=d)))}return[o,l]}class Gu{constructor(){this._partials=new Float64Array(32),this._n=0}add(i){const o=this._partials;let l=0;for(let u=0;u<this._n&&u<32;u++){const d=o[u],g=i+d,a=Math.abs(i)<Math.abs(d)?i-(g-d):d-(g-i);a&&(o[l++]=a),i=g}return o[l]=i,this._n=l+1,this}valueOf(){const i=this._partials;let o=this._n,l,u,d,g=0;if(o>0){for(g=i[--o];o>0&&(l=g,u=i[--o],g=l+u,d=u-(g-l),!d););o>0&&(d<0&&i[o-1]<0||d>0&&i[o-1]>0)&&(u=d*2,l=g+u,u==l-g&&(g=l))}return g}}var Y0=Math.sqrt(50),Q0=Math.sqrt(10),J0=Math.sqrt(2);function gE(t,i,o){var l,u=-1,d,g,a;if(i=+i,t=+t,o=+o,t===i&&o>0)return[t];if((l=i<t)&&(d=t,t=i,i=d),(a=yE(t,i,o))===0||!isFinite(a))return[];if(a>0){let w=Math.round(t/a),S=Math.round(i/a);for(w*a<t&&++w,S*a>i&&--S,g=new Array(d=S-w+1);++u<d;)g[u]=(w+u)*a}else{a=-a;let w=Math.round(t*a),S=Math.round(i*a);for(w/a<t&&++w,S/a>i&&--S,g=new Array(d=S-w+1);++u<d;)g[u]=(w+u)/a}return l&&g.reverse(),g}function yE(t,i,o){var l=(i-t)/Math.max(0,o),u=Math.floor(Math.log(l)/Math.LN10),d=l/Math.pow(10,u);return u>=0?(d>=Y0?10:d>=Q0?5:d>=J0?2:1)*Math.pow(10,u):-Math.pow(10,-u)/(d>=Y0?10:d>=Q0?5:d>=J0?2:1)}function vx(t,i,o){var l=Math.abs(i-t)/Math.max(0,o),u=Math.pow(10,Math.floor(Math.log(l)/Math.LN10)),d=l/u;return d>=Y0?u*=10:d>=Q0?u*=5:d>=J0&&(u*=2),i<t?-u:u}function Mz(t){return Math.ceil(Math.log(Cz(t))/Math.LN2)+1}function kz(t,i){let o;if(i===void 0)for(const l of t)l!=null&&(o<l||o===void 0&&l>=l)&&(o=l);else{let l=-1;for(let u of t)(u=i(u,++l,t))!=null&&(o<u||o===void 0&&u>=u)&&(o=u)}return o}function Pz(t,i,o){t=+t,i=+i,o=(u=arguments.length)<2?(i=t,t=0,1):u<3?1:+o;for(var l=-1,u=Math.max(0,Math.ceil((i-t)/o))|0,d=new Array(u);++l<u;)d[l]=t+l*o;return d}function _6(t,i){if(typeof t[Symbol.iterator]!="function")throw new TypeError("values is not iterable");if(typeof i!="function")throw new TypeError("mapper is not a function");return Array.from(t,(o,l)=>i(o,l,t))}function Dz(t){return t}var t0=1,i0=2,ey=3,_f=4,Sw=1e-6;function zz(t){return"translate("+t+",0)"}function Rz(t){return"translate(0,"+t+")"}function Fz(t){return i=>+t(i)}function Lz(t,i){return i=Math.max(0,t.bandwidth()-i*2)/2,t.round()&&(i=Math.round(i)),o=>+t(o)+i}function Oz(){return!this.__axis}function xE(t,i){var o=[],l=null,u=null,d=6,g=6,a=3,w=typeof window!="undefined"&&window.devicePixelRatio>1?0:.5,S=t===t0||t===_f?-1:1,C=t===_f||t===i0?"x":"y",k=t===t0||t===ey?zz:Rz;function F(R){var W=l==null?i.ticks?i.ticks.apply(i,o):i.domain():l,Z=u==null?i.tickFormat?i.tickFormat.apply(i,o):Dz:u,X=Math.max(d,0)+a,q=i.range(),ue=+q[0]+w,pe=+q[q.length-1]+w,xe=(i.bandwidth?Lz:Fz)(i.copy(),w),fe=R.selection?R.selection():R,Te=fe.selectAll(".domain").data([null]),Ie=fe.selectAll(".tick").data(W,i).order(),Le=Ie.exit(),Pe=Ie.enter().append("g").attr("class","tick"),qe=Ie.select("line"),ze=Ie.select("text");Te=Te.merge(Te.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),Ie=Ie.merge(Pe),qe=qe.merge(Pe.append("line").attr("stroke","currentColor").attr(C+"2",S*d)),ze=ze.merge(Pe.append("text").attr("fill","currentColor").attr(C,S*X).attr("dy",t===t0?"0em":t===ey?"0.71em":"0.32em")),R!==fe&&(Te=Te.transition(R),Ie=Ie.transition(R),qe=qe.transition(R),ze=ze.transition(R),Le=Le.transition(R).attr("opacity",Sw).attr("transform",function(lt){return isFinite(lt=xe(lt))?k(lt+w):this.getAttribute("transform")}),Pe.attr("opacity",Sw).attr("transform",function(lt){var ct=this.parentNode.__axis;return k((ct&&isFinite(ct=ct(lt))?ct:xe(lt))+w)})),Le.remove(),Te.attr("d",t===_f||t===i0?g?"M"+S*g+","+ue+"H"+w+"V"+pe+"H"+S*g:"M"+w+","+ue+"V"+pe:g?"M"+ue+","+S*g+"V"+w+"H"+pe+"V"+S*g:"M"+ue+","+w+"H"+pe),Ie.attr("opacity",1).attr("transform",function(lt){return k(xe(lt)+w)}),qe.attr(C+"2",S*d),ze.attr(C,S*X).text(Z),fe.filter(Oz).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===i0?"start":t===_f?"end":"middle"),fe.each(function(){this.__axis=xe})}return F.scale=function(R){return arguments.length?(i=R,F):i},F.ticks=function(){return o=Array.from(arguments),F},F.tickArguments=function(R){return arguments.length?(o=R==null?[]:Array.from(R),F):o.slice()},F.tickValues=function(R){return arguments.length?(l=R==null?null:Array.from(R),F):l&&l.slice()},F.tickFormat=function(R){return arguments.length?(u=R,F):u},F.tickSize=function(R){return arguments.length?(d=g=+R,F):d},F.tickSizeInner=function(R){return arguments.length?(d=+R,F):d},F.tickSizeOuter=function(R){return arguments.length?(g=+R,F):g},F.tickPadding=function(R){return arguments.length?(a=+R,F):a},F.offset=function(R){return arguments.length?(w=+R,F):w},F}function g6(t){return xE(ey,t)}function y6(t){return xE(_f,t)}var Bz={value:()=>{}};function vE(){for(var t=0,i=arguments.length,o={},l;t<i;++t){if(!(l=arguments[t]+"")||l in o||/[\s.]/.test(l))throw new Error("illegal type: "+l);o[l]=[]}return new Jp(o)}function Jp(t){this._=t}function Uz(t,i){return t.trim().split(/^|\s+/).map(function(o){var l="",u=o.indexOf(".");if(u>=0&&(l=o.slice(u+1),o=o.slice(0,u)),o&&!i.hasOwnProperty(o))throw new Error("unknown type: "+o);return{type:o,name:l}})}Jp.prototype=vE.prototype={constructor:Jp,on:function(t,i){var o=this._,l=Uz(t+"",o),u,d=-1,g=l.length;if(arguments.length<2){for(;++d<g;)if((u=(t=l[d]).type)&&(u=Nz(o[u],t.name)))return u;return}if(i!=null&&typeof i!="function")throw new Error("invalid callback: "+i);for(;++d<g;)if(u=(t=l[d]).type)o[u]=Aw(o[u],t.name,i);else if(i==null)for(u in o)o[u]=Aw(o[u],t.name,null);return this},copy:function(){var t={},i=this._;for(var o in i)t[o]=i[o].slice();return new Jp(t)},call:function(t,i){if((u=arguments.length-2)>0)for(var o=new Array(u),l=0,u,d;l<u;++l)o[l]=arguments[l+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(d=this._[t],l=0,u=d.length;l<u;++l)d[l].value.apply(i,o)},apply:function(t,i,o){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var l=this._[t],u=0,d=l.length;u<d;++u)l[u].value.apply(i,o)}};function Nz(t,i){for(var o=0,l=t.length,u;o<l;++o)if((u=t[o]).name===i)return u.value}function Aw(t,i,o){for(var l=0,u=t.length;l<u;++l)if(t[l].name===i){t[l]=Bz,t=t.slice(0,l).concat(t.slice(l+1));break}return o!=null&&t.push({name:i,value:o}),t}var ty="http://www.w3.org/1999/xhtml",Cw={svg:"http://www.w3.org/2000/svg",xhtml:ty,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function c_(t){var i=t+="",o=i.indexOf(":");return o>=0&&(i=t.slice(0,o))!=="xmlns"&&(t=t.slice(o+1)),Cw.hasOwnProperty(i)?{space:Cw[i],local:t}:t}function jz(t){return function(){var i=this.ownerDocument,o=this.namespaceURI;return o===ty&&i.documentElement.namespaceURI===ty?i.createElement(t):i.createElementNS(o,t)}}function Vz(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function bx(t){var i=c_(t);return(i.local?Vz:jz)(i)}function $z(){}function wx(t){return t==null?$z:function(){return this.querySelector(t)}}function Gz(t){typeof t!="function"&&(t=wx(t));for(var i=this._groups,o=i.length,l=new Array(o),u=0;u<o;++u)for(var d=i[u],g=d.length,a=l[u]=new Array(g),w,S,C=0;C<g;++C)(w=d[C])&&(S=t.call(w,w.__data__,C,d))&&("__data__"in w&&(S.__data__=w.__data__),a[C]=S);return new os(l,this._parents)}function qz(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Zz(){return[]}function bE(t){return t==null?Zz:function(){return this.querySelectorAll(t)}}function Wz(t){return function(){return qz(t.apply(this,arguments))}}function Hz(t){typeof t=="function"?t=Wz(t):t=bE(t);for(var i=this._groups,o=i.length,l=[],u=[],d=0;d<o;++d)for(var g=i[d],a=g.length,w,S=0;S<a;++S)(w=g[S])&&(l.push(t.call(w,w.__data__,S,g)),u.push(w));return new os(l,u)}function wE(t){return function(){return this.matches(t)}}function TE(t){return function(i){return i.matches(t)}}var Xz=Array.prototype.find;function Kz(t){return function(){return Xz.call(this.children,t)}}function Yz(){return this.firstElementChild}function Qz(t){return this.select(t==null?Yz:Kz(typeof t=="function"?t:TE(t)))}var Jz=Array.prototype.filter;function eR(){return Array.from(this.children)}function tR(t){return function(){return Jz.call(this.children,t)}}function iR(t){return this.selectAll(t==null?eR:tR(typeof t=="function"?t:TE(t)))}function rR(t){typeof t!="function"&&(t=wE(t));for(var i=this._groups,o=i.length,l=new Array(o),u=0;u<o;++u)for(var d=i[u],g=d.length,a=l[u]=[],w,S=0;S<g;++S)(w=d[S])&&t.call(w,w.__data__,S,d)&&a.push(w);return new os(l,this._parents)}function EE(t){return new Array(t.length)}function nR(){return new os(this._enter||this._groups.map(EE),this._parents)}function wm(t,i){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=i}wm.prototype={constructor:wm,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,i){return this._parent.insertBefore(t,i)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function sR(t){return function(){return t}}function oR(t,i,o,l,u,d){for(var g=0,a,w=i.length,S=d.length;g<S;++g)(a=i[g])?(a.__data__=d[g],l[g]=a):o[g]=new wm(t,d[g]);for(;g<w;++g)(a=i[g])&&(u[g]=a)}function aR(t,i,o,l,u,d,g){var a,w,S=new Map,C=i.length,k=d.length,F=new Array(C),R;for(a=0;a<C;++a)(w=i[a])&&(F[a]=R=g.call(w,w.__data__,a,i)+"",S.has(R)?u[a]=w:S.set(R,w));for(a=0;a<k;++a)R=g.call(t,d[a],a,d)+"",(w=S.get(R))?(l[a]=w,w.__data__=d[a],S.delete(R)):o[a]=new wm(t,d[a]);for(a=0;a<C;++a)(w=i[a])&&S.get(F[a])===w&&(u[a]=w)}function lR(t){return t.__data__}function cR(t,i){if(!arguments.length)return Array.from(this,lR);var o=i?aR:oR,l=this._parents,u=this._groups;typeof t!="function"&&(t=sR(t));for(var d=u.length,g=new Array(d),a=new Array(d),w=new Array(d),S=0;S<d;++S){var C=l[S],k=u[S],F=k.length,R=uR(t.call(C,C&&C.__data__,S,l)),W=R.length,Z=a[S]=new Array(W),X=g[S]=new Array(W),q=w[S]=new Array(F);o(C,k,Z,X,q,R,i);for(var ue=0,pe=0,xe,fe;ue<W;++ue)if(xe=Z[ue]){for(ue>=pe&&(pe=ue+1);!(fe=X[pe])&&++pe<W;);xe._next=fe||null}}return g=new os(g,l),g._enter=a,g._exit=w,g}function uR(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function hR(){return new os(this._exit||this._groups.map(EE),this._parents)}function fR(t,i,o){var l=this.enter(),u=this,d=this.exit();return typeof t=="function"?(l=t(l),l&&(l=l.selection())):l=l.append(t+""),i!=null&&(u=i(u),u&&(u=u.selection())),o==null?d.remove():o(d),l&&u?l.merge(u).order():u}function dR(t){for(var i=t.selection?t.selection():t,o=this._groups,l=i._groups,u=o.length,d=l.length,g=Math.min(u,d),a=new Array(u),w=0;w<g;++w)for(var S=o[w],C=l[w],k=S.length,F=a[w]=new Array(k),R,W=0;W<k;++W)(R=S[W]||C[W])&&(F[W]=R);for(;w<u;++w)a[w]=o[w];return new os(a,this._parents)}function pR(){for(var t=this._groups,i=-1,o=t.length;++i<o;)for(var l=t[i],u=l.length-1,d=l[u],g;--u>=0;)(g=l[u])&&(d&&g.compareDocumentPosition(d)^4&&d.parentNode.insertBefore(g,d),d=g);return this}function mR(t){t||(t=_R);function i(k,F){return k&&F?t(k.__data__,F.__data__):!k-!F}for(var o=this._groups,l=o.length,u=new Array(l),d=0;d<l;++d){for(var g=o[d],a=g.length,w=u[d]=new Array(a),S,C=0;C<a;++C)(S=g[C])&&(w[C]=S);w.sort(i)}return new os(u,this._parents).order()}function _R(t,i){return t<i?-1:t>i?1:t>=i?0:NaN}function gR(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function yR(){return Array.from(this)}function xR(){for(var t=this._groups,i=0,o=t.length;i<o;++i)for(var l=t[i],u=0,d=l.length;u<d;++u){var g=l[u];if(g)return g}return null}function vR(){let t=0;for(const i of this)++t;return t}function bR(){return!this.node()}function wR(t){for(var i=this._groups,o=0,l=i.length;o<l;++o)for(var u=i[o],d=0,g=u.length,a;d<g;++d)(a=u[d])&&t.call(a,a.__data__,d,u);return this}function TR(t){return function(){this.removeAttribute(t)}}function ER(t){return function(){this.removeAttributeNS(t.space,t.local)}}function SR(t,i){return function(){this.setAttribute(t,i)}}function AR(t,i){return function(){this.setAttributeNS(t.space,t.local,i)}}function CR(t,i){return function(){var o=i.apply(this,arguments);o==null?this.removeAttribute(t):this.setAttribute(t,o)}}function IR(t,i){return function(){var o=i.apply(this,arguments);o==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,o)}}function MR(t,i){var o=c_(t);if(arguments.length<2){var l=this.node();return o.local?l.getAttributeNS(o.space,o.local):l.getAttribute(o)}return this.each((i==null?o.local?ER:TR:typeof i=="function"?o.local?IR:CR:o.local?AR:SR)(o,i))}function SE(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function kR(t){return function(){this.style.removeProperty(t)}}function PR(t,i,o){return function(){this.style.setProperty(t,i,o)}}function DR(t,i,o){return function(){var l=i.apply(this,arguments);l==null?this.style.removeProperty(t):this.style.setProperty(t,l,o)}}function zR(t,i,o){return arguments.length>1?this.each((i==null?kR:typeof i=="function"?DR:PR)(t,i,o==null?"":o)):qu(this.node(),t)}function qu(t,i){return t.style.getPropertyValue(i)||SE(t).getComputedStyle(t,null).getPropertyValue(i)}function RR(t){return function(){delete this[t]}}function FR(t,i){return function(){this[t]=i}}function LR(t,i){return function(){var o=i.apply(this,arguments);o==null?delete this[t]:this[t]=o}}function OR(t,i){return arguments.length>1?this.each((i==null?RR:typeof i=="function"?LR:FR)(t,i)):this.node()[t]}function AE(t){return t.trim().split(/^|\s+/)}function Tx(t){return t.classList||new CE(t)}function CE(t){this._node=t,this._names=AE(t.getAttribute("class")||"")}CE.prototype={add:function(t){var i=this._names.indexOf(t);i<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var i=this._names.indexOf(t);i>=0&&(this._names.splice(i,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function IE(t,i){for(var o=Tx(t),l=-1,u=i.length;++l<u;)o.add(i[l])}function ME(t,i){for(var o=Tx(t),l=-1,u=i.length;++l<u;)o.remove(i[l])}function BR(t){return function(){IE(this,t)}}function UR(t){return function(){ME(this,t)}}function NR(t,i){return function(){(i.apply(this,arguments)?IE:ME)(this,t)}}function jR(t,i){var o=AE(t+"");if(arguments.length<2){for(var l=Tx(this.node()),u=-1,d=o.length;++u<d;)if(!l.contains(o[u]))return!1;return!0}return this.each((typeof i=="function"?NR:i?BR:UR)(o,i))}function VR(){this.textContent=""}function $R(t){return function(){this.textContent=t}}function GR(t){return function(){var i=t.apply(this,arguments);this.textContent=i==null?"":i}}function qR(t){return arguments.length?this.each(t==null?VR:(typeof t=="function"?GR:$R)(t)):this.node().textContent}function ZR(){this.innerHTML=""}function WR(t){return function(){this.innerHTML=t}}function HR(t){return function(){var i=t.apply(this,arguments);this.innerHTML=i==null?"":i}}function XR(t){return arguments.length?this.each(t==null?ZR:(typeof t=="function"?HR:WR)(t)):this.node().innerHTML}function KR(){this.nextSibling&&this.parentNode.appendChild(this)}function YR(){return this.each(KR)}function QR(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function JR(){return this.each(QR)}function e5(t){var i=typeof t=="function"?t:bx(t);return this.select(function(){return this.appendChild(i.apply(this,arguments))})}function t5(){return null}function i5(t,i){var o=typeof t=="function"?t:bx(t),l=i==null?t5:typeof i=="function"?i:wx(i);return this.select(function(){return this.insertBefore(o.apply(this,arguments),l.apply(this,arguments)||null)})}function r5(){var t=this.parentNode;t&&t.removeChild(this)}function n5(){return this.each(r5)}function s5(){var t=this.cloneNode(!1),i=this.parentNode;return i?i.insertBefore(t,this.nextSibling):t}function o5(){var t=this.cloneNode(!0),i=this.parentNode;return i?i.insertBefore(t,this.nextSibling):t}function a5(t){return this.select(t?o5:s5)}function l5(t){return arguments.length?this.property("__data__",t):this.node().__data__}function c5(t){return function(i){t.call(this,i,this.__data__)}}function u5(t){return t.trim().split(/^|\s+/).map(function(i){var o="",l=i.indexOf(".");return l>=0&&(o=i.slice(l+1),i=i.slice(0,l)),{type:i,name:o}})}function h5(t){return function(){var i=this.__on;if(!!i){for(var o=0,l=-1,u=i.length,d;o<u;++o)d=i[o],(!t.type||d.type===t.type)&&d.name===t.name?this.removeEventListener(d.type,d.listener,d.options):i[++l]=d;++l?i.length=l:delete this.__on}}}function f5(t,i,o){return function(){var l=this.__on,u,d=c5(i);if(l){for(var g=0,a=l.length;g<a;++g)if((u=l[g]).type===t.type&&u.name===t.name){this.removeEventListener(u.type,u.listener,u.options),this.addEventListener(u.type,u.listener=d,u.options=o),u.value=i;return}}this.addEventListener(t.type,d,o),u={type:t.type,name:t.name,value:i,listener:d,options:o},l?l.push(u):this.__on=[u]}}function d5(t,i,o){var l=u5(t+""),u,d=l.length,g;if(arguments.length<2){var a=this.node().__on;if(a){for(var w=0,S=a.length,C;w<S;++w)for(u=0,C=a[w];u<d;++u)if((g=l[u]).type===C.type&&g.name===C.name)return C.value}return}for(a=i?f5:h5,u=0;u<d;++u)this.each(a(l[u],i,o));return this}function kE(t,i,o){var l=SE(t),u=l.CustomEvent;typeof u=="function"?u=new u(i,o):(u=l.document.createEvent("Event"),o?(u.initEvent(i,o.bubbles,o.cancelable),u.detail=o.detail):u.initEvent(i,!1,!1)),t.dispatchEvent(u)}function p5(t,i){return function(){return kE(this,t,i)}}function m5(t,i){return function(){return kE(this,t,i.apply(this,arguments))}}function _5(t,i){return this.each((typeof i=="function"?m5:p5)(t,i))}function*g5(){for(var t=this._groups,i=0,o=t.length;i<o;++i)for(var l=t[i],u=0,d=l.length,g;u<d;++u)(g=l[u])&&(yield g)}var PE=[null];function os(t,i){this._groups=t,this._parents=i}function od(){return new os([[document.documentElement]],PE)}function y5(){return this}os.prototype=od.prototype={constructor:os,select:Gz,selectAll:Hz,selectChild:Qz,selectChildren:iR,filter:rR,data:cR,enter:nR,exit:hR,join:fR,merge:dR,selection:y5,order:pR,sort:mR,call:gR,nodes:yR,node:xR,size:vR,empty:bR,each:wR,attr:MR,style:zR,property:OR,classed:jR,text:qR,html:XR,raise:YR,lower:JR,append:e5,insert:i5,remove:n5,clone:a5,datum:l5,on:d5,dispatch:_5,[Symbol.iterator]:g5};function x5(t){return typeof t=="string"?new os([[document.querySelector(t)]],[document.documentElement]):new os([[t]],PE)}function x6(t){return x5(bx(t).call(document.documentElement))}function v5(t){let i;for(;i=t.sourceEvent;)t=i;return t}function v6(t,i){if(t=v5(t),i===void 0&&(i=t.currentTarget),i){var o=i.ownerSVGElement||i;if(o.createSVGPoint){var l=o.createSVGPoint();return l.x=t.clientX,l.y=t.clientY,l=l.matrixTransform(i.getScreenCTM().inverse()),[l.x,l.y]}if(i.getBoundingClientRect){var u=i.getBoundingClientRect();return[t.clientX-u.left-i.clientLeft,t.clientY-u.top-i.clientTop]}}return[t.pageX,t.pageY]}function Ex(t,i,o){t.prototype=i.prototype=o,o.constructor=t}function DE(t,i){var o=Object.create(t.prototype);for(var l in i)o[l]=i[l];return o}function ad(){}var Gf=.7,Tm=1/Gf,Ru="\\s*([+-]?\\d+)\\s*",qf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Co="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",b5=/^#([0-9a-f]{3,8})$/,w5=new RegExp("^rgb\\("+[Ru,Ru,Ru]+"\\)$"),T5=new RegExp("^rgb\\("+[Co,Co,Co]+"\\)$"),E5=new RegExp("^rgba\\("+[Ru,Ru,Ru,qf]+"\\)$"),S5=new RegExp("^rgba\\("+[Co,Co,Co,qf]+"\\)$"),A5=new RegExp("^hsl\\("+[qf,Co,Co]+"\\)$"),C5=new RegExp("^hsla\\("+[qf,Co,Co,qf]+"\\)$"),Iw={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ex(ad,uc,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Mw,formatHex:Mw,formatHsl:I5,formatRgb:kw,toString:kw});function Mw(){return this.rgb().formatHex()}function I5(){return zE(this).formatHsl()}function kw(){return this.rgb().formatRgb()}function uc(t){var i,o;return t=(t+"").trim().toLowerCase(),(i=b5.exec(t))?(o=i[1].length,i=parseInt(i[1],16),o===6?Pw(i):o===3?new ts(i>>8&15|i>>4&240,i>>4&15|i&240,(i&15)<<4|i&15,1):o===8?$p(i>>24&255,i>>16&255,i>>8&255,(i&255)/255):o===4?$p(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|i&240,((i&15)<<4|i&15)/255):null):(i=w5.exec(t))?new ts(i[1],i[2],i[3],1):(i=T5.exec(t))?new ts(i[1]*255/100,i[2]*255/100,i[3]*255/100,1):(i=E5.exec(t))?$p(i[1],i[2],i[3],i[4]):(i=S5.exec(t))?$p(i[1]*255/100,i[2]*255/100,i[3]*255/100,i[4]):(i=A5.exec(t))?Rw(i[1],i[2]/100,i[3]/100,1):(i=C5.exec(t))?Rw(i[1],i[2]/100,i[3]/100,i[4]):Iw.hasOwnProperty(t)?Pw(Iw[t]):t==="transparent"?new ts(NaN,NaN,NaN,0):null}function Pw(t){return new ts(t>>16&255,t>>8&255,t&255,1)}function $p(t,i,o,l){return l<=0&&(t=i=o=NaN),new ts(t,i,o,l)}function M5(t){return t instanceof ad||(t=uc(t)),t?(t=t.rgb(),new ts(t.r,t.g,t.b,t.opacity)):new ts}function iy(t,i,o,l){return arguments.length===1?M5(t):new ts(t,i,o,l==null?1:l)}function ts(t,i,o,l){this.r=+t,this.g=+i,this.b=+o,this.opacity=+l}Ex(ts,iy,DE(ad,{brighter:function(t){return t=t==null?Tm:Math.pow(Tm,t),new ts(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?Gf:Math.pow(Gf,t),new ts(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Dw,formatHex:Dw,formatRgb:zw,toString:zw}));function Dw(){return"#"+r0(this.r)+r0(this.g)+r0(this.b)}function zw(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function r0(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function Rw(t,i,o,l){return l<=0?t=i=o=NaN:o<=0||o>=1?t=i=NaN:i<=0&&(t=NaN),new bo(t,i,o,l)}function zE(t){if(t instanceof bo)return new bo(t.h,t.s,t.l,t.opacity);if(t instanceof ad||(t=uc(t)),!t)return new bo;if(t instanceof bo)return t;t=t.rgb();var i=t.r/255,o=t.g/255,l=t.b/255,u=Math.min(i,o,l),d=Math.max(i,o,l),g=NaN,a=d-u,w=(d+u)/2;return a?(i===d?g=(o-l)/a+(o<l)*6:o===d?g=(l-i)/a+2:g=(i-o)/a+4,a/=w<.5?d+u:2-d-u,g*=60):a=w>0&&w<1?0:g,new bo(g,a,w,t.opacity)}function k5(t,i,o,l){return arguments.length===1?zE(t):new bo(t,i,o,l==null?1:l)}function bo(t,i,o,l){this.h=+t,this.s=+i,this.l=+o,this.opacity=+l}Ex(bo,k5,DE(ad,{brighter:function(t){return t=t==null?Tm:Math.pow(Tm,t),new bo(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?Gf:Math.pow(Gf,t),new bo(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,i=isNaN(t)||isNaN(this.s)?0:this.s,o=this.l,l=o+(o<.5?o:1-o)*i,u=2*o-l;return new ts(n0(t>=240?t-240:t+120,u,l),n0(t,u,l),n0(t<120?t+240:t-120,u,l),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function n0(t,i,o){return(t<60?i+(o-i)*t/60:t<180?o:t<240?i+(o-i)*(240-t)/60:i)*255}var Sx=t=>()=>t;function P5(t,i){return function(o){return t+o*i}}function D5(t,i,o){return t=Math.pow(t,o),i=Math.pow(i,o)-t,o=1/o,function(l){return Math.pow(t+l*i,o)}}function z5(t){return(t=+t)==1?RE:function(i,o){return o-i?D5(i,o,t):Sx(isNaN(i)?o:i)}}function RE(t,i){var o=i-t;return o?P5(t,o):Sx(isNaN(t)?i:t)}var Em=function t(i){var o=z5(i);function l(u,d){var g=o((u=iy(u)).r,(d=iy(d)).r),a=o(u.g,d.g),w=o(u.b,d.b),S=RE(u.opacity,d.opacity);return function(C){return u.r=g(C),u.g=a(C),u.b=w(C),u.opacity=S(C),u+""}}return l.gamma=t,l}(1);function R5(t,i){i||(i=[]);var o=t?Math.min(i.length,t.length):0,l=i.slice(),u;return function(d){for(u=0;u<o;++u)l[u]=t[u]*(1-d)+i[u]*d;return l}}function F5(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function L5(t,i){var o=i?i.length:0,l=t?Math.min(o,t.length):0,u=new Array(l),d=new Array(o),g;for(g=0;g<l;++g)u[g]=Ax(t[g],i[g]);for(;g<o;++g)d[g]=i[g];return function(a){for(g=0;g<l;++g)d[g]=u[g](a);return d}}function O5(t,i){var o=new Date;return t=+t,i=+i,function(l){return o.setTime(t*(1-l)+i*l),o}}function Zs(t,i){return t=+t,i=+i,function(o){return t*(1-o)+i*o}}function B5(t,i){var o={},l={},u;(t===null||typeof t!="object")&&(t={}),(i===null||typeof i!="object")&&(i={});for(u in i)u in t?o[u]=Ax(t[u],i[u]):l[u]=i[u];return function(d){for(u in o)l[u]=o[u](d);return l}}var ry=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,s0=new RegExp(ry.source,"g");function U5(t){return function(){return t}}function N5(t){return function(i){return t(i)+""}}function FE(t,i){var o=ry.lastIndex=s0.lastIndex=0,l,u,d,g=-1,a=[],w=[];for(t=t+"",i=i+"";(l=ry.exec(t))&&(u=s0.exec(i));)(d=u.index)>o&&(d=i.slice(o,d),a[g]?a[g]+=d:a[++g]=d),(l=l[0])===(u=u[0])?a[g]?a[g]+=u:a[++g]=u:(a[++g]=null,w.push({i:g,x:Zs(l,u)})),o=s0.lastIndex;return o<i.length&&(d=i.slice(o),a[g]?a[g]+=d:a[++g]=d),a.length<2?w[0]?N5(w[0].x):U5(i):(i=w.length,function(S){for(var C=0,k;C<i;++C)a[(k=w[C]).i]=k.x(S);return a.join("")})}function Ax(t,i){var o=typeof i,l;return i==null||o==="boolean"?Sx(i):(o==="number"?Zs:o==="string"?(l=uc(i))?(i=l,Em):FE:i instanceof uc?Em:i instanceof Date?O5:F5(i)?R5:Array.isArray(i)?L5:typeof i.valueOf!="function"&&typeof i.toString!="function"||isNaN(i)?B5:Zs)(t,i)}function j5(t,i){return t=+t,i=+i,function(o){return Math.round(t*(1-o)+i*o)}}var Fw=180/Math.PI,ny={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function LE(t,i,o,l,u,d){var g,a,w;return(g=Math.sqrt(t*t+i*i))&&(t/=g,i/=g),(w=t*o+i*l)&&(o-=t*w,l-=i*w),(a=Math.sqrt(o*o+l*l))&&(o/=a,l/=a,w/=a),t*l<i*o&&(t=-t,i=-i,w=-w,g=-g),{translateX:u,translateY:d,rotate:Math.atan2(i,t)*Fw,skewX:Math.atan(w)*Fw,scaleX:g,scaleY:a}}var Gp;function V5(t){const i=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return i.isIdentity?ny:LE(i.a,i.b,i.c,i.d,i.e,i.f)}function $5(t){return t==null||(Gp||(Gp=document.createElementNS("http://www.w3.org/2000/svg","g")),Gp.setAttribute("transform",t),!(t=Gp.transform.baseVal.consolidate()))?ny:(t=t.matrix,LE(t.a,t.b,t.c,t.d,t.e,t.f))}function OE(t,i,o,l){function u(S){return S.length?S.pop()+" ":""}function d(S,C,k,F,R,W){if(S!==k||C!==F){var Z=R.push("translate(",null,i,null,o);W.push({i:Z-4,x:Zs(S,k)},{i:Z-2,x:Zs(C,F)})}else(k||F)&&R.push("translate("+k+i+F+o)}function g(S,C,k,F){S!==C?(S-C>180?C+=360:C-S>180&&(S+=360),F.push({i:k.push(u(k)+"rotate(",null,l)-2,x:Zs(S,C)})):C&&k.push(u(k)+"rotate("+C+l)}function a(S,C,k,F){S!==C?F.push({i:k.push(u(k)+"skewX(",null,l)-2,x:Zs(S,C)}):C&&k.push(u(k)+"skewX("+C+l)}function w(S,C,k,F,R,W){if(S!==k||C!==F){var Z=R.push(u(R)+"scale(",null,",",null,")");W.push({i:Z-4,x:Zs(S,k)},{i:Z-2,x:Zs(C,F)})}else(k!==1||F!==1)&&R.push(u(R)+"scale("+k+","+F+")")}return function(S,C){var k=[],F=[];return S=t(S),C=t(C),d(S.translateX,S.translateY,C.translateX,C.translateY,k,F),g(S.rotate,C.rotate,k,F),a(S.skewX,C.skewX,k,F),w(S.scaleX,S.scaleY,C.scaleX,C.scaleY,k,F),S=C=null,function(R){for(var W=-1,Z=F.length,X;++W<Z;)k[(X=F[W]).i]=X.x(R);return k.join("")}}}var G5=OE(V5,"px, ","px)","deg)"),q5=OE($5,", ",")",")"),Zu=0,gf=0,uf=0,BE=1e3,Sm,yf,Am=0,hc=0,u_=0,Zf=typeof performance=="object"&&performance.now?performance:Date,UE=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Cx(){return hc||(UE(Z5),hc=Zf.now()+u_)}function Z5(){hc=0}function Cm(){this._call=this._time=this._next=null}Cm.prototype=NE.prototype={constructor:Cm,restart:function(t,i,o){if(typeof t!="function")throw new TypeError("callback is not a function");o=(o==null?Cx():+o)+(i==null?0:+i),!this._next&&yf!==this&&(yf?yf._next=this:Sm=this,yf=this),this._call=t,this._time=o,sy()},stop:function(){this._call&&(this._call=null,this._time=1/0,sy())}};function NE(t,i,o){var l=new Cm;return l.restart(t,i,o),l}function W5(){Cx(),++Zu;for(var t=Sm,i;t;)(i=hc-t._time)>=0&&t._call.call(void 0,i),t=t._next;--Zu}function Lw(){hc=(Am=Zf.now())+u_,Zu=gf=0;try{W5()}finally{Zu=0,X5(),hc=0}}function H5(){var t=Zf.now(),i=t-Am;i>BE&&(u_-=i,Am=t)}function X5(){for(var t,i=Sm,o,l=1/0;i;)i._call?(l>i._time&&(l=i._time),t=i,i=i._next):(o=i._next,i._next=null,i=t?t._next=o:Sm=o);yf=t,sy(l)}function sy(t){if(!Zu){gf&&(gf=clearTimeout(gf));var i=t-hc;i>24?(t<1/0&&(gf=setTimeout(Lw,t-Zf.now()-u_)),uf&&(uf=clearInterval(uf))):(uf||(Am=Zf.now(),uf=setInterval(H5,BE)),Zu=1,UE(Lw))}}function Ow(t,i,o){var l=new Cm;return i=i==null?0:+i,l.restart(u=>{l.stop(),t(u+i)},i,o),l}var K5=vE("start","end","cancel","interrupt"),Y5=[],jE=0,Bw=1,oy=2,em=3,Uw=4,ay=5,tm=6;function h_(t,i,o,l,u,d){var g=t.__transition;if(!g)t.__transition={};else if(o in g)return;Q5(t,o,{name:i,index:l,group:u,on:K5,tween:Y5,time:d.time,delay:d.delay,duration:d.duration,ease:d.ease,timer:null,state:jE})}function Ix(t,i){var o=Ks(t,i);if(o.state>jE)throw new Error("too late; already scheduled");return o}function ko(t,i){var o=Ks(t,i);if(o.state>em)throw new Error("too late; already running");return o}function Ks(t,i){var o=t.__transition;if(!o||!(o=o[i]))throw new Error("transition not found");return o}function Q5(t,i,o){var l=t.__transition,u;l[i]=o,o.timer=NE(d,0,o.time);function d(S){o.state=Bw,o.timer.restart(g,o.delay,o.time),o.delay<=S&&g(S-o.delay)}function g(S){var C,k,F,R;if(o.state!==Bw)return w();for(C in l)if(R=l[C],R.name===o.name){if(R.state===em)return Ow(g);R.state===Uw?(R.state=tm,R.timer.stop(),R.on.call("interrupt",t,t.__data__,R.index,R.group),delete l[C]):+C<i&&(R.state=tm,R.timer.stop(),R.on.call("cancel",t,t.__data__,R.index,R.group),delete l[C])}if(Ow(function(){o.state===em&&(o.state=Uw,o.timer.restart(a,o.delay,o.time),a(S))}),o.state=oy,o.on.call("start",t,t.__data__,o.index,o.group),o.state===oy){for(o.state=em,u=new Array(F=o.tween.length),C=0,k=-1;C<F;++C)(R=o.tween[C].value.call(t,t.__data__,o.index,o.group))&&(u[++k]=R);u.length=k+1}}function a(S){for(var C=S<o.duration?o.ease.call(null,S/o.duration):(o.timer.restart(w),o.state=ay,1),k=-1,F=u.length;++k<F;)u[k].call(t,C);o.state===ay&&(o.on.call("end",t,t.__data__,o.index,o.group),w())}function w(){o.state=tm,o.timer.stop(),delete l[i];for(var S in l)return;delete t.__transition}}function J5(t,i){var o=t.__transition,l,u,d=!0,g;if(!!o){i=i==null?null:i+"";for(g in o){if((l=o[g]).name!==i){d=!1;continue}u=l.state>oy&&l.state<ay,l.state=tm,l.timer.stop(),l.on.call(u?"interrupt":"cancel",t,t.__data__,l.index,l.group),delete o[g]}d&&delete t.__transition}}function eF(t){return this.each(function(){J5(this,t)})}function tF(t,i){var o,l;return function(){var u=ko(this,t),d=u.tween;if(d!==o){l=o=d;for(var g=0,a=l.length;g<a;++g)if(l[g].name===i){l=l.slice(),l.splice(g,1);break}}u.tween=l}}function iF(t,i,o){var l,u;if(typeof o!="function")throw new Error;return function(){var d=ko(this,t),g=d.tween;if(g!==l){u=(l=g).slice();for(var a={name:i,value:o},w=0,S=u.length;w<S;++w)if(u[w].name===i){u[w]=a;break}w===S&&u.push(a)}d.tween=u}}function rF(t,i){var o=this._id;if(t+="",arguments.length<2){for(var l=Ks(this.node(),o).tween,u=0,d=l.length,g;u<d;++u)if((g=l[u]).name===t)return g.value;return null}return this.each((i==null?tF:iF)(o,t,i))}function Mx(t,i,o){var l=t._id;return t.each(function(){var u=ko(this,l);(u.value||(u.value={}))[i]=o.apply(this,arguments)}),function(u){return Ks(u,l).value[i]}}function VE(t,i){var o;return(typeof i=="number"?Zs:i instanceof uc?Em:(o=uc(i))?(i=o,Em):FE)(t,i)}function nF(t){return function(){this.removeAttribute(t)}}function sF(t){return function(){this.removeAttributeNS(t.space,t.local)}}function oF(t,i,o){var l,u=o+"",d;return function(){var g=this.getAttribute(t);return g===u?null:g===l?d:d=i(l=g,o)}}function aF(t,i,o){var l,u=o+"",d;return function(){var g=this.getAttributeNS(t.space,t.local);return g===u?null:g===l?d:d=i(l=g,o)}}function lF(t,i,o){var l,u,d;return function(){var g,a=o(this),w;return a==null?void this.removeAttribute(t):(g=this.getAttribute(t),w=a+"",g===w?null:g===l&&w===u?d:(u=w,d=i(l=g,a)))}}function cF(t,i,o){var l,u,d;return function(){var g,a=o(this),w;return a==null?void this.removeAttributeNS(t.space,t.local):(g=this.getAttributeNS(t.space,t.local),w=a+"",g===w?null:g===l&&w===u?d:(u=w,d=i(l=g,a)))}}function uF(t,i){var o=c_(t),l=o==="transform"?q5:VE;return this.attrTween(t,typeof i=="function"?(o.local?cF:lF)(o,l,Mx(this,"attr."+t,i)):i==null?(o.local?sF:nF)(o):(o.local?aF:oF)(o,l,i))}function hF(t,i){return function(o){this.setAttribute(t,i.call(this,o))}}function fF(t,i){return function(o){this.setAttributeNS(t.space,t.local,i.call(this,o))}}function dF(t,i){var o,l;function u(){var d=i.apply(this,arguments);return d!==l&&(o=(l=d)&&fF(t,d)),o}return u._value=i,u}function pF(t,i){var o,l;function u(){var d=i.apply(this,arguments);return d!==l&&(o=(l=d)&&hF(t,d)),o}return u._value=i,u}function mF(t,i){var o="attr."+t;if(arguments.length<2)return(o=this.tween(o))&&o._value;if(i==null)return this.tween(o,null);if(typeof i!="function")throw new Error;var l=c_(t);return this.tween(o,(l.local?dF:pF)(l,i))}function _F(t,i){return function(){Ix(this,t).delay=+i.apply(this,arguments)}}function gF(t,i){return i=+i,function(){Ix(this,t).delay=i}}function yF(t){var i=this._id;return arguments.length?this.each((typeof t=="function"?_F:gF)(i,t)):Ks(this.node(),i).delay}function xF(t,i){return function(){ko(this,t).duration=+i.apply(this,arguments)}}function vF(t,i){return i=+i,function(){ko(this,t).duration=i}}function bF(t){var i=this._id;return arguments.length?this.each((typeof t=="function"?xF:vF)(i,t)):Ks(this.node(),i).duration}function wF(t,i){if(typeof i!="function")throw new Error;return function(){ko(this,t).ease=i}}function TF(t){var i=this._id;return arguments.length?this.each(wF(i,t)):Ks(this.node(),i).ease}function EF(t,i){return function(){var o=i.apply(this,arguments);if(typeof o!="function")throw new Error;ko(this,t).ease=o}}function SF(t){if(typeof t!="function")throw new Error;return this.each(EF(this._id,t))}function AF(t){typeof t!="function"&&(t=wE(t));for(var i=this._groups,o=i.length,l=new Array(o),u=0;u<o;++u)for(var d=i[u],g=d.length,a=l[u]=[],w,S=0;S<g;++S)(w=d[S])&&t.call(w,w.__data__,S,d)&&a.push(w);return new Yo(l,this._parents,this._name,this._id)}function CF(t){if(t._id!==this._id)throw new Error;for(var i=this._groups,o=t._groups,l=i.length,u=o.length,d=Math.min(l,u),g=new Array(l),a=0;a<d;++a)for(var w=i[a],S=o[a],C=w.length,k=g[a]=new Array(C),F,R=0;R<C;++R)(F=w[R]||S[R])&&(k[R]=F);for(;a<l;++a)g[a]=i[a];return new Yo(g,this._parents,this._name,this._id)}function IF(t){return(t+"").trim().split(/^|\s+/).every(function(i){var o=i.indexOf(".");return o>=0&&(i=i.slice(0,o)),!i||i==="start"})}function MF(t,i,o){var l,u,d=IF(i)?Ix:ko;return function(){var g=d(this,t),a=g.on;a!==l&&(u=(l=a).copy()).on(i,o),g.on=u}}function kF(t,i){var o=this._id;return arguments.length<2?Ks(this.node(),o).on.on(t):this.each(MF(o,t,i))}function PF(t){return function(){var i=this.parentNode;for(var o in this.__transition)if(+o!==t)return;i&&i.removeChild(this)}}function DF(){return this.on("end.remove",PF(this._id))}function zF(t){var i=this._name,o=this._id;typeof t!="function"&&(t=wx(t));for(var l=this._groups,u=l.length,d=new Array(u),g=0;g<u;++g)for(var a=l[g],w=a.length,S=d[g]=new Array(w),C,k,F=0;F<w;++F)(C=a[F])&&(k=t.call(C,C.__data__,F,a))&&("__data__"in C&&(k.__data__=C.__data__),S[F]=k,h_(S[F],i,o,F,S,Ks(C,o)));return new Yo(d,this._parents,i,o)}function RF(t){var i=this._name,o=this._id;typeof t!="function"&&(t=bE(t));for(var l=this._groups,u=l.length,d=[],g=[],a=0;a<u;++a)for(var w=l[a],S=w.length,C,k=0;k<S;++k)if(C=w[k]){for(var F=t.call(C,C.__data__,k,w),R,W=Ks(C,o),Z=0,X=F.length;Z<X;++Z)(R=F[Z])&&h_(R,i,o,Z,F,W);d.push(F),g.push(C)}return new Yo(d,g,i,o)}var FF=od.prototype.constructor;function LF(){return new FF(this._groups,this._parents)}function OF(t,i){var o,l,u;return function(){var d=qu(this,t),g=(this.style.removeProperty(t),qu(this,t));return d===g?null:d===o&&g===l?u:u=i(o=d,l=g)}}function $E(t){return function(){this.style.removeProperty(t)}}function BF(t,i,o){var l,u=o+"",d;return function(){var g=qu(this,t);return g===u?null:g===l?d:d=i(l=g,o)}}function UF(t,i,o){var l,u,d;return function(){var g=qu(this,t),a=o(this),w=a+"";return a==null&&(w=a=(this.style.removeProperty(t),qu(this,t))),g===w?null:g===l&&w===u?d:(u=w,d=i(l=g,a))}}function NF(t,i){var o,l,u,d="style."+i,g="end."+d,a;return function(){var w=ko(this,t),S=w.on,C=w.value[d]==null?a||(a=$E(i)):void 0;(S!==o||u!==C)&&(l=(o=S).copy()).on(g,u=C),w.on=l}}function jF(t,i,o){var l=(t+="")=="transform"?G5:VE;return i==null?this.styleTween(t,OF(t,l)).on("end.style."+t,$E(t)):typeof i=="function"?this.styleTween(t,UF(t,l,Mx(this,"style."+t,i))).each(NF(this._id,t)):this.styleTween(t,BF(t,l,i),o).on("end.style."+t,null)}function VF(t,i,o){return function(l){this.style.setProperty(t,i.call(this,l),o)}}function $F(t,i,o){var l,u;function d(){var g=i.apply(this,arguments);return g!==u&&(l=(u=g)&&VF(t,g,o)),l}return d._value=i,d}function GF(t,i,o){var l="style."+(t+="");if(arguments.length<2)return(l=this.tween(l))&&l._value;if(i==null)return this.tween(l,null);if(typeof i!="function")throw new Error;return this.tween(l,$F(t,i,o==null?"":o))}function qF(t){return function(){this.textContent=t}}function ZF(t){return function(){var i=t(this);this.textContent=i==null?"":i}}function WF(t){return this.tween("text",typeof t=="function"?ZF(Mx(this,"text",t)):qF(t==null?"":t+""))}function HF(t){return function(i){this.textContent=t.call(this,i)}}function XF(t){var i,o;function l(){var u=t.apply(this,arguments);return u!==o&&(i=(o=u)&&HF(u)),i}return l._value=t,l}function KF(t){var i="text";if(arguments.length<1)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,XF(t))}function YF(){for(var t=this._name,i=this._id,o=GE(),l=this._groups,u=l.length,d=0;d<u;++d)for(var g=l[d],a=g.length,w,S=0;S<a;++S)if(w=g[S]){var C=Ks(w,i);h_(w,t,o,S,g,{time:C.time+C.delay+C.duration,delay:0,duration:C.duration,ease:C.ease})}return new Yo(l,this._parents,t,o)}function QF(){var t,i,o=this,l=o._id,u=o.size();return new Promise(function(d,g){var a={value:g},w={value:function(){--u===0&&d()}};o.each(function(){var S=ko(this,l),C=S.on;C!==t&&(i=(t=C).copy(),i._.cancel.push(a),i._.interrupt.push(a),i._.end.push(w)),S.on=i}),u===0&&d()})}var JF=0;function Yo(t,i,o,l){this._groups=t,this._parents=i,this._name=o,this._id=l}function GE(){return++JF}var Go=od.prototype;Yo.prototype={constructor:Yo,select:zF,selectAll:RF,selectChild:Go.selectChild,selectChildren:Go.selectChildren,filter:AF,merge:CF,selection:LF,transition:YF,call:Go.call,nodes:Go.nodes,node:Go.node,size:Go.size,empty:Go.empty,each:Go.each,on:kF,attr:uF,attrTween:mF,style:jF,styleTween:GF,text:WF,textTween:KF,remove:DF,tween:rF,delay:yF,duration:bF,ease:TF,easeVarying:SF,end:QF,[Symbol.iterator]:Go[Symbol.iterator]};const b6=t=>+t;function eL(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var tL={time:null,delay:0,duration:250,ease:eL};function iL(t,i){for(var o;!(o=t.__transition)||!(o=o[i]);)if(!(t=t.parentNode))throw new Error(`transition ${i} not found`);return o}function rL(t){var i,o;t instanceof Yo?(i=t._id,t=t._name):(i=GE(),(o=tL).time=Cx(),t=t==null?null:t+"");for(var l=this._groups,u=l.length,d=0;d<u;++d)for(var g=l[d],a=g.length,w,S=0;S<a;++S)(w=g[S])&&h_(w,t,i,S,g,o||iL(w,i));return new Yo(l,this._parents,t,i)}od.prototype.interrupt=eF;od.prototype.transition=rL;const ly=Math.PI,cy=2*ly,Hl=1e-6,nL=cy-Hl;function uy(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function kx(){return new uy}uy.prototype=kx.prototype={constructor:uy,moveTo:function(t,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+i)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,i){this._+="L"+(this._x1=+t)+","+(this._y1=+i)},quadraticCurveTo:function(t,i,o,l){this._+="Q"+ +t+","+ +i+","+(this._x1=+o)+","+(this._y1=+l)},bezierCurveTo:function(t,i,o,l,u,d){this._+="C"+ +t+","+ +i+","+ +o+","+ +l+","+(this._x1=+u)+","+(this._y1=+d)},arcTo:function(t,i,o,l,u){t=+t,i=+i,o=+o,l=+l,u=+u;var d=this._x1,g=this._y1,a=o-t,w=l-i,S=d-t,C=g-i,k=S*S+C*C;if(u<0)throw new Error("negative radius: "+u);if(this._x1===null)this._+="M"+(this._x1=t)+","+(this._y1=i);else if(k>Hl)if(!(Math.abs(C*a-w*S)>Hl)||!u)this._+="L"+(this._x1=t)+","+(this._y1=i);else{var F=o-d,R=l-g,W=a*a+w*w,Z=F*F+R*R,X=Math.sqrt(W),q=Math.sqrt(k),ue=u*Math.tan((ly-Math.acos((W+k-Z)/(2*X*q)))/2),pe=ue/q,xe=ue/X;Math.abs(pe-1)>Hl&&(this._+="L"+(t+pe*S)+","+(i+pe*C)),this._+="A"+u+","+u+",0,0,"+ +(C*F>S*R)+","+(this._x1=t+xe*a)+","+(this._y1=i+xe*w)}},arc:function(t,i,o,l,u,d){t=+t,i=+i,o=+o,d=!!d;var g=o*Math.cos(l),a=o*Math.sin(l),w=t+g,S=i+a,C=1^d,k=d?l-u:u-l;if(o<0)throw new Error("negative radius: "+o);this._x1===null?this._+="M"+w+","+S:(Math.abs(this._x1-w)>Hl||Math.abs(this._y1-S)>Hl)&&(this._+="L"+w+","+S),!!o&&(k<0&&(k=k%cy+cy),k>nL?this._+="A"+o+","+o+",0,1,"+C+","+(t-g)+","+(i-a)+"A"+o+","+o+",0,1,"+C+","+(this._x1=w)+","+(this._y1=S):k>Hl&&(this._+="A"+o+","+o+",0,"+ +(k>=ly)+","+C+","+(this._x1=t+o*Math.cos(u))+","+(this._y1=i+o*Math.sin(u))))},rect:function(t,i,o,l){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+i)+"h"+ +o+"v"+ +l+"h"+-o+"Z"},toString:function(){return this._}};var sL=Array.prototype,qE=sL.slice;function oL(t,i){return t-i}function aL(t){for(var i=0,o=t.length,l=t[o-1][1]*t[0][0]-t[o-1][0]*t[0][1];++i<o;)l+=t[i-1][1]*t[i][0]-t[i-1][0]*t[i][1];return l}var Va=t=>()=>t;function lL(t,i){for(var o=-1,l=i.length,u;++o<l;)if(u=cL(t,i[o]))return u;return 0}function cL(t,i){for(var o=i[0],l=i[1],u=-1,d=0,g=t.length,a=g-1;d<g;a=d++){var w=t[d],S=w[0],C=w[1],k=t[a],F=k[0],R=k[1];if(uL(w,k,i))return 0;C>l!=R>l&&o<(F-S)*(l-C)/(R-C)+S&&(u=-u)}return u}function uL(t,i,o){var l;return hL(t,i,o)&&fL(t[l=+(t[0]===i[0])],o[l],i[l])}function hL(t,i,o){return(i[0]-t[0])*(o[1]-t[1])===(o[0]-t[0])*(i[1]-t[1])}function fL(t,i,o){return t<=i&&i<=o||o<=i&&i<=t}function dL(){}var qo=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function pL(){var t=1,i=1,o=Mz,l=w;function u(S){var C=o(S);if(Array.isArray(C))C=C.slice().sort(oL);else{const k=Iz(S),F=vx(k[0],k[1],C);C=gE(Math.floor(k[0]/F)*F,Math.floor(k[1]/F-1)*F,C)}return C.map(k=>d(S,k))}function d(S,C){var k=[],F=[];return g(S,C,function(R){l(R,S,C),aL(R)>0?k.push([R]):F.push(R)}),F.forEach(function(R){for(var W=0,Z=k.length,X;W<Z;++W)if(lL((X=k[W])[0],R)!==-1){X.push(R);return}}),{type:"MultiPolygon",value:C,coordinates:k}}function g(S,C,k){var F=new Array,R=new Array,W,Z,X,q,ue,pe;for(W=Z=-1,q=S[0]>=C,qo[q<<1].forEach(xe);++W<t-1;)X=q,q=S[W+1]>=C,qo[X|q<<1].forEach(xe);for(qo[q<<0].forEach(xe);++Z<i-1;){for(W=-1,q=S[Z*t+t]>=C,ue=S[Z*t]>=C,qo[q<<1|ue<<2].forEach(xe);++W<t-1;)X=q,q=S[Z*t+t+W+1]>=C,pe=ue,ue=S[Z*t+W+1]>=C,qo[X|q<<1|ue<<2|pe<<3].forEach(xe);qo[q|ue<<3].forEach(xe)}for(W=-1,ue=S[Z*t]>=C,qo[ue<<2].forEach(xe);++W<t-1;)pe=ue,ue=S[Z*t+W+1]>=C,qo[ue<<2|pe<<3].forEach(xe);qo[ue<<3].forEach(xe);function xe(fe){var Te=[fe[0][0]+W,fe[0][1]+Z],Ie=[fe[1][0]+W,fe[1][1]+Z],Le=a(Te),Pe=a(Ie),qe,ze;(qe=R[Le])?(ze=F[Pe])?(delete R[qe.end],delete F[ze.start],qe===ze?(qe.ring.push(Ie),k(qe.ring)):F[qe.start]=R[ze.end]={start:qe.start,end:ze.end,ring:qe.ring.concat(ze.ring)}):(delete R[qe.end],qe.ring.push(Ie),R[qe.end=Pe]=qe):(qe=F[Pe])?(ze=R[Le])?(delete F[qe.start],delete R[ze.end],qe===ze?(qe.ring.push(Ie),k(qe.ring)):F[ze.start]=R[qe.end]={start:ze.start,end:qe.end,ring:ze.ring.concat(qe.ring)}):(delete F[qe.start],qe.ring.unshift(Te),F[qe.start=Le]=qe):F[Le]=R[Pe]={start:Le,end:Pe,ring:[Te,Ie]}}}function a(S){return S[0]*2+S[1]*(t+1)*4}function w(S,C,k){S.forEach(function(F){var R=F[0],W=F[1],Z=R|0,X=W|0,q,ue=C[X*t+Z];R>0&&R<t&&Z===R&&(q=C[X*t+Z-1],F[0]=R+(k-q)/(ue-q)-.5),W>0&&W<i&&X===W&&(q=C[(X-1)*t+Z],F[1]=W+(k-q)/(ue-q)-.5)})}return u.contour=d,u.size=function(S){if(!arguments.length)return[t,i];var C=Math.floor(S[0]),k=Math.floor(S[1]);if(!(C>=0&&k>=0))throw new Error("invalid size");return t=C,i=k,u},u.thresholds=function(S){return arguments.length?(o=typeof S=="function"?S:Array.isArray(S)?Va(qE.call(S)):Va(S),u):o},u.smooth=function(S){return arguments.length?(l=S?w:dL,u):l===w},u}function o0(t,i,o){for(var l=t.width,u=t.height,d=(o<<1)+1,g=0;g<u;++g)for(var a=0,w=0;a<l+o;++a)a<l&&(w+=t.data[a+g*l]),a>=o&&(a>=d&&(w-=t.data[a-d+g*l]),i.data[a-o+g*l]=w/Math.min(a+1,l-1+d-a,d))}function a0(t,i,o){for(var l=t.width,u=t.height,d=(o<<1)+1,g=0;g<l;++g)for(var a=0,w=0;a<u+o;++a)a<u&&(w+=t.data[g+a*l]),a>=o&&(a>=d&&(w-=t.data[g+(a-d)*l]),i.data[g+(a-o)*l]=w/Math.min(a+1,u-1+d-a,d))}function mL(t){return t[0]}function _L(t){return t[1]}function gL(){return 1}function w6(){var t=mL,i=_L,o=gL,l=960,u=500,d=20,g=2,a=d*3,w=l+a*2>>g,S=u+a*2>>g,C=Va(20);function k(q){var ue=new Float32Array(w*S),pe=new Float32Array(w*S),xe=Math.pow(2,-g);q.forEach(function(Ie,Le,Pe){var qe=(t(Ie,Le,Pe)+a)*xe,ze=(i(Ie,Le,Pe)+a)*xe,lt=+o(Ie,Le,Pe);if(qe>=0&&qe<w&&ze>=0&&ze<S){var ct=Math.floor(qe),be=Math.floor(ze),Ze=qe-ct-.5,Qe=ze-be-.5;ue[ct+be*w]+=(1-Ze)*(1-Qe)*lt,ue[ct+1+be*w]+=Ze*(1-Qe)*lt,ue[ct+1+(be+1)*w]+=Ze*Qe*lt,ue[ct+(be+1)*w]+=(1-Ze)*Qe*lt}}),o0({width:w,height:S,data:ue},{width:w,height:S,data:pe},d>>g),a0({width:w,height:S,data:pe},{width:w,height:S,data:ue},d>>g),o0({width:w,height:S,data:ue},{width:w,height:S,data:pe},d>>g),a0({width:w,height:S,data:pe},{width:w,height:S,data:ue},d>>g),o0({width:w,height:S,data:ue},{width:w,height:S,data:pe},d>>g),a0({width:w,height:S,data:pe},{width:w,height:S,data:ue},d>>g);var fe=C(ue);if(!Array.isArray(fe)){var Te=kz(ue);fe=vx(0,Te,fe),fe=Pz(0,Math.floor(Te/fe)*fe,fe),fe.shift()}return pL().thresholds(fe).size([w,S])(ue).map(F)}function F(q){return q.value*=Math.pow(2,-2*g),q.coordinates.forEach(R),q}function R(q){q.forEach(W)}function W(q){q.forEach(Z)}function Z(q){q[0]=q[0]*Math.pow(2,g)-a,q[1]=q[1]*Math.pow(2,g)-a}function X(){return a=d*3,w=l+a*2>>g,S=u+a*2>>g,k}return k.x=function(q){return arguments.length?(t=typeof q=="function"?q:Va(+q),k):t},k.y=function(q){return arguments.length?(i=typeof q=="function"?q:Va(+q),k):i},k.weight=function(q){return arguments.length?(o=typeof q=="function"?q:Va(+q),k):o},k.size=function(q){if(!arguments.length)return[l,u];var ue=+q[0],pe=+q[1];if(!(ue>=0&&pe>=0))throw new Error("invalid size");return l=ue,u=pe,X()},k.cellSize=function(q){if(!arguments.length)return 1<<g;if(!((q=+q)>=1))throw new Error("invalid cell size");return g=Math.floor(Math.log(q)/Math.LN2),X()},k.thresholds=function(q){return arguments.length?(C=typeof q=="function"?q:Array.isArray(q)?Va(qE.call(q)):Va(q),k):C},k.bandwidth=function(q){if(!arguments.length)return Math.sqrt(d*(d+1));if(!((q=+q)>=0))throw new Error("invalid bandwidth");return d=Math.round((Math.sqrt(4*q*q+1)-1)/2),X()},k}function yL(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Im(t,i){if((o=(t=i?t.toExponential(i-1):t.toExponential()).indexOf("e"))<0)return null;var o,l=t.slice(0,o);return[l.length>1?l[0]+l.slice(2):l,+t.slice(o+1)]}function Wu(t){return t=Im(Math.abs(t)),t?t[1]:NaN}function xL(t,i){return function(o,l){for(var u=o.length,d=[],g=0,a=t[0],w=0;u>0&&a>0&&(w+a+1>l&&(a=Math.max(1,l-w)),d.push(o.substring(u-=a,u+a)),!((w+=a+1)>l));)a=t[g=(g+1)%t.length];return d.reverse().join(i)}}function vL(t){return function(i){return i.replace(/[0-9]/g,function(o){return t[+o]})}}var bL=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Mm(t){if(!(i=bL.exec(t)))throw new Error("invalid format: "+t);var i;return new Px({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}Mm.prototype=Px.prototype;function Px(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Px.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function wL(t){e:for(var i=t.length,o=1,l=-1,u;o<i;++o)switch(t[o]){case".":l=u=o;break;case"0":l===0&&(l=o),u=o;break;default:if(!+t[o])break e;l>0&&(l=0);break}return l>0?t.slice(0,l)+t.slice(u+1):t}var ZE;function TL(t,i){var o=Im(t,i);if(!o)return t+"";var l=o[0],u=o[1],d=u-(ZE=Math.max(-8,Math.min(8,Math.floor(u/3)))*3)+1,g=l.length;return d===g?l:d>g?l+new Array(d-g+1).join("0"):d>0?l.slice(0,d)+"."+l.slice(d):"0."+new Array(1-d).join("0")+Im(t,Math.max(0,i+d-1))[0]}function Nw(t,i){var o=Im(t,i);if(!o)return t+"";var l=o[0],u=o[1];return u<0?"0."+new Array(-u).join("0")+l:l.length>u+1?l.slice(0,u+1)+"."+l.slice(u+1):l+new Array(u-l.length+2).join("0")}var jw={"%":(t,i)=>(t*100).toFixed(i),b:t=>Math.round(t).toString(2),c:t=>t+"",d:yL,e:(t,i)=>t.toExponential(i),f:(t,i)=>t.toFixed(i),g:(t,i)=>t.toPrecision(i),o:t=>Math.round(t).toString(8),p:(t,i)=>Nw(t*100,i),r:Nw,s:TL,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Vw(t){return t}var $w=Array.prototype.map,Gw=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function EL(t){var i=t.grouping===void 0||t.thousands===void 0?Vw:xL($w.call(t.grouping,Number),t.thousands+""),o=t.currency===void 0?"":t.currency[0]+"",l=t.currency===void 0?"":t.currency[1]+"",u=t.decimal===void 0?".":t.decimal+"",d=t.numerals===void 0?Vw:vL($w.call(t.numerals,String)),g=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"\u2212":t.minus+"",w=t.nan===void 0?"NaN":t.nan+"";function S(k){k=Mm(k);var F=k.fill,R=k.align,W=k.sign,Z=k.symbol,X=k.zero,q=k.width,ue=k.comma,pe=k.precision,xe=k.trim,fe=k.type;fe==="n"?(ue=!0,fe="g"):jw[fe]||(pe===void 0&&(pe=12),xe=!0,fe="g"),(X||F==="0"&&R==="=")&&(X=!0,F="0",R="=");var Te=Z==="$"?o:Z==="#"&&/[boxX]/.test(fe)?"0"+fe.toLowerCase():"",Ie=Z==="$"?l:/[%p]/.test(fe)?g:"",Le=jw[fe],Pe=/[defgprs%]/.test(fe);pe=pe===void 0?6:/[gprs]/.test(fe)?Math.max(1,Math.min(21,pe)):Math.max(0,Math.min(20,pe));function qe(ze){var lt=Te,ct=Ie,be,Ze,Qe;if(fe==="c")ct=Le(ze)+ct,ze="";else{ze=+ze;var gt=ze<0||1/ze<0;if(ze=isNaN(ze)?w:Le(Math.abs(ze),pe),xe&&(ze=wL(ze)),gt&&+ze==0&&W!=="+"&&(gt=!1),lt=(gt?W==="("?W:a:W==="-"||W==="("?"":W)+lt,ct=(fe==="s"?Gw[8+ZE/3]:"")+ct+(gt&&W==="("?")":""),Pe){for(be=-1,Ze=ze.length;++be<Ze;)if(Qe=ze.charCodeAt(be),48>Qe||Qe>57){ct=(Qe===46?u+ze.slice(be+1):ze.slice(be))+ct,ze=ze.slice(0,be);break}}}ue&&!X&&(ze=i(ze,1/0));var St=lt.length+ze.length+ct.length,bt=St<q?new Array(q-St+1).join(F):"";switch(ue&&X&&(ze=i(bt+ze,bt.length?q-ct.length:1/0),bt=""),R){case"<":ze=lt+ze+ct+bt;break;case"=":ze=lt+bt+ze+ct;break;case"^":ze=bt.slice(0,St=bt.length>>1)+lt+ze+ct+bt.slice(St);break;default:ze=bt+lt+ze+ct;break}return d(ze)}return qe.toString=function(){return k+""},qe}function C(k,F){var R=S((k=Mm(k),k.type="f",k)),W=Math.max(-8,Math.min(8,Math.floor(Wu(F)/3)))*3,Z=Math.pow(10,-W),X=Gw[8+W/3];return function(q){return R(Z*q)+X}}return{format:S,formatPrefix:C}}var qp,WE,HE;SL({thousands:",",grouping:[3],currency:["$",""]});function SL(t){return qp=EL(t),WE=qp.format,HE=qp.formatPrefix,qp}function AL(t){return Math.max(0,-Wu(Math.abs(t)))}function CL(t,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Wu(i)/3)))*3-Wu(Math.abs(t)))}function IL(t,i){return t=Math.abs(t),i=Math.abs(i)-t,Math.max(0,Wu(i)-Wu(t))+1}var ML=Math.PI,kL=ML*2,PL=Math.abs,Dx=Math.sqrt;function Hs(){}function km(t,i){t&&Zw.hasOwnProperty(t.type)&&Zw[t.type](t,i)}var qw={Feature:function(t,i){km(t.geometry,i)},FeatureCollection:function(t,i){for(var o=t.features,l=-1,u=o.length;++l<u;)km(o[l].geometry,i)}},Zw={Sphere:function(t,i){i.sphere()},Point:function(t,i){t=t.coordinates,i.point(t[0],t[1],t[2])},MultiPoint:function(t,i){for(var o=t.coordinates,l=-1,u=o.length;++l<u;)t=o[l],i.point(t[0],t[1],t[2])},LineString:function(t,i){hy(t.coordinates,i,0)},MultiLineString:function(t,i){for(var o=t.coordinates,l=-1,u=o.length;++l<u;)hy(o[l],i,0)},Polygon:function(t,i){Ww(t.coordinates,i)},MultiPolygon:function(t,i){for(var o=t.coordinates,l=-1,u=o.length;++l<u;)Ww(o[l],i)},GeometryCollection:function(t,i){for(var o=t.geometries,l=-1,u=o.length;++l<u;)km(o[l],i)}};function hy(t,i,o){var l=-1,u=t.length-o,d;for(i.lineStart();++l<u;)d=t[l],i.point(d[0],d[1],d[2]);i.lineEnd()}function Ww(t,i){var o=-1,l=t.length;for(i.polygonStart();++o<l;)hy(t[o],i,1);i.polygonEnd()}function hf(t,i){t&&qw.hasOwnProperty(t.type)?qw[t.type](t,i):km(t,i)}var DL=t=>t,l0=new Gu,fy=new Gu,XE,KE,dy,py,$a={point:Hs,lineStart:Hs,lineEnd:Hs,polygonStart:function(){$a.lineStart=zL,$a.lineEnd=FL},polygonEnd:function(){$a.lineStart=$a.lineEnd=$a.point=Hs,l0.add(PL(fy)),fy=new Gu},result:function(){var t=l0/2;return l0=new Gu,t}};function zL(){$a.point=RL}function RL(t,i){$a.point=YE,XE=dy=t,KE=py=i}function YE(t,i){fy.add(py*t-dy*i),dy=t,py=i}function FL(){YE(XE,KE)}var Hw=$a,Hu=1/0,Pm=Hu,Wf=-Hu,Dm=Wf,LL={point:OL,lineStart:Hs,lineEnd:Hs,polygonStart:Hs,polygonEnd:Hs,result:function(){var t=[[Hu,Pm],[Wf,Dm]];return Wf=Dm=-(Pm=Hu=1/0),t}};function OL(t,i){t<Hu&&(Hu=t),t>Wf&&(Wf=t),i<Pm&&(Pm=i),i>Dm&&(Dm=i)}var Xw=LL,my=0,_y=0,xf=0,zm=0,Rm=0,Cu=0,gy=0,yy=0,vf=0,QE,JE,wo,To,Ws={point:fc,lineStart:Kw,lineEnd:Yw,polygonStart:function(){Ws.lineStart=NL,Ws.lineEnd=jL},polygonEnd:function(){Ws.point=fc,Ws.lineStart=Kw,Ws.lineEnd=Yw},result:function(){var t=vf?[gy/vf,yy/vf]:Cu?[zm/Cu,Rm/Cu]:xf?[my/xf,_y/xf]:[NaN,NaN];return my=_y=xf=zm=Rm=Cu=gy=yy=vf=0,t}};function fc(t,i){my+=t,_y+=i,++xf}function Kw(){Ws.point=BL}function BL(t,i){Ws.point=UL,fc(wo=t,To=i)}function UL(t,i){var o=t-wo,l=i-To,u=Dx(o*o+l*l);zm+=u*(wo+t)/2,Rm+=u*(To+i)/2,Cu+=u,fc(wo=t,To=i)}function Yw(){Ws.point=fc}function NL(){Ws.point=VL}function jL(){eS(QE,JE)}function VL(t,i){Ws.point=eS,fc(QE=wo=t,JE=To=i)}function eS(t,i){var o=t-wo,l=i-To,u=Dx(o*o+l*l);zm+=u*(wo+t)/2,Rm+=u*(To+i)/2,Cu+=u,u=To*t-wo*i,gy+=u*(wo+t),yy+=u*(To+i),vf+=u*3,fc(wo=t,To=i)}var Qw=Ws;function tS(t){this._context=t}tS.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,i){switch(this._point){case 0:{this._context.moveTo(t,i),this._point=1;break}case 1:{this._context.lineTo(t,i);break}default:{this._context.moveTo(t+this._radius,i),this._context.arc(t,i,this._radius,0,kL);break}}},result:Hs};var xy=new Gu,c0,iS,rS,bf,wf,Fm={point:Hs,lineStart:function(){Fm.point=$L},lineEnd:function(){c0&&nS(iS,rS),Fm.point=Hs},polygonStart:function(){c0=!0},polygonEnd:function(){c0=null},result:function(){var t=+xy;return xy=new Gu,t}};function $L(t,i){Fm.point=nS,iS=bf=t,rS=wf=i}function nS(t,i){bf-=t,wf-=i,xy.add(Dx(bf*bf+wf*wf)),bf=t,wf=i}var Jw=Fm;function sS(){this._string=[]}sS.prototype={_radius:4.5,_circle:e2(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(t,i){switch(this._point){case 0:{this._string.push("M",t,",",i),this._point=1;break}case 1:{this._string.push("L",t,",",i);break}default:{this._circle==null&&(this._circle=e2(this._radius)),this._string.push("M",t,",",i,this._circle);break}}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}else return null}};function e2(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function T6(t,i){var o=4.5,l,u;function d(g){return g&&(typeof o=="function"&&u.pointRadius(+o.apply(this,arguments)),hf(g,l(u))),u.result()}return d.area=function(g){return hf(g,l(Hw)),Hw.result()},d.measure=function(g){return hf(g,l(Jw)),Jw.result()},d.bounds=function(g){return hf(g,l(Xw)),Xw.result()},d.centroid=function(g){return hf(g,l(Qw)),Qw.result()},d.projection=function(g){return arguments.length?(l=g==null?(t=null,DL):(t=g).stream,d):t},d.context=function(g){return arguments.length?(u=g==null?(i=null,new sS):new tS(i=g),typeof o!="function"&&u.pointRadius(o),d):i},d.pointRadius=function(g){return arguments.length?(o=typeof g=="function"?g:(u.pointRadius(+g),+g),d):o},d.projection(t).context(i)}function GL(t,i){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(i).domain(t);break}return this}function qL(t){return function(){return t}}function ZL(t){return+t}var t2=[0,1];function Iu(t){return t}function vy(t,i){return(i-=t=+t)?function(o){return(o-t)/i}:qL(isNaN(i)?NaN:.5)}function WL(t,i){var o;return t>i&&(o=t,t=i,i=o),function(l){return Math.max(t,Math.min(i,l))}}function HL(t,i,o){var l=t[0],u=t[1],d=i[0],g=i[1];return u<l?(l=vy(u,l),d=o(g,d)):(l=vy(l,u),d=o(d,g)),function(a){return d(l(a))}}function XL(t,i,o){var l=Math.min(t.length,i.length)-1,u=new Array(l),d=new Array(l),g=-1;for(t[l]<t[0]&&(t=t.slice().reverse(),i=i.slice().reverse());++g<l;)u[g]=vy(t[g],t[g+1]),d[g]=o(i[g],i[g+1]);return function(a){var w=Az(t,a,1,l)-1;return d[w](u[w](a))}}function KL(t,i){return i.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function YL(){var t=t2,i=t2,o=Ax,l,u,d,g=Iu,a,w,S;function C(){var F=Math.min(t.length,i.length);return g!==Iu&&(g=WL(t[0],t[F-1])),a=F>2?XL:HL,w=S=null,k}function k(F){return F==null||isNaN(F=+F)?d:(w||(w=a(t.map(l),i,o)))(l(g(F)))}return k.invert=function(F){return g(u((S||(S=a(i,t.map(l),Zs)))(F)))},k.domain=function(F){return arguments.length?(t=Array.from(F,ZL),C()):t.slice()},k.range=function(F){return arguments.length?(i=Array.from(F),C()):i.slice()},k.rangeRound=function(F){return i=Array.from(F),o=j5,C()},k.clamp=function(F){return arguments.length?(g=F?!0:Iu,C()):g!==Iu},k.interpolate=function(F){return arguments.length?(o=F,C()):o},k.unknown=function(F){return arguments.length?(d=F,k):d},function(F,R){return l=F,u=R,C()}}function QL(){return YL()(Iu,Iu)}function JL(t,i,o,l){var u=vx(t,i,o),d;switch(l=Mm(l==null?",f":l),l.type){case"s":{var g=Math.max(Math.abs(t),Math.abs(i));return l.precision==null&&!isNaN(d=CL(u,g))&&(l.precision=d),HE(l,g)}case"":case"e":case"g":case"p":case"r":{l.precision==null&&!isNaN(d=IL(u,Math.max(Math.abs(t),Math.abs(i))))&&(l.precision=d-(l.type==="e"));break}case"f":case"%":{l.precision==null&&!isNaN(d=AL(u))&&(l.precision=d-(l.type==="%")*2);break}}return WE(l)}function eO(t){var i=t.domain;return t.ticks=function(o){var l=i();return gE(l[0],l[l.length-1],o==null?10:o)},t.tickFormat=function(o,l){var u=i();return JL(u[0],u[u.length-1],o==null?10:o,l)},t.nice=function(o){o==null&&(o=10);var l=i(),u=0,d=l.length-1,g=l[u],a=l[d],w,S,C=10;for(a<g&&(S=g,g=a,a=S,S=u,u=d,d=S);C-- >0;){if(S=yE(g,a,o),S===w)return l[u]=g,l[d]=a,i(l);if(S>0)g=Math.floor(g/S)*S,a=Math.ceil(a/S)*S;else if(S<0)g=Math.ceil(g*S)/S,a=Math.floor(a*S)/S;else break;w=S}return t},t}function tO(){var t=QL();return t.copy=function(){return KL(t,tO())},GL.apply(t,arguments),eO(t)}function Or(t){return function(){return t}}function oS(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function aS(t){this._context=t}aS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,i){switch(t=+t,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,i):this._context.moveTo(t,i);break;case 1:this._point=2;default:this._context.lineTo(t,i);break}}};function lS(t){return new aS(t)}function cS(t){return t[0]}function uS(t){return t[1]}function iO(t,i){var o=Or(!0),l=null,u=lS,d=null;t=typeof t=="function"?t:t===void 0?cS:Or(t),i=typeof i=="function"?i:i===void 0?uS:Or(i);function g(a){var w,S=(a=oS(a)).length,C,k=!1,F;for(l==null&&(d=u(F=kx())),w=0;w<=S;++w)!(w<S&&o(C=a[w],w,a))===k&&((k=!k)?d.lineStart():d.lineEnd()),k&&d.point(+t(C,w,a),+i(C,w,a));if(F)return d=null,F+""||null}return g.x=function(a){return arguments.length?(t=typeof a=="function"?a:Or(+a),g):t},g.y=function(a){return arguments.length?(i=typeof a=="function"?a:Or(+a),g):i},g.defined=function(a){return arguments.length?(o=typeof a=="function"?a:Or(!!a),g):o},g.curve=function(a){return arguments.length?(u=a,l!=null&&(d=u(l)),g):u},g.context=function(a){return arguments.length?(a==null?l=d=null:d=u(l=a),g):l},g}function E6(t,i,o){var l=null,u=Or(!0),d=null,g=lS,a=null;t=typeof t=="function"?t:t===void 0?cS:Or(+t),i=typeof i=="function"?i:Or(i===void 0?0:+i),o=typeof o=="function"?o:o===void 0?uS:Or(+o);function w(C){var k,F,R,W=(C=oS(C)).length,Z,X=!1,q,ue=new Array(W),pe=new Array(W);for(d==null&&(a=g(q=kx())),k=0;k<=W;++k){if(!(k<W&&u(Z=C[k],k,C))===X)if(X=!X)F=k,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),R=k-1;R>=F;--R)a.point(ue[R],pe[R]);a.lineEnd(),a.areaEnd()}X&&(ue[k]=+t(Z,k,C),pe[k]=+i(Z,k,C),a.point(l?+l(Z,k,C):ue[k],o?+o(Z,k,C):pe[k]))}if(q)return a=null,q+""||null}function S(){return iO().defined(u).curve(g).context(d)}return w.x=function(C){return arguments.length?(t=typeof C=="function"?C:Or(+C),l=null,w):t},w.x0=function(C){return arguments.length?(t=typeof C=="function"?C:Or(+C),w):t},w.x1=function(C){return arguments.length?(l=C==null?null:typeof C=="function"?C:Or(+C),w):l},w.y=function(C){return arguments.length?(i=typeof C=="function"?C:Or(+C),o=null,w):i},w.y0=function(C){return arguments.length?(i=typeof C=="function"?C:Or(+C),w):i},w.y1=function(C){return arguments.length?(o=C==null?null:typeof C=="function"?C:Or(+C),w):o},w.lineX0=w.lineY0=function(){return S().x(t).y(i)},w.lineY1=function(){return S().x(t).y(o)},w.lineX1=function(){return S().x(l).y(i)},w.defined=function(C){return arguments.length?(u=typeof C=="function"?C:Or(!!C),w):u},w.curve=function(C){return arguments.length?(g=C,d!=null&&(a=g(d)),w):g},w.context=function(C){return arguments.length?(C==null?d=a=null:a=g(d=C),w):d},w}function zx(t){return ZM()?(WM(t),!0):!1}const ld=typeof window!="undefined",rO=t=>typeof t=="string",Fu=()=>{};function by(t,i=!0){sh()?id(t):i?t():ox(t)}function Lm(t){var i;const o=Xa(t);return(i=o==null?void 0:o.$el)!=null?i:o}const cd=ld?window:void 0;ld&&window.document;ld&&window.navigator;ld&&window.location;function Rx(...t){let i,o,l,u;if(rO(t[0])?([o,l,u]=t,i=cd):[i,o,l,u]=t,!i)return Fu;let d=Fu;const g=Ao(()=>Xa(i),w=>{d(),!!w&&(w.addEventListener(o,l,u),d=()=>{w.removeEventListener(o,l,u),d=Fu})},{immediate:!0,flush:"post"}),a=()=>{g(),d()};return zx(a),a}const wy=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Ty="__vueuse_ssr_handlers__";wy[Ty]=wy[Ty]||{};wy[Ty];var i2=Object.getOwnPropertySymbols,nO=Object.prototype.hasOwnProperty,sO=Object.prototype.propertyIsEnumerable,oO=(t,i)=>{var o={};for(var l in t)nO.call(t,l)&&i.indexOf(l)<0&&(o[l]=t[l]);if(t!=null&&i2)for(var l of i2(t))i.indexOf(l)<0&&sO.call(t,l)&&(o[l]=t[l]);return o};function aO(t,i,o={}){const l=o,{window:u=cd}=l,d=oO(l,["window"]);let g;const a=u&&"ResizeObserver"in u,w=()=>{g&&(g.disconnect(),g=void 0)},S=Ao(()=>Lm(t),k=>{w(),a&&u&&k&&(g=new u.ResizeObserver(i),g.observe(k,d))},{immediate:!0,flush:"post"}),C=()=>{w(),S()};return zx(C),{isSupported:a,stop:C}}function S6(t){const i=Pr(0),o=Pr(0),l=Pr(0),u=Pr(0),d=Pr(0),g=Pr(0),a=Pr(0),w=Pr(0);function S(){const C=Lm(t);if(!C){i.value=0,o.value=0,l.value=0,u.value=0,d.value=0,g.value=0,a.value=0,w.value=0;return}const k=C.getBoundingClientRect();i.value=k.height,o.value=k.bottom,l.value=k.left,u.value=k.right,d.value=k.top,g.value=k.width,a.value=k.x,w.value=k.y}return Rx("scroll",S,!0),aO(t,S),{height:i,bottom:o,left:l,right:u,top:d,width:g,x:a,y:w,update:S}}function A6(t,{window:i=cd,scrollTarget:o}={}){const l=Pr(!1),u=()=>{if(!i)return;const d=i.document;if(!t.value)l.value=!1;else{const g=t.value.getBoundingClientRect();l.value=g.top<=(i.innerHeight||d.documentElement.clientHeight)&&g.left<=(i.innerWidth||d.documentElement.clientWidth)&&g.bottom>=0&&g.right>=0}};return by(u),i&&by(()=>Rx((o==null?void 0:o.value)||i,"scroll",u,{capture:!1,passive:!0})),l}function C6(t,i,o={}){const{root:l,rootMargin:u="0px",threshold:d=.1,window:g=cd}=o,a=g&&"IntersectionObserver"in g;let w=Fu;const S=a?Ao(()=>({el:Lm(t),root:Lm(l)}),({el:k,root:F})=>{if(w(),!k)return;const R=new g.IntersectionObserver(i,{root:F,rootMargin:u,threshold:d});R.observe(k),w=()=>{R.disconnect(),w=Fu}},{immediate:!0,flush:"post"}):Fu,C=()=>{w(),S()};return zx(C),{isSupported:a,stop:C}}var r2,n2;ld&&(window==null?void 0:window.navigator)&&((r2=window==null?void 0:window.navigator)==null?void 0:r2.platform)&&/iP(ad|hone|od)/.test((n2=window==null?void 0:window.navigator)==null?void 0:n2.platform);var lO=Object.defineProperty,s2=Object.getOwnPropertySymbols,cO=Object.prototype.hasOwnProperty,uO=Object.prototype.propertyIsEnumerable,o2=(t,i,o)=>i in t?lO(t,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[i]=o,hO=(t,i)=>{for(var o in i||(i={}))cO.call(i,o)&&o2(t,o,i[o]);if(s2)for(var o of s2(i))uO.call(i,o)&&o2(t,o,i[o]);return t};const fO={top:0,left:0,bottom:0,right:0,height:0,width:0};hO({text:""},fO);function I6({window:t=cd,initialWidth:i=1/0,initialHeight:o=1/0}={}){const l=Pr(i),u=Pr(o),d=()=>{t&&(l.value=t.innerWidth,u.value=t.innerHeight)};return d(),by(d),Rx("resize",d,{passive:!0}),{width:l,height:u}}function Zo(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hS(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i}/*!
 * GSAP 3.9.1
 * https://greensock.com
 *
 * @license Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var ns={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Xu={duration:.5,overwrite:!1,delay:0},Fx,Ss=1e8,Xi=1/Ss,Ey=Math.PI*2,dO=Ey/4,pO=0,fS=Math.sqrt,mO=Math.cos,_O=Math.sin,Vr=function(i){return typeof i=="string"},jr=function(i){return typeof i=="function"},Qo=function(i){return typeof i=="number"},Lx=function(i){return typeof i=="undefined"},Jo=function(i){return typeof i=="object"},Un=function(i){return i!==!1},dS=function(){return typeof window!="undefined"},Zp=function(i){return jr(i)||Vr(i)},pS=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},cn=Array.isArray,Sy=/(?:-?\.?\d|\.)+/gi,mS=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Mu=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,u0=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,_S=/[+-]=-?[.\d]+/,gS=/[^,'"\[\]\s]+/gi,gO=/[\d.+\-=]+(?:e[-+]\d*)*/i,ur,yo,Ay,Ox,as={},Om={},yS,xS=function(i){return(Om=Ku(i,as))&&Mo},Bx=function(i,o){return console.warn("Invalid property",i,"set to",o,"Missing plugin? gsap.registerPlugin()")},Bm=function(i,o){return!o&&console.warn(i)},vS=function(i,o){return i&&(as[i]=o)&&Om&&(Om[i]=o)||as},Hf=function(){return 0},Ux={},Ya=[],Cy={},bS,Qn={},h0={},a2=30,im=[],Nx="",jx=function(i){var o=i[0],l,u;if(Jo(o)||jr(o)||(i=[i]),!(l=(o._gsap||{}).harness)){for(u=im.length;u--&&!im[u].targetTest(o););l=im[u]}for(u=i.length;u--;)i[u]&&(i[u]._gsap||(i[u]._gsap=new $S(i[u],l)))||i.splice(u,1);return i},ac=function(i){return i._gsap||jx(As(i))[0]._gsap},wS=function(i,o,l){return(l=i[o])&&jr(l)?i[o]():Lx(l)&&i.getAttribute&&i.getAttribute(o)||l},Nn=function(i,o){return(i=i.split(",")).forEach(o)||i},Sr=function(i){return Math.round(i*1e5)/1e5||0},ln=function(i){return Math.round(i*1e7)/1e7||0},yO=function(i,o){for(var l=o.length,u=0;i.indexOf(o[u])<0&&++u<l;);return u<l},Um=function(){var i=Ya.length,o=Ya.slice(0),l,u;for(Cy={},Ya.length=0,l=0;l<i;l++)u=o[l],u&&u._lazy&&(u.render(u._lazy[0],u._lazy[1],!0)._lazy=0)},TS=function(i,o,l,u){Ya.length&&Um(),i.render(o,l,u),Ya.length&&Um()},ES=function(i){var o=parseFloat(i);return(o||o===0)&&(i+"").match(gS).length<2?o:Vr(i)?i.trim():i},SS=function(i){return i},Ps=function(i,o){for(var l in o)l in i||(i[l]=o[l]);return i},xO=function(i){return function(o,l){for(var u in l)u in o||u==="duration"&&i||u==="ease"||(o[u]=l[u])}},Ku=function(i,o){for(var l in o)i[l]=o[l];return i},l2=function t(i,o){for(var l in o)l!=="__proto__"&&l!=="constructor"&&l!=="prototype"&&(i[l]=Jo(o[l])?t(i[l]||(i[l]={}),o[l]):o[l]);return i},Nm=function(i,o){var l={},u;for(u in i)u in o||(l[u]=i[u]);return l},zf=function(i){var o=i.parent||ur,l=i.keyframes?xO(cn(i.keyframes)):Ps;if(Un(i.inherit))for(;o;)l(i,o.vars.defaults),o=o.parent||o._dp;return i},vO=function(i,o){for(var l=i.length,u=l===o.length;u&&l--&&i[l]===o[l];);return l<0},bO=function(i,o,l,u,d){l===void 0&&(l="_first"),u===void 0&&(u="_last");var g=i[u],a;if(d)for(a=o[d];g&&g[d]>a;)g=g._prev;return g?(o._next=g._next,g._next=o):(o._next=i[l],i[l]=o),o._next?o._next._prev=o:i[u]=o,o._prev=g,o.parent=o._dp=i,o},f_=function(i,o,l,u){l===void 0&&(l="_first"),u===void 0&&(u="_last");var d=o._prev,g=o._next;d?d._next=g:i[l]===o&&(i[l]=g),g?g._prev=d:i[u]===o&&(i[u]=d),o._next=o._prev=o.parent=null},Ho=function(i,o){i.parent&&(!o||i.parent.autoRemoveChildren)&&i.parent.remove(i),i._act=0},lc=function(i,o){if(i&&(!o||o._end>i._dur||o._start<0))for(var l=i;l;)l._dirty=1,l=l.parent;return i},wO=function(i){for(var o=i.parent;o&&o.parent;)o._dirty=1,o.totalDuration(),o=o.parent;return i},TO=function t(i){return!i||i._ts&&t(i.parent)},c2=function(i){return i._repeat?Yu(i._tTime,i=i.duration()+i._rDelay)*i:0},Yu=function(i,o){var l=Math.floor(i/=o);return i&&l===i?l-1:l},jm=function(i,o){return(i-o._start)*o._ts+(o._ts>=0?0:o._dirty?o.totalDuration():o._tDur)},d_=function(i){return i._end=ln(i._start+(i._tDur/Math.abs(i._ts||i._rts||Xi)||0))},AS=function(i,o){var l=i._dp;return l&&l.smoothChildTiming&&i._ts&&(i._start=ln(l._time-(i._ts>0?o/i._ts:((i._dirty?i.totalDuration():i._tDur)-o)/-i._ts)),d_(i),l._dirty||lc(l,i)),i},CS=function(i,o){var l;if((o._time||o._initted&&!o._dur)&&(l=jm(i.rawTime(),o),(!o._dur||ud(0,o.totalDuration(),l)-o._tTime>Xi)&&o.render(l,!0)),lc(i,o)._dp&&i._initted&&i._time>=i._dur&&i._ts){if(i._dur<i.duration())for(l=i;l._dp;)l.rawTime()>=0&&l.totalTime(l._tTime),l=l._dp;i._zTime=-Xi}},Eo=function(i,o,l,u){return o.parent&&Ho(o),o._start=ln((Qo(l)?l:l||i!==ur?ws(i,l,o):i._time)+o._delay),o._end=ln(o._start+(o.totalDuration()/Math.abs(o.timeScale())||0)),bO(i,o,"_first","_last",i._sort?"_start":0),Iy(o)||(i._recent=o),u||CS(i,o),i},IS=function(i,o){return(as.ScrollTrigger||Bx("scrollTrigger",o))&&as.ScrollTrigger.create(o,i)},MS=function(i,o,l,u){if(ZO(i,o),!i._initted)return 1;if(!l&&i._pt&&(i._dur&&i.vars.lazy!==!1||!i._dur&&i.vars.lazy)&&bS!==Es.frame)return Ya.push(i),i._lazy=[o,u],1},EO=function t(i){var o=i.parent;return o&&o._ts&&o._initted&&!o._lock&&(o.rawTime()<0||t(o))},Iy=function(i){var o=i.data;return o==="isFromStart"||o==="isStart"},SO=function(i,o,l,u){var d=i.ratio,g=o<0||!o&&(!i._start&&EO(i)&&!(!i._initted&&Iy(i))||(i._ts<0||i._dp._ts<0)&&!Iy(i))?0:1,a=i._rDelay,w=0,S,C,k;if(a&&i._repeat&&(w=ud(0,i._tDur,o),C=Yu(w,a),i._yoyo&&C&1&&(g=1-g),C!==Yu(i._tTime,a)&&(d=1-g,i.vars.repeatRefresh&&i._initted&&i.invalidate())),g!==d||u||i._zTime===Xi||!o&&i._zTime){if(!i._initted&&MS(i,o,u,l))return;for(k=i._zTime,i._zTime=o||(l?Xi:0),l||(l=o&&!k),i.ratio=g,i._from&&(g=1-g),i._time=0,i._tTime=w,S=i._pt;S;)S.r(g,S.d),S=S._next;i._startAt&&o<0&&i._startAt.render(o,!0,!0),i._onUpdate&&!l&&Cs(i,"onUpdate"),w&&i._repeat&&!l&&i.parent&&Cs(i,"onRepeat"),(o>=i._tDur||o<0)&&i.ratio===g&&(g&&Ho(i,1),l||(Cs(i,g?"onComplete":"onReverseComplete",!0),i._prom&&i._prom()))}else i._zTime||(i._zTime=o)},AO=function(i,o,l){var u;if(l>o)for(u=i._first;u&&u._start<=l;){if(u.data==="isPause"&&u._start>o)return u;u=u._next}else for(u=i._last;u&&u._start>=l;){if(u.data==="isPause"&&u._start<o)return u;u=u._prev}},Qu=function(i,o,l,u){var d=i._repeat,g=ln(o)||0,a=i._tTime/i._tDur;return a&&!u&&(i._time*=g/i._dur),i._dur=g,i._tDur=d?d<0?1e10:ln(g*(d+1)+i._rDelay*d):g,a>0&&!u?AS(i,i._tTime=i._tDur*a):i.parent&&d_(i),l||lc(i.parent,i),i},u2=function(i){return i instanceof Bn?lc(i):Qu(i,i._dur)},CO={_start:0,endTime:Hf,totalDuration:Hf},ws=function t(i,o,l){var u=i.labels,d=i._recent||CO,g=i.duration()>=Ss?d.endTime(!1):i._dur,a,w,S;return Vr(o)&&(isNaN(o)||o in u)?(w=o.charAt(0),S=o.substr(-1)==="%",a=o.indexOf("="),w==="<"||w===">"?(a>=0&&(o=o.replace(/=/,"")),(w==="<"?d._start:d.endTime(d._repeat>=0))+(parseFloat(o.substr(1))||0)*(S?(a<0?d:l).totalDuration()/100:1)):a<0?(o in u||(u[o]=g),u[o]):(w=parseFloat(o.charAt(a-1)+o.substr(a+1)),S&&l&&(w=w/100*(cn(l)?l[0]:l).totalDuration()),a>1?t(i,o.substr(0,a-1),l)+w:g+w)):o==null?g:+o},Rf=function(i,o,l){var u=Qo(o[1]),d=(u?2:1)+(i<2?0:1),g=o[d],a,w;if(u&&(g.duration=o[1]),g.parent=l,i){for(a=g,w=l;w&&!("immediateRender"in a);)a=w.vars.defaults||{},w=Un(w.vars.inherit)&&w.parent;g.immediateRender=Un(a.immediateRender),i<2?g.runBackwards=1:g.startAt=o[d-1]}return new Br(o[0],g,o[d+1])},sl=function(i,o){return i||i===0?o(i):o},ud=function(i,o,l){return l<i?i:l>o?o:l},On=function(i,o){return!Vr(i)||!(o=gO.exec(i))?"":i.substr(o.index+o[0].length)},IO=function(i,o,l){return sl(l,function(u){return ud(i,o,u)})},My=[].slice,kS=function(i,o){return i&&Jo(i)&&"length"in i&&(!o&&!i.length||i.length-1 in i&&Jo(i[0]))&&!i.nodeType&&i!==yo},MO=function(i,o,l){return l===void 0&&(l=[]),i.forEach(function(u){var d;return Vr(u)&&!o||kS(u,1)?(d=l).push.apply(d,As(u)):l.push(u)})||l},As=function(i,o,l){return Vr(i)&&!l&&(Ay||!Ju())?My.call((o||Ox).querySelectorAll(i),0):cn(i)?MO(i,l):kS(i)?My.call(i,0):i?[i]:[]},kO=function(i){return i=As(i)[0]||Bm("Invalid scope")||{},function(o){var l=i.current||i.nativeElement||i;return As(o,l.querySelectorAll?l:l===i?Bm("Invalid scope")||Ox.createElement("div"):i)}},PS=function(i){return i.sort(function(){return .5-Math.random()})},DS=function(i){if(jr(i))return i;var o=Jo(i)?i:{each:i},l=cc(o.ease),u=o.from||0,d=parseFloat(o.base)||0,g={},a=u>0&&u<1,w=isNaN(u)||a,S=o.axis,C=u,k=u;return Vr(u)?C=k={center:.5,edges:.5,end:1}[u]||0:!a&&w&&(C=u[0],k=u[1]),function(F,R,W){var Z=(W||o).length,X=g[Z],q,ue,pe,xe,fe,Te,Ie,Le,Pe;if(!X){if(Pe=o.grid==="auto"?0:(o.grid||[1,Ss])[1],!Pe){for(Ie=-Ss;Ie<(Ie=W[Pe++].getBoundingClientRect().left)&&Pe<Z;);Pe--}for(X=g[Z]=[],q=w?Math.min(Pe,Z)*C-.5:u%Pe,ue=Pe===Ss?0:w?Z*k/Pe-.5:u/Pe|0,Ie=0,Le=Ss,Te=0;Te<Z;Te++)pe=Te%Pe-q,xe=ue-(Te/Pe|0),X[Te]=fe=S?Math.abs(S==="y"?xe:pe):fS(pe*pe+xe*xe),fe>Ie&&(Ie=fe),fe<Le&&(Le=fe);u==="random"&&PS(X),X.max=Ie-Le,X.min=Le,X.v=Z=(parseFloat(o.amount)||parseFloat(o.each)*(Pe>Z?Z-1:S?S==="y"?Z/Pe:Pe:Math.max(Pe,Z/Pe))||0)*(u==="edges"?-1:1),X.b=Z<0?d-Z:d,X.u=On(o.amount||o.each)||0,l=l&&Z<0?NS(l):l}return Z=(X[F]-X.min)/X.max||0,ln(X.b+(l?l(Z):Z)*X.v)+X.u}},ky=function(i){var o=Math.pow(10,((i+"").split(".")[1]||"").length);return function(l){var u=Math.round(parseFloat(l)/i)*i*o;return(u-u%1)/o+(Qo(l)?0:On(l))}},zS=function(i,o){var l=cn(i),u,d;return!l&&Jo(i)&&(u=l=i.radius||Ss,i.values?(i=As(i.values),(d=!Qo(i[0]))&&(u*=u)):i=ky(i.increment)),sl(o,l?jr(i)?function(g){return d=i(g),Math.abs(d-g)<=u?d:g}:function(g){for(var a=parseFloat(d?g.x:g),w=parseFloat(d?g.y:0),S=Ss,C=0,k=i.length,F,R;k--;)d?(F=i[k].x-a,R=i[k].y-w,F=F*F+R*R):F=Math.abs(i[k]-a),F<S&&(S=F,C=k);return C=!u||S<=u?i[C]:g,d||C===g||Qo(g)?C:C+On(g)}:ky(i))},RS=function(i,o,l,u){return sl(cn(i)?!o:l===!0?!!(l=0):!u,function(){return cn(i)?i[~~(Math.random()*i.length)]:(l=l||1e-5)&&(u=l<1?Math.pow(10,(l+"").length-2):1)&&Math.floor(Math.round((i-l/2+Math.random()*(o-i+l*.99))/l)*l*u)/u})},PO=function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return function(u){return o.reduce(function(d,g){return g(d)},u)}},DO=function(i,o){return function(l){return i(parseFloat(l))+(o||On(l))}},zO=function(i,o,l){return LS(i,o,0,1,l)},FS=function(i,o,l){return sl(l,function(u){return i[~~o(u)]})},RO=function t(i,o,l){var u=o-i;return cn(i)?FS(i,t(0,i.length),o):sl(l,function(d){return(u+(d-i)%u)%u+i})},FO=function t(i,o,l){var u=o-i,d=u*2;return cn(i)?FS(i,t(0,i.length-1),o):sl(l,function(g){return g=(d+(g-i)%d)%d||0,i+(g>u?d-g:g)})},Xf=function(i){for(var o=0,l="",u,d,g,a;~(u=i.indexOf("random(",o));)g=i.indexOf(")",u),a=i.charAt(u+7)==="[",d=i.substr(u+7,g-u-7).match(a?gS:Sy),l+=i.substr(o,u-o)+RS(a?d:+d[0],a?0:+d[1],+d[2]||1e-5),o=g+1;return l+i.substr(o,i.length-o)},LS=function(i,o,l,u,d){var g=o-i,a=u-l;return sl(d,function(w){return l+((w-i)/g*a||0)})},LO=function t(i,o,l,u){var d=isNaN(i+o)?0:function(R){return(1-R)*i+R*o};if(!d){var g=Vr(i),a={},w,S,C,k,F;if(l===!0&&(u=1)&&(l=null),g)i={p:i},o={p:o};else if(cn(i)&&!cn(o)){for(C=[],k=i.length,F=k-2,S=1;S<k;S++)C.push(t(i[S-1],i[S]));k--,d=function(W){W*=k;var Z=Math.min(F,~~W);return C[Z](W-Z)},l=o}else u||(i=Ku(cn(i)?[]:{},i));if(!C){for(w in o)Vx.call(a,i,w,"get",o[w]);d=function(W){return qx(W,a)||(g?i.p:i)}}}return sl(l,d)},h2=function(i,o,l){var u=i.labels,d=Ss,g,a,w;for(g in u)a=u[g]-o,a<0==!!l&&a&&d>(a=Math.abs(a))&&(w=g,d=a);return w},Cs=function(i,o,l){var u=i.vars,d=u[o],g,a;if(!!d)return g=u[o+"Params"],a=u.callbackScope||i,l&&Ya.length&&Um(),g?d.apply(a,g):d.call(a)},Tf=function(i){return Ho(i),i.scrollTrigger&&i.scrollTrigger.kill(!1),i.progress()<1&&Cs(i,"onInterrupt"),i},ku,OO=function(i){i=!i.name&&i.default||i;var o=i.name,l=jr(i),u=o&&!l&&i.init?function(){this._props=[]}:i,d={init:Hf,render:qx,add:Vx,kill:JO,modifier:QO,rawVars:0},g={targetTest:0,get:0,getSetter:Gx,aliases:{},register:0};if(Ju(),i!==u){if(Qn[o])return;Ps(u,Ps(Nm(i,d),g)),Ku(u.prototype,Ku(d,Nm(i,g))),Qn[u.prop=o]=u,i.targetTest&&(im.push(u),Ux[o]=1),o=(o==="css"?"CSS":o.charAt(0).toUpperCase()+o.substr(1))+"Plugin"}vS(o,u),i.register&&i.register(Mo,u,jn)},Zi=255,Ef={aqua:[0,Zi,Zi],lime:[0,Zi,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Zi],navy:[0,0,128],white:[Zi,Zi,Zi],olive:[128,128,0],yellow:[Zi,Zi,0],orange:[Zi,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Zi,0,0],pink:[Zi,192,203],cyan:[0,Zi,Zi],transparent:[Zi,Zi,Zi,0]},f0=function(i,o,l){return i+=i<0?1:i>1?-1:0,(i*6<1?o+(l-o)*i*6:i<.5?l:i*3<2?o+(l-o)*(2/3-i)*6:o)*Zi+.5|0},OS=function(i,o,l){var u=i?Qo(i)?[i>>16,i>>8&Zi,i&Zi]:0:Ef.black,d,g,a,w,S,C,k,F,R,W;if(!u){if(i.substr(-1)===","&&(i=i.substr(0,i.length-1)),Ef[i])u=Ef[i];else if(i.charAt(0)==="#"){if(i.length<6&&(d=i.charAt(1),g=i.charAt(2),a=i.charAt(3),i="#"+d+d+g+g+a+a+(i.length===5?i.charAt(4)+i.charAt(4):"")),i.length===9)return u=parseInt(i.substr(1,6),16),[u>>16,u>>8&Zi,u&Zi,parseInt(i.substr(7),16)/255];i=parseInt(i.substr(1),16),u=[i>>16,i>>8&Zi,i&Zi]}else if(i.substr(0,3)==="hsl"){if(u=W=i.match(Sy),!o)w=+u[0]%360/360,S=+u[1]/100,C=+u[2]/100,g=C<=.5?C*(S+1):C+S-C*S,d=C*2-g,u.length>3&&(u[3]*=1),u[0]=f0(w+1/3,d,g),u[1]=f0(w,d,g),u[2]=f0(w-1/3,d,g);else if(~i.indexOf("="))return u=i.match(mS),l&&u.length<4&&(u[3]=1),u}else u=i.match(Sy)||Ef.transparent;u=u.map(Number)}return o&&!W&&(d=u[0]/Zi,g=u[1]/Zi,a=u[2]/Zi,k=Math.max(d,g,a),F=Math.min(d,g,a),C=(k+F)/2,k===F?w=S=0:(R=k-F,S=C>.5?R/(2-k-F):R/(k+F),w=k===d?(g-a)/R+(g<a?6:0):k===g?(a-d)/R+2:(d-g)/R+4,w*=60),u[0]=~~(w+.5),u[1]=~~(S*100+.5),u[2]=~~(C*100+.5)),l&&u.length<4&&(u[3]=1),u},BS=function(i){var o=[],l=[],u=-1;return i.split(Qa).forEach(function(d){var g=d.match(Mu)||[];o.push.apply(o,g),l.push(u+=g.length+1)}),o.c=l,o},f2=function(i,o,l){var u="",d=(i+u).match(Qa),g=o?"hsla(":"rgba(",a=0,w,S,C,k;if(!d)return i;if(d=d.map(function(F){return(F=OS(F,o,1))&&g+(o?F[0]+","+F[1]+"%,"+F[2]+"%,"+F[3]:F.join(","))+")"}),l&&(C=BS(i),w=l.c,w.join(u)!==C.c.join(u)))for(S=i.replace(Qa,"1").split(Mu),k=S.length-1;a<k;a++)u+=S[a]+(~w.indexOf(a)?d.shift()||g+"0,0,0,0)":(C.length?C:d.length?d:l).shift());if(!S)for(S=i.split(Qa),k=S.length-1;a<k;a++)u+=S[a]+d[a];return u+S[k]},Qa=function(){var t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",i;for(i in Ef)t+="|"+i+"\\b";return new RegExp(t+")","gi")}(),BO=/hsl[a]?\(/,US=function(i){var o=i.join(" "),l;if(Qa.lastIndex=0,Qa.test(o))return l=BO.test(o),i[1]=f2(i[1],l),i[0]=f2(i[0],l,BS(i[1])),!0},Vm,Es=function(){var t=Date.now,i=500,o=33,l=t(),u=l,d=1e3/240,g=d,a=[],w,S,C,k,F,R,W=function Z(X){var q=t()-u,ue=X===!0,pe,xe,fe,Te;if(q>i&&(l+=q-o),u+=q,fe=u-l,pe=fe-g,(pe>0||ue)&&(Te=++k.frame,F=fe-k.time*1e3,k.time=fe=fe/1e3,g+=pe+(pe>=d?4:d-pe),xe=1),ue||(w=S(Z)),xe)for(R=0;R<a.length;R++)a[R](fe,F,Te,X)};return k={time:0,frame:0,tick:function(){W(!0)},deltaRatio:function(X){return F/(1e3/(X||60))},wake:function(){yS&&(!Ay&&dS()&&(yo=Ay=window,Ox=yo.document||{},as.gsap=Mo,(yo.gsapVersions||(yo.gsapVersions=[])).push(Mo.version),xS(Om||yo.GreenSockGlobals||!yo.gsap&&yo||{}),C=yo.requestAnimationFrame),w&&k.sleep(),S=C||function(X){return setTimeout(X,g-k.time*1e3+1|0)},Vm=1,W(2))},sleep:function(){(C?yo.cancelAnimationFrame:clearTimeout)(w),Vm=0,S=Hf},lagSmoothing:function(X,q){i=X||1/Xi,o=Math.min(q,i,0)},fps:function(X){d=1e3/(X||240),g=k.time*1e3+d},add:function(X){a.indexOf(X)<0&&a.push(X),Ju()},remove:function(X,q){~(q=a.indexOf(X))&&a.splice(q,1)&&R>=q&&R--},_listeners:a},k}(),Ju=function(){return!Vm&&Es.wake()},bi={},UO=/^[\d.\-M][\d.\-,\s]/,NO=/["']/g,jO=function(i){for(var o={},l=i.substr(1,i.length-3).split(":"),u=l[0],d=1,g=l.length,a,w,S;d<g;d++)w=l[d],a=d!==g-1?w.lastIndexOf(","):w.length,S=w.substr(0,a),o[u]=isNaN(S)?S.replace(NO,"").trim():+S,u=w.substr(a+1).trim();return o},VO=function(i){var o=i.indexOf("(")+1,l=i.indexOf(")"),u=i.indexOf("(",o);return i.substring(o,~u&&u<l?i.indexOf(")",l+1):l)},$O=function(i){var o=(i+"").split("("),l=bi[o[0]];return l&&o.length>1&&l.config?l.config.apply(null,~i.indexOf("{")?[jO(o[1])]:VO(i).split(",").map(ES)):bi._CE&&UO.test(i)?bi._CE("",i):l},NS=function(i){return function(o){return 1-i(1-o)}},jS=function t(i,o){for(var l=i._first,u;l;)l instanceof Bn?t(l,o):l.vars.yoyoEase&&(!l._yoyo||!l._repeat)&&l._yoyo!==o&&(l.timeline?t(l.timeline,o):(u=l._ease,l._ease=l._yEase,l._yEase=u,l._yoyo=o)),l=l._next},cc=function(i,o){return i&&(jr(i)?i:bi[i]||$O(i))||o},dc=function(i,o,l,u){l===void 0&&(l=function(w){return 1-o(1-w)}),u===void 0&&(u=function(w){return w<.5?o(w*2)/2:1-o((1-w)*2)/2});var d={easeIn:o,easeOut:l,easeInOut:u},g;return Nn(i,function(a){bi[a]=as[a]=d,bi[g=a.toLowerCase()]=l;for(var w in d)bi[g+(w==="easeIn"?".in":w==="easeOut"?".out":".inOut")]=bi[a+"."+w]=d[w]}),d},VS=function(i){return function(o){return o<.5?(1-i(1-o*2))/2:.5+i((o-.5)*2)/2}},d0=function t(i,o,l){var u=o>=1?o:1,d=(l||(i?.3:.45))/(o<1?o:1),g=d/Ey*(Math.asin(1/u)||0),a=function(C){return C===1?1:u*Math.pow(2,-10*C)*_O((C-g)*d)+1},w=i==="out"?a:i==="in"?function(S){return 1-a(1-S)}:VS(a);return d=Ey/d,w.config=function(S,C){return t(i,S,C)},w},p0=function t(i,o){o===void 0&&(o=1.70158);var l=function(g){return g?--g*g*((o+1)*g+o)+1:0},u=i==="out"?l:i==="in"?function(d){return 1-l(1-d)}:VS(l);return u.config=function(d){return t(i,d)},u};Nn("Linear,Quad,Cubic,Quart,Quint,Strong",function(t,i){var o=i<5?i+1:i;dc(t+",Power"+(o-1),i?function(l){return Math.pow(l,o)}:function(l){return l},function(l){return 1-Math.pow(1-l,o)},function(l){return l<.5?Math.pow(l*2,o)/2:1-Math.pow((1-l)*2,o)/2})});bi.Linear.easeNone=bi.none=bi.Linear.easeIn;dc("Elastic",d0("in"),d0("out"),d0());(function(t,i){var o=1/i,l=2*o,u=2.5*o,d=function(a){return a<o?t*a*a:a<l?t*Math.pow(a-1.5/i,2)+.75:a<u?t*(a-=2.25/i)*a+.9375:t*Math.pow(a-2.625/i,2)+.984375};dc("Bounce",function(g){return 1-d(1-g)},d)})(7.5625,2.75);dc("Expo",function(t){return t?Math.pow(2,10*(t-1)):0});dc("Circ",function(t){return-(fS(1-t*t)-1)});dc("Sine",function(t){return t===1?1:-mO(t*dO)+1});dc("Back",p0("in"),p0("out"),p0());bi.SteppedEase=bi.steps=as.SteppedEase={config:function(i,o){i===void 0&&(i=1);var l=1/i,u=i+(o?0:1),d=o?1:0,g=1-Xi;return function(a){return((u*ud(0,g,a)|0)+d)*l}}};Xu.ease=bi["quad.out"];Nn("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(t){return Nx+=t+","+t+"Params,"});var $S=function(i,o){this.id=pO++,i._gsap=this,this.target=i,this.harness=o,this.get=o?o.get:wS,this.set=o?o.getSetter:Gx},Kf=function(){function t(o){this.vars=o,this._delay=+o.delay||0,(this._repeat=o.repeat===1/0?-2:o.repeat||0)&&(this._rDelay=o.repeatDelay||0,this._yoyo=!!o.yoyo||!!o.yoyoEase),this._ts=1,Qu(this,+o.duration,1,1),this.data=o.data,Vm||Es.wake()}var i=t.prototype;return i.delay=function(l){return l||l===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+l-this._delay),this._delay=l,this):this._delay},i.duration=function(l){return arguments.length?this.totalDuration(this._repeat>0?l+(l+this._rDelay)*this._repeat:l):this.totalDuration()&&this._dur},i.totalDuration=function(l){return arguments.length?(this._dirty=0,Qu(this,this._repeat<0?l:(l-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},i.totalTime=function(l,u){if(Ju(),!arguments.length)return this._tTime;var d=this._dp;if(d&&d.smoothChildTiming&&this._ts){for(AS(this,l),!d._dp||d.parent||CS(d,this);d&&d.parent;)d.parent._time!==d._start+(d._ts>=0?d._tTime/d._ts:(d.totalDuration()-d._tTime)/-d._ts)&&d.totalTime(d._tTime,!0),d=d.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&l<this._tDur||this._ts<0&&l>0||!this._tDur&&!l)&&Eo(this._dp,this,this._start-this._delay)}return(this._tTime!==l||!this._dur&&!u||this._initted&&Math.abs(this._zTime)===Xi||!l&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=l),TS(this,l,u)),this},i.time=function(l,u){return arguments.length?this.totalTime(Math.min(this.totalDuration(),l+c2(this))%(this._dur+this._rDelay)||(l?this._dur:0),u):this._time},i.totalProgress=function(l,u){return arguments.length?this.totalTime(this.totalDuration()*l,u):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},i.progress=function(l,u){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-l:l)+c2(this),u):this.duration()?Math.min(1,this._time/this._dur):this.ratio},i.iteration=function(l,u){var d=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(l-1)*d,u):this._repeat?Yu(this._tTime,d)+1:1},i.timeScale=function(l){if(!arguments.length)return this._rts===-Xi?0:this._rts;if(this._rts===l)return this;var u=this.parent&&this._ts?jm(this.parent._time,this):this._tTime;return this._rts=+l||0,this._ts=this._ps||l===-Xi?0:this._rts,wO(this.totalTime(ud(-this._delay,this._tDur,u),!0)),d_(this),this},i.paused=function(l){return arguments.length?(this._ps!==l&&(this._ps=l,l?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Ju(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Xi&&(this._tTime-=Xi)))),this):this._ps},i.startTime=function(l){if(arguments.length){this._start=l;var u=this.parent||this._dp;return u&&(u._sort||!this.parent)&&Eo(u,this,l-this._delay),this}return this._start},i.endTime=function(l){return this._start+(Un(l)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},i.rawTime=function(l){var u=this.parent||this._dp;return u?l&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?jm(u.rawTime(l),this):this._tTime:this._tTime},i.globalTime=function(l){for(var u=this,d=arguments.length?l:u.rawTime();u;)d=u._start+d/(u._ts||1),u=u._dp;return d},i.repeat=function(l){return arguments.length?(this._repeat=l===1/0?-2:l,u2(this)):this._repeat===-2?1/0:this._repeat},i.repeatDelay=function(l){if(arguments.length){var u=this._time;return this._rDelay=l,u2(this),u?this.time(u):this}return this._rDelay},i.yoyo=function(l){return arguments.length?(this._yoyo=l,this):this._yoyo},i.seek=function(l,u){return this.totalTime(ws(this,l),Un(u))},i.restart=function(l,u){return this.play().totalTime(l?-this._delay:0,Un(u))},i.play=function(l,u){return l!=null&&this.seek(l,u),this.reversed(!1).paused(!1)},i.reverse=function(l,u){return l!=null&&this.seek(l||this.totalDuration(),u),this.reversed(!0).paused(!1)},i.pause=function(l,u){return l!=null&&this.seek(l,u),this.paused(!0)},i.resume=function(){return this.paused(!1)},i.reversed=function(l){return arguments.length?(!!l!==this.reversed()&&this.timeScale(-this._rts||(l?-Xi:0)),this):this._rts<0},i.invalidate=function(){return this._initted=this._act=0,this._zTime=-Xi,this},i.isActive=function(){var l=this.parent||this._dp,u=this._start,d;return!!(!l||this._ts&&this._initted&&l.isActive()&&(d=l.rawTime(!0))>=u&&d<this.endTime(!0)-Xi)},i.eventCallback=function(l,u,d){var g=this.vars;return arguments.length>1?(u?(g[l]=u,d&&(g[l+"Params"]=d),l==="onUpdate"&&(this._onUpdate=u)):delete g[l],this):g[l]},i.then=function(l){var u=this;return new Promise(function(d){var g=jr(l)?l:SS,a=function(){var S=u.then;u.then=null,jr(g)&&(g=g(u))&&(g.then||g===u)&&(u.then=S),d(g),u.then=S};u._initted&&u.totalProgress()===1&&u._ts>=0||!u._tTime&&u._ts<0?a():u._prom=a})},i.kill=function(){Tf(this)},t}();Ps(Kf.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Xi,_prom:0,_ps:!1,_rts:1});var Bn=function(t){hS(i,t);function i(l,u){var d;return l===void 0&&(l={}),d=t.call(this,l)||this,d.labels={},d.smoothChildTiming=!!l.smoothChildTiming,d.autoRemoveChildren=!!l.autoRemoveChildren,d._sort=Un(l.sortChildren),ur&&Eo(l.parent||ur,Zo(d),u),l.reversed&&d.reverse(),l.paused&&d.paused(!0),l.scrollTrigger&&IS(Zo(d),l.scrollTrigger),d}var o=i.prototype;return o.to=function(u,d,g){return Rf(0,arguments,this),this},o.from=function(u,d,g){return Rf(1,arguments,this),this},o.fromTo=function(u,d,g,a){return Rf(2,arguments,this),this},o.set=function(u,d,g){return d.duration=0,d.parent=this,zf(d).repeatDelay||(d.repeat=0),d.immediateRender=!!d.immediateRender,new Br(u,d,ws(this,g),1),this},o.call=function(u,d,g){return Eo(this,Br.delayedCall(0,u,d),g)},o.staggerTo=function(u,d,g,a,w,S,C){return g.duration=d,g.stagger=g.stagger||a,g.onComplete=S,g.onCompleteParams=C,g.parent=this,new Br(u,g,ws(this,w)),this},o.staggerFrom=function(u,d,g,a,w,S,C){return g.runBackwards=1,zf(g).immediateRender=Un(g.immediateRender),this.staggerTo(u,d,g,a,w,S,C)},o.staggerFromTo=function(u,d,g,a,w,S,C,k){return a.startAt=g,zf(a).immediateRender=Un(a.immediateRender),this.staggerTo(u,d,a,w,S,C,k)},o.render=function(u,d,g){var a=this._time,w=this._dirty?this.totalDuration():this._tDur,S=this._dur,C=u<=0?0:ln(u),k=this._zTime<0!=u<0&&(this._initted||!S),F,R,W,Z,X,q,ue,pe,xe,fe,Te,Ie;if(this!==ur&&C>w&&u>=0&&(C=w),C!==this._tTime||g||k){if(a!==this._time&&S&&(C+=this._time-a,u+=this._time-a),F=C,xe=this._start,pe=this._ts,q=!pe,k&&(S||(a=this._zTime),(u||!d)&&(this._zTime=u)),this._repeat){if(Te=this._yoyo,X=S+this._rDelay,this._repeat<-1&&u<0)return this.totalTime(X*100+u,d,g);if(F=ln(C%X),C===w?(Z=this._repeat,F=S):(Z=~~(C/X),Z&&Z===C/X&&(F=S,Z--),F>S&&(F=S)),fe=Yu(this._tTime,X),!a&&this._tTime&&fe!==Z&&(fe=Z),Te&&Z&1&&(F=S-F,Ie=1),Z!==fe&&!this._lock){var Le=Te&&fe&1,Pe=Le===(Te&&Z&1);if(Z<fe&&(Le=!Le),a=Le?0:S,this._lock=1,this.render(a||(Ie?0:ln(Z*X)),d,!S)._lock=0,this._tTime=C,!d&&this.parent&&Cs(this,"onRepeat"),this.vars.repeatRefresh&&!Ie&&(this.invalidate()._lock=1),a&&a!==this._time||q!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(S=this._dur,w=this._tDur,Pe&&(this._lock=2,a=Le?S:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!Ie&&this.invalidate()),this._lock=0,!this._ts&&!q)return this;jS(this,Ie)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(ue=AO(this,ln(a),ln(F)),ue&&(C-=F-(F=ue._start))),this._tTime=C,this._time=F,this._act=!pe,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=u,a=0),!a&&F&&!d&&(Cs(this,"onStart"),this._tTime!==C))return this;if(F>=a&&u>=0)for(R=this._first;R;){if(W=R._next,(R._act||F>=R._start)&&R._ts&&ue!==R){if(R.parent!==this)return this.render(u,d,g);if(R.render(R._ts>0?(F-R._start)*R._ts:(R._dirty?R.totalDuration():R._tDur)+(F-R._start)*R._ts,d,g),F!==this._time||!this._ts&&!q){ue=0,W&&(C+=this._zTime=-Xi);break}}R=W}else{R=this._last;for(var qe=u<0?u:F;R;){if(W=R._prev,(R._act||qe<=R._end)&&R._ts&&ue!==R){if(R.parent!==this)return this.render(u,d,g);if(R.render(R._ts>0?(qe-R._start)*R._ts:(R._dirty?R.totalDuration():R._tDur)+(qe-R._start)*R._ts,d,g),F!==this._time||!this._ts&&!q){ue=0,W&&(C+=this._zTime=qe?-Xi:Xi);break}}R=W}}if(ue&&!d&&(this.pause(),ue.render(F>=a?0:-Xi)._zTime=F>=a?1:-1,this._ts))return this._start=xe,d_(this),this.render(u,d,g);this._onUpdate&&!d&&Cs(this,"onUpdate",!0),(C===w&&w>=this.totalDuration()||!C&&a)&&(xe===this._start||Math.abs(pe)!==Math.abs(this._ts))&&(this._lock||((u||!S)&&(C===w&&this._ts>0||!C&&this._ts<0)&&Ho(this,1),!d&&!(u<0&&!a)&&(C||a||!w)&&(Cs(this,C===w&&u>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(C<w&&this.timeScale()>0)&&this._prom())))}return this},o.add=function(u,d){var g=this;if(Qo(d)||(d=ws(this,d,u)),!(u instanceof Kf)){if(cn(u))return u.forEach(function(a){return g.add(a,d)}),this;if(Vr(u))return this.addLabel(u,d);if(jr(u))u=Br.delayedCall(0,u);else return this}return this!==u?Eo(this,u,d):this},o.getChildren=function(u,d,g,a){u===void 0&&(u=!0),d===void 0&&(d=!0),g===void 0&&(g=!0),a===void 0&&(a=-Ss);for(var w=[],S=this._first;S;)S._start>=a&&(S instanceof Br?d&&w.push(S):(g&&w.push(S),u&&w.push.apply(w,S.getChildren(!0,d,g)))),S=S._next;return w},o.getById=function(u){for(var d=this.getChildren(1,1,1),g=d.length;g--;)if(d[g].vars.id===u)return d[g]},o.remove=function(u){return Vr(u)?this.removeLabel(u):jr(u)?this.killTweensOf(u):(f_(this,u),u===this._recent&&(this._recent=this._last),lc(this))},o.totalTime=function(u,d){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=ln(Es.time-(this._ts>0?u/this._ts:(this.totalDuration()-u)/-this._ts))),t.prototype.totalTime.call(this,u,d),this._forcing=0,this):this._tTime},o.addLabel=function(u,d){return this.labels[u]=ws(this,d),this},o.removeLabel=function(u){return delete this.labels[u],this},o.addPause=function(u,d,g){var a=Br.delayedCall(0,d||Hf,g);return a.data="isPause",this._hasPause=1,Eo(this,a,ws(this,u))},o.removePause=function(u){var d=this._first;for(u=ws(this,u);d;)d._start===u&&d.data==="isPause"&&Ho(d),d=d._next},o.killTweensOf=function(u,d,g){for(var a=this.getTweensOf(u,g),w=a.length;w--;)Ga!==a[w]&&a[w].kill(u,d);return this},o.getTweensOf=function(u,d){for(var g=[],a=As(u),w=this._first,S=Qo(d),C;w;)w instanceof Br?yO(w._targets,a)&&(S?(!Ga||w._initted&&w._ts)&&w.globalTime(0)<=d&&w.globalTime(w.totalDuration())>d:!d||w.isActive())&&g.push(w):(C=w.getTweensOf(a,d)).length&&g.push.apply(g,C),w=w._next;return g},o.tweenTo=function(u,d){d=d||{};var g=this,a=ws(g,u),w=d,S=w.startAt,C=w.onStart,k=w.onStartParams,F=w.immediateRender,R,W=Br.to(g,Ps({ease:d.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:d.duration||Math.abs((a-(S&&"time"in S?S.time:g._time))/g.timeScale())||Xi,onStart:function(){if(g.pause(),!R){var X=d.duration||Math.abs((a-(S&&"time"in S?S.time:g._time))/g.timeScale());W._dur!==X&&Qu(W,X,0,1).render(W._time,!0,!0),R=1}C&&C.apply(W,k||[])}},d));return F?W.render(0):W},o.tweenFromTo=function(u,d,g){return this.tweenTo(d,Ps({startAt:{time:ws(this,u)}},g))},o.recent=function(){return this._recent},o.nextLabel=function(u){return u===void 0&&(u=this._time),h2(this,ws(this,u))},o.previousLabel=function(u){return u===void 0&&(u=this._time),h2(this,ws(this,u),1)},o.currentLabel=function(u){return arguments.length?this.seek(u,!0):this.previousLabel(this._time+Xi)},o.shiftChildren=function(u,d,g){g===void 0&&(g=0);for(var a=this._first,w=this.labels,S;a;)a._start>=g&&(a._start+=u,a._end+=u),a=a._next;if(d)for(S in w)w[S]>=g&&(w[S]+=u);return lc(this)},o.invalidate=function(){var u=this._first;for(this._lock=0;u;)u.invalidate(),u=u._next;return t.prototype.invalidate.call(this)},o.clear=function(u){u===void 0&&(u=!0);for(var d=this._first,g;d;)g=d._next,this.remove(d),d=g;return this._dp&&(this._time=this._tTime=this._pTime=0),u&&(this.labels={}),lc(this)},o.totalDuration=function(u){var d=0,g=this,a=g._last,w=Ss,S,C,k;if(arguments.length)return g.timeScale((g._repeat<0?g.duration():g.totalDuration())/(g.reversed()?-u:u));if(g._dirty){for(k=g.parent;a;)S=a._prev,a._dirty&&a.totalDuration(),C=a._start,C>w&&g._sort&&a._ts&&!g._lock?(g._lock=1,Eo(g,a,C-a._delay,1)._lock=0):w=C,C<0&&a._ts&&(d-=C,(!k&&!g._dp||k&&k.smoothChildTiming)&&(g._start+=C/g._ts,g._time-=C,g._tTime-=C),g.shiftChildren(-C,!1,-1/0),w=0),a._end>d&&a._ts&&(d=a._end),a=S;Qu(g,g===ur&&g._time>d?g._time:d,1,1),g._dirty=0}return g._tDur},i.updateRoot=function(u){if(ur._ts&&(TS(ur,jm(u,ur)),bS=Es.frame),Es.frame>=a2){a2+=ns.autoSleep||120;var d=ur._first;if((!d||!d._ts)&&ns.autoSleep&&Es._listeners.length<2){for(;d&&!d._ts;)d=d._next;d||Es.sleep()}}},i}(Kf);Ps(Bn.prototype,{_lock:0,_hasPause:0,_forcing:0});var GO=function(i,o,l,u,d,g,a){var w=new jn(this._pt,i,o,0,1,XS,null,d),S=0,C=0,k,F,R,W,Z,X,q,ue;for(w.b=l,w.e=u,l+="",u+="",(q=~u.indexOf("random("))&&(u=Xf(u)),g&&(ue=[l,u],g(ue,i,o),l=ue[0],u=ue[1]),F=l.match(u0)||[];k=u0.exec(u);)W=k[0],Z=u.substring(S,k.index),R?R=(R+1)%5:Z.substr(-5)==="rgba("&&(R=1),W!==F[C++]&&(X=parseFloat(F[C-1])||0,w._pt={_next:w._pt,p:Z||C===1?Z:",",s:X,c:W.charAt(1)==="="?parseFloat(W.substr(2))*(W.charAt(0)==="-"?-1:1):parseFloat(W)-X,m:R&&R<4?Math.round:0},S=u0.lastIndex);return w.c=S<u.length?u.substring(S,u.length):"",w.fp=a,(_S.test(u)||q)&&(w.e=0),this._pt=w,w},Vx=function(i,o,l,u,d,g,a,w,S){jr(u)&&(u=u(d||0,i,g));var C=i[o],k=l!=="get"?l:jr(C)?S?i[o.indexOf("set")||!jr(i["get"+o.substr(3)])?o:"get"+o.substr(3)](S):i[o]():C,F=jr(C)?S?XO:WS:$x,R;if(Vr(u)&&(~u.indexOf("random(")&&(u=Xf(u)),u.charAt(1)==="="&&(R=parseFloat(k)+parseFloat(u.substr(2))*(u.charAt(0)==="-"?-1:1)+(On(k)||0),(R||R===0)&&(u=R))),k!==u)return!isNaN(k*u)&&u!==""?(R=new jn(this._pt,i,o,+k||0,u-(k||0),typeof C=="boolean"?YO:HS,0,F),S&&(R.fp=S),a&&R.modifier(a,this,i),this._pt=R):(!C&&!(o in i)&&Bx(o,u),GO.call(this,i,o,k,u,F,w||ns.stringFilter,S))},qO=function(i,o,l,u,d){if(jr(i)&&(i=Ff(i,d,o,l,u)),!Jo(i)||i.style&&i.nodeType||cn(i)||pS(i))return Vr(i)?Ff(i,d,o,l,u):i;var g={},a;for(a in i)g[a]=Ff(i[a],d,o,l,u);return g},GS=function(i,o,l,u,d,g){var a,w,S,C;if(Qn[i]&&(a=new Qn[i]).init(d,a.rawVars?o[i]:qO(o[i],u,d,g,l),l,u,g)!==!1&&(l._pt=w=new jn(l._pt,d,i,0,1,a.render,a,0,a.priority),l!==ku))for(S=l._ptLookup[l._targets.indexOf(d)],C=a._props.length;C--;)S[a._props[C]]=w;return a},Ga,ZO=function t(i,o){var l=i.vars,u=l.ease,d=l.startAt,g=l.immediateRender,a=l.lazy,w=l.onUpdate,S=l.onUpdateParams,C=l.callbackScope,k=l.runBackwards,F=l.yoyoEase,R=l.keyframes,W=l.autoRevert,Z=i._dur,X=i._startAt,q=i._targets,ue=i.parent,pe=ue&&ue.data==="nested"?ue.parent._targets:q,xe=i._overwrite==="auto"&&!Fx,fe=i.timeline,Te,Ie,Le,Pe,qe,ze,lt,ct,be,Ze,Qe,gt,St;if(fe&&(!R||!u)&&(u="none"),i._ease=cc(u,Xu.ease),i._yEase=F?NS(cc(F===!0?u:F,Xu.ease)):0,F&&i._yoyo&&!i._repeat&&(F=i._yEase,i._yEase=i._ease,i._ease=F),i._from=!fe&&!!l.runBackwards,!fe||R&&!l.stagger){if(ct=q[0]?ac(q[0]).harness:0,gt=ct&&l[ct.prop],Te=Nm(l,Ux),X&&Ho(X.render(-1,!0)),d)if(Ho(i._startAt=Br.set(q,Ps({data:"isStart",overwrite:!1,parent:ue,immediateRender:!0,lazy:Un(a),startAt:null,delay:0,onUpdate:w,onUpdateParams:S,callbackScope:C,stagger:0},d))),o<0&&!g&&!W&&i._startAt.render(-1,!0),g){if(o>0&&!W&&(i._startAt=0),Z&&o<=0){o&&(i._zTime=o);return}}else W===!1&&(i._startAt=0);else if(k&&Z){if(X)!W&&(i._startAt=0);else if(o&&(g=!1),Le=Ps({overwrite:!1,data:"isFromStart",lazy:g&&Un(a),immediateRender:g,stagger:0,parent:ue},Te),gt&&(Le[ct.prop]=gt),Ho(i._startAt=Br.set(q,Le)),o<0&&i._startAt.render(-1,!0),i._zTime=o,!g)t(i._startAt,Xi);else if(!o)return}for(i._pt=0,a=Z&&Un(a)||a&&!Z,Ie=0;Ie<q.length;Ie++){if(qe=q[Ie],lt=qe._gsap||jx(q)[Ie]._gsap,i._ptLookup[Ie]=Ze={},Cy[lt.id]&&Ya.length&&Um(),Qe=pe===q?Ie:pe.indexOf(qe),ct&&(be=new ct).init(qe,gt||Te,i,Qe,pe)!==!1&&(i._pt=Pe=new jn(i._pt,qe,be.name,0,1,be.render,be,0,be.priority),be._props.forEach(function(bt){Ze[bt]=Pe}),be.priority&&(ze=1)),!ct||gt)for(Le in Te)Qn[Le]&&(be=GS(Le,Te,i,Qe,qe,pe))?be.priority&&(ze=1):Ze[Le]=Pe=Vx.call(i,qe,Le,"get",Te[Le],Qe,pe,0,l.stringFilter);i._op&&i._op[Ie]&&i.kill(qe,i._op[Ie]),xe&&i._pt&&(Ga=i,ur.killTweensOf(qe,Ze,i.globalTime(o)),St=!i.parent,Ga=0),i._pt&&a&&(Cy[lt.id]=1)}ze&&KS(i),i._onInit&&i._onInit(i)}i._onUpdate=w,i._initted=(!i._op||i._pt)&&!St,R&&o<=0&&fe.render(Ss,!0,!0)},WO=function(i,o){var l=i[0]?ac(i[0]).harness:0,u=l&&l.aliases,d,g,a,w;if(!u)return o;d=Ku({},o);for(g in u)if(g in d)for(w=u[g].split(","),a=w.length;a--;)d[w[a]]=d[g];return d},HO=function(i,o,l,u){var d=o.ease||u||"power1.inOut",g,a;if(cn(o))a=l[i]||(l[i]=[]),o.forEach(function(w,S){return a.push({t:S/(o.length-1)*100,v:w,e:d})});else for(g in o)a=l[g]||(l[g]=[]),g==="ease"||a.push({t:parseFloat(i),v:o[g],e:d})},Ff=function(i,o,l,u,d){return jr(i)?i.call(o,l,u,d):Vr(i)&&~i.indexOf("random(")?Xf(i):i},qS=Nx+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase",ZS={};Nn(qS+",id,stagger,delay,duration,paused,scrollTrigger",function(t){return ZS[t]=1});var Br=function(t){hS(i,t);function i(l,u,d,g){var a;typeof u=="number"&&(d.duration=u,u=d,d=null),a=t.call(this,g?u:zf(u))||this;var w=a.vars,S=w.duration,C=w.delay,k=w.immediateRender,F=w.stagger,R=w.overwrite,W=w.keyframes,Z=w.defaults,X=w.scrollTrigger,q=w.yoyoEase,ue=u.parent||ur,pe=(cn(l)||pS(l)?Qo(l[0]):"length"in u)?[l]:As(l),xe,fe,Te,Ie,Le,Pe,qe,ze;if(a._targets=pe.length?jx(pe):Bm("GSAP target "+l+" not found. https://greensock.com",!ns.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=R,W||F||Zp(S)||Zp(C)){if(u=a.vars,xe=a.timeline=new Bn({data:"nested",defaults:Z||{}}),xe.kill(),xe.parent=xe._dp=Zo(a),xe._start=0,F||Zp(S)||Zp(C)){if(Ie=pe.length,qe=F&&DS(F),Jo(F))for(Le in F)~qS.indexOf(Le)&&(ze||(ze={}),ze[Le]=F[Le]);for(fe=0;fe<Ie;fe++)Te=Nm(u,ZS),Te.stagger=0,q&&(Te.yoyoEase=q),ze&&Ku(Te,ze),Pe=pe[fe],Te.duration=+Ff(S,Zo(a),fe,Pe,pe),Te.delay=(+Ff(C,Zo(a),fe,Pe,pe)||0)-a._delay,!F&&Ie===1&&Te.delay&&(a._delay=C=Te.delay,a._start+=C,Te.delay=0),xe.to(Pe,Te,qe?qe(fe,Pe,pe):0),xe._ease=bi.none;xe.duration()?S=C=0:a.timeline=0}else if(W){zf(Ps(xe.vars.defaults,{ease:"none"})),xe._ease=cc(W.ease||u.ease||"none");var lt=0,ct,be,Ze;if(cn(W))W.forEach(function(Qe){return xe.to(pe,Qe,">")});else{Te={};for(Le in W)Le==="ease"||Le==="easeEach"||HO(Le,W[Le],Te,W.easeEach);for(Le in Te)for(ct=Te[Le].sort(function(Qe,gt){return Qe.t-gt.t}),lt=0,fe=0;fe<ct.length;fe++)be=ct[fe],Ze={ease:be.e,duration:(be.t-(fe?ct[fe-1].t:0))/100*S},Ze[Le]=be.v,xe.to(pe,Ze,lt),lt+=Ze.duration;xe.duration()<S&&xe.to({},{duration:S-xe.duration()})}}S||a.duration(S=xe.duration())}else a.timeline=0;return R===!0&&!Fx&&(Ga=Zo(a),ur.killTweensOf(pe),Ga=0),Eo(ue,Zo(a),d),u.reversed&&a.reverse(),u.paused&&a.paused(!0),(k||!S&&!W&&a._start===ln(ue._time)&&Un(k)&&TO(Zo(a))&&ue.data!=="nested")&&(a._tTime=-Xi,a.render(Math.max(0,-C))),X&&IS(Zo(a),X),a}var o=i.prototype;return o.render=function(u,d,g){var a=this._time,w=this._tDur,S=this._dur,C=u>w-Xi&&u>=0?w:u<Xi?0:u,k,F,R,W,Z,X,q,ue,pe;if(!S)SO(this,u,d,g);else if(C!==this._tTime||!u||g||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=u<0){if(k=C,ue=this.timeline,this._repeat){if(W=S+this._rDelay,this._repeat<-1&&u<0)return this.totalTime(W*100+u,d,g);if(k=ln(C%W),C===w?(R=this._repeat,k=S):(R=~~(C/W),R&&R===C/W&&(k=S,R--),k>S&&(k=S)),X=this._yoyo&&R&1,X&&(pe=this._yEase,k=S-k),Z=Yu(this._tTime,W),k===a&&!g&&this._initted)return this;R!==Z&&(ue&&this._yEase&&jS(ue,X),this.vars.repeatRefresh&&!X&&!this._lock&&(this._lock=g=1,this.render(ln(W*R),!0).invalidate()._lock=0))}if(!this._initted){if(MS(this,u<0?u:k,g,d))return this._tTime=0,this;if(S!==this._dur)return this.render(u,d,g)}if(this._tTime=C,this._time=k,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=q=(pe||this._ease)(k/S),this._from&&(this.ratio=q=1-q),k&&!a&&!d&&(Cs(this,"onStart"),this._tTime!==C))return this;for(F=this._pt;F;)F.r(q,F.d),F=F._next;ue&&ue.render(u<0?u:!k&&X?-Xi:ue._dur*ue._ease(k/this._dur),d,g)||this._startAt&&(this._zTime=u),this._onUpdate&&!d&&(u<0&&this._startAt&&this._startAt.render(u,!0,g),Cs(this,"onUpdate")),this._repeat&&R!==Z&&this.vars.onRepeat&&!d&&this.parent&&Cs(this,"onRepeat"),(C===this._tDur||!C)&&this._tTime===C&&(u<0&&this._startAt&&!this._onUpdate&&this._startAt.render(u,!0,!0),(u||!S)&&(C===this._tDur&&this._ts>0||!C&&this._ts<0)&&Ho(this,1),!d&&!(u<0&&!a)&&(C||a)&&(Cs(this,C===w?"onComplete":"onReverseComplete",!0),this._prom&&!(C<w&&this.timeScale()>0)&&this._prom()))}return this},o.targets=function(){return this._targets},o.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),t.prototype.invalidate.call(this)},o.kill=function(u,d){if(d===void 0&&(d="all"),!u&&(!d||d==="all"))return this._lazy=this._pt=0,this.parent?Tf(this):this;if(this.timeline){var g=this.timeline.totalDuration();return this.timeline.killTweensOf(u,d,Ga&&Ga.vars.overwrite!==!0)._first||Tf(this),this.parent&&g!==this.timeline.totalDuration()&&Qu(this,this._dur*this.timeline._tDur/g,0,1),this}var a=this._targets,w=u?As(u):a,S=this._ptLookup,C=this._pt,k,F,R,W,Z,X,q;if((!d||d==="all")&&vO(a,w))return d==="all"&&(this._pt=0),Tf(this);for(k=this._op=this._op||[],d!=="all"&&(Vr(d)&&(Z={},Nn(d,function(ue){return Z[ue]=1}),d=Z),d=WO(a,d)),q=a.length;q--;)if(~w.indexOf(a[q])){F=S[q],d==="all"?(k[q]=d,W=F,R={}):(R=k[q]=k[q]||{},W=d);for(Z in W)X=F&&F[Z],X&&((!("kill"in X.d)||X.d.kill(Z)===!0)&&f_(this,X,"_pt"),delete F[Z]),R!=="all"&&(R[Z]=1)}return this._initted&&!this._pt&&C&&Tf(this),this},i.to=function(u,d){return new i(u,d,arguments[2])},i.from=function(u,d){return Rf(1,arguments)},i.delayedCall=function(u,d,g,a){return new i(d,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:u,onComplete:d,onReverseComplete:d,onCompleteParams:g,onReverseCompleteParams:g,callbackScope:a})},i.fromTo=function(u,d,g){return Rf(2,arguments)},i.set=function(u,d){return d.duration=0,d.repeatDelay||(d.repeat=0),new i(u,d)},i.killTweensOf=function(u,d,g){return ur.killTweensOf(u,d,g)},i}(Kf);Ps(Br.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Nn("staggerTo,staggerFrom,staggerFromTo",function(t){Br[t]=function(){var i=new Bn,o=My.call(arguments,0);return o.splice(t==="staggerFromTo"?5:4,0,0),i[t].apply(i,o)}});var $x=function(i,o,l){return i[o]=l},WS=function(i,o,l){return i[o](l)},XO=function(i,o,l,u){return i[o](u.fp,l)},KO=function(i,o,l){return i.setAttribute(o,l)},Gx=function(i,o){return jr(i[o])?WS:Lx(i[o])&&i.setAttribute?KO:$x},HS=function(i,o){return o.set(o.t,o.p,Math.round((o.s+o.c*i)*1e6)/1e6,o)},YO=function(i,o){return o.set(o.t,o.p,!!(o.s+o.c*i),o)},XS=function(i,o){var l=o._pt,u="";if(!i&&o.b)u=o.b;else if(i===1&&o.e)u=o.e;else{for(;l;)u=l.p+(l.m?l.m(l.s+l.c*i):Math.round((l.s+l.c*i)*1e4)/1e4)+u,l=l._next;u+=o.c}o.set(o.t,o.p,u,o)},qx=function(i,o){for(var l=o._pt;l;)l.r(i,l.d),l=l._next},QO=function(i,o,l,u){for(var d=this._pt,g;d;)g=d._next,d.p===u&&d.modifier(i,o,l),d=g},JO=function(i){for(var o=this._pt,l,u;o;)u=o._next,o.p===i&&!o.op||o.op===i?f_(this,o,"_pt"):o.dep||(l=1),o=u;return!l},eB=function(i,o,l,u){u.mSet(i,o,u.m.call(u.tween,l,u.mt),u)},KS=function(i){for(var o=i._pt,l,u,d,g;o;){for(l=o._next,u=d;u&&u.pr>o.pr;)u=u._next;(o._prev=u?u._prev:g)?o._prev._next=o:d=o,(o._next=u)?u._prev=o:g=o,o=l}i._pt=d},jn=function(){function t(o,l,u,d,g,a,w,S,C){this.t=l,this.s=d,this.c=g,this.p=u,this.r=a||HS,this.d=w||this,this.set=S||$x,this.pr=C||0,this._next=o,o&&(o._prev=this)}var i=t.prototype;return i.modifier=function(l,u,d){this.mSet=this.mSet||this.set,this.set=eB,this.m=l,this.mt=d,this.tween=u},t}();Nn(Nx+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(t){return Ux[t]=1});as.TweenMax=as.TweenLite=Br;as.TimelineLite=as.TimelineMax=Bn;ur=new Bn({sortChildren:!1,defaults:Xu,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});ns.stringFilter=US;var $m={registerPlugin:function(){for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];o.forEach(function(u){return OO(u)})},timeline:function(i){return new Bn(i)},getTweensOf:function(i,o){return ur.getTweensOf(i,o)},getProperty:function(i,o,l,u){Vr(i)&&(i=As(i)[0]);var d=ac(i||{}).get,g=l?SS:ES;return l==="native"&&(l=""),i&&(o?g((Qn[o]&&Qn[o].get||d)(i,o,l,u)):function(a,w,S){return g((Qn[a]&&Qn[a].get||d)(i,a,w,S))})},quickSetter:function(i,o,l){if(i=As(i),i.length>1){var u=i.map(function(C){return Mo.quickSetter(C,o,l)}),d=u.length;return function(C){for(var k=d;k--;)u[k](C)}}i=i[0]||{};var g=Qn[o],a=ac(i),w=a.harness&&(a.harness.aliases||{})[o]||o,S=g?function(C){var k=new g;ku._pt=0,k.init(i,l?C+l:C,ku,0,[i]),k.render(1,k),ku._pt&&qx(1,ku)}:a.set(i,w);return g?S:function(C){return S(i,w,l?C+l:C,a,1)}},isTweening:function(i){return ur.getTweensOf(i,!0).length>0},defaults:function(i){return i&&i.ease&&(i.ease=cc(i.ease,Xu.ease)),l2(Xu,i||{})},config:function(i){return l2(ns,i||{})},registerEffect:function(i){var o=i.name,l=i.effect,u=i.plugins,d=i.defaults,g=i.extendTimeline;(u||"").split(",").forEach(function(a){return a&&!Qn[a]&&!as[a]&&Bm(o+" effect requires "+a+" plugin.")}),h0[o]=function(a,w,S){return l(As(a),Ps(w||{},d),S)},g&&(Bn.prototype[o]=function(a,w,S){return this.add(h0[o](a,Jo(w)?w:(S=w)&&{},this),S)})},registerEase:function(i,o){bi[i]=cc(o)},parseEase:function(i,o){return arguments.length?cc(i,o):bi},getById:function(i){return ur.getById(i)},exportRoot:function(i,o){i===void 0&&(i={});var l=new Bn(i),u,d;for(l.smoothChildTiming=Un(i.smoothChildTiming),ur.remove(l),l._dp=0,l._time=l._tTime=ur._time,u=ur._first;u;)d=u._next,(o||!(!u._dur&&u instanceof Br&&u.vars.onComplete===u._targets[0]))&&Eo(l,u,u._start-u._delay),u=d;return Eo(ur,l,0),l},utils:{wrap:RO,wrapYoyo:FO,distribute:DS,random:RS,snap:zS,normalize:zO,getUnit:On,clamp:IO,splitColor:OS,toArray:As,selector:kO,mapRange:LS,pipe:PO,unitize:DO,interpolate:LO,shuffle:PS},install:xS,effects:h0,ticker:Es,updateRoot:Bn.updateRoot,plugins:Qn,globalTimeline:ur,core:{PropTween:jn,globals:vS,Tween:Br,Timeline:Bn,Animation:Kf,getCache:ac,_removeLinkedListItem:f_,suppressOverwrites:function(i){return Fx=i}}};Nn("to,from,fromTo,delayedCall,set,killTweensOf",function(t){return $m[t]=Br[t]});Es.add(Bn.updateRoot);ku=$m.to({},{duration:0});var tB=function(i,o){for(var l=i._pt;l&&l.p!==o&&l.op!==o&&l.fp!==o;)l=l._next;return l},iB=function(i,o){var l=i._targets,u,d,g;for(u in o)for(d=l.length;d--;)g=i._ptLookup[d][u],g&&(g=g.d)&&(g._pt&&(g=tB(g,u)),g&&g.modifier&&g.modifier(o[u],i,l[d],u))},m0=function(i,o){return{name:i,rawVars:1,init:function(u,d,g){g._onInit=function(a){var w,S;if(Vr(d)&&(w={},Nn(d,function(C){return w[C]=1}),d=w),o){w={};for(S in d)w[S]=o(d[S]);d=w}iB(a,d)}}}},Mo=$m.registerPlugin({name:"attr",init:function(i,o,l,u,d){var g,a;for(g in o)a=this.add(i,"setAttribute",(i.getAttribute(g)||0)+"",o[g],u,d,0,0,g),a&&(a.op=g),this._props.push(g)}},{name:"endArray",init:function(i,o){for(var l=o.length;l--;)this.add(i,l,i[l]||0,o[l])}},m0("roundProps",ky),m0("modifiers"),m0("snap",zS))||$m;Br.version=Bn.version=Mo.version="3.9.1";yS=1;dS()&&Ju();bi.Power0;bi.Power1;bi.Power2;bi.Power3;bi.Power4;bi.Linear;bi.Quad;bi.Cubic;bi.Quart;bi.Quint;bi.Strong;bi.Elastic;bi.Back;bi.SteppedEase;bi.Bounce;bi.Sine;bi.Expo;bi.Circ;/*!
 * CSSPlugin 3.9.1
 * https://greensock.com
 *
 * Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var d2,qa,Lu,Zx,ic,p2,rB=function(){return typeof window!="undefined"},el={},Xl=180/Math.PI,Ou=Math.PI/180,gu=Math.atan2,m2=1e8,YS=/([A-Z])/g,nB=/(?:left|right|width|margin|padding|x)/i,sB=/[\s,\(]\S/,Za={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},QS=function(i,o){return o.set(o.t,o.p,Math.round((o.s+o.c*i)*1e4)/1e4+o.u,o)},oB=function(i,o){return o.set(o.t,o.p,i===1?o.e:Math.round((o.s+o.c*i)*1e4)/1e4+o.u,o)},aB=function(i,o){return o.set(o.t,o.p,i?Math.round((o.s+o.c*i)*1e4)/1e4+o.u:o.b,o)},lB=function(i,o){var l=o.s+o.c*i;o.set(o.t,o.p,~~(l+(l<0?-.5:.5))+o.u,o)},JS=function(i,o){return o.set(o.t,o.p,i?o.e:o.b,o)},eA=function(i,o){return o.set(o.t,o.p,i!==1?o.b:o.e,o)},cB=function(i,o,l){return i.style[o]=l},uB=function(i,o,l){return i.style.setProperty(o,l)},hB=function(i,o,l){return i._gsap[o]=l},fB=function(i,o,l){return i._gsap.scaleX=i._gsap.scaleY=l},dB=function(i,o,l,u,d){var g=i._gsap;g.scaleX=g.scaleY=l,g.renderTransform(d,g)},pB=function(i,o,l,u,d){var g=i._gsap;g[o]=l,g.renderTransform(d,g)},Qr="transform",tl=Qr+"Origin",tA,Py=function(i,o){var l=qa.createElementNS?qa.createElementNS((o||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),i):qa.createElement(i);return l.style?l:qa.createElement(i)},Xo=function t(i,o,l){var u=getComputedStyle(i);return u[o]||u.getPropertyValue(o.replace(YS,"-$1").toLowerCase())||u.getPropertyValue(o)||!l&&t(i,eh(o)||o,1)||""},_2="O,Moz,ms,Ms,Webkit".split(","),eh=function(i,o,l){var u=o||ic,d=u.style,g=5;if(i in d&&!l)return i;for(i=i.charAt(0).toUpperCase()+i.substr(1);g--&&!(_2[g]+i in d););return g<0?null:(g===3?"ms":g>=0?_2[g]:"")+i},Dy=function(){rB()&&window.document&&(d2=window,qa=d2.document,Lu=qa.documentElement,ic=Py("div")||{style:{}},Py("div"),Qr=eh(Qr),tl=Qr+"Origin",ic.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",tA=!!eh("perspective"),Zx=1)},_0=function t(i){var o=Py("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),l=this.parentNode,u=this.nextSibling,d=this.style.cssText,g;if(Lu.appendChild(o),o.appendChild(this),this.style.display="block",i)try{g=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch{}else this._gsapBBox&&(g=this._gsapBBox());return l&&(u?l.insertBefore(this,u):l.appendChild(this)),Lu.removeChild(o),this.style.cssText=d,g},g2=function(i,o){for(var l=o.length;l--;)if(i.hasAttribute(o[l]))return i.getAttribute(o[l])},iA=function(i){var o;try{o=i.getBBox()}catch{o=_0.call(i,!0)}return o&&(o.width||o.height)||i.getBBox===_0||(o=_0.call(i,!0)),o&&!o.width&&!o.x&&!o.y?{x:+g2(i,["x","cx","x1"])||0,y:+g2(i,["y","cy","y1"])||0,width:0,height:0}:o},rA=function(i){return!!(i.getCTM&&(!i.parentNode||i.ownerSVGElement)&&iA(i))},Yf=function(i,o){if(o){var l=i.style;o in el&&o!==tl&&(o=Qr),l.removeProperty?((o.substr(0,2)==="ms"||o.substr(0,6)==="webkit")&&(o="-"+o),l.removeProperty(o.replace(YS,"-$1").toLowerCase())):l.removeAttribute(o)}},Wa=function(i,o,l,u,d,g){var a=new jn(i._pt,o,l,0,1,g?eA:JS);return i._pt=a,a.b=u,a.e=d,i._props.push(l),a},y2={deg:1,rad:1,turn:1},il=function t(i,o,l,u){var d=parseFloat(l)||0,g=(l+"").trim().substr((d+"").length)||"px",a=ic.style,w=nB.test(o),S=i.tagName.toLowerCase()==="svg",C=(S?"client":"offset")+(w?"Width":"Height"),k=100,F=u==="px",R=u==="%",W,Z,X,q;return u===g||!d||y2[u]||y2[g]?d:(g!=="px"&&!F&&(d=t(i,o,l,"px")),q=i.getCTM&&rA(i),(R||g==="%")&&(el[o]||~o.indexOf("adius"))?(W=q?i.getBBox()[w?"width":"height"]:i[C],Sr(R?d/W*k:d/100*W)):(a[w?"width":"height"]=k+(F?g:u),Z=~o.indexOf("adius")||u==="em"&&i.appendChild&&!S?i:i.parentNode,q&&(Z=(i.ownerSVGElement||{}).parentNode),(!Z||Z===qa||!Z.appendChild)&&(Z=qa.body),X=Z._gsap,X&&R&&X.width&&w&&X.time===Es.time?Sr(d/X.width*k):((R||g==="%")&&(a.position=Xo(i,"position")),Z===i&&(a.position="static"),Z.appendChild(ic),W=ic[C],Z.removeChild(ic),a.position="absolute",w&&R&&(X=ac(Z),X.time=Es.time,X.width=Z[C]),Sr(F?W*d/k:W&&d?k/W*d:0))))},Kl=function(i,o,l,u){var d;return Zx||Dy(),o in Za&&o!=="transform"&&(o=Za[o],~o.indexOf(",")&&(o=o.split(",")[0])),el[o]&&o!=="transform"?(d=Jf(i,u),d=o!=="transformOrigin"?d[o]:d.svg?d.origin:qm(Xo(i,tl))+" "+d.zOrigin+"px"):(d=i.style[o],(!d||d==="auto"||u||~(d+"").indexOf("calc("))&&(d=Gm[o]&&Gm[o](i,o,l)||Xo(i,o)||wS(i,o)||(o==="opacity"?1:0))),l&&!~(d+"").trim().indexOf(" ")?il(i,o,d,l)+l:d},mB=function(i,o,l,u){if(!l||l==="none"){var d=eh(o,i,1),g=d&&Xo(i,d,1);g&&g!==l?(o=d,l=g):o==="borderColor"&&(l=Xo(i,"borderTopColor"))}var a=new jn(this._pt,i.style,o,0,1,XS),w=0,S=0,C,k,F,R,W,Z,X,q,ue,pe,xe,fe,Te;if(a.b=l,a.e=u,l+="",u+="",u==="auto"&&(i.style[o]=u,u=Xo(i,o)||u,i.style[o]=l),C=[l,u],US(C),l=C[0],u=C[1],F=l.match(Mu)||[],Te=u.match(Mu)||[],Te.length){for(;k=Mu.exec(u);)X=k[0],ue=u.substring(w,k.index),W?W=(W+1)%5:(ue.substr(-5)==="rgba("||ue.substr(-5)==="hsla(")&&(W=1),X!==(Z=F[S++]||"")&&(R=parseFloat(Z)||0,xe=Z.substr((R+"").length),fe=X.charAt(1)==="="?+(X.charAt(0)+"1"):0,fe&&(X=X.substr(2)),q=parseFloat(X),pe=X.substr((q+"").length),w=Mu.lastIndex-pe.length,pe||(pe=pe||ns.units[o]||xe,w===u.length&&(u+=pe,a.e+=pe)),xe!==pe&&(R=il(i,o,Z,pe)||0),a._pt={_next:a._pt,p:ue||S===1?ue:",",s:R,c:fe?fe*q:q-R,m:W&&W<4||o==="zIndex"?Math.round:0});a.c=w<u.length?u.substring(w,u.length):""}else a.r=o==="display"&&u==="none"?eA:JS;return _S.test(u)&&(a.e=0),this._pt=a,a},x2={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},_B=function(i){var o=i.split(" "),l=o[0],u=o[1]||"50%";return(l==="top"||l==="bottom"||u==="left"||u==="right")&&(i=l,l=u,u=i),o[0]=x2[l]||l,o[1]=x2[u]||u,o.join(" ")},gB=function(i,o){if(o.tween&&o.tween._time===o.tween._dur){var l=o.t,u=l.style,d=o.u,g=l._gsap,a,w,S;if(d==="all"||d===!0)u.cssText="",w=1;else for(d=d.split(","),S=d.length;--S>-1;)a=d[S],el[a]&&(w=1,a=a==="transformOrigin"?tl:Qr),Yf(l,a);w&&(Yf(l,Qr),g&&(g.svg&&l.removeAttribute("transform"),Jf(l,1),g.uncache=1))}},Gm={clearProps:function(i,o,l,u,d){if(d.data!=="isFromStart"){var g=i._pt=new jn(i._pt,o,l,0,0,gB);return g.u=u,g.pr=-10,g.tween=d,i._props.push(l),1}}},Qf=[1,0,0,1,0,0],nA={},sA=function(i){return i==="matrix(1, 0, 0, 1, 0, 0)"||i==="none"||!i},v2=function(i){var o=Xo(i,Qr);return sA(o)?Qf:o.substr(7).match(mS).map(Sr)},Wx=function(i,o){var l=i._gsap||ac(i),u=i.style,d=v2(i),g,a,w,S;return l.svg&&i.getAttribute("transform")?(w=i.transform.baseVal.consolidate().matrix,d=[w.a,w.b,w.c,w.d,w.e,w.f],d.join(",")==="1,0,0,1,0,0"?Qf:d):(d===Qf&&!i.offsetParent&&i!==Lu&&!l.svg&&(w=u.display,u.display="block",g=i.parentNode,(!g||!i.offsetParent)&&(S=1,a=i.nextSibling,Lu.appendChild(i)),d=v2(i),w?u.display=w:Yf(i,"display"),S&&(a?g.insertBefore(i,a):g?g.appendChild(i):Lu.removeChild(i))),o&&d.length>6?[d[0],d[1],d[4],d[5],d[12],d[13]]:d)},zy=function(i,o,l,u,d,g){var a=i._gsap,w=d||Wx(i,!0),S=a.xOrigin||0,C=a.yOrigin||0,k=a.xOffset||0,F=a.yOffset||0,R=w[0],W=w[1],Z=w[2],X=w[3],q=w[4],ue=w[5],pe=o.split(" "),xe=parseFloat(pe[0])||0,fe=parseFloat(pe[1])||0,Te,Ie,Le,Pe;l?w!==Qf&&(Ie=R*X-W*Z)&&(Le=xe*(X/Ie)+fe*(-Z/Ie)+(Z*ue-X*q)/Ie,Pe=xe*(-W/Ie)+fe*(R/Ie)-(R*ue-W*q)/Ie,xe=Le,fe=Pe):(Te=iA(i),xe=Te.x+(~pe[0].indexOf("%")?xe/100*Te.width:xe),fe=Te.y+(~(pe[1]||pe[0]).indexOf("%")?fe/100*Te.height:fe)),u||u!==!1&&a.smooth?(q=xe-S,ue=fe-C,a.xOffset=k+(q*R+ue*Z)-q,a.yOffset=F+(q*W+ue*X)-ue):a.xOffset=a.yOffset=0,a.xOrigin=xe,a.yOrigin=fe,a.smooth=!!u,a.origin=o,a.originIsAbsolute=!!l,i.style[tl]="0px 0px",g&&(Wa(g,a,"xOrigin",S,xe),Wa(g,a,"yOrigin",C,fe),Wa(g,a,"xOffset",k,a.xOffset),Wa(g,a,"yOffset",F,a.yOffset)),i.setAttribute("data-svg-origin",xe+" "+fe)},Jf=function(i,o){var l=i._gsap||new $S(i);if("x"in l&&!o&&!l.uncache)return l;var u=i.style,d=l.scaleX<0,g="px",a="deg",w=Xo(i,tl)||"0",S,C,k,F,R,W,Z,X,q,ue,pe,xe,fe,Te,Ie,Le,Pe,qe,ze,lt,ct,be,Ze,Qe,gt,St,bt,Ti,Pt,Bi,Ei,rr;return S=C=k=W=Z=X=q=ue=pe=0,F=R=1,l.svg=!!(i.getCTM&&rA(i)),Te=Wx(i,l.svg),l.svg&&(Qe=(!l.uncache||w==="0px 0px")&&!o&&i.getAttribute("data-svg-origin"),zy(i,Qe||w,!!Qe||l.originIsAbsolute,l.smooth!==!1,Te)),xe=l.xOrigin||0,fe=l.yOrigin||0,Te!==Qf&&(qe=Te[0],ze=Te[1],lt=Te[2],ct=Te[3],S=be=Te[4],C=Ze=Te[5],Te.length===6?(F=Math.sqrt(qe*qe+ze*ze),R=Math.sqrt(ct*ct+lt*lt),W=qe||ze?gu(ze,qe)*Xl:0,q=lt||ct?gu(lt,ct)*Xl+W:0,q&&(R*=Math.abs(Math.cos(q*Ou))),l.svg&&(S-=xe-(xe*qe+fe*lt),C-=fe-(xe*ze+fe*ct))):(rr=Te[6],Bi=Te[7],bt=Te[8],Ti=Te[9],Pt=Te[10],Ei=Te[11],S=Te[12],C=Te[13],k=Te[14],Ie=gu(rr,Pt),Z=Ie*Xl,Ie&&(Le=Math.cos(-Ie),Pe=Math.sin(-Ie),Qe=be*Le+bt*Pe,gt=Ze*Le+Ti*Pe,St=rr*Le+Pt*Pe,bt=be*-Pe+bt*Le,Ti=Ze*-Pe+Ti*Le,Pt=rr*-Pe+Pt*Le,Ei=Bi*-Pe+Ei*Le,be=Qe,Ze=gt,rr=St),Ie=gu(-lt,Pt),X=Ie*Xl,Ie&&(Le=Math.cos(-Ie),Pe=Math.sin(-Ie),Qe=qe*Le-bt*Pe,gt=ze*Le-Ti*Pe,St=lt*Le-Pt*Pe,Ei=ct*Pe+Ei*Le,qe=Qe,ze=gt,lt=St),Ie=gu(ze,qe),W=Ie*Xl,Ie&&(Le=Math.cos(Ie),Pe=Math.sin(Ie),Qe=qe*Le+ze*Pe,gt=be*Le+Ze*Pe,ze=ze*Le-qe*Pe,Ze=Ze*Le-be*Pe,qe=Qe,be=gt),Z&&Math.abs(Z)+Math.abs(W)>359.9&&(Z=W=0,X=180-X),F=Sr(Math.sqrt(qe*qe+ze*ze+lt*lt)),R=Sr(Math.sqrt(Ze*Ze+rr*rr)),Ie=gu(be,Ze),q=Math.abs(Ie)>2e-4?Ie*Xl:0,pe=Ei?1/(Ei<0?-Ei:Ei):0),l.svg&&(Qe=i.getAttribute("transform"),l.forceCSS=i.setAttribute("transform","")||!sA(Xo(i,Qr)),Qe&&i.setAttribute("transform",Qe))),Math.abs(q)>90&&Math.abs(q)<270&&(d?(F*=-1,q+=W<=0?180:-180,W+=W<=0?180:-180):(R*=-1,q+=q<=0?180:-180)),l.x=S-((l.xPercent=S&&(l.xPercent||(Math.round(i.offsetWidth/2)===Math.round(-S)?-50:0)))?i.offsetWidth*l.xPercent/100:0)+g,l.y=C-((l.yPercent=C&&(l.yPercent||(Math.round(i.offsetHeight/2)===Math.round(-C)?-50:0)))?i.offsetHeight*l.yPercent/100:0)+g,l.z=k+g,l.scaleX=Sr(F),l.scaleY=Sr(R),l.rotation=Sr(W)+a,l.rotationX=Sr(Z)+a,l.rotationY=Sr(X)+a,l.skewX=q+a,l.skewY=ue+a,l.transformPerspective=pe+g,(l.zOrigin=parseFloat(w.split(" ")[2])||0)&&(u[tl]=qm(w)),l.xOffset=l.yOffset=0,l.force3D=ns.force3D,l.renderTransform=l.svg?xB:tA?oA:yB,l.uncache=0,l},qm=function(i){return(i=i.split(" "))[0]+" "+i[1]},g0=function(i,o,l){var u=On(o);return Sr(parseFloat(o)+parseFloat(il(i,"x",l+"px",u)))+u},yB=function(i,o){o.z="0px",o.rotationY=o.rotationX="0deg",o.force3D=0,oA(i,o)},ql="0deg",ff="0px",Zl=") ",oA=function(i,o){var l=o||this,u=l.xPercent,d=l.yPercent,g=l.x,a=l.y,w=l.z,S=l.rotation,C=l.rotationY,k=l.rotationX,F=l.skewX,R=l.skewY,W=l.scaleX,Z=l.scaleY,X=l.transformPerspective,q=l.force3D,ue=l.target,pe=l.zOrigin,xe="",fe=q==="auto"&&i&&i!==1||q===!0;if(pe&&(k!==ql||C!==ql)){var Te=parseFloat(C)*Ou,Ie=Math.sin(Te),Le=Math.cos(Te),Pe;Te=parseFloat(k)*Ou,Pe=Math.cos(Te),g=g0(ue,g,Ie*Pe*-pe),a=g0(ue,a,-Math.sin(Te)*-pe),w=g0(ue,w,Le*Pe*-pe+pe)}X!==ff&&(xe+="perspective("+X+Zl),(u||d)&&(xe+="translate("+u+"%, "+d+"%) "),(fe||g!==ff||a!==ff||w!==ff)&&(xe+=w!==ff||fe?"translate3d("+g+", "+a+", "+w+") ":"translate("+g+", "+a+Zl),S!==ql&&(xe+="rotate("+S+Zl),C!==ql&&(xe+="rotateY("+C+Zl),k!==ql&&(xe+="rotateX("+k+Zl),(F!==ql||R!==ql)&&(xe+="skew("+F+", "+R+Zl),(W!==1||Z!==1)&&(xe+="scale("+W+", "+Z+Zl),ue.style[Qr]=xe||"translate(0, 0)"},xB=function(i,o){var l=o||this,u=l.xPercent,d=l.yPercent,g=l.x,a=l.y,w=l.rotation,S=l.skewX,C=l.skewY,k=l.scaleX,F=l.scaleY,R=l.target,W=l.xOrigin,Z=l.yOrigin,X=l.xOffset,q=l.yOffset,ue=l.forceCSS,pe=parseFloat(g),xe=parseFloat(a),fe,Te,Ie,Le,Pe;w=parseFloat(w),S=parseFloat(S),C=parseFloat(C),C&&(C=parseFloat(C),S+=C,w+=C),w||S?(w*=Ou,S*=Ou,fe=Math.cos(w)*k,Te=Math.sin(w)*k,Ie=Math.sin(w-S)*-F,Le=Math.cos(w-S)*F,S&&(C*=Ou,Pe=Math.tan(S-C),Pe=Math.sqrt(1+Pe*Pe),Ie*=Pe,Le*=Pe,C&&(Pe=Math.tan(C),Pe=Math.sqrt(1+Pe*Pe),fe*=Pe,Te*=Pe)),fe=Sr(fe),Te=Sr(Te),Ie=Sr(Ie),Le=Sr(Le)):(fe=k,Le=F,Te=Ie=0),(pe&&!~(g+"").indexOf("px")||xe&&!~(a+"").indexOf("px"))&&(pe=il(R,"x",g,"px"),xe=il(R,"y",a,"px")),(W||Z||X||q)&&(pe=Sr(pe+W-(W*fe+Z*Ie)+X),xe=Sr(xe+Z-(W*Te+Z*Le)+q)),(u||d)&&(Pe=R.getBBox(),pe=Sr(pe+u/100*Pe.width),xe=Sr(xe+d/100*Pe.height)),Pe="matrix("+fe+","+Te+","+Ie+","+Le+","+pe+","+xe+")",R.setAttribute("transform",Pe),ue&&(R.style[Qr]=Pe)},vB=function(i,o,l,u,d,g){var a=360,w=Vr(d),S=parseFloat(d)*(w&&~d.indexOf("rad")?Xl:1),C=g?S*g:S-u,k=u+C+"deg",F,R;return w&&(F=d.split("_")[1],F==="short"&&(C%=a,C!==C%(a/2)&&(C+=C<0?a:-a)),F==="cw"&&C<0?C=(C+a*m2)%a-~~(C/a)*a:F==="ccw"&&C>0&&(C=(C-a*m2)%a-~~(C/a)*a)),i._pt=R=new jn(i._pt,o,l,u,C,oB),R.e=k,R.u="deg",i._props.push(l),R},b2=function(i,o){for(var l in o)i[l]=o[l];return i},bB=function(i,o,l){var u=b2({},l._gsap),d="perspective,force3D,transformOrigin,svgOrigin",g=l.style,a,w,S,C,k,F,R,W;u.svg?(S=l.getAttribute("transform"),l.setAttribute("transform",""),g[Qr]=o,a=Jf(l,1),Yf(l,Qr),l.setAttribute("transform",S)):(S=getComputedStyle(l)[Qr],g[Qr]=o,a=Jf(l,1),g[Qr]=S);for(w in el)S=u[w],C=a[w],S!==C&&d.indexOf(w)<0&&(R=On(S),W=On(C),k=R!==W?il(l,w,S,W):parseFloat(S),F=parseFloat(C),i._pt=new jn(i._pt,a,w,k,F-k,QS),i._pt.u=W||0,i._props.push(w));b2(a,u)};Nn("padding,margin,Width,Radius",function(t,i){var o="Top",l="Right",u="Bottom",d="Left",g=(i<3?[o,l,u,d]:[o+d,o+l,u+l,u+d]).map(function(a){return i<2?t+a:"border"+a+t});Gm[i>1?"border"+t:t]=function(a,w,S,C,k){var F,R;if(arguments.length<4)return F=g.map(function(W){return Kl(a,W,S)}),R=F.join(" "),R.split(F[0]).length===5?F[0]:R;F=(C+"").split(" "),R={},g.forEach(function(W,Z){return R[W]=F[Z]=F[Z]||F[(Z-1)/2|0]}),a.init(w,R,k)}});var aA={name:"css",register:Dy,targetTest:function(i){return i.style&&i.nodeType},init:function(i,o,l,u,d){var g=this._props,a=i.style,w=l.vars.startAt,S,C,k,F,R,W,Z,X,q,ue,pe,xe,fe,Te,Ie;Zx||Dy();for(Z in o)if(Z!=="autoRound"&&(C=o[Z],!(Qn[Z]&&GS(Z,o,l,u,i,d)))){if(R=typeof C,W=Gm[Z],R==="function"&&(C=C.call(l,u,i,d),R=typeof C),R==="string"&&~C.indexOf("random(")&&(C=Xf(C)),W)W(this,i,Z,C,l)&&(Ie=1);else if(Z.substr(0,2)==="--")S=(getComputedStyle(i).getPropertyValue(Z)+"").trim(),C+="",Qa.lastIndex=0,Qa.test(S)||(X=On(S),q=On(C)),q?X!==q&&(S=il(i,Z,S,q)+q):X&&(C+=X),this.add(a,"setProperty",S,C,u,d,0,0,Z),g.push(Z);else if(R!=="undefined"){if(w&&Z in w?(S=typeof w[Z]=="function"?w[Z].call(l,u,i,d):w[Z],Vr(S)&&~S.indexOf("random(")&&(S=Xf(S)),On(S+"")||(S+=ns.units[Z]||On(Kl(i,Z))||""),(S+"").charAt(1)==="="&&(S=Kl(i,Z))):S=Kl(i,Z),F=parseFloat(S),ue=R==="string"&&C.charAt(1)==="="?+(C.charAt(0)+"1"):0,ue&&(C=C.substr(2)),k=parseFloat(C),Z in Za&&(Z==="autoAlpha"&&(F===1&&Kl(i,"visibility")==="hidden"&&k&&(F=0),Wa(this,a,"visibility",F?"inherit":"hidden",k?"inherit":"hidden",!k)),Z!=="scale"&&Z!=="transform"&&(Z=Za[Z],~Z.indexOf(",")&&(Z=Z.split(",")[0]))),pe=Z in el,pe){if(xe||(fe=i._gsap,fe.renderTransform&&!o.parseTransform||Jf(i,o.parseTransform),Te=o.smoothOrigin!==!1&&fe.smooth,xe=this._pt=new jn(this._pt,a,Qr,0,1,fe.renderTransform,fe,0,-1),xe.dep=1),Z==="scale")this._pt=new jn(this._pt,fe,"scaleY",fe.scaleY,(ue?ue*k:k-fe.scaleY)||0),g.push("scaleY",Z),Z+="X";else if(Z==="transformOrigin"){C=_B(C),fe.svg?zy(i,C,0,Te,0,this):(q=parseFloat(C.split(" ")[2])||0,q!==fe.zOrigin&&Wa(this,fe,"zOrigin",fe.zOrigin,q),Wa(this,a,Z,qm(S),qm(C)));continue}else if(Z==="svgOrigin"){zy(i,C,1,Te,0,this);continue}else if(Z in nA){vB(this,fe,Z,F,C,ue);continue}else if(Z==="smoothOrigin"){Wa(this,fe,"smooth",fe.smooth,C);continue}else if(Z==="force3D"){fe[Z]=C;continue}else if(Z==="transform"){bB(this,C,i);continue}}else Z in a||(Z=eh(Z)||Z);if(pe||(k||k===0)&&(F||F===0)&&!sB.test(C)&&Z in a)X=(S+"").substr((F+"").length),k||(k=0),q=On(C)||(Z in ns.units?ns.units[Z]:X),X!==q&&(F=il(i,Z,S,q)),this._pt=new jn(this._pt,pe?fe:a,Z,F,ue?ue*k:k-F,!pe&&(q==="px"||Z==="zIndex")&&o.autoRound!==!1?lB:QS),this._pt.u=q||0,X!==q&&q!=="%"&&(this._pt.b=S,this._pt.r=aB);else if(Z in a)mB.call(this,i,Z,S,C);else if(Z in i)this.add(i,Z,S||i[Z],C,u,d);else{Bx(Z,C);continue}g.push(Z)}}Ie&&KS(this)},get:Kl,aliases:Za,getSetter:function(i,o,l){var u=Za[o];return u&&u.indexOf(",")<0&&(o=u),o in el&&o!==tl&&(i._gsap.x||Kl(i,"x"))?l&&p2===l?o==="scale"?fB:hB:(p2=l||{})&&(o==="scale"?dB:pB):i.style&&!Lx(i.style[o])?cB:~o.indexOf("-")?uB:Gx(i,o)},core:{_removeProperty:Yf,_getMatrix:Wx}};Mo.utils.checkPrefix=eh;(function(t,i,o,l){var u=Nn(t+","+i+","+o,function(d){el[d]=1});Nn(i,function(d){ns.units[d]="deg",nA[d]=1}),Za[u[13]]=t+","+i,Nn(l,function(d){var g=d.split(":");Za[g[1]]=u[g[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Nn("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(t){ns.units[t]="px"});Mo.registerPlugin(aA);var wB=Mo.registerPlugin(aA)||Mo;wB.core.Tween;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ii=function(){return ii=Object.assign||function(i){for(var o,l=1,u=arguments.length;l<u;l++){o=arguments[l];for(var d in o)Object.prototype.hasOwnProperty.call(o,d)&&(i[d]=o[d])}return i},ii.apply(this,arguments)},w2=function(){function t(){}return t.log=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];console.log.apply(console,i)},t.error=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];console.error.apply(console,i)},t.time=function(i){console.time(i)},t.timeEnd=function(i){console.timeEnd(i)},t}(),T2={50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"},E2=!1,qi={black:"#000",white:"#fff",rose:{50:"#fff1f2",100:"#ffe4e6",200:"#fecdd3",300:"#fda4af",400:"#fb7185",500:"#f43f5e",600:"#e11d48",700:"#be123c",800:"#9f1239",900:"#881337"},pink:{50:"#fdf2f8",100:"#fce7f3",200:"#fbcfe8",300:"#f9a8d4",400:"#f472b6",500:"#ec4899",600:"#db2777",700:"#be185d",800:"#9d174d",900:"#831843"},fuchsia:{50:"#fdf4ff",100:"#fae8ff",200:"#f5d0fe",300:"#f0abfc",400:"#e879f9",500:"#d946ef",600:"#c026d3",700:"#a21caf",800:"#86198f",900:"#701a75"},purple:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7e22ce",800:"#6b21a8",900:"#581c87"},violet:{50:"#f5f3ff",100:"#ede9fe",200:"#ddd6fe",300:"#c4b5fd",400:"#a78bfa",500:"#8b5cf6",600:"#7c3aed",700:"#6d28d9",800:"#5b21b6",900:"#4c1d95"},indigo:{50:"#eef2ff",100:"#e0e7ff",200:"#c7d2fe",300:"#a5b4fc",400:"#818cf8",500:"#6366f1",600:"#4f46e5",700:"#4338ca",800:"#3730a3",900:"#312e81"},blue:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"},sky:T2,get lightBlue(){return E2||(w2.log("warn - `lightBlue` has been renamed to `sky`."),w2.log("warn - Please update your color palette to eliminate this warning."),E2=!0),T2},cyan:{50:"#ecfeff",100:"#cffafe",200:"#a5f3fc",300:"#67e8f9",400:"#22d3ee",500:"#06b6d4",600:"#0891b2",700:"#0e7490",800:"#155e75",900:"#164e63"},teal:{50:"#f0fdfa",100:"#ccfbf1",200:"#99f6e4",300:"#5eead4",400:"#2dd4bf",500:"#14b8a6",600:"#0d9488",700:"#0f766e",800:"#115e59",900:"#134e4a"},emerald:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b"},green:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d"},lime:{50:"#f7fee7",100:"#ecfccb",200:"#d9f99d",300:"#bef264",400:"#a3e635",500:"#84cc16",600:"#65a30d",700:"#4d7c0f",800:"#3f6212",900:"#365314"},yellow:{50:"#fefce8",100:"#fef9c3",200:"#fef08a",300:"#fde047",400:"#facc15",500:"#eab308",600:"#ca8a04",700:"#a16207",800:"#854d0e",900:"#713f12"},amber:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f"},orange:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12"},red:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d"},warmGray:{50:"#fafaf9",100:"#f5f5f4",200:"#e7e5e4",300:"#d6d3d1",400:"#a8a29e",500:"#78716c",600:"#57534e",700:"#44403c",800:"#292524",900:"#1c1917"},trueGray:{50:"#fafafa",100:"#f5f5f5",200:"#e5e5e5",300:"#d4d4d4",400:"#a3a3a3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717"},gray:{50:"#fafafa",100:"#f4f4f5",200:"#e4e4e7",300:"#d4d4d8",400:"#a1a1aa",500:"#71717a",600:"#52525b",700:"#3f3f46",800:"#27272a",900:"#18181b"},coolGray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},blueGray:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94A3B8",500:"#64748B",600:"#475569",700:"#334155",800:"#1E293B",900:"#0F172A"},zink:{50:"#fafafa",100:"#f4f4f5",200:"#e4e4e7",300:"#d4d4d8",400:"#a1a1aa",500:"#71717A",600:"#52525B",700:"#3F3F46",800:"#27272A",900:"#18181B"},neutral:{50:"#fafafa",100:"#f5f5f5",200:"#e5e5e5",300:"#d4d4d4",400:"#a3a3a3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717"},stone:{50:"#fafaf9",100:"#f5f5f4",200:"#e7e5e4",300:"#d6d3d1",400:"#a8a29e",500:"#78716C",600:"#57534E",700:"#44403C",800:"#292524",900:"#1C1917"},light:{50:"#fdfdfd",100:"#fcfcfc",200:"#fafafa",300:"#f8f9fa",400:"#f6f6f6",500:"#f2f2f2",600:"#f1f3f5",700:"#e9ecef",800:"#dee2e6",900:"#dde1e3"},dark:{50:"#4a4a4a",100:"#3c3c3c",200:"#323232",300:"#2d2d2d",400:"#222222",500:"#1f1f1f",600:"#1c1c1e",700:"#1b1b1b",800:"#181818",900:"#0f0f0f"}},TB={spin:{from:{transform:"rotate(0deg)"},to:{transform:"rotate(360deg)"}},ping:{"0%":{transform:"scale(1)",opacity:"1"},"75%, 100%":{transform:"scale(2)",opacity:"0"}},pulse:{"0%, 100%":{opacity:"1"},"50%":{opacity:".5"}},bounce:{"0%, 100%":{transform:"translateY(-25%)",animationTimingFunction:"cubic-bezier(0.8,0,1,1)"},"50%":{transform:"translateY(0)",animationTimingFunction:"cubic-bezier(0,0,0.2,1)"}},shock:{"from, 20%, 53%, 80%, to":{animationTimingFunction:"cubic-bezier(0.215, 0.61, 0.355, 1)",transform:"translate3d(0, 0, 0)"},"40%, 43%":{animationTimingFunction:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",transform:"translate3d(0, -30px, 0)"},"70%":{animationTimingFunction:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",transform:"translate3d(0, -15px, 0)"},"90%":{transform:"translate3d(0, -4px, 0)"}},flash:{"from, 50%, to":{opacity:"1"},"25%, 75%":{opacity:"0"}},bubble:{from:{transform:"scale3d(1, 1, 1)"},"50%":{transform:"scale3d(1.05, 1.05, 1.05)"},to:{transform:"scale3d(1, 1, 1)"}},rubberBand:{from:{transform:"scale3d(1, 1, 1)"},"30%":{transform:"scale3d(1.25, 0.75, 1)"},"40%":{transform:"scale3d(0.75, 1.25, 1)"},"50%":{transform:"scale3d(1.15, 0.85, 1)"},"65%":{transform:"scale3d(0.95, 1.05, 1)"},"75%":{transform:"scale3d(1.05, 0.95, 1)"},to:{transform:"scale3d(1, 1, 1)"}},shakeX:{"from, to":{transform:"translate3d(0, 0, 0)"},"10%, 30%, 50%, 70%, 90%":{transform:"translate3d(-10px, 0, 0)"},"20%, 40%, 60%, 80%":{transform:"translate3d(10px, 0, 0)"}},shakeY:{"from, to":{transform:"translate3d(0, 0, 0)"},"10%, 30%, 50%, 70%, 90%":{transform:"translate3d(0, -10px, 0)"},"20%, 40%, 60%, 80%":{transform:"translate3d(0, 10px, 0)"}},headShake:{"0%":{transform:"translateX(0)"},"6.5%":{transform:"translateX(-6px) rotateY(-9deg)"},"18.5%":{transform:"translateX(5px) rotateY(7deg)"},"31.5%":{transform:"translateX(-3px) rotateY(-5deg)"},"43.5%":{transform:"translateX(2px) rotateY(3deg)"},"50%":{transform:"translateX(0)"}},swing:{"20%":{transform:"rotate3d(0, 0, 1, 15deg)"},"40%":{transform:"rotate3d(0, 0, 1, -10deg)"},"60%":{transform:"rotate3d(0, 0, 1, 5deg)"},"80%":{transform:"rotate3d(0, 0, 1, -5deg)"},to:{transform:"rotate3d(0, 0, 1, 0deg)"}},tada:{from:{transform:"scale3d(1, 1, 1)"},"10%, 20%":{transform:"scale3d(0.9, 0.9, 0.9) rotate3d(0, 0, 1, -3deg)"},"30%, 50%, 70%, 90%":{transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg)"},"40%, 60%, 80%":{transform:"scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg)"},to:{transform:"scale3d(1, 1, 1)"}},wobble:{from:{transform:"translate3d(0, 0, 0)"},"15%":{transform:"translate3d(-25%, 0, 0) rotate3d(0, 0, 1, -5deg)"},"30%":{transform:"translate3d(20%, 0, 0) rotate3d(0, 0, 1, 3deg)"},"45%":{transform:"translate3d(-15%, 0, 0) rotate3d(0, 0, 1, -3deg)"},"60%":{transform:"translate3d(10%, 0, 0) rotate3d(0, 0, 1, 2deg)"},"75%":{transform:"translate3d(-5%, 0, 0) rotate3d(0, 0, 1, -1deg)"},to:{transform:"translate3d(0, 0, 0)"}},jello:{"from, 11.1% to":{transform:"translate3d(0, 0, 0)"},"22.2%":{transform:"skewX(-12.5deg) skewY(-12.5deg)"},"33.3%":{transform:"skewX(6.25deg) skewY(6.25deg)"},"44.4%":{transform:"skewX(-3.125deg) skewY(-3.125deg)"},"55.5%":{transform:"skewX(1.5625deg) skewY(1.5625deg)"},"66.6%":{transform:"skewX(-0.78125deg) skewY(-0.78125deg)"},"77.7%":{transform:"skewX(0.390625deg) skewY(0.390625deg)"},"88.8%":{transform:"skewX(-0.1953125deg) skewY(-0.1953125deg)"}},heartBeat:{"0%":{transform:"scale(1)"},"14%":{transform:"scale(1.3)"},"28%":{transform:"scale(1)"},"42%":{transform:"scale(1.3)"},"70%":{transform:"scale(1)"}},hinge:{"0%":{transformOrigin:"top left",animationTimingFunction:"ease-in-out"},"20%, 60%":{transform:"rotate3d(0, 0, 1, 80deg)",transformOrigin:"top left",animationTimingFunction:"ease-in-out"},"40%, 80%":{transform:"rotate3d(0, 0, 1, 60deg)",transformOrigin:"top left",animationTimingFunction:"ease-in-out"},to:{transform:"translate3d(0, 700px, 0)",opacity:"0"}},jackInTheBox:{from:{opacity:"0",transformOrigin:"center bottom",transform:"scale(0.1) rotate(30deg)"},"50%":{transform:"rotate(-10deg)"},"70%":{transform:"rotate(3deg)"},to:{transform:"scale(1)"}},lightSpeedInRight:{from:{opacity:"0",transform:"translate3d(100%, 0, 0) skewX(-30deg)"},"60%":{opacity:"1",transform:"skewX(20deg)"},"80%":{transform:"skewX(-5deg)"},to:{transform:"translate3d(0, 0, 0)"}},lightSpeedInLeft:{from:{opacity:"0",transform:"translate3d(100%, 0, 0) skewX(-30deg)"},"60%":{opacity:"1",transform:"skewX(20deg)"},"80%":{transform:"skewX(-5deg)"},to:{transform:"translate3d(0, 0, 0)"}},lightSpeedOutLeft:{from:{opacity:"1"},to:{opacity:"0",transform:"translate3d(100%, 0, 0) skewX(30deg)"}},lightSpeedOutRight:{from:{opacity:"1"},to:{opacity:"0",transform:"translate3d(100%, 0, 0) skewX(30deg)"}},flip:{from:{transform:"perspective(400px) scale3d(1, 1, 1) translate3d(0, 0, 0) rotate3d(0, 1, 0, -360deg)",animationTimingFunction:"ease-out"},"40%":{transform:"perspective(400px) scale3d(1, 1, 1) translate3d(0, 0, 150px) rotate3d(0, 1, 0, -190deg)",animationTimingFunction:"ease-out"},"50%":{transform:"perspective(400px) scale3d(1, 1, 1) translate3d(0, 0, 150px) rotate3d(0, 1, 0, -170deg)",animationTimingFunction:"ease-in"},"80%":{transform:"perspective(400px) scale3d(0.95, 0.95, 0.95) translate3d(0, 0, 0) rotate3d(0, 1, 0, 0deg)",animationTimingFunction:"ease-in"},to:{transform:"perspective(400px) scale3d(1, 1, 1) translate3d(0, 0, 0) rotate3d(0, 1, 0, 0deg)",animationTimingFunction:"ease-in"}},flipInX:{from:{transform:"perspective(400px) rotate3d(1, 0, 0, 90deg)",animationTimingFunction:"ease-in",opacity:"0"},"40%":{transform:"perspective(400px) rotate3d(1, 0, 0, -20deg)",animationTimingFunction:"ease-in"},"60%":{transform:"perspective(400px) rotate3d(1, 0, 0, 10deg)",opacity:"1"},"80%":{transform:"perspective(400px) rotate3d(1, 0, 0, -5deg)"},to:{transform:"perspective(400px)"}},flipInY:{from:{transform:"perspective(400px) rotate3d(0, 1, 0, 90deg)",animationTimingFunction:"ease-in",opacity:"0"},"40%":{transform:"perspective(400px) rotate3d(0, 1, 0, -20deg)",animationTimingFunction:"ease-in"},"60%":{transform:"perspective(400px) rotate3d(0, 1, 0, 10deg)",opacity:"1"},"80%":{transform:"perspective(400px) rotate3d(0, 1, 0, -5deg)"},to:{transform:"perspective(400px)"}},flipOutX:{from:{transform:"perspective(400px)"},"30%":{transform:"perspective(400px) rotate3d(1, 0, 0, -20deg)",opacity:"1"},to:{transform:"perspective(400px) rotate3d(1, 0, 0, 90deg)",opacity:"0"}},flipOutY:{from:{transform:"perspective(400px)"},"30%":{transform:"perspective(400px) rotate3d(0, 1, 0, -15deg)",opacity:"1"},to:{transform:"perspective(400px) rotate3d(0, 1, 0, 90deg)",opacity:"0"}},rotateIn:{from:{transformOrigin:"center",transform:"rotate3d(0, 0, 1, -200deg)",opacity:"0"},to:{transformOrigin:"center",transform:"translate3d(0, 0, 0)",opacity:"1"}},rotateInDownLeft:{from:{transformOrigin:"left bottom",transform:"rotate3d(0, 0, 1, -45deg)",opacity:"0"},to:{transformOrigin:"left bottom",transform:"translate3d(0, 0, 0)",opacity:"1"}},rotateInDownRight:{from:{transformOrigin:"right bottom",transform:"rotate3d(0, 0, 1, 45deg)",opacity:"0"},to:{transformOrigin:"right bottom",transform:"translate3d(0, 0, 0)",opacity:"1"}},rotateInUpLeft:{from:{transformOrigin:"left top",transform:"rotate3d(0, 0, 1, 45deg)",opacity:"0"},to:{transformOrigin:"left top",transform:"translate3d(0, 0, 0)",opacity:"1"}},rotateInUpRight:{from:{transformOrigin:"right bottom",transform:"rotate3d(0, 0, 1, -90deg)",opacity:"0"},to:{transformOrigin:"right bottom",transform:"translate3d(0, 0, 0)",opacity:"1"}},rotateOut:{from:{transformOrigin:"center",opacity:"1"},to:{transformOrigin:"center",transform:"rotate3d(0, 0, 1, 200deg)",opacity:"0"}},rotateOutDownLeft:{from:{transformOrigin:"left bottom",opacity:"1"},to:{transformOrigin:"left bottom",transform:"rotate3d(0, 0, 1, 45deg)",opacity:"0"}},rotateOutDownRight:{from:{transformOrigin:"right bottom",opacity:"1"},to:{transformOrigin:"right bottom",transform:"rotate3d(0, 0, 1, -45deg)",opacity:"0"}},rotateOutUpLeft:{from:{transformOrigin:"left bottom",opacity:"1"},to:{transformOrigin:"left bottom",transform:"rotate3d(0, 0, 1, -45deg)",opacity:"0"}},rotateOutUpRight:{from:{transformOrigin:"right bottom",opacity:"1"},to:{transformOrigin:"left bottom",transform:"rotate3d(0, 0, 1, 90deg)",opacity:"0"}},rollIn:{from:{opacity:"0",transform:"translate3d(-100%, 0, 0) rotate3d(0, 0, 1, -120deg)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},rollOut:{from:{opacity:"1"},to:{opacity:"0",transform:"translate3d(100%, 0, 0) rotate3d(0, 0, 1, 120deg)"}},zoomIn:{from:{opacity:"0",transform:"scale3d(0.3, 0.3, 0.3)"},"50%":{opacity:"1"}},zoomInDown:{from:{opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(0, -1000px, 0)",animationTimingFunction:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},"60%":{opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(0, 60px, 0)",animationTimingFunction:"cubic-bezier(0.175, 0.885, 0.32, 1)"}},zoomInLeft:{from:{opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(-1000px, 0, 0)",animationTimingFunction:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},"60%":{opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(10px, 0, 0)",animationTimingFunction:"cubic-bezier(0.175, 0.885, 0.32, 1)"}},zoomInRight:{from:{opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(1000px, 0, 0)",animationTimingFunction:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},"60%":{opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(-10px, 0, 0)",animationTimingFunction:"cubic-bezier(0.175, 0.885, 0.32, 1)"}},zoomInUp:{from:{opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(0, 1000px, 0)",animationTimingFunction:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},"60%":{opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(0, -60px, 0)",animationTimingFunction:"cubic-bezier(0.175, 0.885, 0.32, 1)"}},bounceIn:{"from, 20%, 40%, 60%, 80%, to":{animationTimingFunction:"ease-in-out"},"0%":{opacity:"0",transform:"scale3d(0.3, 0.3, 0.3)"},"20%":{transform:"scale3d(1.1, 1.1, 1.1)"},"40%":{transform:"scale3d(0.9, 0.9, 0.9)"},"60%":{transform:"scale3d(1.03, 1.03, 1.03)",opacity:"1"},"80%":{transform:"scale3d(0.97, 0.97, 0.97)"},to:{opacity:"1",transform:"scale3d(1, 1, 1)"}},bounceInDown:{"from, 60%, 75%, 90%, to":{animationTimingFunction:"cubic-bezier(0.215, 0.61, 0.355, 1)"},"0%":{opacity:"0",transform:"translate3d(0, -3000px, 0)"},"60%":{opacity:"1",transform:"translate3d(0, 25px, 0)"},"75%":{transform:"translate3d(0, -10px, 0)"},"90%":{transform:"translate3d(0, 5px, 0)"},to:{transform:"translate3d(0, 0, 0)"}},bounceInLeft:{"from, 60%, 75%, 90%, to":{animationTimingFunction:"cubic-bezier(0.215, 0.61, 0.355, 1)"},"0%":{opacity:"0",transform:"translate3d(-3000px, 0, 0)"},"60%":{opacity:"1",transform:"translate3d(25px, 0, 0)"},"75%":{transform:"translate3d(-10px, 0, 0)"},"90%":{transform:"translate3d(5px, 0, 0)"},to:{transform:"translate3d(0, 0, 0)"}},bounceInRight:{"from, 60%, 75%, 90%, to":{animationTimingFunction:"cubic-bezier(0.215, 0.61, 0.355, 1)"},"0%":{opacity:"0",transform:"translate3d(3000px, 0, 0)"},"60%":{opacity:"1",transform:"translate3d(-25px, 0, 0)"},"75%":{transform:"translate3d(10px, 0, 0)"},"90%":{transform:"translate3d(-5px, 0, 0)"},to:{transform:"translate3d(0, 0, 0)"}},bounceInUp:{"from, 60%, 75%, 90%, to":{animationTimingFunction:"cubic-bezier(0.215, 0.61, 0.355, 1)"},"0%":{opacity:"0",transform:"translate3d(0, 3000px, 0)"},"60%":{opacity:"1",transform:"translate3d(0, -20px, 0)"},"75%":{transform:"translate3d(0, 10px, 0)"},"90%":{transform:"translate3d(0, -5px, 0)"},to:{transform:"translate3d(0, 0, 0)"}},bounceOut:{"20%":{transform:"scale3d(0.9, 0.9, 0.9)"},"50%, 55%":{opacity:"1",transform:"scale3d(1.1, 1.1, 1.1)"},to:{opacity:"0",transform:"scale3d(0.3, 0.3, 0.3)"}},bounceOutDown:{"20%":{transform:"translate3d(0, 10px, 0)"},"40%, 45%":{opacity:"1",transform:"translate3d(0, -20px, 0)"},to:{opacity:"0",transform:"translate3d(0, 2000px, 0)"}},bounceOutLeft:{"20%":{opacity:"1",transform:"translate3d(20px, 0, 0)"},to:{opacity:"0",transform:"translate3d(-2000px, 0, 0)"}},bounceOutRight:{"20%":{opacity:"1",transform:"translate3d(-20px, 0, 0)"},to:{opacity:"0",transform:"translate3d(2000px, 0, 0)"}},bounceOutUp:{"20%":{transform:"translate3d(0, -10px, 0)"},"40%, 45%":{opacity:"1",transform:"translate3d(0, 20px, 0)"},to:{opacity:"0",transform:"translate3d(0, -2000px, 0)"}},zoomOut:{from:{opacity:"1"},"50%":{opacity:"0",transform:"scale3d(0.3, 0.3, 0.3)"},to:{opacity:"0"}},zoomOutDown:{"40%":{opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(0, -60px, 0)",animationTimingFunction:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},to:{opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(0, 2000px, 0)",transformOrigin:"center bottom",animationTimingFunction:"cubic-bezier(0.175, 0.885, 0.32, 1)"}},zoomOutLeft:{"40%":{opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(42px, 0, 0)"},to:{opacity:"0",transform:"scale(0.1) translate3d(-2000px, 0, 0)",transformOrigin:"left center"}},zoomOutRight:{"40%":{opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(-42px, 0, 0)"},to:{opacity:"0",transform:"scale(0.1) translate3d(2000px, 0, 0)",transformOrigin:"right center"}},zoomOutUp:{"40%":{opacity:"1",transform:"scale3d(0.475, 0.475, 0.475) translate3d(0, 60px, 0)",animationTimingFunction:"cubic-bezier(0.55, 0.055, 0.675, 0.19)"},to:{opacity:"0",transform:"scale3d(0.1, 0.1, 0.1) translate3d(0, -2000px, 0)",transformOrigin:"center bottom",animationTimingFunction:"cubic-bezier(0.175, 0.885, 0.32, 1)"}},slideInDown:{from:{transform:"translate3d(0, -100%, 0)",visibility:"visible"},to:{transform:"translate3d(0, 0, 0)"}},slideInLeft:{from:{transform:"translate3d(-100%, 0, 0)",visibility:"visible"},to:{transform:"translate3d(0, 0, 0)"}},slideInRight:{from:{transform:"translate3d(100%, 0, 0)",visibility:"visible"},to:{transform:"translate3d(0, 0, 0)"}},slideInUp:{from:{transform:"translate3d(0, 100%, 0)",visibility:"visible"},to:{transform:"translate3d(0, 0, 0)"}},slideOutDown:{from:{transform:"translate3d(0, 0, 0)"},to:{visibility:"hidden",transform:"translate3d(0, 100%, 0)"}},slideOutLeft:{from:{transform:"translate3d(0, 0, 0)"},to:{visibility:"hidden",transform:"translate3d(-100%, 0, 0)"}},slideOutRight:{from:{transform:"translate3d(0, 0, 0)"},to:{visibility:"hidden",transform:"translate3d(100%, 0, 0)"}},slideOutUp:{from:{transform:"translate3d(0, 0, 0)"},to:{visibility:"hidden",transform:"translate3d(0, -100%, 0)"}},fadeIn:{from:{opacity:"0"},to:{opacity:"1"}},fadeInDown:{from:{opacity:"0",transform:"translate3d(0, -100%, 0)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},fadeInDownBig:{from:{opacity:"0",transform:"translate3d(0, -2000px, 0)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},fadeInLeft:{from:{opacity:"0",transform:"translate3d(-100%, 0, 0)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},fadeInLeftBig:{from:{opacity:"0",transform:"translate3d(-2000px, 0, 0)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},fadeInRight:{from:{opacity:"0",transform:"translate3d(100%, 0, 0)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},fadeInRightBig:{from:{opacity:"0",transform:"translate3d(2000px, 0, 0)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},fadeInUp:{from:{opacity:"0",transform:"translate3d(0, 100%, 0)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},fadeInUpBig:{from:{opacity:"0",transform:"translate3d(0, 2000px, 0)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},fadeInTopLeft:{from:{opacity:"0",transform:"translate3d(-100%, -100%, 0)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},fadeInTopRight:{from:{opacity:"0",transform:"translate3d(100%, -100%, 0)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},fadeInBottomLeft:{from:{opacity:"0",transform:"translate3d(-100%, 100%, 0)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},fadeInBottomRight:{from:{opacity:"0",transform:"translate3d(100%, 100%, 0)"},to:{opacity:"1",transform:"translate3d(0, 0, 0)"}},fadeOut:{from:{opacity:"1"},to:{opacity:"0"}},fadeOutDown:{from:{opacity:"1"},to:{opacity:"0",transform:"translate3d(0, 100%, 0)"}},fadeOutDownBig:{from:{opacity:"1"},to:{opacity:"0",transform:"translate3d(0, 2000px, 0)"}},fadeOutLeft:{from:{opacity:"1"},to:{opacity:"0",transform:"translate3d(-100%, 0, 0)"}},fadeOutLeftBig:{from:{opacity:"1"},to:{opacity:"0",transform:"translate3d(-2000px, 0, 0)"}},fadeOutRight:{from:{opacity:"1"},to:{opacity:"0",transform:"translate3d(100%, 0, 0)"}},fadeOutRightBig:{from:{opacity:"1"},to:{opacity:"0",transform:"translate3d(2000px, 0, 0)"}},fadeOutUp:{from:{opacity:"1"},to:{opacity:"0",transform:"translate3d(0, -100%, 0)"}},fadeOutUpBig:{from:{opacity:"1"},to:{opacity:"0",transform:"translate3d(0, -2000px, 0)"}},fadeOutTopLeft:{from:{opacity:"1",transform:"translate3d(0, 0, 0)"},to:{opacity:"0",transform:"translate3d(-100%, -100%, 0)"}},fadeOutTopRight:{from:{opacity:"1",transform:"translate3d(0, 0, 0)"},to:{opacity:"0",transform:"translate3d(100%, -100%, 0)"}},fadeOutBottomLeft:{from:{opacity:"1",transform:"translate3d(0, 0, 0)"},to:{opacity:"0",transform:"translate3d(-100%, 100%, 0)"}},fadeOutBottomRight:{from:{opacity:"1",transform:"translate3d(0, 0, 0)"},to:{opacity:"0",transform:"translate3d(100%, 100%, 0)"}},backInUp:{"0%":{opacity:"0.7",transform:"translateY(1200px) scale(0.7)"},"80%":{opacity:"0.7",transform:"translateY(0px) scale(0.7)"},"100%":{opacity:"1",transform:"scale(1)"}},backInDown:{"0%":{opacity:"0.7",transform:"translateY(-1200px) scale(0.7)"},"80%":{opacity:"0.7",transform:"translateY(0px) scale(0.7)"},"100%":{opacity:"1",transform:"scale(1)"}},backInLeft:{"0%":{opacity:"0.7",transform:"translateX(-2000px) scale(0.7)"},"80%":{opacity:"0.7",transform:"translateX(0px) scale(0.7)"},"100%":{opacity:"1",transform:"scale(1)"}},backInRight:{"0%":{opacity:"0.7",transform:"translateX(2000px) scale(0.7)"},"80%":{opacity:"0.7",transform:"translateY(0px) scale(0.7)"},"100%":{opacity:"1",transform:"scale(1)"}},backOutUp:{"0%":{opacity:"1",transform:"scale(1)"},"80%":{opacity:"0.7",transform:"translateY(0px) scale(0.7)"},"100%":{opacity:"0.7",transform:"translateY(-700px) scale(0.7)"}},backOutDown:{"0%":{opacity:"1",transform:"scale(1)"},"80%":{opacity:"0.7",transform:"translateY(0px) scale(0.7)"},"100%":{opacity:"0.7",transform:"translateY(700px) scale(0.7)"}},backOutLeft:{"0%":{opacity:"1",transform:"scale(1)"},"80%":{opacity:"0.7",transform:"translateX(-2000px) scale(0.7)"},"100%":{opacity:"0.7",transform:"translateY(-700px) scale(0.7)"}},backOutRight:{"0%":{opacity:"1",transform:"scale(1)"},"80%":{opacity:"0.7",transform:"translateY(0px) scale(0.7)"},"100%":{opacity:"0.7",transform:"translateX(2000px) scale(0.7)"}}},EB=["hover","focus","active","visited","link","target","focus-visible","focus-within","checked","not-checked","default","disabled","enabled","indeterminate","invalid","valid","optional","required","placeholder-shown","read-only","read-write","not-disabled","first-of-type","not-first-of-type","last-of-type","not-last-of-type","first","last","not-first","not-last","only-child","not-only-child","only-of-type","not-only-of-type","even","odd","even-of-type","odd-of-type","root","empty","before","after","first-letter","first-line","file-selector-button","file","selection","marker","svg","all","children","siblings","sibling","ltr","rtl","group-hover","group-focus","group-active","group-visited","motion-safe","motion-reduce"],S2;(function(t){t[t.base=10]="base",t[t.components=150]="components",t[t.shortcuts=160]="shortcuts",t[t.utilities=2e4]="utilities"})(S2||(S2={}));var A2;(function(t){t[t.columns=80]="columns",t[t.container=100]="container",t[t.space=200]="space",t[t.divideWidth=300]="divideWidth",t[t.divideColor=400]="divideColor",t[t.divideStyle=500]="divideStyle",t[t.divideOpacity=600]="divideOpacity",t[t.accessibility=700]="accessibility",t[t.appearance=800]="appearance",t[t.backgroundAttachment=900]="backgroundAttachment",t[t.backgroundClip=1e3]="backgroundClip",t[t.backgroundColor=1100]="backgroundColor",t[t.backgroundImage=1200]="backgroundImage",t[t.gradientColorStops=1300]="gradientColorStops",t[t.backgroundOpacity=1400]="backgroundOpacity",t[t.backgroundPosition=1500]="backgroundPosition",t[t.backgroundRepeat=1600]="backgroundRepeat",t[t.backgroundSize=1700]="backgroundSize",t[t.backgroundOrigin=1750]="backgroundOrigin",t[t.borderCollapse=1800]="borderCollapse",t[t.borderColor=1900]="borderColor",t[t.borderOpacity=2e3]="borderOpacity",t[t.borderRadius=2100]="borderRadius",t[t.borderStyle=2200]="borderStyle",t[t.borderWidth=2300]="borderWidth",t[t.boxDecorationBreak=2350]="boxDecorationBreak",t[t.boxSizing=2400]="boxSizing",t[t.cursor=2500]="cursor",t[t.captionSide=2550]="captionSide",t[t.emptyCells=2560]="emptyCells",t[t.display=2600]="display",t[t.flexBasis=2699]="flexBasis",t[t.flexDirection=2700]="flexDirection",t[t.flexWrap=2800]="flexWrap",t[t.placeItems=2900]="placeItems",t[t.placeContent=3e3]="placeContent",t[t.placeSelf=3100]="placeSelf",t[t.alignItems=3200]="alignItems",t[t.alignContent=3300]="alignContent",t[t.alignSelf=3400]="alignSelf",t[t.justifyItems=3500]="justifyItems",t[t.justifyContent=3600]="justifyContent",t[t.justifySelf=3700]="justifySelf",t[t.flex=3800]="flex",t[t.flexGrow=3900]="flexGrow",t[t.flexShrink=4e3]="flexShrink",t[t.order=4100]="order",t[t.float=4200]="float",t[t.clear=4300]="clear",t[t.fontFamily=4400]="fontFamily",t[t.fontWeight=4500]="fontWeight",t[t.height=4600]="height",t[t.fontSize=4700]="fontSize",t[t.lineHeight=4800]="lineHeight",t[t.listStylePosition=4900]="listStylePosition",t[t.listStyleType=5e3]="listStyleType",t[t.margin=5100]="margin",t[t.maxHeight=5200]="maxHeight",t[t.maxWidth=5300]="maxWidth",t[t.minHeight=5400]="minHeight",t[t.minWidth=5500]="minWidth",t[t.objectFit=5600]="objectFit",t[t.objectPosition=5700]="objectPosition",t[t.opacity=5800]="opacity",t[t.outline=5900]="outline",t[t.overflow=6e3]="overflow",t[t.overscrollBehavior=6100]="overscrollBehavior",t[t.padding=6200]="padding",t[t.placeholderColor=6300]="placeholderColor",t[t.placeholderOpacity=6400]="placeholderOpacity",t[t.caretColor=6450]="caretColor",t[t.caretOpacity=6460]="caretOpacity",t[t.tabSize=6470]="tabSize",t[t.pointerEvents=6500]="pointerEvents",t[t.position=6600]="position",t[t.inset=6700]="inset",t[t.resize=6800]="resize",t[t.boxShadow=6900]="boxShadow",t[t.boxShadowColor=6950]="boxShadowColor",t[t.ringWidth=7e3]="ringWidth",t[t.ringOffsetColor=7100]="ringOffsetColor",t[t.ringOffsetWidth=7200]="ringOffsetWidth",t[t.ringColor=7300]="ringColor",t[t.ringOpacity=7400]="ringOpacity",t[t.fill=7500]="fill",t[t.stroke=7600]="stroke",t[t.strokeWidth=7700]="strokeWidth",t[t.strokeDashArray=7750]="strokeDashArray",t[t.strokeDashOffset=7760]="strokeDashOffset",t[t.tableLayout=7800]="tableLayout",t[t.textAlign=7900]="textAlign",t[t.textColor=8e3]="textColor",t[t.textOpacity=8100]="textOpacity",t[t.textOverflow=8200]="textOverflow",t[t.textShadow=8250]="textShadow",t[t.fontStyle=8300]="fontStyle",t[t.textTransform=8400]="textTransform",t[t.textDecorationStyle=8450]="textDecorationStyle",t[t.textDecorationLength=8455]="textDecorationLength",t[t.textDecorationColor=8460]="textDecorationColor",t[t.textDecorationOpacity=8470]="textDecorationOpacity",t[t.textDecorationOffset=8480]="textDecorationOffset",t[t.textDecorationThickness=8490]="textDecorationThickness",t[t.textDecoration=8500]="textDecoration",t[t.textIndent=8550]="textIndent",t[t.textStrokeColor=8560]="textStrokeColor",t[t.textStrokeWidth=8570]="textStrokeWidth",t[t.content=8580]="content",t[t.fontSmoothing=8600]="fontSmoothing",t[t.fontVariantNumeric=8700]="fontVariantNumeric",t[t.letterSpacing=8800]="letterSpacing",t[t.userSelect=8900]="userSelect",t[t.verticalAlign=9e3]="verticalAlign",t[t.visibility=9100]="visibility",t[t.backfaceVisibility=9150]="backfaceVisibility",t[t.whitespace=9200]="whitespace",t[t.wordBreak=9300]="wordBreak",t[t.writingMode=9340]="writingMode",t[t.hyphens=9350]="hyphens",t[t.width=9400]="width",t[t.zIndex=9500]="zIndex",t[t.isolation=9550]="isolation",t[t.gap=9600]="gap",t[t.gridAutoFlow=9700]="gridAutoFlow",t[t.gridTemplateColumns=9800]="gridTemplateColumns",t[t.gridAutoColumns=9900]="gridAutoColumns",t[t.gridColumn=1e4]="gridColumn",t[t.gridColumnStart=10100]="gridColumnStart",t[t.gridColumnEnd=10200]="gridColumnEnd",t[t.gridTemplateRows=10300]="gridTemplateRows",t[t.gridAutoRows=10400]="gridAutoRows",t[t.gridRow=10500]="gridRow",t[t.gridRowStart=10600]="gridRowStart",t[t.gridRowEnd=10700]="gridRowEnd",t[t.transform=10800]="transform",t[t.transformOrigin=10900]="transformOrigin",t[t.scale=11e3]="scale",t[t.rotate=11100]="rotate",t[t.translate=11200]="translate",t[t.skew=11300]="skew",t[t.perspective=11350]="perspective",t[t.perspectiveOrigin=11360]="perspectiveOrigin",t[t.transitionProperty=11400]="transitionProperty",t[t.transitionTimingFunction=11500]="transitionTimingFunction",t[t.transitionDuration=11600]="transitionDuration",t[t.transitionDelay=11700]="transitionDelay",t[t.keyframes=11800]="keyframes",t[t.animation=11900]="animation",t[t.imageRendering=11950]="imageRendering",t[t.mixBlendMode=12e3]="mixBlendMode",t[t.backgroundBlendMode=12100]="backgroundBlendMode",t[t.filter=12200]="filter",t[t.blur=12300]="blur",t[t.brightness=12400]="brightness",t[t.contrast=12500]="contrast",t[t.dropShadow=12600]="dropShadow",t[t.grayscale=12700]="grayscale",t[t.hueRotate=12800]="hueRotate",t[t.invert=12900]="invert",t[t.saturate=13e3]="saturate",t[t.sepia=13100]="sepia",t[t.backdropFilter=13200]="backdropFilter",t[t.backdropBlur=13300]="backdropBlur",t[t.backdropBrightness=13400]="backdropBrightness",t[t.backdropContrast=13500]="backdropContrast",t[t.backdropGrayscale=13600]="backdropGrayscale",t[t.backdropHueRotate=13700]="backdropHueRotate",t[t.backdropInvert=13800]="backdropInvert",t[t.backdropOpacity=13900]="backdropOpacity",t[t.backdropSaturate=14e3]="backdropSaturate",t[t.backdropSepia=14100]="backdropSepia",t[t.willChange=14200]="willChange",t[t.touchAction=14300]="touchAction",t[t.scrollBehavior=14400]="scrollBehavior",t[t.accentColor=14500]="accentColor"})(A2||(A2={}));var lA=function(t,i){return{handler:t,config:i}};lA.withOptions=function(t,i){i===void 0&&(i=function(){return{}});var o=function(l){return l===void 0&&(l={}),{__options:l,handler:t(l),config:i(l)}};return o.__isOptionsFunction=!0,o.__pluginFunction=t,o.__configFunction=i,o};var SB={transparent:"transparent",current:"currentColor",inherit:"inherit",light:qi.light,dark:qi.dark,black:qi.black,white:qi.white,gray:qi.coolGray,red:qi.red,yellow:qi.amber,green:qi.emerald,blue:qi.blue,indigo:qi.indigo,purple:qi.violet,pink:qi.pink,rose:qi.rose,fuchsia:qi.fuchsia,violet:qi.violet,cyan:qi.cyan,teal:qi.teal,emerald:qi.emerald,lime:qi.lime,amber:qi.amber,orange:qi.orange,sky:qi.sky,"light-blue":qi.sky,"warm-gray":qi.warmGray,"true-gray":qi.trueGray,"cool-gray":qi.coolGray,"blue-gray":qi.blueGray},yu={xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem"};ii(ii({},yu),{auto:"auto",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10",11:"11",12:"12","3xs":"16rem","2xs":"18rem"}),lA(function(t){var i=t.addUtilities;i({".before\\:contents":{"&::before":{content:'""',display:"contents"}},".after\\:contents":{"&::after":{content:'""',display:"contents"}}})});var cA=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function AB(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var uA={exports:{}};(function(t,i){(function(o,l){t.exports=l()})(cA,function(){var o,l,u;function d(a,w){if(!o)o=w;else if(!l)l=w;else{var S="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",C={};o(C),u=w(C),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([S],{type:"text/javascript"})))}}d(["exports"],function(a){var w="2.7.0",S=C;function C(r,e,s,c){this.cx=3*r,this.bx=3*(s-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(c-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=c,this.p2x=s,this.p2y=c}C.prototype.sampleCurveX=function(r){return((this.ax*r+this.bx)*r+this.cx)*r},C.prototype.sampleCurveY=function(r){return((this.ay*r+this.by)*r+this.cy)*r},C.prototype.sampleCurveDerivativeX=function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},C.prototype.solveCurveX=function(r,e){var s,c,f,p,y;for(e===void 0&&(e=1e-6),f=r,y=0;y<8;y++){if(p=this.sampleCurveX(f)-r,Math.abs(p)<e)return f;var v=this.sampleCurveDerivativeX(f);if(Math.abs(v)<1e-6)break;f-=p/v}if((f=r)<(s=0))return s;if(f>(c=1))return c;for(;s<c;){if(p=this.sampleCurveX(f),Math.abs(p-r)<e)return f;r>p?s=f:c=f,f=.5*(c-s)+s}return f},C.prototype.solve=function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))};var k=F;function F(r,e){this.x=r,this.y=e}F.prototype={clone:function(){return new F(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,s=r.y-this.y;return e*e+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),s=Math.sin(r),c=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=c,this},_rotateAround:function(r,e){var s=Math.cos(r),c=Math.sin(r),f=e.y+c*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-c*(this.y-e.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},F.convert=function(r){return r instanceof F?r:Array.isArray(r)?new F(r[0],r[1]):r};var R=typeof self!="undefined"?self:{},W=1e-6,Z=typeof Float32Array!="undefined"?Float32Array:Array;function X(){var r=new Z(9);return Z!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function q(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ue(r,e,s){var c=e[0],f=e[1],p=e[2],y=e[3],v=e[4],T=e[5],A=e[6],M=e[7],P=e[8],D=e[9],U=e[10],j=e[11],G=e[12],K=e[13],ie=e[14],le=e[15],ge=s[0],we=s[1],Ee=s[2],Se=s[3];return r[0]=ge*c+we*v+Ee*P+Se*G,r[1]=ge*f+we*T+Ee*D+Se*K,r[2]=ge*p+we*A+Ee*U+Se*ie,r[3]=ge*y+we*M+Ee*j+Se*le,r[4]=(ge=s[4])*c+(we=s[5])*v+(Ee=s[6])*P+(Se=s[7])*G,r[5]=ge*f+we*T+Ee*D+Se*K,r[6]=ge*p+we*A+Ee*U+Se*ie,r[7]=ge*y+we*M+Ee*j+Se*le,r[8]=(ge=s[8])*c+(we=s[9])*v+(Ee=s[10])*P+(Se=s[11])*G,r[9]=ge*f+we*T+Ee*D+Se*K,r[10]=ge*p+we*A+Ee*U+Se*ie,r[11]=ge*y+we*M+Ee*j+Se*le,r[12]=(ge=s[12])*c+(we=s[13])*v+(Ee=s[14])*P+(Se=s[15])*G,r[13]=ge*f+we*T+Ee*D+Se*K,r[14]=ge*p+we*A+Ee*U+Se*ie,r[15]=ge*y+we*M+Ee*j+Se*le,r}function pe(r,e,s){var c,f,p,y,v,T,A,M,P,D,U,j,G=s[0],K=s[1],ie=s[2];return e===r?(r[12]=e[0]*G+e[4]*K+e[8]*ie+e[12],r[13]=e[1]*G+e[5]*K+e[9]*ie+e[13],r[14]=e[2]*G+e[6]*K+e[10]*ie+e[14],r[15]=e[3]*G+e[7]*K+e[11]*ie+e[15]):(f=e[1],p=e[2],y=e[3],v=e[4],T=e[5],A=e[6],M=e[7],P=e[8],D=e[9],U=e[10],j=e[11],r[0]=c=e[0],r[1]=f,r[2]=p,r[3]=y,r[4]=v,r[5]=T,r[6]=A,r[7]=M,r[8]=P,r[9]=D,r[10]=U,r[11]=j,r[12]=c*G+v*K+P*ie+e[12],r[13]=f*G+T*K+D*ie+e[13],r[14]=p*G+A*K+U*ie+e[14],r[15]=y*G+M*K+j*ie+e[15]),r}function xe(r,e,s){var c=s[0],f=s[1],p=s[2];return r[0]=e[0]*c,r[1]=e[1]*c,r[2]=e[2]*c,r[3]=e[3]*c,r[4]=e[4]*f,r[5]=e[5]*f,r[6]=e[6]*f,r[7]=e[7]*f,r[8]=e[8]*p,r[9]=e[9]*p,r[10]=e[10]*p,r[11]=e[11]*p,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function fe(r,e,s){var c=Math.sin(s),f=Math.cos(s),p=e[4],y=e[5],v=e[6],T=e[7],A=e[8],M=e[9],P=e[10],D=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=p*f+A*c,r[5]=y*f+M*c,r[6]=v*f+P*c,r[7]=T*f+D*c,r[8]=A*f-p*c,r[9]=M*f-y*c,r[10]=P*f-v*c,r[11]=D*f-T*c,r}function Te(r,e,s){var c=Math.sin(s),f=Math.cos(s),p=e[0],y=e[1],v=e[2],T=e[3],A=e[8],M=e[9],P=e[10],D=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*f-A*c,r[1]=y*f-M*c,r[2]=v*f-P*c,r[3]=T*f-D*c,r[8]=p*c+A*f,r[9]=y*c+M*f,r[10]=v*c+P*f,r[11]=T*c+D*f,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Ie=ue;function Le(){var r=new Z(3);return Z!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Pe(r){var e=new Z(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function qe(r){return Math.hypot(r[0],r[1],r[2])}function ze(r,e,s){var c=new Z(3);return c[0]=r,c[1]=e,c[2]=s,c}function lt(r,e,s){return r[0]=e[0]+s[0],r[1]=e[1]+s[1],r[2]=e[2]+s[2],r}function ct(r,e,s){return r[0]=e[0]-s[0],r[1]=e[1]-s[1],r[2]=e[2]-s[2],r}function be(r,e,s){return r[0]=e[0]*s[0],r[1]=e[1]*s[1],r[2]=e[2]*s[2],r}function Ze(r,e,s){return r[0]=Math.max(e[0],s[0]),r[1]=Math.max(e[1],s[1]),r[2]=Math.max(e[2],s[2]),r}function Qe(r,e,s){return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function gt(r,e,s,c){return r[0]=e[0]+s[0]*c,r[1]=e[1]+s[1]*c,r[2]=e[2]+s[2]*c,r}function St(r,e){var s=e[0],c=e[1],f=e[2],p=s*s+c*c+f*f;return p>0&&(p=1/Math.sqrt(p)),r[0]=e[0]*p,r[1]=e[1]*p,r[2]=e[2]*p,r}function bt(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Ti(r,e,s){var c=e[0],f=e[1],p=e[2],y=s[0],v=s[1],T=s[2];return r[0]=f*T-p*v,r[1]=p*y-c*T,r[2]=c*v-f*y,r}function Pt(r,e,s){var c=e[0],f=e[1],p=e[2],y=s[3]*c+s[7]*f+s[11]*p+s[15];return r[0]=(s[0]*c+s[4]*f+s[8]*p+s[12])/(y=y||1),r[1]=(s[1]*c+s[5]*f+s[9]*p+s[13])/y,r[2]=(s[2]*c+s[6]*f+s[10]*p+s[14])/y,r}function Bi(r,e,s){var c=s[0],f=s[1],p=s[2],y=e[0],v=e[1],T=e[2],A=f*T-p*v,M=p*y-c*T,P=c*v-f*y,D=f*P-p*M,U=p*A-c*P,j=c*M-f*A,G=2*s[3];return M*=G,P*=G,U*=2,j*=2,r[0]=y+(A*=G)+(D*=2),r[1]=v+M+U,r[2]=T+P+j,r}var Ei,rr=ct,it=be,It=qe;function mt(r,e,s){var c=e[0],f=e[1],p=e[2],y=e[3];return r[0]=s[0]*c+s[4]*f+s[8]*p+s[12]*y,r[1]=s[1]*c+s[5]*f+s[9]*p+s[13]*y,r[2]=s[2]*c+s[6]*f+s[10]*p+s[14]*y,r[3]=s[3]*c+s[7]*f+s[11]*p+s[15]*y,r}function Dt(){var r=new Z(4);return Z!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function mi(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function xi(r,e,s){s*=.5;var c=e[0],f=e[1],p=e[2],y=e[3],v=Math.sin(s),T=Math.cos(s);return r[0]=c*T+y*v,r[1]=f*T+p*v,r[2]=p*T-f*v,r[3]=y*T-c*v,r}function Zt(r,e){return r[0]===e[0]&&r[1]===e[1]}Le(),Ei=new Z(4),Z!=Float32Array&&(Ei[0]=0,Ei[1]=0,Ei[2]=0,Ei[3]=0),Le(),ze(1,0,0),ze(0,1,0),Dt(),Dt(),X(),function(){var r;r=new Z(2),Z!=Float32Array&&(r[0]=0,r[1]=0)}();const Gt=Math.PI/180,ce=180/Math.PI;function me(r){return r*Gt}function Re(r){return r*ce}const tt=[[0,0],[1,0],[1,1],[0,1]];function rt(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,s=e*r;return 4*(r<.5?s:3*(r-e)+s-.75)}function _t(r,e,s,c){const f=new S(r,e,s,c);return function(p){return f.solve(p)}}const wt=_t(.25,.1,.25,1);function Xe(r,e,s){return Math.min(s,Math.max(e,r))}function st(r,e,s){return(s=Xe((s-r)/(e-r),0,1))*s*(3-2*s)}function ve(r,e,s){const c=s-e,f=((r-e)%c+c)%c+e;return f===e?s:f}function Oe(r,e,s){if(!r.length)return s(null,[]);let c=r.length;const f=new Array(r.length);let p=null;r.forEach((y,v)=>{e(y,(T,A)=>{T&&(p=T),f[v]=A,--c==0&&s(p,f)})})}function Tt(r){const e=[];for(const s in r)e.push(r[s]);return e}function dt(r,...e){for(const s of e)for(const c in s)r[c]=s[c];return r}let Nt=1;function Wt(){return Nt++}function li(){return function r(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function Xt(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Si(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function _r(r,e){r.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function hn(r,e){return r.indexOf(e,r.length-e.length)!==-1}function Vn(r,e,s){const c={};for(const f in r)c[f]=e.call(s||this,r[f],f,r);return c}function Tn(r,e,s){const c={};for(const f in r)e.call(s||this,r[f],f,r)&&(c[f]=r[f]);return c}function $r(r){return Array.isArray(r)?r.map($r):typeof r=="object"&&r?Vn(r,$r):r}const gr={};function pi(r){gr[r]||(typeof console!="undefined"&&console.warn(r),gr[r]=!0)}function Gr(r,e,s){return(s.y-r.y)*(e.x-r.x)>(e.y-r.y)*(s.x-r.x)}function ta(r){let e=0;for(let s,c,f=0,p=r.length,y=p-1;f<p;y=f++)s=r[f],c=r[y],e+=(c.x-s.x)*(s.y+c.y);return e}function ls(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function ia(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,f,p)=>{const y=f||p;return e[c]=!y||y.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let Po,Ds,$n,Ys=null;function cs(r){if(Ys==null){const e=r.navigator?r.navigator.userAgent:null;Ys=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ys}function ra(r){try{const e=R[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const fn={now:()=>$n!==void 0?$n:R.performance.now(),setNow(r){$n=r},restoreNow(){$n=void 0},frame(r){const e=R.requestAnimationFrame(r);return{cancel:()=>R.cancelAnimationFrame(e)}},getImageData(r,e=0){const s=R.document.createElement("canvas"),c=s.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return s.width=r.width,s.height=r.height,c.drawImage(r,0,0,r.width,r.height),c.getImageData(-e,-e,r.width+2*e,r.height+2*e)},resolveURL:r=>(Po||(Po=R.document.createElement("a")),Po.href=r,Po.href),get devicePixelRatio(){return R.devicePixelRatio},get prefersReducedMotion(){return!!R.matchMedia&&(Ds==null&&(Ds=R.matchMedia("(prefers-reduced-motion: reduce)")),Ds.matches)}};let te;const B={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(te==null){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{te={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):r}catch{te=r}}return te},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},V={supported:!1,testSupport:function(r){!_e&&re&&(Ae?Ce(r):ee=r)}};let ee,re,_e=!1,Ae=!1;function Ce(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,re),r.isContextLost())return;V.supported=!0}catch{}r.deleteTexture(e),_e=!0}R.document&&(re=R.document.createElement("img"),re.onload=function(){ee&&Ce(ee),ee=null,Ae=!0},re.onerror=function(){_e=!0,ee=null},re.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ye="01",ke="NO_ACCESS_TOKEN";function $e(r){return r.indexOf("mapbox:")===0}function We(r){return B.API_URL_REGEX.test(r)}const Je=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Mt(r){const e=r.match(Je);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ft(r){const e=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${e}`}function Lt(r){if(!r)return null;const e=r.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(R.atob(e[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Bt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const s=Lt(B.ACCESS_TOKEN);let c="";return c=s&&s.u?R.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(f,p)=>String.fromCharCode(Number("0x"+p)))):B.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const e=ra("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(e)try{const f=R.localStorage.getItem(s);f&&(this.eventData=JSON.parse(f));const p=R.localStorage.getItem(c);p&&(this.anonId=p)}catch{pi("Unable to read from LocalStorage")}}saveEventData(){const e=ra("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(e)try{R.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&R.localStorage.setItem(s,JSON.stringify(this.eventData))}catch{pi("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,s,c,f){if(!B.EVENTS_URL)return;const p=Mt(B.EVENTS_URL);p.params.push(`access_token=${f||B.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:ye,userId:this.anonId},v=s?dt(y,s):y,T={url:Ft(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=hs(T,A=>{this.pendingRequest=null,c(A),this.saveEventData(),this.processRequests(f)})}queueRequest(e,s){this.queue.push(e),this.processRequests(s)}}const Qt=new class extends Bt{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,e){B.EVENTS_URL&&B.ACCESS_TOKEN&&Array.isArray(r)&&r.some(s=>$e(s)||We(s))&&this.queueRequest(Date.now(),e)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Lt(B.ACCESS_TOKEN),s=e?e.u:B.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;Si(this.anonId)||(this.anonId=li(),c=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),y=new Date(f),v=(f-this.eventData.lastSuccess)/864e5;c=c||v>=1||v<-1||p.getDate()!==y.getDate()}else c=!0;if(!c)return this.processRequests();this.postEvent(f,{"enabled.telemetry":!1},p=>{p||(this.eventData.lastSuccess=f,this.eventData.tokenU=s)},r)}},Li=Qt.postTurnstileEvent.bind(Qt),Ui=new class extends Bt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,e,s,c){this.skuToken=e,this.errorCb=c,B.EVENTS_URL&&(s||B.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},s):this.errorCb(new Error(ke)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Si(this.anonId)||(this.anonId=li()),this.postEvent(s,{skuToken:this.skuToken},c=>{c?this.errorCb(c):e&&(this.success[e]=!0)},r))}},ki=Ui.postMapLoadEvent.bind(Ui),Ni=new class extends Bt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,e,s,c){if(!B.API_URL||!B.SESSION_PATH)return;const f=Mt(B.API_URL+B.SESSION_PATH);f.params.push(`sku=${e||""}`),f.params.push(`access_token=${c||B.ACCESS_TOKEN||""}`);const p={url:Ft(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=g_(p,y=>{this.pendingRequest=null,s(y),this.saveEventData(),this.processRequests(c)})}getSessionAPI(r,e,s,c){this.skuToken=e,this.errorCb=c,B.SESSION_PATH&&B.API_URL&&(s||B.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},s):this.errorCb(new Error(ke)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):e&&(this.success[e]=!0)},r)}},Qs=Ni.getSessionAPI.bind(Ni),zs=new Set,Cr="mapbox-tiles";let us,pc,dd=500,ah=50;function ol(){R.caches&&!us&&(us=R.caches.open(Cr))}function lh(r){const e=r.indexOf("?");return e<0?r:r.slice(0,e)}let mc=1/0;const _c={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(_c);class al extends Error{constructor(e,s,c){s===401&&We(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ch=ls()?()=>self.worker&&self.worker.referrer:()=>(R.location.protocol==="blob:"?R.parent:R).location.href,Gn=function(r,e){if(!(/^file:/.test(s=r.url)||/^file:/.test(ch())&&!/^\w+:/.test(s))){if(R.fetch&&R.Request&&R.AbortController&&R.Request.prototype.hasOwnProperty("signal"))return function(c,f){const p=new R.AbortController,y=new R.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:ch(),signal:p.signal});let v=!1,T=!1;const A=(M=y.url).indexOf("sku=")>0&&We(M);var M;c.type==="json"&&y.headers.set("Accept","application/json");const P=(U,j,G)=>{if(T)return;if(U&&U.message!=="SecurityError"&&pi(U),j&&G)return D(j);const K=Date.now();R.fetch(y).then(ie=>{if(ie.ok){const le=A?ie.clone():null;return D(ie,le,K)}return f(new al(ie.statusText,ie.status,c.url))}).catch(ie=>{ie.code!==20&&f(new Error(ie.message))})},D=(U,j,G)=>{(c.type==="arrayBuffer"?U.arrayBuffer():c.type==="json"?U.json():U.text()).then(K=>{T||(j&&G&&function(ie,le,ge){if(ol(),!us)return;const we={status:le.status,statusText:le.statusText,headers:new R.Headers};le.headers.forEach((Se,Ve)=>we.headers.set(Ve,Se));const Ee=ia(le.headers.get("Cache-Control")||"");Ee["no-store"]||(Ee["max-age"]&&we.headers.set("Expires",new Date(ge+1e3*Ee["max-age"]).toUTCString()),new Date(we.headers.get("Expires")).getTime()-ge<42e4||function(Se,Ve){if(pc===void 0)try{new Response(new ReadableStream),pc=!0}catch{pc=!1}pc?Ve(Se.body):Se.blob().then(Ve)}(le,Se=>{const Ve=new R.Response(Se,we);ol(),us&&us.then(Ne=>Ne.put(lh(ie.url),Ve)).catch(Ne=>pi(Ne.message))}))}(y,j,G),v=!0,f(null,K,U.headers.get("Cache-Control"),U.headers.get("Expires")))}).catch(K=>{T||f(new Error(K.message))})};return A?function(U,j){if(ol(),!us)return j(null);const G=lh(U.url);us.then(K=>{K.match(G).then(ie=>{const le=function(ge){if(!ge)return!1;const we=new Date(ge.headers.get("Expires")||0),Ee=ia(ge.headers.get("Cache-Control")||"");return we>Date.now()&&!Ee["no-cache"]}(ie);K.delete(G),le&&K.put(G,ie.clone()),j(null,ie,le)}).catch(j)}).catch(j)}(y,P):P(null,null),{cancel:()=>{T=!0,v||p.abort()}}}(r,e);if(ls()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var s;return function(c,f){const p=new R.XMLHttpRequest;p.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const y in c.headers)p.setRequestHeader(y,c.headers[y]);return c.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=c.credentials==="include",p.onerror=()=>{f(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let y=p.response;if(c.type==="json")try{y=JSON.parse(p.response)}catch(v){return f(v)}f(null,y,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else f(new al(p.statusText,p.status,c.url))},p.send(c.body),{cancel:()=>p.abort()}}(r,e)},ll=function(r,e){return Gn(dt(r,{type:"arrayBuffer"}),e)},hs=function(r,e){return Gn(dt(r,{method:"POST"}),e)},g_=function(r,e){return Gn(dt(r,{method:"GET"}),e)};function pd(r){const e=R.document.createElement("a");return e.href=r,e.protocol===R.document.location.protocol&&e.host===R.document.location.host}const na="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let sa,cl;sa=[],cl=0;const md=function(r,e){if(V.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),cl>=B.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return sa.push(p),p}cl++;let s=!1;const c=()=>{if(!s)for(s=!0,cl--;sa.length&&cl<B.MAX_PARALLEL_IMAGE_REQUESTS;){const p=sa.shift(),{requestParameters:y,callback:v,cancelled:T}=p;T||(p.cancel=md(y,v).cancel)}},f=ll(r,(p,y,v,T)=>{c(),p?e(p):y&&(R.createImageBitmap?function(A,M){const P=new R.Blob([new Uint8Array(A)],{type:"image/png"});R.createImageBitmap(P).then(D=>{M(null,D)}).catch(D=>{M(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(A,M)=>e(A,M,v,T)):function(A,M){const P=new R.Image,D=R.URL;P.onload=()=>{M(null,P),D.revokeObjectURL(P.src),P.onload=null,R.requestAnimationFrame(()=>{P.src=na})},P.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const U=new R.Blob([new Uint8Array(A)],{type:"image/png"});P.src=A.byteLength?D.createObjectURL(U):na}(y,(A,M)=>e(A,M,v,T)))});return{cancel:()=>{f.cancel(),c()}}};function _d(r,e,s){s[r]&&s[r].indexOf(e)!==-1||(s[r]=s[r]||[],s[r].push(e))}function gc(r,e,s){if(s&&s[r]){const c=s[r].indexOf(e);c!==-1&&s[r].splice(c,1)}}class Js{constructor(e,s={}){dt(this,s),this.type=e}}class yc extends Js{constructor(e,s={}){super("error",dt({error:e},s))}}class eo{on(e,s){return this._listeners=this._listeners||{},_d(e,s,this._listeners),this}off(e,s){return gc(e,s,this._listeners),gc(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},_d(e,s,this._oneTimeListeners),this):new Promise(c=>this.once(e,c))}fire(e,s){typeof e=="string"&&(e=new Js(e,s||{}));const c=e.type;if(this.listens(c)){e.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const v of f)v.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const v of p)gc(c,v,this._oneTimeListeners),v.call(this,e);const y=this._eventedParent;y&&(dt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof yc&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var Be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class xt{constructor(e,s,c,f){this.message=(e?`${e}: `:"")+c,f&&(this.identifier=f),s!=null&&s.__line__&&(this.line=s.__line__)}}function gd(r){const e=r.value;return e?[new xt(r.key,e,"constants have been deprecated as of v8")]:[]}function to(r,...e){for(const s of e)for(const c in s)r[c]=s[c];return r}function tr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Rs(r){if(Array.isArray(r))return r.map(Rs);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const s in r)e[s]=Rs(r[s]);return e}return tr(r)}class fs extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class xc{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[c,f]of s)this.bindings[c]=f}concat(e){return new xc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const io={kind:"null"},yt={kind:"number"},ri={kind:"string"},Kt={kind:"boolean"},ds={kind:"color"},oa={kind:"object"},Yt={kind:"value"},ul={kind:"collator"},ro={kind:"formatted"},hl={kind:"resolvedImage"};function En(r,e){return{kind:"array",itemType:r,N:e}}function Ki(r){if(r.kind==="array"){const e=Ki(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const y_=[io,yt,ri,Kt,ds,ro,oa,En(Yt),hl];function en(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!en(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const s of y_)if(!en(s,e))return null}}return`Expected ${Ki(r)} but found ${Ki(e)} instead.`}function vc(r,e){return e.some(s=>s.kind===r.kind)}function aa(r,e){return e.some(s=>s==="null"?r===null:s==="array"?Array.isArray(r):s==="object"?r&&!Array.isArray(r)&&typeof r=="object":s===typeof r)}function la(r){var e={exports:{}};return r(e,e.exports),e.exports}var ca=la(function(r,e){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(v){return(v=Math.round(v))<0?0:v>255?255:v}function f(v){return c(v[v.length-1]==="%"?parseFloat(v)/100*255:parseInt(v))}function p(v){return(T=v[v.length-1]==="%"?parseFloat(v)/100:parseFloat(v))<0?0:T>1?1:T;var T}function y(v,T,A){return A<0?A+=1:A>1&&(A-=1),6*A<1?v+(T-v)*A*6:2*A<1?T:3*A<2?v+(T-v)*(2/3-A)*6:v}try{e.parseCSSColor=function(v){var T,A=v.replace(/ /g,"").toLowerCase();if(A in s)return s[A].slice();if(A[0]==="#")return A.length===4?(T=parseInt(A.substr(1),16))>=0&&T<=4095?[(3840&T)>>4|(3840&T)>>8,240&T|(240&T)>>4,15&T|(15&T)<<4,1]:null:A.length===7&&(T=parseInt(A.substr(1),16))>=0&&T<=16777215?[(16711680&T)>>16,(65280&T)>>8,255&T,1]:null;var M=A.indexOf("("),P=A.indexOf(")");if(M!==-1&&P+1===A.length){var D=A.substr(0,M),U=A.substr(M+1,P-(M+1)).split(","),j=1;switch(D){case"rgba":if(U.length!==4)return null;j=p(U.pop());case"rgb":return U.length!==3?null:[f(U[0]),f(U[1]),f(U[2]),j];case"hsla":if(U.length!==4)return null;j=p(U.pop());case"hsl":if(U.length!==3)return null;var G=(parseFloat(U[0])%360+360)%360/360,K=p(U[1]),ie=p(U[2]),le=ie<=.5?ie*(K+1):ie+K-ie*K,ge=2*ie-le;return[c(255*y(ge,le,G+1/3)),c(255*y(ge,le,G)),c(255*y(ge,le,G-1/3)),j];default:return null}}return null}}catch{}});class fi{constructor(e,s,c,f=1){this.r=e,this.g=s,this.b=c,this.a=f}static parse(e){if(!e)return;if(e instanceof fi)return e;if(typeof e!="string")return;const s=ca.parseCSSColor(e);return s?new fi(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[e,s,c,f]=this.toArray();return`rgba(${Math.round(e)},${Math.round(s)},${Math.round(c)},${f})`}toArray(){const{r:e,g:s,b:c,a:f}=this;return f===0?[0,0,0,0]:[255*e/f,255*s/f,255*c/f,f]}}fi.black=new fi(0,0,0,1),fi.white=new fi(1,1,1,1),fi.transparent=new fi(0,0,0,0),fi.red=new fi(1,0,0,1),fi.blue=new fi(0,0,1,1);class bc{constructor(e,s,c){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class uh{constructor(e,s,c,f,p){this.text=e.normalize?e.normalize():e,this.image=s,this.scale=c,this.fontStack=f,this.textColor=p}}class qt{constructor(e){this.sections=e}static fromString(e){return new qt([new uh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof qt?e:qt.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const s of this.sections){if(s.image){e.push(["image",s.image.name]);continue}e.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),e.push(c)}return e}}class Sn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Sn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function yd(r,e,s,c){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[r,e,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[r,e,s,c]:[r,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wc(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof fi||r instanceof bc||r instanceof qt||r instanceof Sn)return!0;if(Array.isArray(r)){for(const e of r)if(!wc(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!wc(r[e]))return!1;return!0}return!1}function nr(r){if(r===null)return io;if(typeof r=="string")return ri;if(typeof r=="boolean")return Kt;if(typeof r=="number")return yt;if(r instanceof fi)return ds;if(r instanceof bc)return ul;if(r instanceof qt)return ro;if(r instanceof Sn)return hl;if(Array.isArray(r)){const e=r.length;let s;for(const c of r){const f=nr(c);if(s){if(s===f)continue;s=Yt;break}s=f}return En(s||Yt,e)}return oa}function fl(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof fi||r instanceof qt||r instanceof Sn?r.toString():JSON.stringify(r)}class no{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!wc(e[1]))return s.error("invalid value");const c=e[1];let f=nr(c);const p=s.expectedType;return f.kind!=="array"||f.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(f=p),new no(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof fi?["rgba"].concat(this.value.toArray()):this.value instanceof qt?this.value.serialize():this.value}}class yr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Tc={string:ri,number:yt,boolean:Kt,object:oa};class An{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let c,f=1;const p=e[0];if(p==="array"){let v,T;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in Tc)||A==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=Tc[A],f++}else v=Yt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=e[2],f++}c=En(v,T)}else c=Tc[p];const y=[];for(;f<e.length;f++){const v=s.parse(e[f],f,Yt);if(!v)return null;y.push(v)}return new An(c,y)}evaluate(e){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(e);if(!en(this.type,nr(c)))return c;if(s===this.args.length-1)throw new yr(`Expected value to be of type ${Ki(this.type)}, but found ${Ki(nr(c))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,s=[e.kind];if(e.kind==="array"){const c=e.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);const f=e.N;(typeof f=="number"||this.args.length>1)&&s.push(f)}}return s.concat(this.args.map(c=>c.serialize()))}}class ps{constructor(e){this.type=ro,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const c=e[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const f=[];let p=!1;for(let y=1;y<=e.length-1;++y){const v=e[y];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let T=null;if(v["font-scale"]&&(T=s.parse(v["font-scale"],1,yt),!T))return null;let A=null;if(v["text-font"]&&(A=s.parse(v["text-font"],1,En(ri)),!A))return null;let M=null;if(v["text-color"]&&(M=s.parse(v["text-color"],1,ds),!M))return null;const P=f[f.length-1];P.scale=T,P.font=A,P.textColor=M}else{const T=s.parse(e[y],1,Yt);if(!T)return null;const A=T.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,f.push({content:T,scale:null,font:null,textColor:null})}}return new ps(f)}evaluate(e){return new qt(this.sections.map(s=>{const c=s.content.evaluate(e);return nr(c)===hl?new uh("",c,null,null,null):new uh(fl(c),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const s of this.sections){e.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),e.push(c)}return e}}class Do{constructor(e){this.type=hl,this.input=e}static parse(e,s){if(e.length!==2)return s.error("Expected two arguments.");const c=s.parse(e[1],1,ri);return c?new Do(c):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),c=Sn.fromString(s);return c&&e.availableImages&&(c.available=e.availableImages.indexOf(s)>-1),c}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const x_={"to-boolean":Kt,"to-color":ds,"to-number":yt,"to-string":ri};class ms{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const c=e[0];if((c==="to-boolean"||c==="to-string")&&e.length!==2)return s.error("Expected one argument.");const f=x_[c],p=[];for(let y=1;y<e.length;y++){const v=s.parse(e[y],y,Yt);if(!v)return null;p.push(v)}return new ms(f,p)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let s,c;for(const f of this.args){if(s=f.evaluate(e),c=null,s instanceof fi)return s;if(typeof s=="string"){const p=e.parseColor(s);if(p)return p}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:yd(s[0],s[1],s[2],s[3]),!c))return new fi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new yr(c||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const c of this.args){if(s=c.evaluate(e),s===null)return 0;const f=Number(s);if(!isNaN(f))return f}throw new yr(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?qt.fromString(fl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Sn.fromString(fl(this.args[0].evaluate(e))):fl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ps([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Do(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(s=>{e.push(s.serialize())}),e}}const xd=["Unknown","Point","LineString","Polygon"];class vd{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?xd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:c,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*s-e[0])+this.featureDistanceData.bearing[1]*(f*s-e[1])}return 0}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=fi.parse(e)),s}}class dn{constructor(e,s,c,f){this.name=e,this.type=s,this._evaluate=c,this.args=f}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,s){const c=e[0],f=dn.definitions[c];if(!f)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,v=y.filter(([A])=>!Array.isArray(A)||A.length===e.length-1);let T=null;for(const[A,M]of v){T=new Ac(s.registry,s.path,null,s.scope);const P=[];let D=!1;for(let U=1;U<e.length;U++){const j=e[U],G=Array.isArray(A)?A[U-1]:A.type,K=T.parse(j,1+P.length,G);if(!K){D=!0;break}P.push(K)}if(!D)if(Array.isArray(A)&&A.length!==P.length)T.error(`Expected ${A.length} arguments, but found ${P.length} instead.`);else{for(let U=0;U<P.length;U++){const j=Array.isArray(A)?A[U]:A.type,G=P[U];T.concat(U+1).checkSubtype(j,G.type)}if(T.errors.length===0)return new dn(c,p,M,P)}}if(v.length===1)s.errors.push(...T.errors);else{const A=(v.length?v:y).map(([P])=>{return D=P,Array.isArray(D)?`(${D.map(Ki).join(", ")})`:`(${Ki(D.type)}...)`;var D}).join(" | "),M=[];for(let P=1;P<e.length;P++){const D=s.parse(e[P],1+M.length);if(!D)return null;M.push(Ki(D.type))}s.error(`Expected arguments of type ${A}, but found (${M.join(", ")}) instead.`)}return null}static register(e,s){dn.definitions=s;for(const c in s)e[c]=dn}}class dl{constructor(e,s,c){this.type=ul,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");const c=e[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const f=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Kt);if(!f)return null;const p=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Kt);if(!p)return null;let y=null;return c.locale&&(y=s.parse(c.locale,1,ri),!y)?null:new dl(f,p,y)}evaluate(e){return new bc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const so=8192;function Ec(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function pl(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function bd(r,e){const s=(180+r[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(s*f*so),Math.round(c*f*so)]}function wd(r,e,s){const c=r[0]-e[0],f=r[1]-e[1],p=r[0]-s[0],y=r[1]-s[1];return c*y-p*f==0&&c*p<=0&&f*y<=0}function hh(r,e){let s=!1;for(let y=0,v=e.length;y<v;y++){const T=e[y];for(let A=0,M=T.length;A<M-1;A++){if(wd(r,T[A],T[A+1]))return!1;(f=T[A])[1]>(c=r)[1]!=(p=T[A+1])[1]>c[1]&&c[0]<(p[0]-f[0])*(c[1]-f[1])/(p[1]-f[1])+f[0]&&(s=!s)}}var c,f,p;return s}function Td(r,e){for(let s=0;s<e.length;s++)if(hh(r,e[s]))return!0;return!1}function fh(r,e,s,c){const f=c[0]-s[0],p=c[1]-s[1],y=(r[0]-s[0])*p-f*(r[1]-s[1]),v=(e[0]-s[0])*p-f*(e[1]-s[1]);return y>0&&v<0||y<0&&v>0}function v_(r,e,s){for(const A of s)for(let M=0;M<A.length-1;++M)if((v=[(y=A[M+1])[0]-(p=A[M])[0],y[1]-p[1]])[0]*(T=[(f=e)[0]-(c=r)[0],f[1]-c[1]])[1]-v[1]*T[0]!=0&&fh(c,f,p,y)&&fh(p,y,c,f))return!0;var c,f,p,y,v,T;return!1}function Ed(r,e){for(let s=0;s<r.length;++s)if(!hh(r[s],e))return!1;for(let s=0;s<r.length-1;++s)if(v_(r[s],r[s+1],e))return!1;return!0}function b_(r,e){for(let s=0;s<e.length;s++)if(Ed(r,e[s]))return!0;return!1}function dh(r,e,s){const c=[];for(let f=0;f<r.length;f++){const p=[];for(let y=0;y<r[f].length;y++){const v=bd(r[f][y],s);Ec(e,v),p.push(v)}c.push(p)}return c}function Sd(r,e,s){const c=[];for(let f=0;f<r.length;f++){const p=dh(r[f],e,s);c.push(p)}return c}function ph(r,e,s,c){if(r[0]<s[0]||r[0]>s[2]){const f=.5*c;let p=r[0]-s[0]>f?-c:s[0]-r[0]>f?c:0;p===0&&(p=r[0]-s[2]>f?-c:s[2]-r[0]>f?c:0),r[0]+=p}Ec(e,r)}function Ad(r,e,s,c){const f=Math.pow(2,c.z)*so,p=[c.x*so,c.y*so],y=[];for(const v of r)for(const T of v){const A=[T.x+p[0],T.y+p[1]];ph(A,e,s,f),y.push(A)}return y}function Cd(r,e,s,c){const f=Math.pow(2,c.z)*so,p=[c.x*so,c.y*so],y=[];for(const T of r){const A=[];for(const M of T){const P=[M.x+p[0],M.y+p[1]];Ec(e,P),A.push(P)}y.push(A)}if(e[2]-e[0]<=f/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const T of y)for(const A of T)ph(A,e,s,f)}var v;return y}class zo{constructor(e,s){this.type=Kt,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(wc(e[1])){const c=e[1];if(c.type==="FeatureCollection")for(let f=0;f<c.features.length;++f){const p=c.features[f].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new zo(c,c.features[f].geometry)}else if(c.type==="Feature"){const f=c.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new zo(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new zo(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,c){const f=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(c.type==="Polygon"){const v=dh(c.coordinates,p,y),T=Ad(s.geometry(),f,p,y);if(!pl(f,p))return!1;for(const A of T)if(!hh(A,v))return!1}if(c.type==="MultiPolygon"){const v=Sd(c.coordinates,p,y),T=Ad(s.geometry(),f,p,y);if(!pl(f,p))return!1;for(const A of T)if(!Td(A,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,c){const f=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(c.type==="Polygon"){const v=dh(c.coordinates,p,y),T=Cd(s.geometry(),f,p,y);if(!pl(f,p))return!1;for(const A of T)if(!Ed(A,v))return!1}if(c.type==="MultiPolygon"){const v=Sd(c.coordinates,p,y),T=Cd(s.geometry(),f,p,y);if(!pl(f,p))return!1;for(const A of T)if(!b_(A,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function ua(r){if(r instanceof dn&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof zo)return!1;let e=!0;return r.eachChild(s=>{e&&!ua(s)&&(e=!1)}),e}function ml(r){if(r instanceof dn&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(s=>{e&&!ml(s)&&(e=!1)}),e}function _l(r,e){if(r instanceof dn&&e.indexOf(r.name)>=0)return!1;let s=!0;return r.eachChild(c=>{s&&!_l(c,e)&&(s=!1)}),s}class Sc{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=e[1];return s.scope.has(c)?new Sc(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ac{constructor(e,s=[],c,f=new xc,p=[]){this.registry=e,this.path=s,this.key=s.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=p,this.expectedType=c}parse(e,s,c,f,p={}){return s?this.concat(s,c,f)._parse(e,p):this._parse(e,p)}_parse(e,s){function c(f,p,y){return y==="assert"?new An(p,[f]):y==="coerce"?new ms(p,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=e[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[f];if(p){let y=p.parse(e,this);if(!y)return null;if(this.expectedType){const v=this.expectedType,T=y.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||T.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(v,T))return null}else y=c(y,v,s.typeAnnotation||"coerce");else y=c(y,v,s.typeAnnotation||"assert")}if(!(y instanceof no)&&y.type.kind!=="resolvedImage"&&Cc(y)){const v=new vd;try{y=new no(y.type,y.evaluate(v))}catch(T){return this.error(T.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,c){const f=typeof e=="number"?this.path.concat(e):this.path,p=c?this.scope.concat(c):this.scope;return new Ac(this.registry,f,s||null,p,this.errors)}error(e,...s){const c=`${this.key}${s.map(f=>`[${f}]`).join("")}`;this.errors.push(new fs(c,e))}checkSubtype(e,s){const c=en(e,s);return c&&this.error(c),c}}function Cc(r){if(r instanceof Sc)return Cc(r.boundExpression);if(r instanceof dn&&r.name==="error"||r instanceof dl||r instanceof zo)return!1;const e=r instanceof ms||r instanceof An;let s=!0;return r.eachChild(c=>{s=e?s&&Cc(c):s&&c instanceof no}),!!s&&ua(r)&&_l(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function gl(r,e){const s=r.length-1;let c,f,p=0,y=s,v=0;for(;p<=y;)if(v=Math.floor((p+y)/2),c=r[v],f=r[v+1],c<=e){if(v===s||e<f)return v;p=v+1}else{if(!(c>e))throw new yr("Input is not a number.");y=v-1}return 0}class yl{constructor(e,s,c){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[f,p]of c)this.labels.push(f),this.outputs.push(p)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(e[1],1,yt);if(!c)return null;const f=[];let p=null;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);for(let y=1;y<e.length;y+=2){const v=y===1?-1/0:e[y],T=e[y+1],A=y,M=y+1;if(typeof v!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(f.length&&f[f.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const P=s.parse(T,M,p);if(!P)return null;p=p||P.type,f.push([v,P])}return new yl(p,c,f)}evaluate(e){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(e);const f=this.input.evaluate(e);if(f<=s[0])return c[0].evaluate(e);const p=s.length;return f>=s[p-1]?c[p-1].evaluate(e):c[gl(s,f)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&e.push(this.labels[s]),e.push(this.outputs[s].serialize());return e}}function vi(r,e,s){return r*(1-s)+e*s}var Ic=Object.freeze({__proto__:null,number:vi,color:function(r,e,s){return new fi(vi(r.r,e.r,s),vi(r.g,e.g,s),vi(r.b,e.b,s),vi(r.a,e.a,s))},array:function(r,e,s){return r.map((c,f)=>vi(c,e[f],s))}});const Id=.95047,xl=1.08883,mh=4/29,Mc=6/29,Md=3*Mc*Mc,w_=Math.PI/180,T_=180/Math.PI;function kc(r){return r>.008856451679035631?Math.pow(r,1/3):r/Md+mh}function Pc(r){return r>Mc?r*r*r:Md*(r-mh)}function Dc(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function vl(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function kd(r){const e=vl(r.r),s=vl(r.g),c=vl(r.b),f=kc((.4124564*e+.3575761*s+.1804375*c)/Id),p=kc((.2126729*e+.7151522*s+.072175*c)/1);return{l:116*p-16,a:500*(f-p),b:200*(p-kc((.0193339*e+.119192*s+.9503041*c)/xl)),alpha:r.a}}function Pd(r){let e=(r.l+16)/116,s=isNaN(r.a)?e:e+r.a/500,c=isNaN(r.b)?e:e-r.b/200;return e=1*Pc(e),s=Id*Pc(s),c=xl*Pc(c),new fi(Dc(3.2404542*s-1.5371385*e-.4985314*c),Dc(-.969266*s+1.8760108*e+.041556*c),Dc(.0556434*s-.2040259*e+1.0572252*c),r.alpha)}function E_(r,e,s){const c=e-r;return r+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const bl={forward:kd,reverse:Pd,interpolate:function(r,e,s){return{l:vi(r.l,e.l,s),a:vi(r.a,e.a,s),b:vi(r.b,e.b,s),alpha:vi(r.alpha,e.alpha,s)}}},wl={forward:function(r){const{l:e,a:s,b:c}=kd(r),f=Math.atan2(c,s)*T_;return{h:f<0?f+360:f,c:Math.sqrt(s*s+c*c),l:e,alpha:r.a}},reverse:function(r){const e=r.h*w_,s=r.c;return Pd({l:r.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:r.alpha})},interpolate:function(r,e,s){return{h:E_(r.h,e.h,s),c:vi(r.c,e.c,s),l:vi(r.l,e.l,s),alpha:vi(r.alpha,e.alpha,s)}}};var Dd=Object.freeze({__proto__:null,lab:bl,hcl:wl});class tn{constructor(e,s,c,f,p){this.type=e,this.operator=s,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[y,v]of p)this.labels.push(y),this.outputs.push(v)}static interpolationFactor(e,s,c,f){let p=0;if(e.name==="exponential")p=zc(s,e.base,c,f);else if(e.name==="linear")p=zc(s,1,c,f);else if(e.name==="cubic-bezier"){const y=e.controlPoints;p=new S(y[0],y[1],y[2],y[3]).solve(zc(s,1,c,f))}return p}static parse(e,s){let[c,f,p,...y]=e;if(!Array.isArray(f)||f.length===0)return s.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const A=f[1];if(typeof A!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:A}}else{if(f[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const A=f.slice(1);if(A.length!==4||A.some(M=>typeof M!="number"||M<0||M>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(p=s.parse(p,2,yt),!p)return null;const v=[];let T=null;c==="interpolate-hcl"||c==="interpolate-lab"?T=ds:s.expectedType&&s.expectedType.kind!=="value"&&(T=s.expectedType);for(let A=0;A<y.length;A+=2){const M=y[A],P=y[A+1],D=A+3,U=A+4;if(typeof M!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(v.length&&v[v.length-1][0]>=M)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const j=s.parse(P,U,T);if(!j)return null;T=T||j.type,v.push([M,j])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new tn(T,c,f,p,v):s.error(`Type ${Ki(T)} is not interpolatable.`)}evaluate(e){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(e);const f=this.input.evaluate(e);if(f<=s[0])return c[0].evaluate(e);const p=s.length;if(f>=s[p-1])return c[p-1].evaluate(e);const y=gl(s,f),v=tn.interpolationFactor(this.interpolation,f,s[y],s[y+1]),T=c[y].evaluate(e),A=c[y+1].evaluate(e);return this.operator==="interpolate"?Ic[this.type.kind.toLowerCase()](T,A,v):this.operator==="interpolate-hcl"?wl.reverse(wl.interpolate(wl.forward(T),wl.forward(A),v)):bl.reverse(bl.interpolate(bl.forward(T),bl.forward(A),v))}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,e,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function zc(r,e,s,c){const f=c-s,p=r-s;return f===0?0:e===1?p/f:(Math.pow(e,p)-1)/(Math.pow(e,f)-1)}class Ro{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let c=null;const f=s.expectedType;f&&f.kind!=="value"&&(c=f);const p=[];for(const v of e.slice(1)){const T=s.parse(v,1+p.length,c,void 0,{typeAnnotation:"omit"});if(!T)return null;c=c||T.type,p.push(T)}const y=f&&p.some(v=>en(f,v.type));return new Ro(y?Yt:c,p)}evaluate(e){let s,c=null,f=0;for(const p of this.args){if(f++,c=p.evaluate(e),c&&c instanceof Sn&&!c.available&&(s||(s=c),c=null,f===this.args.length))return s;if(c!==null)break}return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class Rc{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const c=[];for(let p=1;p<e.length-1;p+=2){const y=e[p];if(typeof y!="string")return s.error(`Expected string, but found ${typeof y} instead.`,p);if(/[^a-zA-Z0-9_]/.test(y))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=s.parse(e[p+1],p+1);if(!v)return null;c.push([y,v])}const f=s.parse(e[e.length-1],e.length-1,s.expectedType,c);return f?new Rc(c,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[s,c]of this.bindings)e.push(s,c.serialize());return e.push(this.result.serialize()),e}}class _h{constructor(e,s,c){this.type=e,this.index=s,this.input=c}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,yt),f=s.parse(e[2],2,En(s.expectedType||Yt));return c&&f?new _h(f.type.itemType,c,f):null}evaluate(e){const s=this.index.evaluate(e),c=this.input.evaluate(e);if(s<0)throw new yr(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new yr(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new yr(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class gh{constructor(e,s){this.type=Kt,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,Yt),f=s.parse(e[2],2,Yt);return c&&f?vc(c.type,[Kt,ri,yt,io,Yt])?new gh(c,f):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ki(c.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!c)return!1;if(!aa(s,["boolean","string","number","null"]))throw new yr(`Expected first argument to be of type boolean, string, number or null, but found ${Ki(nr(s))} instead.`);if(!aa(c,["string","array"]))throw new yr(`Expected second argument to be of type array or string, but found ${Ki(nr(c))} instead.`);return c.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class qn{constructor(e,s,c){this.type=yt,this.needle=e,this.haystack=s,this.fromIndex=c}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,Yt),f=s.parse(e[2],2,Yt);if(!c||!f)return null;if(!vc(c.type,[Kt,ri,yt,io,Yt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ki(c.type)} instead`);if(e.length===4){const p=s.parse(e[3],3,yt);return p?new qn(c,f,p):null}return new qn(c,f)}evaluate(e){const s=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!aa(s,["boolean","string","number","null"]))throw new yr(`Expected first argument to be of type boolean, string, number or null, but found ${Ki(nr(s))} instead.`);if(!aa(c,["string","array"]))throw new yr(`Expected second argument to be of type array or string, but found ${Ki(nr(c))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(e);return c.indexOf(s,f)}return c.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Fc{constructor(e,s,c,f,p,y){this.inputType=e,this.type=s,this.input=c,this.cases=f,this.outputs=p,this.otherwise=y}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let c,f;s.expectedType&&s.expectedType.kind!=="value"&&(f=s.expectedType);const p={},y=[];for(let A=2;A<e.length-1;A+=2){let M=e[A];const P=e[A+1];Array.isArray(M)||(M=[M]);const D=s.concat(A);if(M.length===0)return D.error("Expected at least one branch label.");for(const j of M){if(typeof j!="number"&&typeof j!="string")return D.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return D.error("Numeric branch labels must be integer values.");if(c){if(D.checkSubtype(c,nr(j)))return null}else c=nr(j);if(p[String(j)]!==void 0)return D.error("Branch labels must be unique.");p[String(j)]=y.length}const U=s.parse(P,A,f);if(!U)return null;f=f||U.type,y.push(U)}const v=s.parse(e[1],1,Yt);if(!v)return null;const T=s.parse(e[e.length-1],e.length-1,f);return T?v.type.kind!=="value"&&s.concat(1).checkSubtype(c,v.type)?null:new Fc(c,f,v,p,y,T):null}evaluate(e){const s=this.input.evaluate(e);return(nr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],f={};for(const y of s){const v=f[this.cases[y]];v===void 0?(f[this.cases[y]]=c.length,c.push([this.cases[y],[y]])):c[v][1].push(y)}const p=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,v]of c)e.push(v.length===1?p(v[0]):v.map(p)),e.push(this.outputs[y].serialize());return e.push(this.otherwise.serialize()),e}}class oo{constructor(e,s,c){this.type=e,this.branches=s,this.otherwise=c}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const f=[];for(let y=1;y<e.length-1;y+=2){const v=s.parse(e[y],y,Kt);if(!v)return null;const T=s.parse(e[y+1],y+1,c);if(!T)return null;f.push([v,T]),c=c||T.type}const p=s.parse(e[e.length-1],e.length-1,c);return p?new oo(c,f,p):null}evaluate(e){for(const[s,c]of this.branches)if(s.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,c]of this.branches)e(s),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class Tl{constructor(e,s,c,f){this.type=e,this.input=s,this.beginIndex=c,this.endIndex=f}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=s.parse(e[1],1,Yt),f=s.parse(e[2],2,yt);if(!c||!f)return null;if(!vc(c.type,[En(Yt),ri,Yt]))return s.error(`Expected first argument to be of type array or string, but found ${Ki(c.type)} instead`);if(e.length===4){const p=s.parse(e[3],3,yt);return p?new Tl(c.type,c,f,p):null}return new Tl(c.type,c,f)}evaluate(e){const s=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!aa(s,["string","array"]))throw new yr(`Expected first argument to be of type array or string, but found ${Ki(nr(s))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(e);return s.slice(c,f)}return s.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function zd(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Lc(r,e,s,c){return c.compare(e,s)===0}function ao(r,e,s){const c=r!=="=="&&r!=="!=";return class hA{constructor(p,y,v){this.type=Kt,this.lhs=p,this.rhs=y,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||y.type.kind==="value"}static parse(p,y){if(p.length!==3&&p.length!==4)return y.error("Expected two or three arguments.");const v=p[0];let T=y.parse(p[1],1,Yt);if(!T)return null;if(!zd(v,T.type))return y.concat(1).error(`"${v}" comparisons are not supported for type '${Ki(T.type)}'.`);let A=y.parse(p[2],2,Yt);if(!A)return null;if(!zd(v,A.type))return y.concat(2).error(`"${v}" comparisons are not supported for type '${Ki(A.type)}'.`);if(T.type.kind!==A.type.kind&&T.type.kind!=="value"&&A.type.kind!=="value")return y.error(`Cannot compare types '${Ki(T.type)}' and '${Ki(A.type)}'.`);c&&(T.type.kind==="value"&&A.type.kind!=="value"?T=new An(A.type,[T]):T.type.kind!=="value"&&A.type.kind==="value"&&(A=new An(T.type,[A])));let M=null;if(p.length===4){if(T.type.kind!=="string"&&A.type.kind!=="string"&&T.type.kind!=="value"&&A.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(M=y.parse(p[3],3,ul),!M)return null}return new hA(T,A,M)}evaluate(p){const y=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(c&&this.hasUntypedArgument){const T=nr(y),A=nr(v);if(T.kind!==A.kind||T.kind!=="string"&&T.kind!=="number")throw new yr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${T.kind}, ${A.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const T=nr(y),A=nr(v);if(T.kind!=="string"||A.kind!=="string")return e(p,y,v)}return this.collator?s(p,y,v,this.collator.evaluate(p)):e(p,y,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[r];return this.eachChild(y=>{p.push(y.serialize())}),p}}}const Rd=ao("==",function(r,e,s){return e===s},Lc),yh=ao("!=",function(r,e,s){return e!==s},function(r,e,s,c){return!Lc(0,e,s,c)}),xh=ao("<",function(r,e,s){return e<s},function(r,e,s,c){return c.compare(e,s)<0}),Fd=ao(">",function(r,e,s){return e>s},function(r,e,s,c){return c.compare(e,s)>0}),vh=ao("<=",function(r,e,s){return e<=s},function(r,e,s,c){return c.compare(e,s)<=0}),Ld=ao(">=",function(r,e,s){return e>=s},function(r,e,s,c){return c.compare(e,s)>=0});class Oc{constructor(e,s,c,f,p){this.type=ri,this.number=e,this.locale=s,this.currency=c,this.minFractionDigits=f,this.maxFractionDigits=p}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");const c=s.parse(e[1],1,yt);if(!c)return null;const f=e[2];if(typeof f!="object"||Array.isArray(f))return s.error("NumberFormat options argument must be an object.");let p=null;if(f.locale&&(p=s.parse(f.locale,1,ri),!p))return null;let y=null;if(f.currency&&(y=s.parse(f.currency,1,ri),!y))return null;let v=null;if(f["min-fraction-digits"]&&(v=s.parse(f["min-fraction-digits"],1,yt),!v))return null;let T=null;return f["max-fraction-digits"]&&(T=s.parse(f["max-fraction-digits"],1,yt),!T)?null:new Oc(c,p,y,v,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Bc{constructor(e){this.type=yt,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=s.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Ki(c.type)} instead.`):new Bc(c):null}evaluate(e){const s=this.input.evaluate(e);if(typeof s=="string"||Array.isArray(s))return s.length;throw new yr(`Expected value to be of type string or array, but found ${Ki(nr(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(s=>{e.push(s.serialize())}),e}}const Zn={"==":Rd,"!=":yh,">":Fd,"<":xh,">=":Ld,"<=":vh,array:An,at:_h,boolean:An,case:oo,coalesce:Ro,collator:dl,format:ps,image:Do,in:gh,"index-of":qn,interpolate:tn,"interpolate-hcl":tn,"interpolate-lab":tn,length:Bc,let:Rc,literal:no,match:Fc,number:An,"number-format":Oc,object:An,slice:Tl,step:yl,string:An,"to-boolean":ms,"to-color":ms,"to-number":ms,"to-string":ms,var:Sc,within:zo};function bh(r,[e,s,c,f]){e=e.evaluate(r),s=s.evaluate(r),c=c.evaluate(r);const p=f?f.evaluate(r):1,y=yd(e,s,c,p);if(y)throw new yr(y);return new fi(e/255*p,s/255*p,c/255*p,p)}function wh(r,e){return r in e}function El(r,e){const s=e[r];return s===void 0?null:s}function lo(r){return{type:r}}function Od(r){return{result:"success",value:r}}function Fs(r){return{result:"error",value:r}}function ha(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Bd(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Th(r){return!!r.expression&&r.expression.interpolated}function _i(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Uc(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Nc(r){return r}function Sl(r,e){const s=e.type==="color",c=r.stops&&typeof r.stops[0][0]=="object",f=c||!(c||r.property!==void 0),p=r.type||(Th(e)?"exponential":"interval");if(s&&((r=to({},r)).stops&&(r.stops=r.stops.map(A=>[A[0],fi.parse(A[1])])),r.default=fi.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Dd[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let y,v,T;if(p==="exponential")y=Ud;else if(p==="interval")y=S_;else if(p==="categorical"){y=jc,v=Object.create(null);for(const A of r.stops)v[A[0]]=A[1];T=typeof r.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);y=A_}if(c){const A={},M=[];for(let U=0;U<r.stops.length;U++){const j=r.stops[U],G=j[0].zoom;A[G]===void 0&&(A[G]={zoom:G,type:r.type,property:r.property,default:r.default,stops:[]},M.push(G)),A[G].stops.push([j[0].value,j[1]])}const P=[];for(const U of M)P.push([A[U].zoom,Sl(A[U],e)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:tn.interpolationFactor.bind(void 0,D),zoomStops:P.map(U=>U[0]),evaluate:({zoom:U},j)=>Ud({stops:P,base:r.base},e,U).evaluate(U,j)}}if(f){const A=p==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:tn.interpolationFactor.bind(void 0,A),zoomStops:r.stops.map(M=>M[0]),evaluate:({zoom:M})=>y(r,e,M,v,T)}}return{kind:"source",evaluate(A,M){const P=M&&M.properties?M.properties[r.property]:void 0;return P===void 0?Ir(r.default,e.default):y(r,e,P,v,T)}}}function Ir(r,e,s){return r!==void 0?r:e!==void 0?e:s!==void 0?s:void 0}function jc(r,e,s,c,f){return Ir(typeof s===f?c[s]:void 0,r.default,e.default)}function S_(r,e,s){if(_i(s)!=="number")return Ir(r.default,e.default);const c=r.stops.length;if(c===1||s<=r.stops[0][0])return r.stops[0][1];if(s>=r.stops[c-1][0])return r.stops[c-1][1];const f=gl(r.stops.map(p=>p[0]),s);return r.stops[f][1]}function Ud(r,e,s){const c=r.base!==void 0?r.base:1;if(_i(s)!=="number")return Ir(r.default,e.default);const f=r.stops.length;if(f===1||s<=r.stops[0][0])return r.stops[0][1];if(s>=r.stops[f-1][0])return r.stops[f-1][1];const p=gl(r.stops.map(M=>M[0]),s),y=function(M,P,D,U){const j=U-D,G=M-D;return j===0?0:P===1?G/j:(Math.pow(P,G)-1)/(Math.pow(P,j)-1)}(s,c,r.stops[p][0],r.stops[p+1][0]),v=r.stops[p][1],T=r.stops[p+1][1];let A=Ic[e.type]||Nc;if(r.colorSpace&&r.colorSpace!=="rgb"){const M=Dd[r.colorSpace];A=(P,D)=>M.reverse(M.interpolate(M.forward(P),M.forward(D),y))}return typeof v.evaluate=="function"?{evaluate(...M){const P=v.evaluate.apply(void 0,M),D=T.evaluate.apply(void 0,M);if(P!==void 0&&D!==void 0)return A(P,D,y)}}:A(v,T,y)}function A_(r,e,s){return e.type==="color"?s=fi.parse(s):e.type==="formatted"?s=qt.fromString(s.toString()):e.type==="resolvedImage"?s=Sn.fromString(s.toString()):_i(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0),Ir(s,r.default,e.default)}dn.register(Zn,{error:[{kind:"error"},[ri],(r,[e])=>{throw new yr(e.evaluate(r))}],typeof:[ri,[Yt],(r,[e])=>Ki(nr(e.evaluate(r)))],"to-rgba":[En(yt,4),[ds],(r,[e])=>e.evaluate(r).toArray()],rgb:[ds,[yt,yt,yt],bh],rgba:[ds,[yt,yt,yt,yt],bh],has:{type:Kt,overloads:[[[ri],(r,[e])=>wh(e.evaluate(r),r.properties())],[[ri,oa],(r,[e,s])=>wh(e.evaluate(r),s.evaluate(r))]]},get:{type:Yt,overloads:[[[ri],(r,[e])=>El(e.evaluate(r),r.properties())],[[ri,oa],(r,[e,s])=>El(e.evaluate(r),s.evaluate(r))]]},"feature-state":[Yt,[ri],(r,[e])=>El(e.evaluate(r),r.featureState||{})],properties:[oa,[],r=>r.properties()],"geometry-type":[ri,[],r=>r.geometryType()],id:[Yt,[],r=>r.id()],zoom:[yt,[],r=>r.globals.zoom],pitch:[yt,[],r=>r.globals.pitch||0],"distance-from-center":[yt,[],r=>r.distanceFromCenter()],"heatmap-density":[yt,[],r=>r.globals.heatmapDensity||0],"line-progress":[yt,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[yt,[],r=>r.globals.skyRadialProgress||0],accumulated:[Yt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[yt,lo(yt),(r,e)=>{let s=0;for(const c of e)s+=c.evaluate(r);return s}],"*":[yt,lo(yt),(r,e)=>{let s=1;for(const c of e)s*=c.evaluate(r);return s}],"-":{type:yt,overloads:[[[yt,yt],(r,[e,s])=>e.evaluate(r)-s.evaluate(r)],[[yt],(r,[e])=>-e.evaluate(r)]]},"/":[yt,[yt,yt],(r,[e,s])=>e.evaluate(r)/s.evaluate(r)],"%":[yt,[yt,yt],(r,[e,s])=>e.evaluate(r)%s.evaluate(r)],ln2:[yt,[],()=>Math.LN2],pi:[yt,[],()=>Math.PI],e:[yt,[],()=>Math.E],"^":[yt,[yt,yt],(r,[e,s])=>Math.pow(e.evaluate(r),s.evaluate(r))],sqrt:[yt,[yt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[yt,[yt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[yt,[yt],(r,[e])=>Math.log(e.evaluate(r))],log2:[yt,[yt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[yt,[yt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[yt,[yt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[yt,[yt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[yt,[yt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[yt,[yt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[yt,[yt],(r,[e])=>Math.atan(e.evaluate(r))],min:[yt,lo(yt),(r,e)=>Math.min(...e.map(s=>s.evaluate(r)))],max:[yt,lo(yt),(r,e)=>Math.max(...e.map(s=>s.evaluate(r)))],abs:[yt,[yt],(r,[e])=>Math.abs(e.evaluate(r))],round:[yt,[yt],(r,[e])=>{const s=e.evaluate(r);return s<0?-Math.round(-s):Math.round(s)}],floor:[yt,[yt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[yt,[yt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Kt,[ri,Yt],(r,[e,s])=>r.properties()[e.value]===s.value],"filter-id-==":[Kt,[Yt],(r,[e])=>r.id()===e.value],"filter-type-==":[Kt,[ri],(r,[e])=>r.geometryType()===e.value],"filter-<":[Kt,[ri,Yt],(r,[e,s])=>{const c=r.properties()[e.value],f=s.value;return typeof c==typeof f&&c<f}],"filter-id-<":[Kt,[Yt],(r,[e])=>{const s=r.id(),c=e.value;return typeof s==typeof c&&s<c}],"filter->":[Kt,[ri,Yt],(r,[e,s])=>{const c=r.properties()[e.value],f=s.value;return typeof c==typeof f&&c>f}],"filter-id->":[Kt,[Yt],(r,[e])=>{const s=r.id(),c=e.value;return typeof s==typeof c&&s>c}],"filter-<=":[Kt,[ri,Yt],(r,[e,s])=>{const c=r.properties()[e.value],f=s.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[Kt,[Yt],(r,[e])=>{const s=r.id(),c=e.value;return typeof s==typeof c&&s<=c}],"filter->=":[Kt,[ri,Yt],(r,[e,s])=>{const c=r.properties()[e.value],f=s.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[Kt,[Yt],(r,[e])=>{const s=r.id(),c=e.value;return typeof s==typeof c&&s>=c}],"filter-has":[Kt,[Yt],(r,[e])=>e.value in r.properties()],"filter-has-id":[Kt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Kt,[En(ri)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Kt,[En(Yt)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Kt,[ri,En(Yt)],(r,[e,s])=>s.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Kt,[ri,En(Yt)],(r,[e,s])=>function(c,f,p,y){for(;p<=y;){const v=p+y>>1;if(f[v]===c)return!0;f[v]>c?y=v-1:p=v+1}return!1}(r.properties()[e.value],s.value,0,s.value.length-1)],all:{type:Kt,overloads:[[[Kt,Kt],(r,[e,s])=>e.evaluate(r)&&s.evaluate(r)],[lo(Kt),(r,e)=>{for(const s of e)if(!s.evaluate(r))return!1;return!0}]]},any:{type:Kt,overloads:[[[Kt,Kt],(r,[e,s])=>e.evaluate(r)||s.evaluate(r)],[lo(Kt),(r,e)=>{for(const s of e)if(s.evaluate(r))return!0;return!1}]]},"!":[Kt,[Kt],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Kt,[ri],(r,[e])=>{const s=r.globals&&r.globals.isSupportedScript;return!s||s(e.evaluate(r))}],upcase:[ri,[ri],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[ri,[ri],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[ri,lo(Yt),(r,e)=>e.map(s=>fl(s.evaluate(r))).join("")],"resolved-locale":[ri,[ul],(r,[e])=>e.evaluate(r).resolvedLocale()]});class Eh{constructor(e,s){this.expression=e,this._warningHistory={},this._evaluator=new vd,this._defaultValue=s?function(c){return c.type==="color"&&Uc(c.default)?new fi(0,0,0,0):c.type==="color"?fi.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(e,s,c,f,p,y,v,T){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=f,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,s,c,f,p,y,v,T){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=T||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new yr(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console!="undefined"&&console.warn(A.message)),this._defaultValue}}}function fa(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Zn}function Al(r,e){const s=new Ac(Zn,[],e?function(f){const p={color:ds,string:ri,number:yt,enum:ri,boolean:Kt,formatted:ro,resolvedImage:hl};return f.type==="array"?En(p[f.value]||Yt,f.length):p[f.type]}(e):void 0),c=s.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Od(new Eh(c,e)):Fs(s.errors)}class Cl{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent=e!=="constant"&&!ml(s.expression)}evaluateWithoutErrorHandling(e,s,c,f,p,y){return this._styleExpression.evaluateWithoutErrorHandling(e,s,c,f,p,y)}evaluate(e,s,c,f,p,y){return this._styleExpression.evaluate(e,s,c,f,p,y)}}class Sh{constructor(e,s,c,f){this.kind=e,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!ml(s.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,s,c,f,p,y){return this._styleExpression.evaluateWithoutErrorHandling(e,s,c,f,p,y)}evaluate(e,s,c,f,p,y){return this._styleExpression.evaluate(e,s,c,f,p,y)}interpolationFactor(e,s,c){return this.interpolationType?tn.interpolationFactor(this.interpolationType,e,s,c):0}}function Nd(r,e){if((r=Al(r,e)).result==="error")return r;const s=r.value.expression,c=ua(s);if(!c&&!ha(e))return Fs([new fs("","data expressions not supported")]);const f=_l(s,["zoom","pitch","distance-from-center"]);if(!f&&!Bd(e))return Fs([new fs("","zoom expressions not supported")]);const p=Vc(s);return p||f?p instanceof fs?Fs([p]):p instanceof tn&&!Th(e)?Fs([new fs("",'"interpolate" expressions cannot be used with this property')]):Od(p?new Sh(c?"camera":"composite",r.value,p.labels,p instanceof tn?p.interpolation:void 0):new Cl(c?"constant":"source",r.value)):Fs([new fs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class da{constructor(e,s){this._parameters=e,this._specification=s,to(this,Sl(this._parameters,this._specification))}static deserialize(e){return new da(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Vc(r){let e=null;if(r instanceof Rc)e=Vc(r.result);else if(r instanceof Ro){for(const s of r.args)if(e=Vc(s),e)break}else(r instanceof yl||r instanceof tn)&&r.input instanceof dn&&r.input.name==="zoom"&&(e=r);return e instanceof fs||r.eachChild(s=>{const c=Vc(s);c instanceof fs?e=c:!e&&c?e=new fs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&c&&e!==c&&(e=new fs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Cn(r){const e=r.key,s=r.value,c=r.valueSpec||{},f=r.objectElementValidators||{},p=r.style,y=r.styleSpec;let v=[];const T=_i(s);if(T!=="object")return[new xt(e,s,`object expected, ${T} found`)];for(const A in s){const M=A.split(".")[0],P=c[M]||c["*"];let D;if(f[M])D=f[M];else if(c[M])D=xr;else if(f["*"])D=f["*"];else{if(!c["*"]){v.push(new xt(e,s[A],`unknown property "${A}"`));continue}D=xr}v=v.concat(D({key:(e&&`${e}.`)+A,value:s[A],valueSpec:P,style:p,styleSpec:y,object:s,objectKey:A},s))}for(const A in c)f[A]||c[A].required&&c[A].default===void 0&&s[A]===void 0&&v.push(new xt(e,s,`missing required property "${A}"`));return v}function Ah(r){const e=r.value,s=r.valueSpec,c=r.style,f=r.styleSpec,p=r.key,y=r.arrayElementValidator||xr;if(_i(e)!=="array")return[new xt(p,e,`array expected, ${_i(e)} found`)];if(s.length&&e.length!==s.length)return[new xt(p,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new xt(p,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let v={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum};f.$version<7&&(v.function=s.function),_i(s.value)==="object"&&(v=s.value);let T=[];for(let A=0;A<e.length;A++)T=T.concat(y({array:e,arrayIndex:A,value:e[A],valueSpec:v,style:c,styleSpec:f,key:`${p}[${A}]`}));return T}function jd(r){const e=r.key,s=r.value,c=r.valueSpec;let f=_i(s);if(f==="number"&&s!=s&&(f="NaN"),f!=="number")return[new xt(e,s,`number expected, ${f} found`)];if("minimum"in c){let p=c.minimum;if(_i(c.minimum)==="array"&&(p=c.minimum[r.arrayIndex]),s<p)return[new xt(e,s,`${s} is less than the minimum value ${p}`)]}if("maximum"in c){let p=c.maximum;if(_i(c.maximum)==="array"&&(p=c.maximum[r.arrayIndex]),s>p)return[new xt(e,s,`${s} is greater than the maximum value ${p}`)]}return[]}function $c(r){const e=r.valueSpec,s=tr(r.value.type);let c,f,p,y={};const v=s!=="categorical"&&r.value.property===void 0,T=!v,A=_i(r.value.stops)==="array"&&_i(r.value.stops[0])==="array"&&_i(r.value.stops[0][0])==="object",M=Cn({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(U){if(s==="identity")return[new xt(U.key,U.value,'identity function may not have a "stops" property')];let j=[];const G=U.value;return j=j.concat(Ah({key:U.key,value:G,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:P})),_i(G)==="array"&&G.length===0&&j.push(new xt(U.key,G,"array must have at least one stop")),j},default:function(U){return xr({key:U.key,value:U.value,valueSpec:e,style:U.style,styleSpec:U.styleSpec})}}});return s==="identity"&&v&&M.push(new xt(r.key,r.value,'missing required property "property"')),s==="identity"||r.value.stops||M.push(new xt(r.key,r.value,'missing required property "stops"')),s==="exponential"&&r.valueSpec.expression&&!Th(r.valueSpec)&&M.push(new xt(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(T&&!ha(r.valueSpec)?M.push(new xt(r.key,r.value,"property functions not supported")):v&&!Bd(r.valueSpec)&&M.push(new xt(r.key,r.value,"zoom functions not supported"))),s!=="categorical"&&!A||r.value.property!==void 0||M.push(new xt(r.key,r.value,'"property" property is required')),M;function P(U){let j=[];const G=U.value,K=U.key;if(_i(G)!=="array")return[new xt(K,G,`array expected, ${_i(G)} found`)];if(G.length!==2)return[new xt(K,G,`array length 2 expected, length ${G.length} found`)];if(A){if(_i(G[0])!=="object")return[new xt(K,G,`object expected, ${_i(G[0])} found`)];if(G[0].zoom===void 0)return[new xt(K,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new xt(K,G,"object stop key must have value")];if(p&&p>tr(G[0].zoom))return[new xt(K,G[0].zoom,"stop zoom values must appear in ascending order")];tr(G[0].zoom)!==p&&(p=tr(G[0].zoom),f=void 0,y={}),j=j.concat(Cn({key:`${K}[0]`,value:G[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:jd,value:D}}))}else j=j.concat(D({key:`${K}[0]`,value:G[0],valueSpec:{},style:U.style,styleSpec:U.styleSpec},G));return fa(Rs(G[1]))?j.concat([new xt(`${K}[1]`,G[1],"expressions are not allowed in function stops.")]):j.concat(xr({key:`${K}[1]`,value:G[1],valueSpec:e,style:U.style,styleSpec:U.styleSpec}))}function D(U,j){const G=_i(U.value),K=tr(U.value),ie=U.value!==null?U.value:j;if(c){if(G!==c)return[new xt(U.key,ie,`${G} stop domain type must match previous stop domain type ${c}`)]}else c=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new xt(U.key,ie,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&s!=="categorical"){let le=`number expected, ${G} found`;return ha(e)&&s===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xt(U.key,ie,le)]}return s!=="categorical"||G!=="number"||isFinite(K)&&Math.floor(K)===K?s!=="categorical"&&G==="number"&&f!==void 0&&K<f?[new xt(U.key,ie,"stop domain values must appear in ascending order")]:(f=K,s==="categorical"&&K in y?[new xt(U.key,ie,"stop domain values must be unique")]:(y[K]=!0,[])):[new xt(U.key,ie,`integer expected, found ${K}`)]}}function Ls(r){const e=(r.expressionContext==="property"?Nd:Al)(Rs(r.value),r.valueSpec);if(e.result==="error")return e.value.map(c=>new xt(`${r.key}${c.key}`,r.value,c.message));const s=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!s.outputDefined())return[new xt(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!ml(s))return[new xt(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter")return Ch(s,r);if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!_l(s,["zoom","feature-state"]))return[new xt(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!ua(s))return[new xt(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ch(r,e){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const f of e.valueSpec.expression.parameters)s.delete(f);if(s.size===0)return[];const c=[];return r instanceof dn&&s.has(r.name)?[new xt(e.key,e.value,`["${r.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(r.eachChild(f=>{c.push(...Ch(f,e))}),c)}function Gc(r){const e=r.key,s=r.value,c=r.valueSpec,f=[];return Array.isArray(c.values)?c.values.indexOf(tr(s))===-1&&f.push(new xt(e,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(tr(s))===-1&&f.push(new xt(e,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),f}function qc(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!qc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Zc(r,e="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};qc(r)||(r=Hc(r));const s=r;let c=!0;try{c=function(A){if(!pa(A))return A;let M=Rs(A);return Vd(M),M=Wc(M),M}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(s,null,2)}
        `)}const f=Be[`filter_${e}`],p=Al(c,f);let y=null;if(p.result==="error")throw new Error(p.value.map(A=>`${A.key}: ${A.message}`).join(", "));y=(A,M,P)=>p.value.evaluate(A,M,{},P);let v=null,T=null;if(c!==s){const A=Al(s,f);if(A.result==="error")throw new Error(A.value.map(M=>`${M.key}: ${M.message}`).join(", "));v=(M,P,D,U,j)=>A.value.evaluate(M,P,{},D,void 0,void 0,U,j),T=!ua(A.value.expression)}return y=y,{filter:y,dynamicFilter:v||void 0,needGeometry:Ih(c),needFeature:!!T}}function Wc(r){if(!Array.isArray(r))return r;const e=function(s){if(C_.has(s[0])){for(let c=1;c<s.length;c++)if(pa(s[c]))return!0}return s}(r);return e===!0?e:e.map(s=>Wc(s))}function Vd(r){let e=!1;const s=[];if(r[0]==="case"){for(let c=1;c<r.length-1;c+=2)e=e||pa(r[c]),s.push(r[c+1]);s.push(r[r.length-1])}else if(r[0]==="match"){e=e||pa(r[1]);for(let c=2;c<r.length-1;c+=2)s.push(r[c+1]);s.push(r[r.length-1])}else if(r[0]==="step"){e=e||pa(r[1]);for(let c=1;c<r.length-1;c+=2)s.push(r[c+1])}e&&(r.length=0,r.push("any",...s));for(let c=1;c<r.length;c++)Vd(r[c])}function pa(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let s=1;s<r.length;s++)if(pa(r[s]))return!0;return!1}const C_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function I_(r,e){return r<e?-1:r>e?1:0}function Ih(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(Ih(r[e]))return!0;return!1}function Hc(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Mh(r[1],r[2],"=="):e==="!="?Xc(Mh(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Mh(r[1],r[2],e):e==="any"?(s=r.slice(1),["any"].concat(s.map(Hc))):e==="all"?["all"].concat(r.slice(1).map(Hc)):e==="none"?["all"].concat(r.slice(1).map(Hc).map(Xc)):e==="in"?$d(r[1],r.slice(2)):e==="!in"?Xc($d(r[1],r.slice(2))):e==="has"?Gd(r[1]):e==="!has"?Xc(Gd(r[1])):e!=="within"||r;var s}function Mh(r,e,s){switch(r){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,r,e]}}function $d(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",r,["literal",e.sort(I_)]]:["filter-in-small",r,["literal",e]]}}function Gd(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Xc(r){return["!",r]}function kh(r){if(qc(Rs(r.value))){const e=Rs(r.layerType);return Ls(to({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${e||"fill"}`]}))}return qd(r)}function qd(r){const e=r.value,s=r.key;if(_i(e)!=="array")return[new xt(s,e,`array expected, ${_i(e)} found`)];const c=r.styleSpec;let f,p=[];if(e.length<1)return[new xt(s,e,"filter array must have at least 1 element")];switch(p=p.concat(Gc({key:`${s}[0]`,value:e[0],valueSpec:c.filter_operator,style:r.style,styleSpec:r.styleSpec})),tr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&tr(e[1])==="$type"&&p.push(new xt(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new xt(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(f=_i(e[1]),f!=="string"&&p.push(new xt(`${s}[1]`,e[1],`string expected, ${f} found`)));for(let y=2;y<e.length;y++)f=_i(e[y]),tr(e[1])==="$type"?p=p.concat(Gc({key:`${s}[${y}]`,value:e[y],valueSpec:c.geometry_type,style:r.style,styleSpec:r.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&p.push(new xt(`${s}[${y}]`,e[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)p=p.concat(qd({key:`${s}[${y}]`,value:e[y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":f=_i(e[1]),e.length!==2?p.push(new xt(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="string"&&p.push(new xt(`${s}[1]`,e[1],`string expected, ${f} found`));break;case"within":f=_i(e[1]),e.length!==2?p.push(new xt(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="object"&&p.push(new xt(`${s}[1]`,e[1],`object expected, ${f} found`))}return p}function Il(r,e){const s=r.key,c=r.style,f=r.styleSpec,p=r.value,y=r.objectKey,v=f[`${e}_${r.layerType}`];if(!v)return[];const T=y.match(/^(.*)-transition$/);if(e==="paint"&&T&&v[T[1]]&&v[T[1]].transition)return xr({key:s,value:p,valueSpec:f.transition,style:c,styleSpec:f});const A=r.valueSpec||v[y];if(!A)return[new xt(s,p,`unknown property "${y}"`)];let M;if(_i(p)==="string"&&ha(A)&&!A.tokens&&(M=/^{([^}]+)}$/.exec(p)))return[new xt(s,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const P=[];return r.layerType==="symbol"&&(y==="text-field"&&c&&!c.glyphs&&P.push(new xt(s,p,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Uc(Rs(p))&&tr(p.type)==="identity"&&P.push(new xt(s,p,'"text-font" does not support identity functions'))),P.concat(xr({key:r.key,value:p,valueSpec:A,style:c,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:y}))}function Zd(r){return Il(r,"paint")}function Wd(r){return Il(r,"layout")}function Ml(r){let e=[];const s=r.value,c=r.key,f=r.style,p=r.styleSpec;s.type||s.ref||e.push(new xt(c,s,'either "type" or "ref" is required'));let y=tr(s.type);const v=tr(s.ref);if(s.id){const T=tr(s.id);for(let A=0;A<r.arrayIndex;A++){const M=f.layers[A];tr(M.id)===T&&e.push(new xt(c,s.id,`duplicate layer id "${s.id}", previously used at line ${M.id.__line__}`))}}if("ref"in s){let T;["type","source","source-layer","filter","layout"].forEach(A=>{A in s&&e.push(new xt(c,s[A],`"${A}" is prohibited for ref layers`))}),f.layers.forEach(A=>{tr(A.id)===v&&(T=A)}),T?T.ref?e.push(new xt(c,s.ref,"ref cannot reference another ref layer")):y=tr(T.type):e.push(new xt(c,s.ref,`ref layer "${v}" not found`))}else if(y!=="background"&&y!=="sky")if(s.source){const T=f.sources&&f.sources[s.source],A=T&&tr(T.type);T?A==="vector"&&y==="raster"?e.push(new xt(c,s.source,`layer "${s.id}" requires a raster source`)):A==="raster"&&y!=="raster"?e.push(new xt(c,s.source,`layer "${s.id}" requires a vector source`)):A!=="vector"||s["source-layer"]?A==="raster-dem"&&y!=="hillshade"?e.push(new xt(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!s.paint||!s.paint["line-gradient"]||A==="geojson"&&T.lineMetrics||e.push(new xt(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new xt(c,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new xt(c,s.source,`source "${s.source}" not found`))}else e.push(new xt(c,s,'missing required property "source"'));return e=e.concat(Cn({key:c,value:s,valueSpec:p.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>xr({key:`${c}.type`,value:s.type,valueSpec:p.layer.type,style:r.style,styleSpec:r.styleSpec,object:s,objectKey:"type"}),filter:T=>kh(to({layerType:y},T)),layout:T=>Cn({layer:s,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":A=>Wd(to({layerType:y},A))}}),paint:T=>Cn({layer:s,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":A=>Zd(to({layerType:y},A))}})}})),e}function ma(r){const e=r.value,s=r.key,c=_i(e);return c!=="string"?[new xt(s,e,`string expected, ${c} found`)]:[]}const Ph={promoteId:function({key:r,value:e}){if(_i(e)==="string")return ma({key:r,value:e});{const s=[];for(const c in e)s.push(...ma({key:`${r}.${c}`,value:e[c]}));return s}}};function Hd(r){const e=r.value,s=r.key,c=r.styleSpec,f=r.style;if(!e.type)return[new xt(s,e,'"type" is required')];const p=tr(e.type);let y;switch(p){case"vector":case"raster":case"raster-dem":return y=Cn({key:s,value:e,valueSpec:c[`source_${p.replace("-","_")}`],style:r.style,styleSpec:c,objectElementValidators:Ph}),y;case"geojson":if(y=Cn({key:s,value:e,valueSpec:c.source_geojson,style:f,styleSpec:c,objectElementValidators:Ph}),e.cluster)for(const v in e.clusterProperties){const[T,A]=e.clusterProperties[v],M=typeof T=="string"?[T,["accumulated"],["get",v]]:T;y.push(...Ls({key:`${s}.${v}.map`,value:A,expressionContext:"cluster-map"})),y.push(...Ls({key:`${s}.${v}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return y;case"video":return Cn({key:s,value:e,valueSpec:c.source_video,style:f,styleSpec:c});case"image":return Cn({key:s,value:e,valueSpec:c.source_image,style:f,styleSpec:c});case"canvas":return[new xt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gc({key:`${s}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,styleSpec:c})}}function Dh(r){const e=r.value,s=r.styleSpec,c=s.light,f=r.style;let p=[];const y=_i(e);if(e===void 0)return p;if(y!=="object")return p=p.concat([new xt("light",e,`object expected, ${y} found`)]),p;for(const v in e){const T=v.match(/^(.*)-transition$/);p=p.concat(T&&c[T[1]]&&c[T[1]].transition?xr({key:v,value:e[v],valueSpec:s.transition,style:f,styleSpec:s}):c[v]?xr({key:v,value:e[v],valueSpec:c[v],style:f,styleSpec:s}):[new xt(v,e[v],`unknown property "${v}"`)])}return p}function zh(r){const e=r.value,s=r.key,c=r.style,f=r.styleSpec,p=f.terrain;let y=[];const v=_i(e);if(e===void 0)return y;if(v!=="object")return y=y.concat([new xt("terrain",e,`object expected, ${v} found`)]),y;for(const T in e){const A=T.match(/^(.*)-transition$/);y=y.concat(A&&p[A[1]]&&p[A[1]].transition?xr({key:T,value:e[T],valueSpec:f.transition,style:c,styleSpec:f}):p[T]?xr({key:T,value:e[T],valueSpec:p[T],style:c,styleSpec:f}):[new xt(T,e[T],`unknown property "${T}"`)])}if(e.source){const T=c.sources&&c.sources[e.source],A=T&&tr(T.type);T?A!=="raster-dem"&&y.push(new xt(s,e.source,`terrain cannot be used with a source of type ${A}, it only be used with a "raster-dem" source type`)):y.push(new xt(s,e.source,`source "${e.source}" not found`))}else y.push(new xt(s,e,'terrain is missing required property "source"'));return y}function Rh(r){const e=r.value,s=r.style,c=r.styleSpec,f=c.fog;let p=[];const y=_i(e);if(e===void 0)return p;if(y!=="object")return p=p.concat([new xt("fog",e,`object expected, ${y} found`)]),p;for(const v in e){const T=v.match(/^(.*)-transition$/);p=p.concat(T&&f[T[1]]&&f[T[1]].transition?xr({key:v,value:e[v],valueSpec:c.transition,style:s,styleSpec:c}):f[v]?xr({key:v,value:e[v],valueSpec:f[v],style:s,styleSpec:c}):[new xt(v,e[v],`unknown property "${v}"`)])}return p}const Fh={"*":()=>[],array:Ah,boolean:function(r){const e=r.value,s=r.key,c=_i(e);return c!=="boolean"?[new xt(s,e,`boolean expected, ${c} found`)]:[]},number:jd,color:function(r){const e=r.key,s=r.value,c=_i(s);return c!=="string"?[new xt(e,s,`color expected, ${c} found`)]:ca.parseCSSColor(s)===null?[new xt(e,s,`color expected, "${s}" found`)]:[]},constants:gd,enum:Gc,filter:kh,function:$c,layer:Ml,object:Cn,source:Hd,light:Dh,terrain:zh,fog:Rh,string:ma,formatted:function(r){return ma(r).length===0?[]:Ls(r)},resolvedImage:function(r){return ma(r).length===0?[]:Ls(r)},projection:function(r){const e=r.value,s=r.styleSpec,c=s.projection,f=r.style;let p=[];const y=_i(e);if(y==="object")for(const v in e)p=p.concat(xr({key:v,value:e[v],valueSpec:c[v],style:f,styleSpec:s}));else y!=="string"&&(p=p.concat([new xt("projection",e,`object or string expected, ${y} found`)]));return p}};function xr(r){const e=r.value,s=r.valueSpec,c=r.styleSpec;return s.expression&&Uc(tr(e))?$c(r):s.expression&&fa(Rs(e))?Ls(r):s.type&&Fh[s.type]?Fh[s.type](r):Cn(to({},r,{valueSpec:s.type?c[s.type]:s}))}function Lh(r){const e=r.value,s=r.key,c=ma(r);return c.length||(e.indexOf("{fontstack}")===-1&&c.push(new xt(s,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&c.push(new xt(s,e,'"glyphs" url must include a "{range}" token'))),c}function Os(r,e=Be){let s=[];return s=s.concat(xr({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:Lh,"*":()=>[]}})),r.constants&&(s=s.concat(gd({key:"constants",value:r.constants,style:r,styleSpec:e}))),Xd(s)}function Xd(r){return[].concat(r).sort((e,s)=>e.line-s.line)}function Wn(r){return function(...e){return Xd(r.apply(this,e))}}Os.source=Wn(Hd),Os.light=Wn(Dh),Os.terrain=Wn(zh),Os.fog=Wn(Rh),Os.layer=Wn(Ml),Os.filter=Wn(kh),Os.paintProperty=Wn(Zd),Os.layoutProperty=Wn(Wd);const _a=Os,ga=_a.light,M_=_a.fog,Oh=_a.paintProperty,k_=_a.layoutProperty;function Kd(r,e){let s=!1;if(e&&e.length)for(const c of e)r.fire(new yc(new Error(c.message))),s=!0;return s}var kl=qr;function qr(r,e,s){var c=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var f=new Int32Array(this.arrayBuffer);r=f[0],this.d=(e=f[1])+2*(s=f[2]);for(var p=0;p<this.d*this.d;p++){var y=f[3+p],v=f[3+p+1];c.push(y===v?null:f.subarray(y,v))}var T=f[3+c.length+1];this.keys=f.subarray(f[3+c.length],T),this.bboxes=f.subarray(T),this.insert=this._insertReadonly}else{this.d=e+2*s;for(var A=0;A<this.d*this.d;A++)c.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=r,this.padding=s,this.scale=e/r,this.uid=0;var M=s/e*r;this.min=-M,this.max=r+M}qr.prototype.insert=function(r,e,s,c,f){this._forEachCell(e,s,c,f,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(e),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(f)},qr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},qr.prototype._insertCell=function(r,e,s,c,f,p){this.cells[f].push(p)},qr.prototype.query=function(r,e,s,c,f){var p=this.min,y=this.max;if(r<=p&&e<=p&&y<=s&&y<=c&&!f)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(r,e,s,c,this._queryCell,v,{},f),v},qr.prototype._queryCell=function(r,e,s,c,f,p,y,v){var T=this.cells[f];if(T!==null)for(var A=this.keys,M=this.bboxes,P=0;P<T.length;P++){var D=T[P];if(y[D]===void 0){var U=4*D;(v?v(M[U+0],M[U+1],M[U+2],M[U+3]):r<=M[U+2]&&e<=M[U+3]&&s>=M[U+0]&&c>=M[U+1])?(y[D]=!0,p.push(A[D])):y[D]=!1}}},qr.prototype._forEachCell=function(r,e,s,c,f,p,y,v){for(var T=this._convertToCellCoord(r),A=this._convertToCellCoord(e),M=this._convertToCellCoord(s),P=this._convertToCellCoord(c),D=T;D<=M;D++)for(var U=A;U<=P;U++){var j=this.d*U+D;if((!v||v(this._convertFromCellCoord(D),this._convertFromCellCoord(U),this._convertFromCellCoord(D+1),this._convertFromCellCoord(U+1)))&&f.call(this,r,e,s,c,j,p,y,v))return}},qr.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},qr.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},qr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,e=3+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var f=new Int32Array(e+s+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var p=e,y=0;y<r.length;y++){var v=r[y];f[3+y]=p,f.set(v,p),p+=v.length}return f[3+r.length]=p,f.set(this.keys,p),f[3+r.length+1]=p+=this.keys.length,f.set(this.bboxes,p),p+=this.bboxes.length,f.buffer};const{ImageData:Pl,ImageBitmap:ya}=R,Dl={};function Et(r,e,s={}){Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),Dl[r]={klass:e,omit:s.omit||[],shallow:s.shallow||[]}}Et("Object",Object),kl.serialize=function(r,e){const s=r.toArrayBuffer();return e&&e.push(s),{buffer:s}},kl.deserialize=function(r){return new kl(r.buffer)},Et("Grid",kl),Et("Color",fi),Et("Error",Error),Et("ResolvedImage",Sn),Et("StylePropertyFunction",da),Et("StyleExpression",Eh,{omit:["_evaluator"]}),Et("ZoomDependentExpression",Sh),Et("ZoomConstantExpression",Cl),Et("CompoundExpression",dn,{omit:["_evaluate"]});for(const r in Zn)Zn[r]._classRegistryKey||Et(`Expression_${r}`,Zn[r]);function xa(r){return r&&typeof ArrayBuffer!="undefined"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Yd(r){return ya&&r instanceof ya}function zl(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(xa(r)||Yd(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const s=r;return e&&e.push(s.buffer),s}if(r instanceof Pl)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const s=[];for(const c of r)s.push(zl(c,e));return s}if(typeof r=="object"){const s=r.constructor,c=s._classRegistryKey;if(!c)throw new Error("can't serialize object of unregistered class");const f=s.serialize?s.serialize(r,e):{};if(!s.serialize){for(const p in r){if(!r.hasOwnProperty(p)||Dl[c].omit.indexOf(p)>=0)continue;const y=r[p];f[p]=Dl[c].shallow.indexOf(p)>=0?y:zl(y,e)}r instanceof Error&&(f.message=r.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(f.$name=c),f}throw new Error("can't serialize object of type "+typeof r)}function co(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||xa(r)||Yd(r)||ArrayBuffer.isView(r)||r instanceof Pl)return r;if(Array.isArray(r))return r.map(co);if(typeof r=="object"){const e=r.$name||"Object",{klass:s}=Dl[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(r);const c=Object.create(s.prototype);for(const f of Object.keys(r)){if(f==="$name")continue;const p=r[f];c[f]=Dl[e].shallow.indexOf(f)>=0?p:co(p)}return c}throw new Error("can't deserialize object of type "+typeof r)}class m{constructor(){this.first=!0}update(e,s){const c=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=c,!0))}}const n=r=>r>=1536&&r<=1791,h=r=>r>=1872&&r<=1919,_=r=>r>=2208&&r<=2303,x=r=>r>=11904&&r<=12031,b=r=>r>=12032&&r<=12255,E=r=>r>=12272&&r<=12287,I=r=>r>=12288&&r<=12351,z=r=>r>=12352&&r<=12447,L=r=>r>=12448&&r<=12543,O=r=>r>=12544&&r<=12591,N=r=>r>=12704&&r<=12735,$=r=>r>=12736&&r<=12783,Q=r=>r>=12784&&r<=12799,H=r=>r>=12800&&r<=13055,J=r=>r>=13056&&r<=13311,he=r=>r>=13312&&r<=19903,Y=r=>r>=19968&&r<=40959,oe=r=>r>=40960&&r<=42127,ae=r=>r>=42128&&r<=42191,ne=r=>r>=44032&&r<=55215,se=r=>r>=63744&&r<=64255,de=r=>r>=64336&&r<=65023,Me=r=>r>=65040&&r<=65055,Fe=r=>r>=65072&&r<=65103,ht=r=>r>=65104&&r<=65135,et=r=>r>=65136&&r<=65279,Ye=r=>r>=65280&&r<=65519;function Ue(r){for(const e of r)if(Ge(e.charCodeAt(0)))return!0;return!1}function De(r){for(const e of r)if(!Ke(e.charCodeAt(0)))return!1;return!0}function Ke(r){return!(n(r)||h(r)||_(r)||de(r)||et(r))}function Ge(r){return!(r!==746&&r!==747&&(r<4352||!(N(r)||O(r)||Fe(r)&&!(r>=65097&&r<=65103)||se(r)||J(r)||x(r)||$(r)||!(!I(r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||he(r)||Y(r)||H(r)||(e=>e>=12592&&e<=12687)(r)||(e=>e>=43360&&e<=43391)(r)||(e=>e>=55216&&e<=55295)(r)||(e=>e>=4352&&e<=4607)(r)||ne(r)||z(r)||E(r)||(e=>e>=12688&&e<=12703)(r)||b(r)||Q(r)||L(r)&&r!==12540||!(!Ye(r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!ht(r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||(e=>e>=5120&&e<=5759)(r)||(e=>e>=6320&&e<=6399)(r)||Me(r)||(e=>e>=19904&&e<=19967)(r)||oe(r)||ae(r))))}function kt(r){return!(Ge(r)||function(e){return!!((s=>s>=128&&s<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(s=>s>=8192&&s<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(s=>s>=8448&&s<=8527)(e)||(s=>s>=8528&&s<=8591)(e)||(s=>s>=8960&&s<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(s=>s>=9216&&s<=9279)(e)&&e!==9251||(s=>s>=9280&&s<=9311)(e)||(s=>s>=9312&&s<=9471)(e)||(s=>s>=9632&&s<=9727)(e)||(s=>s>=9728&&s<=9983)(e)&&!(e>=9754&&e<=9759)||(s=>s>=11008&&s<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||I(e)||L(e)||(s=>s>=57344&&s<=63743)(e)||Fe(e)||ht(e)||Ye(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function Ot(r){return r>=1424&&r<=2303||de(r)||et(r)}function Ht(r,e){return!(!e&&Ot(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||(s=>s>=6016&&s<=6143)(r))}function ut(r){for(const e of r)if(Ot(e.charCodeAt(0)))return!0;return!1}const zt="deferred",Vt="loading",wi="loaded";let Pi=null,jt="unavailable",Jt=null;const ji=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(jt="error"),Pi&&Pi(r)};function hr(){rn.fire(new Js("pluginStateChange",{pluginStatus:jt,pluginURL:Jt}))}const rn=new eo,In=function(){return jt},Hn=function(){if(jt!==zt||!Jt)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");jt=Vt,hr(),Jt&&ll({url:Jt},r=>{r?ji(r):(jt=wi,hr())})},ci={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>jt===wi||ci.applyArabicShaping!=null,isLoading:()=>jt===Vt,setState(r){jt=r.pluginStatus,Jt=r.pluginURL},isParsed:()=>ci.applyArabicShaping!=null&&ci.processBidirectionalText!=null&&ci.processStyledBidirectionalText!=null,getPluginURL:()=>Jt};class $t{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new m,this.transition={},this.pitch=0)}isSupportedScript(e){return function(s,c){for(const f of s)if(!Ht(f.charCodeAt(0),c))return!1;return!0}(e,ci.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,s=e-Math.floor(e),c=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class ni{constructor(e,s){this.property=e,this.value=s,this.expression=function(c,f){if(Uc(c))return new da(c,f);if(fa(c)){const p=Nd(c,f);if(p.result==="error")throw new Error(p.value.map(y=>`${y.key}: ${y.message}`).join(", "));return p.value}{let p=c;return typeof c=="string"&&f.type==="color"&&(p=fi.parse(c)),{kind:"constant",evaluate:()=>p}}}(s===void 0?e.specification.default:s,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,s,c){return this.property.possiblyEvaluate(this,e,s,c)}}class Ji{constructor(e){this.property=e,this.value=new ni(e,void 0)}transitioned(e,s){return new Oi(this.property,this.value,s,dt({},e.transition,this.transition),e.now)}untransitioned(){return new Oi(this.property,this.value,null,{},0)}}class pn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return $r(this._values[e].value.value)}setValue(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new Ji(this._values[e].property)),this._values[e].value=new ni(this._values[e].property,s===null?void 0:$r(s))}getTransition(e){return $r(this._values[e].transition)}setTransition(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new Ji(this._values[e].property)),this._values[e].transition=$r(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(e[s]=c);const f=this.getTransition(s);f!==void 0&&(e[`${s}-transition`]=f)}return e}transitioned(e,s){const c=new mn(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(e,s._values[f]);return c}untransitioned(){const e=new mn(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class Oi{constructor(e,s,c,f,p){const y=f.delay||0,v=f.duration||0;p=p||0,this.property=e,this.value=s,this.begin=p+y,this.end=this.begin+v,e.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(e,s,c){const f=e.now||0,p=this.value.possiblyEvaluate(e,s,c),y=this.prior;if(y){if(f>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(f<this.begin)return y.possiblyEvaluate(e,s,c);{const v=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,s,c),p,rt(v))}}return p}}class mn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,c){const f=new Fo(this._properties);for(const p of Object.keys(this._values))f._values[p]=this._values[p].possiblyEvaluate(e,s,c);return f}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Rl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return $r(this._values[e].value)}setValue(e,s){this._values[e]=new ni(this._values[e].property,s===null?void 0:$r(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(e[s]=c)}return e}possiblyEvaluate(e,s,c){const f=new Fo(this._properties);for(const p of Object.keys(this._values))f._values[p]=this._values[p].possiblyEvaluate(e,s,c);return f}}class nn{constructor(e,s,c){this.property=e,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,c,f){return this.property.evaluate(this.value,this.parameters,e,s,c,f)}}class Fo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class At{constructor(e){this.specification=e}possiblyEvaluate(e,s){return e.expression.evaluate(s)}interpolate(e,s,c){const f=Ic[this.specification.type];return f?f(e,s,c):e}}class Rt{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,c,f){return new nn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(s,null,{},c,f)}:e.expression,s)}interpolate(e,s,c){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new nn(this,{kind:"constant",value:void 0},e.parameters);const f=Ic[this.specification.type];return f?new nn(this,{kind:"constant",value:f(e.value.value,s.value.value,c)},e.parameters):e}evaluate(e,s,c,f,p,y){return e.kind==="constant"?e.value:e.evaluate(s,c,f,p,y)}}class vr extends Rt{possiblyEvaluate(e,s,c,f){if(e.value===void 0)return new nn(this,{kind:"constant",value:void 0},s);if(e.expression.kind==="constant"){const p=e.expression.evaluate(s,null,{},c,f),y=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,v=this._calculate(y,y,y,s);return new nn(this,{kind:"constant",value:v},s)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:s.zoom-1}),e.expression.evaluate({zoom:s.zoom}),e.expression.evaluate({zoom:s.zoom+1}),s);return new nn(this,{kind:"constant",value:p},s)}return new nn(this,e.expression,s)}evaluate(e,s,c,f,p,y){if(e.kind==="source"){const v=e.evaluate(s,c,f,p,y);return this._calculate(v,v,v,s)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(s.zoom)-1},c,f),e.evaluate({zoom:Math.floor(s.zoom)},c,f),e.evaluate({zoom:Math.floor(s.zoom)+1},c,f),s):e.value}_calculate(e,s,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:s,other:c}:{from:c,to:s,other:e}}interpolate(e){return e}}class Lo{constructor(e){this.specification=e}possiblyEvaluate(e,s,c,f){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(s,null,{},c,f);return this._calculate(p,p,p,s)}return this._calculate(e.expression.evaluate(new $t(Math.floor(s.zoom-1),s)),e.expression.evaluate(new $t(Math.floor(s.zoom),s)),e.expression.evaluate(new $t(Math.floor(s.zoom+1),s)),s)}}_calculate(e,s,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:c,to:s}}interpolate(e){return e}}class uo{constructor(e){this.specification=e}possiblyEvaluate(e,s,c,f){return!!e.expression.evaluate(s,null,{},c,f)}interpolate(){return!1}}class Mr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in e){const c=e[s];c.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new ni(c,void 0),p=this.defaultTransitionablePropertyValues[s]=new Ji(c);this.defaultTransitioningPropertyValues[s]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate({})}}}function Kx(r,e){return 256*(r=Xe(Math.floor(r),0,255))+Xe(Math.floor(e),0,255)}Et("DataDrivenProperty",Rt),Et("DataConstantProperty",At),Et("CrossFadedDataDrivenProperty",vr),Et("CrossFadedProperty",Lo),Et("ColorRampProperty",uo);const xA={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bh{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class sr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Yi(r,e=1){let s=0,c=0;return{members:r.map(f=>{const p=xA[f.type].BYTES_PER_ELEMENT,y=s=Yx(s,Math.max(e,p)),v=f.components||1;return c=Math.max(c,p),s+=p*v,{name:f.name,type:f.type,components:v,offset:y}}),size:Yx(s,Math.max(c,e)),alignment:e}}function Yx(r,e){return Math.ceil(r/e)*e}class Kc extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){const f=2*e;return this.int16[f+0]=s,this.int16[f+1]=c,e}}Kc.prototype.bytesPerElement=4,Et("StructArrayLayout2i4",Kc);class Yc extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,c,f)}emplace(e,s,c,f,p){const y=4*e;return this.int16[y+0]=s,this.int16[y+1]=c,this.int16[y+2]=f,this.int16[y+3]=p,e}}Yc.prototype.bytesPerElement=8,Et("StructArrayLayout4i8",Yc);class P_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,p,y,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,s,c,f,p,y,v)}emplace(e,s,c,f,p,y,v,T){const A=6*e,M=12*e,P=3*e;return this.int16[A+0]=s,this.int16[A+1]=c,this.uint8[M+4]=f,this.uint8[M+5]=p,this.uint8[M+6]=y,this.uint8[M+7]=v,this.float32[P+2]=T,e}}P_.prototype.bytesPerElement=12,Et("StructArrayLayout2i4ub1f12",P_);class Qc extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,c)}emplace(e,s,c,f){const p=3*e;return this.float32[p+0]=s,this.float32[p+1]=c,this.float32[p+2]=f,e}}Qc.prototype.bytesPerElement=12,Et("StructArrayLayout3f12",Qc);class va extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,p,y,v,T,A,M){const P=this.length;return this.resize(P+1),this.emplace(P,e,s,c,f,p,y,v,T,A,M)}emplace(e,s,c,f,p,y,v,T,A,M,P){const D=10*e;return this.uint16[D+0]=s,this.uint16[D+1]=c,this.uint16[D+2]=f,this.uint16[D+3]=p,this.uint16[D+4]=y,this.uint16[D+5]=v,this.uint16[D+6]=T,this.uint16[D+7]=A,this.uint16[D+8]=M,this.uint16[D+9]=P,e}}va.prototype.bytesPerElement=20,Et("StructArrayLayout10ui20",va);class Qd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,p,y,v,T){const A=this.length;return this.resize(A+1),this.emplace(A,e,s,c,f,p,y,v,T)}emplace(e,s,c,f,p,y,v,T,A){const M=8*e;return this.uint16[M+0]=s,this.uint16[M+1]=c,this.uint16[M+2]=f,this.uint16[M+3]=p,this.uint16[M+4]=y,this.uint16[M+5]=v,this.uint16[M+6]=T,this.uint16[M+7]=A,e}}Qd.prototype.bytesPerElement=16,Et("StructArrayLayout8ui16",Qd);class D_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,p,y,v,T,A,M,P,D,U,j,G,K){const ie=this.length;return this.resize(ie+1),this.emplace(ie,e,s,c,f,p,y,v,T,A,M,P,D,U,j,G,K)}emplace(e,s,c,f,p,y,v,T,A,M,P,D,U,j,G,K,ie){const le=16*e;return this.int16[le+0]=s,this.int16[le+1]=c,this.int16[le+2]=f,this.int16[le+3]=p,this.uint16[le+4]=y,this.uint16[le+5]=v,this.uint16[le+6]=T,this.uint16[le+7]=A,this.int16[le+8]=M,this.int16[le+9]=P,this.int16[le+10]=D,this.int16[le+11]=U,this.int16[le+12]=j,this.int16[le+13]=G,this.int16[le+14]=K,this.int16[le+15]=ie,e}}D_.prototype.bytesPerElement=32,Et("StructArrayLayout4i4ui4i4i32",D_);class z_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}z_.prototype.bytesPerElement=4,Et("StructArrayLayout1ul4",z_);class R_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,p,y,v,T,A,M,P,D,U){const j=this.length;return this.resize(j+1),this.emplace(j,e,s,c,f,p,y,v,T,A,M,P,D,U)}emplace(e,s,c,f,p,y,v,T,A,M,P,D,U,j){const G=20*e,K=10*e;return this.int16[G+0]=s,this.int16[G+1]=c,this.int16[G+2]=f,this.int16[G+3]=p,this.int16[G+4]=y,this.float32[K+3]=v,this.float32[K+4]=T,this.float32[K+5]=A,this.float32[K+6]=M,this.int16[G+14]=P,this.uint32[K+8]=D,this.uint16[G+18]=U,this.uint16[G+19]=j,e}}R_.prototype.bytesPerElement=40,Et("StructArrayLayout5i4f1i1ul2ui40",R_);class Jd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,p,y,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,s,c,f,p,y,v)}emplace(e,s,c,f,p,y,v,T){const A=8*e;return this.int16[A+0]=s,this.int16[A+1]=c,this.int16[A+2]=f,this.int16[A+4]=p,this.int16[A+5]=y,this.int16[A+6]=v,this.int16[A+7]=T,e}}Jd.prototype.bytesPerElement=16,Et("StructArrayLayout3i2i2i16",Jd);class F_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,c,f,p)}emplace(e,s,c,f,p,y){const v=4*e,T=8*e;return this.float32[v+0]=s,this.float32[v+1]=c,this.float32[v+2]=f,this.int16[T+6]=p,this.int16[T+7]=y,e}}F_.prototype.bytesPerElement=16,Et("StructArrayLayout2f1f2i16",F_);class L_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,c,f)}emplace(e,s,c,f,p){const y=12*e,v=3*e;return this.uint8[y+0]=s,this.uint8[y+1]=c,this.float32[v+1]=f,this.float32[v+2]=p,e}}L_.prototype.bytesPerElement=12,Et("StructArrayLayout2ub2f12",L_);class Xn extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,c)}emplace(e,s,c,f){const p=3*e;return this.uint16[p+0]=s,this.uint16[p+1]=c,this.uint16[p+2]=f,e}}Xn.prototype.bytesPerElement=6,Et("StructArrayLayout3ui6",Xn);class O_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,p,y,v,T,A,M,P,D,U,j,G,K,ie,le,ge,we,Ee){const Se=this.length;return this.resize(Se+1),this.emplace(Se,e,s,c,f,p,y,v,T,A,M,P,D,U,j,G,K,ie,le,ge,we,Ee)}emplace(e,s,c,f,p,y,v,T,A,M,P,D,U,j,G,K,ie,le,ge,we,Ee,Se){const Ve=30*e,Ne=15*e,ft=60*e;return this.int16[Ve+0]=s,this.int16[Ve+1]=c,this.int16[Ve+2]=f,this.float32[Ne+2]=p,this.float32[Ne+3]=y,this.uint16[Ve+8]=v,this.uint16[Ve+9]=T,this.uint32[Ne+5]=A,this.uint32[Ne+6]=M,this.uint32[Ne+7]=P,this.uint16[Ve+16]=D,this.uint16[Ve+17]=U,this.uint16[Ve+18]=j,this.float32[Ne+10]=G,this.float32[Ne+11]=K,this.uint8[ft+48]=ie,this.uint8[ft+49]=le,this.uint8[ft+50]=ge,this.uint32[Ne+13]=we,this.int16[Ve+28]=Ee,this.uint8[ft+58]=Se,e}}O_.prototype.bytesPerElement=60,Et("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",O_);class B_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,p,y,v,T,A,M,P,D,U,j,G,K,ie,le,ge,we,Ee,Se,Ve,Ne,ft,ot,je,at,pt,He){const vt=this.length;return this.resize(vt+1),this.emplace(vt,e,s,c,f,p,y,v,T,A,M,P,D,U,j,G,K,ie,le,ge,we,Ee,Se,Ve,Ne,ft,ot,je,at,pt,He)}emplace(e,s,c,f,p,y,v,T,A,M,P,D,U,j,G,K,ie,le,ge,we,Ee,Se,Ve,Ne,ft,ot,je,at,pt,He,vt){const Ct=38*e,oi=19*e;return this.int16[Ct+0]=s,this.int16[Ct+1]=c,this.int16[Ct+2]=f,this.float32[oi+2]=p,this.float32[oi+3]=y,this.int16[Ct+8]=v,this.int16[Ct+9]=T,this.int16[Ct+10]=A,this.int16[Ct+11]=M,this.int16[Ct+12]=P,this.int16[Ct+13]=D,this.uint16[Ct+14]=U,this.uint16[Ct+15]=j,this.uint16[Ct+16]=G,this.uint16[Ct+17]=K,this.uint16[Ct+18]=ie,this.uint16[Ct+19]=le,this.uint16[Ct+20]=ge,this.uint16[Ct+21]=we,this.uint16[Ct+22]=Ee,this.uint16[Ct+23]=Se,this.uint16[Ct+24]=Ve,this.uint16[Ct+25]=Ne,this.uint16[Ct+26]=ft,this.uint16[Ct+27]=ot,this.uint16[Ct+28]=je,this.uint32[oi+15]=at,this.float32[oi+16]=pt,this.float32[oi+17]=He,this.float32[oi+18]=vt,e}}B_.prototype.bytesPerElement=76,Et("StructArrayLayout3i2f6i15ui1ul3f76",B_);class ep extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}ep.prototype.bytesPerElement=4,Et("StructArrayLayout1f4",ep);class U_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,c)}emplace(e,s,c,f){const p=3*e;return this.int16[p+0]=s,this.int16[p+1]=c,this.int16[p+2]=f,e}}U_.prototype.bytesPerElement=6,Et("StructArrayLayout3i6",U_);class Uh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f,p,y,v){const T=this.length;return this.resize(T+1),this.emplace(T,e,s,c,f,p,y,v)}emplace(e,s,c,f,p,y,v,T){const A=7*e;return this.float32[A+0]=s,this.float32[A+1]=c,this.float32[A+2]=f,this.float32[A+3]=p,this.float32[A+4]=y,this.float32[A+5]=v,this.float32[A+6]=T,e}}Uh.prototype.bytesPerElement=28,Et("StructArrayLayout7f28",Uh);class N_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,c,f)}emplace(e,s,c,f,p){const y=6*e;return this.uint32[3*e+0]=s,this.uint16[y+2]=c,this.uint16[y+3]=f,this.uint16[y+4]=p,e}}N_.prototype.bytesPerElement=12,Et("StructArrayLayout1ul3ui12",N_);class ba extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){const f=2*e;return this.uint16[f+0]=s,this.uint16[f+1]=c,e}}ba.prototype.bytesPerElement=4,Et("StructArrayLayout2ui4",ba);class tp extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}tp.prototype.bytesPerElement=2,Et("StructArrayLayout1ui2",tp);class ip extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,s)}emplace(e,s,c){const f=2*e;return this.float32[f+0]=s,this.float32[f+1]=c,e}}ip.prototype.bytesPerElement=8,Et("StructArrayLayout2f8",ip);class j_ extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,c,f)}emplace(e,s,c,f,p){const y=4*e;return this.float32[y+0]=s,this.float32[y+1]=c,this.float32[y+2]=f,this.float32[y+3]=p,e}}j_.prototype.bytesPerElement=16,Et("StructArrayLayout4f16",j_);class Qx extends Bh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Qx.prototype.size=40;class V_ extends R_{get(e){return new Qx(this,e)}}Et("CollisionBoxArray",V_);class Jx extends Bh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Jx.prototype.size=60;class ev extends O_{get(e){return new Jx(this,e)}}Et("PlacedSymbolArray",ev);class tv extends Bh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}tv.prototype.size=76;class iv extends B_{get(e){return new tv(this,e)}}Et("SymbolInstanceArray",iv);class rv extends ep{getoffsetX(e){return this.float32[1*e+0]}}Et("GlyphOffsetArray",rv);class nv extends U_{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Et("SymbolLineVertexArray",nv);class sv extends Bh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sv.prototype.size=12;class ov extends N_{get(e){return new sv(this,e)}}Et("FeatureIndexArray",ov);class av extends Bh{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}av.prototype.size=4;class lv extends ba{get(e){return new av(this,e)}}Et("FillExtrusionCentroidArray",lv);const vA=Yi([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),bA=Yi([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var cv=la(function(r){r.exports=function(e,s){var c,f,p,y,v,T,A,M;for(f=e.length-(c=3&e.length),p=s,v=3432918353,T=461845907,M=0;M<f;)A=255&e.charCodeAt(M)|(255&e.charCodeAt(++M))<<8|(255&e.charCodeAt(++M))<<16|(255&e.charCodeAt(++M))<<24,++M,p=27492+(65535&(y=5*(65535&(p=(p^=A=(65535&(A=(A=(65535&A)*v+(((A>>>16)*v&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(A=0,c){case 3:A^=(255&e.charCodeAt(M+2))<<16;case 2:A^=(255&e.charCodeAt(M+1))<<8;case 1:p^=A=(65535&(A=(A=(65535&(A^=255&e.charCodeAt(M)))*v+(((A>>>16)*v&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295}return p^=e.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}}),wA=la(function(r){r.exports=function(e,s){for(var c,f=e.length,p=s^f,y=0;f>=4;)c=1540483477*(65535&(c=255&e.charCodeAt(y)|(255&e.charCodeAt(++y))<<8|(255&e.charCodeAt(++y))<<16|(255&e.charCodeAt(++y))<<24))+((1540483477*(c>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:p^=(255&e.charCodeAt(y+2))<<16;case 2:p^=(255&e.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&e.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}}),Nh=cv,TA=wA;Nh.murmur3=cv,Nh.murmur2=TA;class rp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,c,f){this.ids.push(uv(e)),this.positions.push(s,c,f)}getPositions(e){const s=uv(e);let c=0,f=this.ids.length-1;for(;c<f;){const y=c+f>>1;this.ids[y]>=s?f=y:c=y+1}const p=[];for(;this.ids[c]===s;)p.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return p}static serialize(e,s){const c=new Float64Array(e.ids),f=new Uint32Array(e.positions);return $_(c,f,0,c.length-1),s&&s.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(e){const s=new rp;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function uv(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Nh(String(r))}function $_(r,e,s,c){for(;s<c;){const f=r[s+c>>1];let p=s-1,y=c+1;for(;;){do p++;while(r[p]<f);do y--;while(r[y]>f);if(p>=y)break;np(r,p,y),np(e,3*p,3*y),np(e,3*p+1,3*y+1),np(e,3*p+2,3*y+2)}y-s<c-y?($_(r,e,s,y),s=y+1):($_(r,e,y+1,c),c=y)}}function np(r,e,s){const c=r[e];r[e]=r[s],r[s]=c}Et("FeaturePositionMap",rp);class Oo{constructor(e,s){this.gl=e.gl,this.location=s}}class sp extends Oo{constructor(e,s){super(e,s),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class hv extends Oo{constructor(e,s){super(e,s),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class fv extends Oo{constructor(e,s){super(e,s),this.current=fi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const EA=new Float32Array(16),SA=new Float32Array(9),AA=new Float32Array(4);function G_(r){return[Kx(255*r.r,255*r.g),Kx(255*r.b,255*r.a)]}class jh{constructor(e,s,c){this.value=e,this.uniformNames=s.map(f=>`u_${f}`),this.type=c}setUniform(e,s,c){e.set(c.constantOr(this.value))}getBinding(e,s,c){return this.type==="color"?new fv(e,s):new sp(e,s)}}class Jc{constructor(e,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=s.tl.concat(s.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,s,c,f){const p=f==="u_pattern_to"||f==="u_dash_to"?this.patternTo:f==="u_pattern_from"||f==="u_dash_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&e.set(p)}getBinding(e,s,c){return c==="u_pattern_from"||c==="u_pattern_to"||c==="u_dash_from"||c==="u_dash_to"?new hv(e,s):new sp(e,s)}}class Bo{constructor(e,s,c,f){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(p=>({name:`a_${p}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,s,c,f,p,y){const v=this.paintVertexArray.length,T=this.expression.evaluate(new $t(0),s,{},p,f,y);this.paintVertexArray.resize(e),this._setPaintValue(v,e,T)}updatePaintArray(e,s,c,f,p){const y=this.expression.evaluate({zoom:0},c,f,void 0,p);this._setPaintValue(e,s,y)}_setPaintValue(e,s,c){if(this.type==="color"){const f=G_(c);for(let p=e;p<s;p++)this.paintVertexArray.emplace(p,f[0],f[1])}else{for(let f=e;f<s;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bs{constructor(e,s,c,f,p,y){this.expression=e,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=c,this.useIntegerZoom=f,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,s,c,f,p,y){const v=this.expression.evaluate(new $t(this.zoom),s,{},p,f,y),T=this.expression.evaluate(new $t(this.zoom+1),s,{},p,f,y),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,v,T)}updatePaintArray(e,s,c,f,p){const y=this.expression.evaluate({zoom:this.zoom},c,f,void 0,p),v=this.expression.evaluate({zoom:this.zoom+1},c,f,void 0,p);this._setPaintValue(e,s,y,v)}_setPaintValue(e,s,c,f){if(this.type==="color"){const p=G_(c),y=G_(f);for(let v=e;v<s;v++)this.paintVertexArray.emplace(v,p[0],p[1],y[0],y[1])}else{for(let p=e;p<s;p++)this.paintVertexArray.emplace(p,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,f=Xe(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);e.set(f)}getBinding(e,s,c){return new sp(e,s)}}class wa{constructor(e,s,c,f,p,y,v){this.expression=e,this.type=c,this.useIntegerZoom=f,this.zoom=p,this.layerId=v,this.paintVertexAttributes=(c==="array"?bA:vA).members;for(let T=0;T<s.length;++T);this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(e,s,c){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(e,s,c,f,p,y){this._setPaintValues(e,s,c.patterns&&c.patterns[this.layerId],y)}_setPaintValues(e,s,c,f){if(!f||!c)return;const{min:p,mid:y,max:v}=c,T=f[p],A=f[y],M=f[v];if(T&&A&&M)for(let P=e;P<s;P++)this._setPaintValue(this.zoomInPaintVertexArray,P,A,T),this._setPaintValue(this.zoomOutPaintVertexArray,P,A,M)}_setPaintValue(e,s,c,f){e.emplace(s,c.tl[0],c.tl[1],c.br[0],c.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],c.pixelRatio,f.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Uo{constructor(e,s,c=()=>!0){this.binders={},this._buffers=[];const f=[];for(const p in e.paint._values){if(!c(p))continue;const y=e.paint.get(p);if(!(y instanceof nn&&ha(y.property.specification)))continue;const v=IA(p,e.type),T=y.value,A=y.property.specification.type,M=y.property.useIntegerZoom,P=y.property.specification["property-type"],D=P==="cross-faded"||P==="cross-faded-data-driven",U=String(p)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(T.kind!=="constant"||U)if(T.kind==="source"||U||D){const j=dv(p,A,"source");this.binders[p]=D?new wa(T,v,A,M,s,j,e.id):new Bo(T,v,A,j),f.push(`/a_${p}`)}else{const j=dv(p,A,"composite");this.binders[p]=new Bs(T,v,A,M,s,j),f.push(`/z_${p}`)}else this.binders[p]=D?new Jc(T.value,v):new jh(T.value,v,A),f.push(`/u_${p}`)}this.cacheKey=f.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof Bo||s instanceof Bs?s.maxValue:0}populatePaintArrays(e,s,c,f,p,y){for(const v in this.binders){const T=this.binders[v];(T instanceof Bo||T instanceof Bs||T instanceof wa)&&T.populatePaintArray(e,s,c,f,p,y)}}setConstantPatternPositions(e,s){for(const c in this.binders){const f=this.binders[c];f instanceof Jc&&f.setConstantPatternPositions(e,s)}}updatePaintArrays(e,s,c,f,p,y){let v=!1;for(const T in e){const A=s.getPositions(T);for(const M of A){const P=c.feature(M.index);for(const D in this.binders){const U=this.binders[D];if((U instanceof Bo||U instanceof Bs||U instanceof wa)&&U.expression.isStateDependent===!0){const j=f.paint.get(D);U.expression=j.value,U.updatePaintArray(M.start,M.end,P,e[T],p,y),v=!0}}}}return v}defines(){const e=[];for(const s in this.binders){const c=this.binders[s];(c instanceof jh||c instanceof Jc)&&e.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Bo||c instanceof Bs||c instanceof wa)for(let f=0;f<c.paintVertexAttributes.length;f++)e.push(c.paintVertexAttributes[f].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof jh||c instanceof Jc||c instanceof Bs)for(const f of c.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,s){const c=[];for(const f in this.binders){const p=this.binders[f];if(p instanceof jh||p instanceof Jc||p instanceof Bs){for(const y of p.uniformNames)if(s[y]){const v=p.getBinding(e,s[y],y);c.push({name:y,property:f,binding:v})}}}return c}setUniforms(e,s,c,f){for(const{name:p,property:y,binding:v}of s)this.binders[y].setUniform(v,f,c.get(y),p)}updatePaintBuffers(e){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(e&&c instanceof wa){const f=e.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(c instanceof Bo||c instanceof Bs)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(e){for(const s in this.binders){const c=this.binders[s];(c instanceof Bo||c instanceof Bs||c instanceof wa)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof Bo||s instanceof Bs||s instanceof wa)&&s.destroy()}}}class Fl{constructor(e,s,c=()=>!0){this.programConfigurations={};for(const f of e)this.programConfigurations[f.id]=new Uo(f,s,c);this.needsUpload=!1,this._featureMap=new rp,this._bufferOffset=0}populatePaintArrays(e,s,c,f,p,y,v){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,s,f,p,y,v);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,c,f,p){for(const y of c)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,s,y,f,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const CA={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function IA(r,e){return CA[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const MA={"line-pattern":{source:va,composite:va},"fill-pattern":{source:va,composite:va},"fill-extrusion-pattern":{source:va,composite:va},"line-dasharray":{source:Qd,composite:Qd}},kA={color:{source:ip,composite:j_},number:{source:ep,composite:ip}};function dv(r,e,s){const c=MA[r];return c&&c[s]||kA[e][s]}Et("ConstantBinder",jh),Et("CrossFadedConstantBinder",Jc),Et("SourceExpressionBinder",Bo),Et("CrossFadedCompositeBinder",wa),Et("CompositeExpressionBinder",Bs),Et("ProgramConfiguration",Uo,{omit:["_buffers"]}),Et("ProgramConfigurationSet",Fl);const op="-transition";class Us extends eo{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),s.layout&&(this._unevaluatedLayout=new Rl(s.layout)),s.paint)){this._transitionablePaint=new pn(s.paint);for(const c in e.paint)this.setPaintProperty(c,e.paint[c],{validate:!1});for(const c in e.layout)this.setLayoutProperty(c,e.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fo(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s,c={}){s!=null&&this._validate(k_,`layers.${this.id}.layout.${e}`,e,s,c)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return hn(e,op)?this._transitionablePaint.getTransition(e.slice(0,-op.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,c={}){if(s!=null&&this._validate(Oh,`layers.${this.id}.paint.${e}`,e,s,c))return!1;if(hn(e,op))return this._transitionablePaint.setTransition(e.slice(0,-op.length),s||void 0),!1;{const f=this._transitionablePaint._values[e],p=f.property.specification["property-type"]==="cross-faded-data-driven",y=f.value.isDataDriven(),v=f.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||y||p||this._handleOverridablePaintPropertyUpdate(e,v,T)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,s,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Tn(e,(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}_validate(e,s,c,f,p={}){return(!p||p.validate!==!1)&&Kd(this,e.call(_a,{key:s,layerType:this.type,objectKey:c,value:f,styleSpec:Be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof nn&&ha(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Zc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const PA=Yi([{name:"a_pos",components:2,type:"Int16"}],4),{members:DA}=PA;class or{constructor(e=[]){this.segments=e}prepareSegment(e,s,c,f){let p=this.segments[this.segments.length-1];return e>or.MAX_VERTEX_ARRAY_LENGTH&&pi(`Max vertices per segment is ${or.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>or.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==f)&&(p={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},f!==void 0&&(p.sortKey=f),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,c,f){return new or([{vertexOffset:e,primitiveOffset:s,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}or.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Et("SegmentVector",or);var ti=8192;class Ll{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ci?new Ci(e.lng,e.lat):Ci.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ci?new Ci(e.lng,e.lat):Ci.convert(e),this}extend(e){const s=this._sw,c=this._ne;let f,p;if(e instanceof Ci)f=e,p=e;else{if(!(e instanceof Ll))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ll.convert(e)):this.extend(Ci.convert(e)):this;if(f=e._sw,p=e._ne,!f||!p)return this}return s||c?(s.lng=Math.min(f.lng,s.lng),s.lat=Math.min(f.lat,s.lat),c.lng=Math.max(p.lng,c.lng),c.lat=Math.max(p.lat,c.lat)):(this._sw=new Ci(f.lng,f.lat),this._ne=new Ci(p.lng,p.lat)),this}getCenter(){return new Ci((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ci(this.getWest(),this.getNorth())}getSouthEast(){return new Ci(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:c}=Ci.convert(e);let f=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}static convert(e){return!e||e instanceof Ll?e:new Ll(e)}}const pv=63710088e-1;class Ci{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ci(ve(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,c=this.lat*s,f=e.lat*s,p=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((e.lng-this.lng)*s);return pv*Math.acos(Math.min(p,1))}toBounds(e=0){const s=360*e/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new Ll(new Ci(this.lng-c,this.lat-s),new Ci(this.lng+c,this.lat+s))}static convert(e){if(e instanceof Ci)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ci(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ci(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const mv=2*Math.PI*pv;function _v(r){return mv*Math.cos(r*Math.PI/180)}function eu(r){return(180+r)/360}function tu(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Ns(r,e){return r/_v(e)}function No(r){return 360*r-180}function _s(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function gv(r,e){return r*_v(_s(e))}const ho=85.051129;class ap{constructor(e,s,c=0){this.x=+e,this.y=+s,this.z=+c}static fromLngLat(e,s=0){const c=Ci.convert(e);return new ap(eu(c.lng),tu(c.lat),Ns(s,c.lat))}toLngLat(){return new Ci(No(this.x),_s(this.y))}toAltitude(){return gv(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/mv*(e=_s(this.y),1/Math.cos(e*Math.PI/180));var e}}function q_(r,e,s,c,f,p,y,v,T){const A=(e+c)/2,M=(s+f)/2,P=new k(A,M);v(P),function(D,U,j,G,K,ie){const le=j-K,ge=G-ie;return Math.abs((G-U)*le-(j-D)*ge)/Math.hypot(le,ge)}(P.x,P.y,p.x,p.y,y.x,y.y)>=T?(q_(r,e,s,A,M,p,P,v,T),q_(r,A,M,c,f,P,y,v,T)):r.push(y)}function zA(r,e,s){const c=[];let f,p,y;for(const v of r){const{x:T,y:A}=v;e(v),y?q_(c,f,p,T,A,y,v,e,s):c.push(v),f=T,p=A,y=v}return c}const Z_=Math.pow(2,14)-1,yv=-Z_-1;function RA(r,e){const s=Math.round(r.x*e),c=Math.round(r.y*e);return r.x=Xe(s,yv,Z_),r.y=Xe(c,yv,Z_),(s<r.x||s>r.x+1||c<r.y||c>r.y+1)&&pi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function jo(r,e,s){const c=r.loadGeometry(),f=r.extent,p=ti/f;if(e&&s&&s.projection.isReprojectedInTileSpace){const y=1<<e.z,{scale:v,x:T,y:A,projection:M}=s,P=D=>{const U=No((e.x+D.x/f)/y),j=_s((e.y+D.y/f)/y),G=M.project(U,j);D.x=(G.x*v-T)*f,D.y=(G.y*v-A)*f};for(let D=0;D<c.length;D++)if(r.type!==1)c[D]=zA(c[D],P,1);else{const U=[];for(const j of c[D])j.x<0||j.x>=f||j.y<0||j.y>=f||(P(j),U.push(j));c[D]=U}}for(const y of c)for(const v of y)RA(v,p);return c}function Ol(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?jo(r):[]}}function lp(r,e,s,c,f){r.emplaceBack(2*e+(c+1)/2,2*s+(f+1)/2)}class W_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Kc,this.indexArray=new Xn,this.segments=new or,this.programConfigurations=new Fl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,c,f){const p=this.layers[0],y=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:T,id:A,index:M,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,U=Ol(T,D);if(!this.layers[0]._featureFilter.filter(new $t(this.zoom),U,c))continue;const j=v?v.evaluate(U,{},c):void 0,G={id:A,properties:T.properties,type:T.type,sourceLayerIndex:P,index:M,geometry:D?U.geometry:jo(T,c,f),patterns:{},sortKey:j};y.push(G)}v&&y.sort((T,A)=>T.sortKey-A.sortKey);for(const T of y){const{geometry:A,index:M,sourceLayerIndex:P}=T,D=e[M].feature;this.addFeature(T,A,M,s.availableImages,c),s.featureIndex.insert(D,A,M,P,this.index)}}update(e,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,DA),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,c,f,p){for(const y of s)for(const v of y){const T=v.x,A=v.y;if(T<0||T>=ti||A<0||A>=ti)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=M.vertexLength;lp(this.layoutVertexArray,T,A,-1,-1),lp(this.layoutVertexArray,T,A,1,-1),lp(this.layoutVertexArray,T,A,1,1),lp(this.layoutVertexArray,T,A,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},f,p)}}function xv(r,e){for(let s=0;s<r.length;s++)if(iu(e,r[s]))return!0;for(let s=0;s<e.length;s++)if(iu(r,e[s]))return!0;return!!H_(r,e)}function FA(r,e,s){return!!iu(r,e)||!!X_(e,r,s)}function vv(r,e){if(r.length===1)return wv(e,r[0]);for(let s=0;s<e.length;s++){const c=e[s];for(let f=0;f<c.length;f++)if(iu(r,c[f]))return!0}for(let s=0;s<r.length;s++)if(wv(e,r[s]))return!0;for(let s=0;s<e.length;s++)if(H_(r,e[s]))return!0;return!1}function LA(r,e,s){if(r.length>1){if(H_(r,e))return!0;for(let c=0;c<e.length;c++)if(X_(e[c],r,s))return!0}for(let c=0;c<r.length;c++)if(X_(r[c],e,s))return!0;return!1}function H_(r,e){if(r.length===0||e.length===0)return!1;for(let s=0;s<r.length-1;s++){const c=r[s],f=r[s+1];for(let p=0;p<e.length-1;p++)if(OA(c,f,e[p],e[p+1]))return!0}return!1}function OA(r,e,s,c){return Gr(r,s,c)!==Gr(e,s,c)&&Gr(r,e,s)!==Gr(r,e,c)}function X_(r,e,s){const c=s*s;if(e.length===1)return r.distSqr(e[0])<c;for(let f=1;f<e.length;f++)if(bv(r,e[f-1],e[f])<c)return!0;return!1}function bv(r,e,s){const c=e.distSqr(s);if(c===0)return r.distSqr(e);const f=((r.x-e.x)*(s.x-e.x)+(r.y-e.y)*(s.y-e.y))/c;return r.distSqr(f<0?e:f>1?s:s.sub(e)._mult(f)._add(e))}function wv(r,e){let s,c,f,p=!1;for(let y=0;y<r.length;y++){s=r[y];for(let v=0,T=s.length-1;v<s.length;T=v++)c=s[v],f=s[T],c.y>e.y!=f.y>e.y&&e.x<(f.x-c.x)*(e.y-c.y)/(f.y-c.y)+c.x&&(p=!p)}return p}function iu(r,e){let s=!1;for(let c=0,f=r.length-1;c<r.length;f=c++){const p=r[c],y=r[f];p.y>e.y!=y.y>e.y&&e.x<(y.x-p.x)*(e.y-p.y)/(y.y-p.y)+p.x&&(s=!s)}return s}function Tv(r,e,s,c,f){for(const y of r)if(e<=y.x&&s<=y.y&&c>=y.x&&f>=y.y)return!0;const p=[new k(e,s),new k(e,f),new k(c,f),new k(c,s)];if(r.length>2){for(const y of p)if(iu(r,y))return!0}for(let y=0;y<r.length-1;y++)if(BA(r[y],r[y+1],p))return!0;return!1}function BA(r,e,s){const c=s[0],f=s[2];if(r.x<c.x&&e.x<c.x||r.x>f.x&&e.x>f.x||r.y<c.y&&e.y<c.y||r.y>f.y&&e.y>f.y)return!1;const p=Gr(r,e,s[0]);return p!==Gr(r,e,s[1])||p!==Gr(r,e,s[2])||p!==Gr(r,e,s[3])}function ru(r,e,s){const c=e.paint.get(r).value;return c.kind==="constant"?c.value:s.programConfigurations.get(e.id).getMaxValue(r)}function cp(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Ev(r,e,s,c,f){if(!e[0]&&!e[1])return r;const p=k.convert(e)._mult(f);s==="viewport"&&p._rotate(-c);const y=[];for(let v=0;v<r.length;v++)y.push(r[v].sub(p));return y}function Sv(r,e,s,c){const f=k.convert(r)._mult(c);return e==="viewport"&&f._rotate(-s),f}Et("CircleBucket",W_,{omit:["layers"]});const UA=new Mr({"circle-sort-key":new Rt(Be.layout_circle["circle-sort-key"])});var NA={paint:new Mr({"circle-radius":new Rt(Be.paint_circle["circle-radius"]),"circle-color":new Rt(Be.paint_circle["circle-color"]),"circle-blur":new Rt(Be.paint_circle["circle-blur"]),"circle-opacity":new Rt(Be.paint_circle["circle-opacity"]),"circle-translate":new At(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new At(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new At(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new At(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Rt(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Rt(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Rt(Be.paint_circle["circle-stroke-opacity"])}),layout:UA};class K_{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,c,f){const p=Math.pow(2,c),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const A=mt([],T,e),M=1/A[3]/s*p;return function(P,D,U){return P[0]=D[0]*U[0],P[1]=D[1]*U[1],P[2]=D[2]*U[2],P[3]=D[3]*U[3],P}(A,A,[M,M,f?1/A[3]:M,M])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const A=St([],Ti([],rr([],y[T[0]],y[T[1]]),rr([],y[T[2]],y[T[1]]))),M=-bt(A,y[T[1]]);return A.concat(M)});return new K_(y,v)}}class js{constructor(e,s){this.min=e,this.max=s,this.center=Qe([],lt([],this.min,this.max),.5)}quadrant(e){const s=[e%2==0,e<2],c=Pe(this.min),f=Pe(this.max);for(let p=0;p<s.length;p++)c[p]=s[p]?this.min[p]:this.center[p],f[p]=s[p]?this.center[p]:this.max[p];return f[2]=this.max[2],new js(c,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,s=this.max;return[[e[0],e[1],e[2]],[s[0],e[1],e[2]],[s[0],s[1],e[2]],[e[0],s[1],e[2]],[e[0],e[1],s[2]],[s[0],e[1],s[2]],[s[0],s[1],s[2]],[e[0],s[1],s[2]]]}intersects(e){const s=this.getCorners();let c=!0;for(let f=0;f<e.planes.length;f++){const p=e.planes[f];let y=0;for(let v=0;v<s.length;v++)y+=bt(p,s[v])+p[3]>=0;if(y===0)return 0;y!==s.length&&(c=!1)}if(c)return 2;for(let f=0;f<3;f++){let p=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let v=0;v<e.points.length;v++){const T=e.points[v][f]-this.min[f];p=Math.min(p,T),y=Math.max(y,T)}if(y<0||p>this.max[f]-this.min[f])return 0}return 1}}function Av(r,e,s,c,f,p,y,v,T){if(p&&r.queryGeometry.isAboveHorizon)return!1;p&&(T*=r.pixelToTileUnitsFactor);for(const A of e)for(const M of A){const P=M.add(v),D=f&&s.elevation?s.elevation.exaggeration()*f.getElevationAt(P.x,P.y,!0):0,U=p?P:jA(P,D,c),j=p?r.tilespaceRays.map(K=>$A(K,D)):r.queryGeometry.screenGeometry,G=mt([],[M.x,M.y,D,1],c);if(!y&&p?T*=G[3]/s.cameraToCenterDistance:y&&!p&&(T*=s.cameraToCenterDistance/G[3]),FA(j,U,T))return!0}return!1}function jA(r,e,s){const c=mt([],[r.x,r.y,e,1],s);return new k(c[0]/c[3],c[1]/c[3])}const Cv=ze(0,0,0),VA=ze(0,0,1);function $A(r,e){const s=Le();return Cv[2]=e,r.intersectsPlane(Cv,VA,s),new k(s[0],s[1])}class Iv extends W_{}function Y_(r,{width:e,height:s},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*s*c)throw new RangeError("mismatched image size")}else f=new Uint8Array(e*s*c);return r.width=e,r.height=s,r.data=f,r}function Mv(r,{width:e,height:s},c){if(e===r.width&&s===r.height)return;const f=Y_({},{width:e,height:s},c);Q_(r,f,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,s)},c),r.width=e,r.height=s,r.data=f.data}function Q_(r,e,s,c,f,p){if(f.width===0||f.height===0)return e;if(f.width>r.width||f.height>r.height||s.x>r.width-f.width||s.y>r.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||c.x>e.width-f.width||c.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,v=e.data;for(let T=0;T<f.height;T++){const A=((s.y+T)*r.width+s.x)*p,M=((c.y+T)*e.width+c.x)*p;for(let P=0;P<f.width*p;P++)v[M+P]=y[A+P]}return e}Et("HeatmapBucket",Iv,{omit:["layers"]});class Ta{constructor(e,s){Y_(this,e,1,s)}resize(e){Mv(this,e,1)}clone(){return new Ta({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,c,f,p){Q_(e,s,c,f,p,1)}}class Kn{constructor(e,s){Y_(this,e,4,s)}resize(e){Mv(this,e,4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Kn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,c,f,p){Q_(e,s,c,f,p,4)}}Et("AlphaImage",Ta),Et("RGBAImage",Kn);var GA={paint:new Mr({"heatmap-radius":new Rt(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Rt(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new At(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new uo(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new At(Be.paint_heatmap["heatmap-opacity"])})};function J_(r){const e={},s=r.resolution||256,c=r.clips?r.clips.length:1,f=r.image||new Kn({width:s,height:c}),p=(y,v,T)=>{e[r.evaluationKey]=T;const A=r.expression.evaluate(e);f.data[y+v+0]=Math.floor(255*A.r/A.a),f.data[y+v+1]=Math.floor(255*A.g/A.a),f.data[y+v+2]=Math.floor(255*A.b/A.a),f.data[y+v+3]=Math.floor(255*A.a)};if(r.clips)for(let y=0,v=0;y<c;++y,v+=4*s)for(let T=0,A=0;T<s;T++,A+=4){const M=T/(s-1),{start:P,end:D}=r.clips[y];p(v,A,P*(1-M)+D*M)}else for(let y=0,v=0;y<s;y++,v+=4)p(0,v,y/(s-1));return f}var qA={paint:new Mr({"hillshade-illumination-direction":new At(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new At(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new At(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new At(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new At(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new At(Be.paint_hillshade["hillshade-accent-color"])})};const ZA=Yi([{name:"a_pos",components:2,type:"Int16"}],4),{members:WA}=ZA;var up=hp,HA=hp;function hp(r,e,s){s=s||2;var c,f,p,y,v,T,A,M=e&&e.length,P=M?e[0]*s:r.length,D=kv(r,0,P,s,!0),U=[];if(!D||D.next===D.prev)return U;if(M&&(D=function(G,K,ie,le){var ge,we,Ee,Se=[];for(ge=0,we=K.length;ge<we;ge++)(Ee=kv(G,K[ge]*le,ge<we-1?K[ge+1]*le:G.length,le,!1))===Ee.next&&(Ee.steiner=!0),Se.push(iC(Ee));for(Se.sort(JA),ge=0;ge<Se.length;ge++)ie=Ea(ie=eC(Se[ge],ie),ie.next);return ie}(r,e,D,s)),r.length>80*s){c=p=r[0],f=y=r[1];for(var j=s;j<P;j+=s)(v=r[j])<c&&(c=v),(T=r[j+1])<f&&(f=T),v>p&&(p=v),T>y&&(y=T);A=(A=Math.max(p-c,y-f))!==0?1/A:0}return Vh(D,U,s,c,f,A),U}function kv(r,e,s,c,f){var p,y;if(f===ig(r,e,s,c)>0)for(p=e;p<s;p+=c)y=zv(p,r[p],r[p+1],y);else for(p=s-c;p>=e;p-=c)y=zv(p,r[p],r[p+1],y);return y&&fp(y,y.next)&&(Gh(y),y=y.next),y}function Ea(r,e){if(!r)return r;e||(e=r);var s,c=r;do if(s=!1,c.steiner||!fp(c,c.next)&&ar(c.prev,c,c.next)!==0)c=c.next;else{if(Gh(c),(c=e=c.prev)===c.next)break;s=!0}while(s||c!==e);return e}function Vh(r,e,s,c,f,p,y){if(r){!y&&p&&function(M,P,D,U){var j=M;do j.z===null&&(j.z=eg(j.x,j.y,P,D,U)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==M);j.prevZ.nextZ=null,j.prevZ=null,function(G){var K,ie,le,ge,we,Ee,Se,Ve,Ne=1;do{for(ie=G,G=null,we=null,Ee=0;ie;){for(Ee++,le=ie,Se=0,K=0;K<Ne&&(Se++,le=le.nextZ);K++);for(Ve=Ne;Se>0||Ve>0&&le;)Se!==0&&(Ve===0||!le||ie.z<=le.z)?(ge=ie,ie=ie.nextZ,Se--):(ge=le,le=le.nextZ,Ve--),we?we.nextZ=ge:G=ge,ge.prevZ=we,we=ge;ie=le}we.nextZ=null,Ne*=2}while(Ee>1)}(j)}(r,c,f,p);for(var v,T,A=r;r.prev!==r.next;)if(v=r.prev,T=r.next,p?KA(r,c,f,p):XA(r))e.push(v.i/s),e.push(r.i/s),e.push(T.i/s),Gh(r),r=T.next,A=T.next;else if((r=T)===A){y?y===1?Vh(r=YA(Ea(r),e,s),e,s,c,f,p,2):y===2&&QA(r,e,s,c,f,p):Vh(Ea(r),e,s,c,f,p,1);break}}}function XA(r){var e=r.prev,s=r,c=r.next;if(ar(e,s,c)>=0)return!1;for(var f=r.next.next;f!==r.prev;){if(nu(e.x,e.y,s.x,s.y,c.x,c.y,f.x,f.y)&&ar(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function KA(r,e,s,c){var f=r.prev,p=r,y=r.next;if(ar(f,p,y)>=0)return!1;for(var v=f.x>p.x?f.x>y.x?f.x:y.x:p.x>y.x?p.x:y.x,T=f.y>p.y?f.y>y.y?f.y:y.y:p.y>y.y?p.y:y.y,A=eg(f.x<p.x?f.x<y.x?f.x:y.x:p.x<y.x?p.x:y.x,f.y<p.y?f.y<y.y?f.y:y.y:p.y<y.y?p.y:y.y,e,s,c),M=eg(v,T,e,s,c),P=r.prevZ,D=r.nextZ;P&&P.z>=A&&D&&D.z<=M;){if(P!==r.prev&&P!==r.next&&nu(f.x,f.y,p.x,p.y,y.x,y.y,P.x,P.y)&&ar(P.prev,P,P.next)>=0||(P=P.prevZ,D!==r.prev&&D!==r.next&&nu(f.x,f.y,p.x,p.y,y.x,y.y,D.x,D.y)&&ar(D.prev,D,D.next)>=0))return!1;D=D.nextZ}for(;P&&P.z>=A;){if(P!==r.prev&&P!==r.next&&nu(f.x,f.y,p.x,p.y,y.x,y.y,P.x,P.y)&&ar(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;D&&D.z<=M;){if(D!==r.prev&&D!==r.next&&nu(f.x,f.y,p.x,p.y,y.x,y.y,D.x,D.y)&&ar(D.prev,D,D.next)>=0)return!1;D=D.nextZ}return!0}function YA(r,e,s){var c=r;do{var f=c.prev,p=c.next.next;!fp(f,p)&&Pv(f,c,c.next,p)&&$h(f,p)&&$h(p,f)&&(e.push(f.i/s),e.push(c.i/s),e.push(p.i/s),Gh(c),Gh(c.next),c=r=p),c=c.next}while(c!==r);return Ea(c)}function QA(r,e,s,c,f,p){var y=r;do{for(var v=y.next.next;v!==y.prev;){if(y.i!==v.i&&rC(y,v)){var T=Dv(y,v);return y=Ea(y,y.next),T=Ea(T,T.next),Vh(y,e,s,c,f,p),void Vh(T,e,s,c,f,p)}v=v.next}y=y.next}while(y!==r)}function JA(r,e){return r.x-e.x}function eC(r,e){var s=function(p,y){var v,T=y,A=p.x,M=p.y,P=-1/0;do{if(M<=T.y&&M>=T.next.y&&T.next.y!==T.y){var D=T.x+(M-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(D<=A&&D>P){if(P=D,D===A){if(M===T.y)return T;if(M===T.next.y)return T.next}v=T.x<T.next.x?T:T.next}}T=T.next}while(T!==y);if(!v)return null;if(A===P)return v;var U,j=v,G=v.x,K=v.y,ie=1/0;T=v;do A>=T.x&&T.x>=G&&A!==T.x&&nu(M<K?A:P,M,G,K,M<K?P:A,M,T.x,T.y)&&(U=Math.abs(M-T.y)/(A-T.x),$h(T,p)&&(U<ie||U===ie&&(T.x>v.x||T.x===v.x&&tC(v,T)))&&(v=T,ie=U)),T=T.next;while(T!==j);return v}(r,e);if(!s)return e;var c=Dv(s,r),f=Ea(s,s.next);return Ea(c,c.next),e===s?f:e}function tC(r,e){return ar(r.prev,r,e.prev)<0&&ar(e.next,r,r.next)<0}function eg(r,e,s,c,f){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-s)*f)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-c)*f)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function iC(r){var e=r,s=r;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==r);return s}function nu(r,e,s,c,f,p,y,v){return(f-y)*(e-v)-(r-y)*(p-v)>=0&&(r-y)*(c-v)-(s-y)*(e-v)>=0&&(s-y)*(p-v)-(f-y)*(c-v)>=0}function rC(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(s,c){var f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==c.i&&f.next.i!==c.i&&Pv(f,f.next,s,c))return!0;f=f.next}while(f!==s);return!1}(r,e)&&($h(r,e)&&$h(e,r)&&function(s,c){var f=s,p=!1,y=(s.x+c.x)/2,v=(s.y+c.y)/2;do f.y>v!=f.next.y>v&&f.next.y!==f.y&&y<(f.next.x-f.x)*(v-f.y)/(f.next.y-f.y)+f.x&&(p=!p),f=f.next;while(f!==s);return p}(r,e)&&(ar(r.prev,r,e.prev)||ar(r,e.prev,e))||fp(r,e)&&ar(r.prev,r,r.next)>0&&ar(e.prev,e,e.next)>0)}function ar(r,e,s){return(e.y-r.y)*(s.x-e.x)-(e.x-r.x)*(s.y-e.y)}function fp(r,e){return r.x===e.x&&r.y===e.y}function Pv(r,e,s,c){var f=pp(ar(r,e,s)),p=pp(ar(r,e,c)),y=pp(ar(s,c,r)),v=pp(ar(s,c,e));return f!==p&&y!==v||!(f!==0||!dp(r,s,e))||!(p!==0||!dp(r,c,e))||!(y!==0||!dp(s,r,c))||!(v!==0||!dp(s,e,c))}function dp(r,e,s){return e.x<=Math.max(r.x,s.x)&&e.x>=Math.min(r.x,s.x)&&e.y<=Math.max(r.y,s.y)&&e.y>=Math.min(r.y,s.y)}function pp(r){return r>0?1:r<0?-1:0}function $h(r,e){return ar(r.prev,r,r.next)<0?ar(r,e,r.next)>=0&&ar(r,r.prev,e)>=0:ar(r,e,r.prev)<0||ar(r,r.next,e)<0}function Dv(r,e){var s=new tg(r.i,r.x,r.y),c=new tg(e.i,e.x,e.y),f=r.next,p=e.prev;return r.next=e,e.prev=r,s.next=f,f.prev=s,c.next=s,s.prev=c,p.next=c,c.prev=p,c}function zv(r,e,s,c){var f=new tg(r,e,s);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function Gh(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function tg(r,e,s){this.i=r,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ig(r,e,s,c){for(var f=0,p=e,y=s-c;p<s;p+=c)f+=(r[y]-r[p])*(r[p+1]+r[y+1]),y=p;return f}function nC(r,e,s,c,f){Rv(r,e,s||0,c||r.length-1,f||sC)}function Rv(r,e,s,c,f){for(;c>s;){if(c-s>600){var p=c-s+1,y=e-s+1,v=Math.log(p),T=.5*Math.exp(2*v/3),A=.5*Math.sqrt(v*T*(p-T)/p)*(y-p/2<0?-1:1);Rv(r,e,Math.max(s,Math.floor(e-y*T/p+A)),Math.min(c,Math.floor(e+(p-y)*T/p+A)),f)}var M=r[e],P=s,D=c;for(qh(r,s,e),f(r[c],M)>0&&qh(r,s,c);P<D;){for(qh(r,P,D),P++,D--;f(r[P],M)<0;)P++;for(;f(r[D],M)>0;)D--}f(r[s],M)===0?qh(r,s,D):qh(r,++D,c),D<=e&&(s=D+1),e<=D&&(c=D-1)}}function qh(r,e,s){var c=r[e];r[e]=r[s],r[s]=c}function sC(r,e){return r<e?-1:r>e?1:0}function rg(r,e){const s=r.length;if(s<=1)return[r];const c=[];let f,p;for(let y=0;y<s;y++){const v=ta(r[y]);v!==0&&(r[y].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(f&&c.push(f),f=[r[y]]):f.push(r[y]))}if(f&&c.push(f),e>1)for(let y=0;y<c.length;y++)c[y].length<=e||(nC(c[y],e,1,c[y].length-1,oC),c[y]=c[y].slice(0,e));return c}function oC(r,e){return e.area-r.area}function ng(r,e,s){const c=s.patternDependencies;let f=!1;for(const p of e){const y=p.paint.get(`${r}-pattern`);y.isConstant()||(f=!0);const v=y.constantOr(null);v&&(f=!0,c[v.to]=!0,c[v.from]=!0)}return f}function sg(r,e,s,c,f){const p=f.patternDependencies;for(const y of e){const v=y.paint.get(`${r}-pattern`).value;if(v.kind!=="constant"){let T=v.evaluate({zoom:c-1},s,{},f.availableImages),A=v.evaluate({zoom:c},s,{},f.availableImages),M=v.evaluate({zoom:c+1},s,{},f.availableImages);T=T&&T.name?T.name:T,A=A&&A.name?A.name:A,M=M&&M.name?M.name:M,p[T]=!0,p[A]=!0,p[M]=!0,s.patterns[y.id]={min:T,mid:A,max:M}}}return s}hp.deviation=function(r,e,s,c){var f=e&&e.length,p=Math.abs(ig(r,0,f?e[0]*s:r.length,s));if(f)for(var y=0,v=e.length;y<v;y++)p-=Math.abs(ig(r,e[y]*s,y<v-1?e[y+1]*s:r.length,s));var T=0;for(y=0;y<c.length;y+=3){var A=c[y]*s,M=c[y+1]*s,P=c[y+2]*s;T+=Math.abs((r[A]-r[P])*(r[M+1]-r[A+1])-(r[A]-r[M])*(r[P+1]-r[A+1]))}return p===0&&T===0?0:Math.abs((T-p)/p)},hp.flatten=function(r){for(var e=r[0][0].length,s={vertices:[],holes:[],dimensions:e},c=0,f=0;f<r.length;f++){for(var p=0;p<r[f].length;p++)for(var y=0;y<e;y++)s.vertices.push(r[f][p][y]);f>0&&s.holes.push(c+=r[f-1].length)}return s},up.default=HA;class mp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Kc,this.indexArray=new Xn,this.indexArray2=new ba,this.programConfigurations=new Fl(e.layers,e.zoom),this.segments=new or,this.segments2=new or,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,c,f){this.hasPattern=ng("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:v,id:T,index:A,sourceLayerIndex:M}of e){const P=this.layers[0]._featureFilter.needGeometry,D=Ol(v,P);if(!this.layers[0]._featureFilter.filter(new $t(this.zoom),D,c))continue;const U=p?p.evaluate(D,{},c,s.availableImages):void 0,j={id:T,properties:v.properties,type:v.type,sourceLayerIndex:M,index:A,geometry:P?D.geometry:jo(v,c,f),patterns:{},sortKey:U};y.push(j)}p&&y.sort((v,T)=>v.sortKey-T.sortKey);for(const v of y){const{geometry:T,index:A,sourceLayerIndex:M}=v;if(this.hasPattern){const P=sg("fill",this.layers,v,this.zoom,s);this.patternFeatures.push(P)}else this.addFeature(v,T,A,c,{},s.availableImages);s.featureIndex.insert(e[A].feature,T,A,M,this.index)}}update(e,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c,f)}addFeatures(e,s,c,f){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,WA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,c,f,p,y=[]){for(const v of rg(s,500)){let T=0;for(const j of v)T+=j.length;const A=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),M=A.vertexLength,P=[],D=[];for(const j of v){if(j.length===0)continue;j!==v[0]&&D.push(P.length/2);const G=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),K=G.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(K+j.length-1,K),P.push(j[0].x),P.push(j[0].y);for(let ie=1;ie<j.length;ie++)this.layoutVertexArray.emplaceBack(j[ie].x,j[ie].y),this.indexArray2.emplaceBack(K+ie-1,K+ie),P.push(j[ie].x),P.push(j[ie].y);G.vertexLength+=j.length,G.primitiveLength+=j.length}const U=up(P,D);for(let j=0;j<U.length;j+=3)this.indexArray.emplaceBack(M+U[j],M+U[j+1],M+U[j+2]);A.vertexLength+=T,A.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,p,y,f)}}Et("FillBucket",mp,{omit:["layers","patternFeatures"]});const aC=new Mr({"fill-sort-key":new Rt(Be.layout_fill["fill-sort-key"])});var lC={paint:new Mr({"fill-antialias":new At(Be.paint_fill["fill-antialias"]),"fill-opacity":new Rt(Be.paint_fill["fill-opacity"]),"fill-color":new Rt(Be.paint_fill["fill-color"]),"fill-outline-color":new Rt(Be.paint_fill["fill-outline-color"]),"fill-translate":new At(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new At(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new vr(Be.paint_fill["fill-pattern"])}),layout:aC};const cC=Yi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),uC=Yi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:hC}=cC;var Fv=su;function su(r,e,s,c,f){this.properties={},this.extent=s,this.type=0,this._pbf=r,this._geometry=-1,this._keys=c,this._values=f,r.readFields(fC,this,e)}function fC(r,e,s){r==1?e.id=s.readVarint():r==2?function(c,f){for(var p=c.readVarint()+c.pos;c.pos<p;){var y=f._keys[c.readVarint()],v=f._values[c.readVarint()];f.properties[y]=v}}(s,e):r==3?e.type=s.readVarint():r==4&&(e._geometry=s.pos)}function dC(r){for(var e,s,c=0,f=0,p=r.length,y=p-1;f<p;y=f++)c+=((s=r[y]).x-(e=r[f]).x)*(e.y+s.y);return c}su.types=["Unknown","Point","LineString","Polygon"],su.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,s=r.readVarint()+r.pos,c=1,f=0,p=0,y=0,v=[];r.pos<s;){if(f<=0){var T=r.readVarint();c=7&T,f=T>>3}if(f--,c===1||c===2)p+=r.readSVarint(),y+=r.readSVarint(),c===1&&(e&&v.push(e),e=[]),e.push(new k(p,y));else{if(c!==7)throw new Error("unknown command "+c);e&&e.push(e[0].clone())}}return e&&v.push(e),v},su.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,s=1,c=0,f=0,p=0,y=1/0,v=-1/0,T=1/0,A=-1/0;r.pos<e;){if(c<=0){var M=r.readVarint();s=7&M,c=M>>3}if(c--,s===1||s===2)(f+=r.readSVarint())<y&&(y=f),f>v&&(v=f),(p+=r.readSVarint())<T&&(T=p),p>A&&(A=p);else if(s!==7)throw new Error("unknown command "+s)}return[y,T,v,A]},su.prototype.toGeoJSON=function(r,e,s){var c,f,p=this.extent*Math.pow(2,s),y=this.extent*r,v=this.extent*e,T=this.loadGeometry(),A=su.types[this.type];function M(U){for(var j=0;j<U.length;j++){var G=U[j];U[j]=[360*(G.x+y)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(c=0;c<T.length;c++)P[c]=T[c][0];M(T=P);break;case 2:for(c=0;c<T.length;c++)M(T[c]);break;case 3:for(T=function(U){var j=U.length;if(j<=1)return[U];for(var G,K,ie=[],le=0;le<j;le++){var ge=dC(U[le]);ge!==0&&(K===void 0&&(K=ge<0),K===ge<0?(G&&ie.push(G),G=[U[le]]):G.push(U[le]))}return G&&ie.push(G),ie}(T),c=0;c<T.length;c++)for(f=0;f<T[c].length;f++)M(T[c][f])}T.length===1?T=T[0]:A="Multi"+A;var D={type:"Feature",geometry:{type:A,coordinates:T},properties:this.properties};return"id"in this&&(D.id=this.id),D};var Lv=Ov;function Ov(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(pC,this,e),this.length=this._features.length}function pC(r,e,s){r===15?e.version=s.readVarint():r===1?e.name=s.readString():r===5?e.extent=s.readVarint():r===2?e._features.push(s.pos):r===3?e._keys.push(s.readString()):r===4&&e._values.push(function(c){for(var f=null,p=c.readVarint()+c.pos;c.pos<p;){var y=c.readVarint()>>3;f=y===1?c.readString():y===2?c.readFloat():y===3?c.readDouble():y===4?c.readVarint64():y===5?c.readVarint():y===6?c.readSVarint():y===7?c.readBoolean():null}return f}(s))}function mC(r,e,s){if(r===3){var c=new Lv(s,s.readVarint()+s.pos);c.length&&(e[c.name]=c)}}Ov.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new Fv(this._pbf,e,this.extent,this._keys,this._values)};var Bl={VectorTile:function(r,e){this.layers=r.readFields(mC,{},e)},VectorTileFeature:Fv,VectorTileLayer:Lv};const _C=Bl.VectorTileFeature.types,gC=Math.pow(2,13);function Zh(r,e,s,c,f,p,y,v){r.emplaceBack((e<<1)+y,(s<<1)+p,(Math.floor(c*gC)<<1)+f,Math.round(v))}class Bv{constructor(){this.acc=new k(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new k(e.x,e.y),this.max=new k(e.x,e.y))}append(e,s){this.currentPolyCount.edges++,this.acc._add(e);let c=!!this.borders;const f=this.min,p=this.max;e.x<f.x?(f.x=e.x,c=!0):e.x>p.x&&(p.x=e.x,c=!0),e.y<f.y?(f.y=e.y,c=!0):e.y>p.y&&(p.y=e.y,c=!0),((e.x===0||e.x===ti)&&e.x===s.x)!=((e.y===0||e.y===ti)&&e.y===s.y)&&this.processBorderOverlap(e,s),c&&this.checkBorderIntersection(e,s)}checkBorderIntersection(e,s){s.x<0!=e.x<0&&this.addBorderIntersection(0,vi(s.y,e.y,(0-s.x)/(e.x-s.x))),s.x>ti!=e.x>ti&&this.addBorderIntersection(1,vi(s.y,e.y,(ti-s.x)/(e.x-s.x))),s.y<0!=e.y<0&&this.addBorderIntersection(2,vi(s.x,e.x,(0-s.y)/(e.y-s.y))),s.y>ti!=e.y>ti&&this.addBorderIntersection(3,vi(s.x,e.x,(ti-s.y)/(e.y-s.y)))}addBorderIntersection(e,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[e];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(e,s){if(e.x===s.x){if(e.y===s.y)return;const c=e.x===0?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,e.y)}else{const c=e.y===0?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,e.x)}}centroid(){const e=this.polyCount.reduce((s,c)=>s+c.edges,0);return e!==0?this.acc.div(e)._round():new k(0,0)}span(){return new k(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,s)=>e+ +(s[0]!==Number.MAX_VALUE),0)}}class og{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Yc,this.centroidVertexArray=new lv,this.indexArray=new Xn,this.programConfigurations=new Fl(e.layers,e.zoom),this.segments=new or,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=e.enableTerrain}populate(e,s,c,f){this.features=[],this.hasPattern=ng("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(p){const y=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*y/(y*y+1)/ti/(1<<p.z)}(c);for(const{feature:p,id:y,index:v,sourceLayerIndex:T}of e){const A=this.layers[0]._featureFilter.needGeometry,M=Ol(p,A);if(!this.layers[0]._featureFilter.filter(new $t(this.zoom),M,c))continue;const P={id:y,sourceLayerIndex:T,index:v,geometry:A?M.geometry:jo(p,c,f),properties:p.properties,type:p.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(sg("fill-extrusion",this.layers,P,this.zoom,s)):this.addFeature(P,P.geometry,v,c,{},s.availableImages),s.featureIndex.insert(p,P.geometry,v,T,this.index,D)}this.sortBorders()}addFeatures(e,s,c,f){for(const p of this.features){const{geometry:y}=p;this.addFeature(p,y,p.index,s,c,f)}this.sortBorders()}update(e,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hC),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,uC.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,c,f,p,y){const v=this.enableTerrain?new Bv:null;for(const A of rg(s,500)){let M=0,P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(A.length===0||(T=A[0]).every(K=>K.x<=0)||T.every(K=>K.x>=ti)||T.every(K=>K.y<=0)||T.every(K=>K.y>=ti))continue;for(let K=0;K<A.length;K++){const ie=A[K];if(ie.length===0)continue;M+=ie.length;let le=0;v&&v.startRing(ie[0]);for(let ge=0;ge<ie.length;ge++){const we=ie[ge];if(ge>=1){const Ee=ie[ge-1];if(!yC(we,Ee)){v&&v.append(we,Ee),P.vertexLength+4>or.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Se=we.sub(Ee)._perp(),Ve=Se.x/(Math.abs(Se.x)+Math.abs(Se.y)),Ne=Se.y>0?1:0,ft=Ee.dist(we);le+ft>32768&&(le=0),Zh(this.layoutVertexArray,we.x,we.y,Ve,Ne,0,0,le),Zh(this.layoutVertexArray,we.x,we.y,Ve,Ne,0,1,le),le+=ft,Zh(this.layoutVertexArray,Ee.x,Ee.y,Ve,Ne,0,0,le),Zh(this.layoutVertexArray,Ee.x,Ee.y,Ve,Ne,0,1,le);const ot=P.vertexLength;this.indexArray.emplaceBack(ot,ot+2,ot+1),this.indexArray.emplaceBack(ot+1,ot+2,ot+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+M>or.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),_C[e.type]!=="Polygon")continue;const D=[],U=[],j=P.vertexLength;for(let K=0;K<A.length;K++){const ie=A[K];if(ie.length!==0){ie!==A[0]&&U.push(D.length/2);for(let le=0;le<ie.length;le++){const ge=ie[le];Zh(this.layoutVertexArray,ge.x,ge.y,0,0,1,1,0),D.push(ge.x),D.push(ge.y),v&&v.currentPolyCount.top++}}}const G=up(D,U);for(let K=0;K<G.length;K+=3)this.indexArray.emplaceBack(j+G[K],j+G[K+2],j+G[K+1]);P.primitiveLength+=G.length/3,P.vertexLength+=M}var T;if(v&&v.polyCount.length>0){if(v.borders){v.vertexArrayOffset=this.centroidVertexArray.length;const A=v.borders,M=this.featuresOnBorder.push(v)-1;for(let P=0;P<4;P++)A[P][0]!==Number.MAX_VALUE&&this.borders[P].push(M)}this.encodeCentroid(v.borders?void 0:v.centroid(),v)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,p,y,f)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((s,c)=>this.featuresOnBorder[s].borders[e][0]-this.featuresOnBorder[c].borders[e][0])}encodeCentroid(e,s,c=!0){let f,p;if(e)if(e.y!==0){const v=s.span()._mult(this.tileToMeter);f=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(v.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else f=Math.ceil(7*(e.x+450)),p=0;else f=0,p=+c;let y=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(const v of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let T=0;T<2*v.edges;T++)this.centroidVertexArray.emplace(y++,0,p),this.centroidVertexArray.emplace(y++,f,p);for(let T=0;T<v.top;T++)this.centroidVertexArray.emplace(y++,f,p)}}}function yC(r,e){return r.x===e.x&&(r.x<0||r.x>ti)||r.y===e.y&&(r.y<0||r.y>ti)}Et("FillExtrusionBucket",og,{omit:["layers","features"]}),Et("PartMetadata",Bv);var xC={paint:new Mr({"fill-extrusion-opacity":new At(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Rt(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new At(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new At(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vr(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Rt(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Rt(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new At(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Wh(r,e){return r.x*e.x+r.y*e.y}function Uv(r,e){if(r.length===1){let s=0;const c=e[s++];let f;for(;!f||c.equals(f);)if(f=e[s++],!f)return 1/0;for(;s<e.length;s++){const p=e[s],y=r[0],v=f.sub(c),T=p.sub(c),A=y.sub(c),M=Wh(v,v),P=Wh(v,T),D=Wh(T,T),U=Wh(A,v),j=Wh(A,T),G=M*D-P*P,K=(D*U-P*j)/G,ie=(M*j-P*U)/G,le=c.z*(1-K-ie)+f.z*K+p.z*ie;if(isFinite(le))return le}return 1/0}{let s=1/0;for(const c of e)s=Math.min(s,c.z);return s}}function Nv(r){const e=new k(r[0],r[1]);return e.z=r[2],e}function vC(r,e,s,c,f,p,y,v){const T=y*f.getElevationAt(r,e,!0,!0),A=p[0]!==0,M=A?p[1]===0?y*(p[0]/7-450):y*function(P,D,U){const j=Math.floor(D[0]/8),G=Math.floor(D[1]/8),K=10*(D[0]-8*j),ie=10*(D[1]-8*G),le=P.getElevationAt(j,G,!0,!0),ge=P.getMeterToDEM(U),we=Math.floor(.5*(K*ge-1)),Ee=Math.floor(.5*(ie*ge-1)),Se=P.tileCoordToPixel(j,G),Ve=2*we+1,Ne=2*Ee+1,ft=function(vt,Ct,oi,zi,ui){return[vt.getElevationAtPixel(Ct,oi,!0),vt.getElevationAtPixel(Ct+ui,oi,!0),vt.getElevationAtPixel(Ct,oi+ui,!0),vt.getElevationAtPixel(Ct+zi,oi+ui,!0)]}(P,Se.x-we,Se.y-Ee,Ve,Ne),ot=Math.abs(ft[0]-ft[1]),je=Math.abs(ft[2]-ft[3]),at=Math.abs(ft[0]-ft[2])+Math.abs(ft[1]-ft[3]),pt=Math.min(.25,.5*ge*(ot+je)/Ve),He=Math.min(.25,.5*ge*at/Ne);return le+Math.max(pt*K,He*ie)}(f,p,v):T;return{base:T+(s===0)?-1:s,top:A?Math.max(M+c,T+s+2):T+c}}const bC=Yi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:wC}=bC,TC=Yi([{name:"a_packed",components:3,type:"Float32"}]),{members:EC}=TC,SC=Bl.VectorTileFeature.types,AC=Math.cos(Math.PI/180*37.5);class _p{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new P_,this.layoutVertexArray2=new Qc,this.indexArray=new Xn,this.programConfigurations=new Fl(e.layers,e.zoom),this.segments=new or,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,c,f){this.hasPattern=ng("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:M,id:P,index:D,sourceLayerIndex:U}of e){const j=this.layers[0]._featureFilter.needGeometry,G=Ol(M,j);if(!this.layers[0]._featureFilter.filter(new $t(this.zoom),G,c))continue;const K=p?p.evaluate(G,{},c):void 0,ie={id:P,properties:M.properties,type:M.type,sourceLayerIndex:U,index:D,geometry:j?G.geometry:jo(M,c,f),patterns:{},sortKey:K};y.push(ie)}p&&y.sort((M,P)=>M.sortKey-P.sortKey);const{lineAtlas:v,featureIndex:T}=s,A=this.addConstantDashes(v);for(const M of y){const{geometry:P,index:D,sourceLayerIndex:U}=M;if(A&&this.addFeatureDashes(M,v),this.hasPattern){const j=sg("line",this.layers,M,this.zoom,s);this.patternFeatures.push(j)}else this.addFeature(M,P,D,c,v.positions,s.availableImages);T.insert(e[D].feature,P,D,U,this.index)}}addConstantDashes(e){let s=!1;for(const c of this.layers){const f=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(f.kind!=="constant"||p.kind!=="constant")s=!0;else{const y=p.value,v=f.value;if(!v)continue;e.addDash(v.from,y),e.addDash(v.to,y),v.other&&e.addDash(v.other,y)}}return s}addFeatureDashes(e,s){const c=this.zoom;for(const f of this.layers){const p=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if(p.kind==="constant"&&y.kind==="constant")continue;let v,T,A,M,P,D;if(p.kind==="constant"){const K=p.value;if(!K)continue;v=K.other||K.to,T=K.to,A=K.from}else v=p.evaluate({zoom:c-1},e),T=p.evaluate({zoom:c},e),A=p.evaluate({zoom:c+1},e);y.kind==="constant"?M=P=D=y.value:(M=y.evaluate({zoom:c-1},e),P=y.evaluate({zoom:c},e),D=y.evaluate({zoom:c+1},e)),s.addDash(v,M),s.addDash(T,P),s.addDash(A,D);const U=s.getKey(v,M),j=s.getKey(T,P),G=s.getKey(A,D);e.patterns[f.id]={min:U,mid:j,max:G}}}update(e,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,c,f)}addFeatures(e,s,c,f){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,EC)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wC),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,c,f,p,y){const v=this.layers[0].layout,T=v.get("line-join").evaluate(e,{}),A=v.get("line-cap").evaluate(e,{}),M=v.get("line-miter-limit"),P=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const D of s)this.addLine(D,e,T,A,M,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,p,y,f)}addLine(e,s,c,f,p,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<e.length-1;ie++)this.totalDistance+=e[ie].dist(e[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=SC[s.type]==="Polygon";let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let A=0;for(;A<T-1&&e[A].equals(e[A+1]);)A++;if(T<(v?3:2))return;c==="bevel"&&(p=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let D,U,j,G,K;this.e1=this.e2=-1,v&&(D=e[T-2],K=e[A].sub(D)._unit()._perp());for(let ie=A;ie<T;ie++){if(j=ie===T-1?v?e[A+1]:void 0:e[ie+1],j&&e[ie].equals(j))continue;K&&(G=K),D&&(U=D),D=e[ie],K=j?j.sub(D)._unit()._perp():G,G=G||K;let le=G.add(K);le.x===0&&le.y===0||le._unit();const ge=G.x*K.x+G.y*K.y,we=le.x*K.x+le.y*K.y,Ee=we!==0?1/we:1/0,Se=2*Math.sqrt(2-2*we),Ve=we<AC&&U&&j,Ne=G.x*K.y-G.y*K.x>0;if(Ve&&ie>A){const je=D.dist(U);if(je>2*M){const at=D.sub(D.sub(U)._mult(M/je)._round());this.updateDistance(U,at),this.addCurrentVertex(at,G,0,0,P),U=at}}const ft=U&&j;let ot=ft?c:v?"butt":f;if(ft&&ot==="round"&&(Ee<y?ot="miter":Ee<=2&&(ot="fakeround")),ot==="miter"&&Ee>p&&(ot="bevel"),ot==="bevel"&&(Ee>2&&(ot="flipbevel"),Ee<p&&(ot="miter")),U&&this.updateDistance(U,D),ot==="miter")le._mult(Ee),this.addCurrentVertex(D,le,0,0,P);else if(ot==="flipbevel"){if(Ee>100)le=K.mult(-1);else{const je=Ee*G.add(K).mag()/G.sub(K).mag();le._perp()._mult(je*(Ne?-1:1))}this.addCurrentVertex(D,le,0,0,P),this.addCurrentVertex(D,le.mult(-1),0,0,P)}else if(ot==="bevel"||ot==="fakeround"){const je=-Math.sqrt(Ee*Ee-1),at=Ne?je:0,pt=Ne?0:je;if(U&&this.addCurrentVertex(D,G,at,pt,P),ot==="fakeround"){const He=Math.round(180*Se/Math.PI/20);for(let vt=1;vt<He;vt++){let Ct=vt/He;if(Ct!==.5){const zi=Ct-.5;Ct+=Ct*zi*(Ct-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*zi*zi+(.848013+ge*(.215638*ge-1.06021)))}const oi=K.sub(G)._mult(Ct)._add(G)._unit()._mult(Ne?-1:1);this.addHalfVertex(D,oi.x,oi.y,!1,Ne,0,P)}}j&&this.addCurrentVertex(D,K,-at,-pt,P)}else if(ot==="butt")this.addCurrentVertex(D,le,0,0,P);else if(ot==="square"){const je=U?1:-1;U||this.addCurrentVertex(D,le,je,je,P),this.addCurrentVertex(D,le,0,0,P),U&&this.addCurrentVertex(D,le,je,je,P)}else ot==="round"&&(U&&(this.addCurrentVertex(D,G,0,0,P),this.addCurrentVertex(D,G,1,1,P,!0)),j&&(this.addCurrentVertex(D,K,-1,-1,P,!0),this.addCurrentVertex(D,K,0,0,P)));if(Ve&&ie<T-1){const je=D.dist(j);if(je>2*M){const at=D.add(j.sub(D)._mult(M/je)._round());this.updateDistance(D,at),this.addCurrentVertex(at,K,0,0,P),D=at}}}}addCurrentVertex(e,s,c,f,p,y=!1){const v=s.y*f-s.x,T=-s.y-s.x*f;this.addHalfVertex(e,s.x+s.y*c,s.y-s.x*c,y,!1,c,p),this.addHalfVertex(e,v,T,y,!0,-f,p)}addHalfVertex({x:e,y:s},c,f,p,y,v,T){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(s<<1)+(y?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const A=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),T.primitiveLength++),y?this.e2=A:this.e1=A}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}Et("LineBucket",_p,{omit:["layers","patternFeatures"]});const CC=new Mr({"line-cap":new Rt(Be.layout_line["line-cap"]),"line-join":new Rt(Be.layout_line["line-join"]),"line-miter-limit":new At(Be.layout_line["line-miter-limit"]),"line-round-limit":new At(Be.layout_line["line-round-limit"]),"line-sort-key":new Rt(Be.layout_line["line-sort-key"])});var jv={paint:new Mr({"line-opacity":new Rt(Be.paint_line["line-opacity"]),"line-color":new Rt(Be.paint_line["line-color"]),"line-translate":new At(Be.paint_line["line-translate"]),"line-translate-anchor":new At(Be.paint_line["line-translate-anchor"]),"line-width":new Rt(Be.paint_line["line-width"]),"line-gap-width":new Rt(Be.paint_line["line-gap-width"]),"line-offset":new Rt(Be.paint_line["line-offset"]),"line-blur":new Rt(Be.paint_line["line-blur"]),"line-dasharray":new vr(Be.paint_line["line-dasharray"]),"line-pattern":new vr(Be.paint_line["line-pattern"]),"line-gradient":new uo(Be.paint_line["line-gradient"])}),layout:CC};const Vv=new class extends Rt{possiblyEvaluate(r,e){return e=new $t(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,s,c){return e=dt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,s,c)}}(jv.paint.properties["line-width"].specification);function $v(r,e){return e>0?e+2*r:r}Vv.useIntegerZoom=!0;const IC=Yi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),MC=Yi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Yi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const kC=Yi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),PC=Yi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Yi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gv=Yi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),DC=Yi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Yi([{name:"triangle",components:3,type:"Uint16"}]),Yi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Yi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Yi([{type:"Float32",name:"offsetX"}]),Yi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Fr=24;const fo=128;function ag(r,e){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new $t(r+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:f}=s;let p=0;for(;p<c.length&&c[p]<=r;)p++;p=Math.max(0,p-1);let y=p;for(;y<c.length&&c[y]<r+1;)y++;y=Math.min(c.length-1,y);const v=c[p],T=c[y];return s.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:v,maxZoom:T,minSize:s.evaluate(new $t(v)),maxSize:s.evaluate(new $t(T)),interpolationType:f}}}function gp(r,{uSize:e,uSizeT:s},{lowerSize:c,upperSize:f}){return r.kind==="source"?c/fo:r.kind==="composite"?vi(c/fo,f/fo,s):e}function ou(r,e){let s=0,c=0;if(r.kind==="constant")c=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:f,minZoom:p,maxZoom:y}=r,v=f?Xe(tn.interpolationFactor(f,e,p,y),0,1):0;r.kind==="camera"?c=vi(r.minSize,r.maxSize,v):s=v}return{uSizeT:s,uSize:c}}var zC=Object.freeze({__proto__:null,getSizeData:ag,evaluateSizeForFeature:gp,evaluateSizeForZoom:ou,SIZE_PACK_FACTOR:fo});function RC(r,e,s){return r.sections.forEach(c=>{c.text=function(f,p,y){const v=p.layout.get("text-transform").evaluate(y,{});return v==="uppercase"?f=f.toLocaleUpperCase():v==="lowercase"&&(f=f.toLocaleLowerCase()),ci.applyArabicShaping&&(f=ci.applyArabicShaping(f)),f}(c.text,e,s)}),r}const Hh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function FC(r){return r==="\uFE36"||r==="\uFE48"||r==="\uFE38"||r==="\uFE44"||r==="\uFE42"||r==="\uFE3E"||r==="\uFE3C"||r==="\uFE3A"||r==="\uFE18"||r==="\uFE40"||r==="\uFE10"||r==="\uFE13"||r==="\uFE14"||r==="\uFF40"||r==="\uFFE3"||r==="\uFE11"||r==="\uFE12"}function LC(r){return r==="\uFE35"||r==="\uFE47"||r==="\uFE37"||r==="\uFE43"||r==="\uFE41"||r==="\uFE3D"||r==="\uFE3B"||r==="\uFE39"||r==="\uFE17"||r==="\uFE3F"}var qv=function(r,e,s,c,f){var p,y,v=8*f-c-1,T=(1<<v)-1,A=T>>1,M=-7,P=s?f-1:0,D=s?-1:1,U=r[e+P];for(P+=D,p=U&(1<<-M)-1,U>>=-M,M+=v;M>0;p=256*p+r[e+P],P+=D,M-=8);for(y=p&(1<<-M)-1,p>>=-M,M+=c;M>0;y=256*y+r[e+P],P+=D,M-=8);if(p===0)p=1-A;else{if(p===T)return y?NaN:1/0*(U?-1:1);y+=Math.pow(2,c),p-=A}return(U?-1:1)*y*Math.pow(2,p-c)},Zv=function(r,e,s,c,f,p){var y,v,T,A=8*p-f-1,M=(1<<A)-1,P=M>>1,D=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=c?0:p-1,j=c?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,y=M):(y=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-y))<1&&(y--,T*=2),(e+=y+P>=1?D/T:D*Math.pow(2,1-P))*T>=2&&(y++,T/=2),y+P>=M?(v=0,y=M):y+P>=1?(v=(e*T-1)*Math.pow(2,f),y+=P):(v=e*Math.pow(2,P-1)*Math.pow(2,f),y=0));f>=8;r[s+U]=255&v,U+=j,v/=256,f-=8);for(y=y<<f|v,A+=f;A>0;r[s+U]=255&y,U+=j,y/=256,A-=8);r[s+U-j]|=128*G},Xh=Di;function Di(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Di.Varint=0,Di.Fixed64=1,Di.Bytes=2,Di.Fixed32=5;var lg=4294967296,Wv=1/lg,Hv=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Vo(r){return r.type===Di.Bytes?r.readVarint()+r.pos:r.pos+1}function au(r,e,s){return s?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Xv(r,e,s){var c=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(c);for(var f=s.pos-1;f>=r;f--)s.buf[f+c]=s.buf[f]}function OC(r,e){for(var s=0;s<r.length;s++)e.writeVarint(r[s])}function BC(r,e){for(var s=0;s<r.length;s++)e.writeSVarint(r[s])}function UC(r,e){for(var s=0;s<r.length;s++)e.writeFloat(r[s])}function NC(r,e){for(var s=0;s<r.length;s++)e.writeDouble(r[s])}function jC(r,e){for(var s=0;s<r.length;s++)e.writeBoolean(r[s])}function VC(r,e){for(var s=0;s<r.length;s++)e.writeFixed32(r[s])}function $C(r,e){for(var s=0;s<r.length;s++)e.writeSFixed32(r[s])}function GC(r,e){for(var s=0;s<r.length;s++)e.writeFixed64(r[s])}function qC(r,e){for(var s=0;s<r.length;s++)e.writeSFixed64(r[s])}function yp(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function lu(r,e,s){r[s]=e,r[s+1]=e>>>8,r[s+2]=e>>>16,r[s+3]=e>>>24}function Kv(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function ZC(r,e,s){e.glyphs=[],r===1&&s.readMessage(WC,e)}function WC(r,e,s){if(r===3){const{id:c,bitmap:f,width:p,height:y,left:v,top:T,advance:A}=s.readMessage(HC,{});e.glyphs.push({id:c,bitmap:new Ta({width:p+6,height:y+6},f),metrics:{width:p,height:y,left:v,top:T,advance:A}})}else r===4?e.ascender=s.readSVarint():r===5&&(e.descender=s.readSVarint())}function HC(r,e,s){r===1?e.id=s.readVarint():r===2?e.bitmap=s.readBytes():r===3?e.width=s.readVarint():r===4?e.height=s.readVarint():r===5?e.left=s.readSVarint():r===6?e.top=s.readSVarint():r===7&&(e.advance=s.readVarint())}function cg(r){let e=0,s=0;for(const y of r)e+=y.w*y.h,s=Math.max(s,y.w);r.sort((y,v)=>v.h-y.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let f=0,p=0;for(const y of r)for(let v=c.length-1;v>=0;v--){const T=c[v];if(!(y.w>T.w||y.h>T.h)){if(y.x=T.x,y.y=T.y,p=Math.max(p,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===T.w&&y.h===T.h){const A=c.pop();v<c.length&&(c[v]=A)}else y.h===T.h?(T.x+=y.w,T.w-=y.w):y.w===T.w?(T.y+=y.h,T.h-=y.h):(c.push({x:T.x+y.w,y:T.y,w:T.w-y.w,h:y.h}),T.y+=y.h,T.h-=y.h);break}}return{w:f,h:p,fill:e/(f*p)||0}}Di.prototype={destroy:function(){this.buf=null},readFields:function(r,e,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),f=c>>3,p=this.pos;this.type=7&c,r(f,e,this),this.pos===p&&this.skip(c)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=yp(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Kv(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=yp(this.buf,this.pos)+yp(this.buf,this.pos+4)*lg;return this.pos+=8,r},readSFixed64:function(){var r=yp(this.buf,this.pos)+Kv(this.buf,this.pos+4)*lg;return this.pos+=8,r},readFloat:function(){var r=qv(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=qv(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,s,c=this.buf;return e=127&(s=c[this.pos++]),s<128?e:(e|=(127&(s=c[this.pos++]))<<7,s<128?e:(e|=(127&(s=c[this.pos++]))<<14,s<128?e:(e|=(127&(s=c[this.pos++]))<<21,s<128?e:function(f,p,y){var v,T,A=y.buf;if(v=(112&(T=A[y.pos++]))>>4,T<128||(v|=(127&(T=A[y.pos++]))<<3,T<128)||(v|=(127&(T=A[y.pos++]))<<10,T<128)||(v|=(127&(T=A[y.pos++]))<<17,T<128)||(v|=(127&(T=A[y.pos++]))<<24,T<128)||(v|=(1&(T=A[y.pos++]))<<31,T<128))return au(f,v,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(s=c[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Hv?function(s,c,f){return Hv.decode(s.subarray(c,f))}(this.buf,e,r):function(s,c,f){for(var p="",y=c;y<f;){var v,T,A,M=s[y],P=null,D=M>239?4:M>223?3:M>191?2:1;if(y+D>f)break;D===1?M<128&&(P=M):D===2?(192&(v=s[y+1]))==128&&(P=(31&M)<<6|63&v)<=127&&(P=null):D===3?(T=s[y+2],(192&(v=s[y+1]))==128&&(192&T)==128&&((P=(15&M)<<12|(63&v)<<6|63&T)<=2047||P>=55296&&P<=57343)&&(P=null)):D===4&&(T=s[y+2],A=s[y+3],(192&(v=s[y+1]))==128&&(192&T)==128&&(192&A)==128&&((P=(15&M)<<18|(63&v)<<12|(63&T)<<6|63&A)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,D=1):P>65535&&(P-=65536,p+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),p+=String.fromCharCode(P),y+=D}return p}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Di.Bytes)return r.push(this.readVarint(e));var s=Vo(this);for(r=r||[];this.pos<s;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Di.Bytes)return r.push(this.readSVarint());var e=Vo(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Di.Bytes)return r.push(this.readBoolean());var e=Vo(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Di.Bytes)return r.push(this.readFloat());var e=Vo(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Di.Bytes)return r.push(this.readDouble());var e=Vo(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Di.Bytes)return r.push(this.readFixed32());var e=Vo(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Di.Bytes)return r.push(this.readSFixed32());var e=Vo(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Di.Bytes)return r.push(this.readFixed64());var e=Vo(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Di.Bytes)return r.push(this.readSFixed64());var e=Vo(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Di.Varint)for(;this.buf[this.pos++]>127;);else if(e===Di.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Di.Fixed32)this.pos+=4;else{if(e!==Di.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),lu(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),lu(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),lu(this.buf,-1&r,this.pos),lu(this.buf,Math.floor(r*Wv),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),lu(this.buf,-1&r,this.pos),lu(this.buf,Math.floor(r*Wv),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,s){var c,f;if(e>=0?(c=e%4294967296|0,f=e/4294967296|0):(f=~(-e/4294967296),4294967295^(c=~(-e%4294967296))?c=c+1|0:(c=0,f=f+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(p,y,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)}(c,0,s),function(p,y){var v=(7&p)<<4;y.buf[y.pos++]|=v|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))}(f,s)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(c,f,p){for(var y,v,T=0;T<f.length;T++){if((y=f.charCodeAt(T))>55295&&y<57344){if(!v){y>56319||T+1===f.length?(c[p++]=239,c[p++]=191,c[p++]=189):v=y;continue}if(y<56320){c[p++]=239,c[p++]=191,c[p++]=189,v=y;continue}y=v-55296<<10|y-56320|65536,v=null}else v&&(c[p++]=239,c[p++]=191,c[p++]=189,v=null);y<128?c[p++]=y:(y<2048?c[p++]=y>>6|192:(y<65536?c[p++]=y>>12|224:(c[p++]=y>>18|240,c[p++]=y>>12&63|128),c[p++]=y>>6&63|128),c[p++]=63&y|128)}return p}(this.buf,r,this.pos);var s=this.pos-e;s>=128&&Xv(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s},writeFloat:function(r){this.realloc(4),Zv(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Zv(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var s=0;s<e;s++)this.buf[this.pos++]=r[s]},writeRawMessage:function(r,e){this.pos++;var s=this.pos;r(e,this);var c=this.pos-s;c>=128&&Xv(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(r,e,s){this.writeTag(r,Di.Bytes),this.writeRawMessage(e,s)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,OC,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,BC,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,jC,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,UC,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,NC,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,VC,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,$C,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,GC,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,qC,e)},writeBytesField:function(r,e){this.writeTag(r,Di.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Di.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Di.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Di.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Di.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Di.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Di.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Di.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Di.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Di.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,Boolean(e))}};class ug{constructor(e,{pixelRatio:s,version:c,stretchX:f,stretchY:p,content:y}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=f,this.stretchY=p,this.content=y,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Yv{constructor(e,s){const c={},f={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,c,p),this.addImages(s,f,p);const{w:y,h:v}=cg(p),T=new Kn({width:y||1,height:v||1});for(const A in e){const M=e[A],P=c[A].paddedRect;Kn.copy(M.data,T,{x:0,y:0},{x:P.x+1,y:P.y+1},M.data)}for(const A in s){const M=s[A],P=f[A].paddedRect,D=P.x+1,U=P.y+1,j=M.data.width,G=M.data.height;Kn.copy(M.data,T,{x:0,y:0},{x:D,y:U},M.data),Kn.copy(M.data,T,{x:0,y:G-1},{x:D,y:U-1},{width:j,height:1}),Kn.copy(M.data,T,{x:0,y:0},{x:D,y:U+G},{width:j,height:1}),Kn.copy(M.data,T,{x:j-1,y:0},{x:D-1,y:U},{width:1,height:G}),Kn.copy(M.data,T,{x:0,y:0},{x:D+j,y:U},{width:1,height:G})}this.image=T,this.iconPositions=c,this.patternPositions=f}addImages(e,s,c){for(const f in e){const p=e[f],y={x:0,y:0,w:p.data.width+2,h:p.data.height+2};c.push(y),s[f]=new ug(y,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(e,s){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in e.updatedImages)this.patchUpdatedImage(this.iconPositions[c],e.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c),s)}patchUpdatedImage(e,s,c){if(!e||!s||e.version===s.version)return;e.version=s.version;const[f,p]=e.tl;c.update(s.data,void 0,{x:f,y:p})}}Et("ImagePosition",ug),Et("ImageAtlas",Yv);const Yn={horizontal:1,vertical:2,horizontalOnly:3};class Kh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,s){const c=new Kh;return c.scale=e||1,c.fontStack=s,c}static forImage(e){const s=new Kh;return s.imageName=e,s}}class cu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const c=new cu;for(let f=0;f<e.sections.length;f++){const p=e.sections[f];p.image?c.addImageSection(p):c.addTextSection(p,s)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(s,c){let f="";for(let p=0;p<s.length;p++){const y=s.charCodeAt(p+1)||null,v=s.charCodeAt(p-1)||null;f+=!c&&(y&&kt(y)&&!Hh[s[p+1]]||v&&kt(v)&&!Hh[s[p-1]])||!Hh[s[p]]?s[p]:Hh[s[p]]}return f}(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&xp[this.text.charCodeAt(c)];c++)e++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&xp[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const c=new cu;return c.text=this.text.substring(e,s),c.sectionIndex=this.sectionIndex.slice(e,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(Kh.forText(e.scale,e.fontStack||s));const c=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(c)}addImageSection(e){const s=e.image?e.image.name:"";if(s.length===0)return void pi("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Kh.forImage(s)),this.sectionIndex.push(this.sections.length-1)):pi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hg(r,e,s,c,f,p,y,v,T,A,M,P,D,U,j,G){const K=cu.fromFeature(r,f);let ie;P===Yn.vertical&&K.verticalizePunctuation(D);const{processBidirectionalText:le,processStyledBidirectionalText:ge}=ci;if(le&&K.sections.length===1){ie=[];const Se=le(K.toString(),fg(K,A,p,e,c,U,j));for(const Ve of Se){const Ne=new cu;Ne.text=Ve,Ne.sections=K.sections;for(let ft=0;ft<Ve.length;ft++)Ne.sectionIndex.push(0);ie.push(Ne)}}else if(ge){ie=[];const Se=ge(K.text,K.sectionIndex,fg(K,A,p,e,c,U,j));for(const Ve of Se){const Ne=new cu;Ne.text=Ve[0],Ne.sectionIndex=Ve[1],Ne.sections=K.sections,ie.push(Ne)}}else ie=function(Se,Ve){const Ne=[],ft=Se.text;let ot=0;for(const je of Ve)Ne.push(Se.substring(ot,je)),ot=je;return ot<ft.length&&Ne.push(Se.substring(ot,ft.length)),Ne}(K,fg(K,A,p,e,c,U,j));const we=[],Ee={positionedLines:we,text:K.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Se,Ve,Ne,ft,ot,je,at,pt,He,vt,Ct,oi){let zi=0,ui=0,hi=0;const nt=pt==="right"?1:pt==="left"?0:.5;let gi=!1;for(const yi of ot){const si=yi.getSections();for(const $i of si){if($i.imageName)continue;const cr=Ve[$i.fontStack];if(cr&&(gi=cr.ascender!==void 0&&cr.descender!==void 0,!gi))break}if(!gi)break}let di=0;for(const yi of ot){yi.trim();const si=yi.getMaxScale(),$i=(si-1)*Fr,cr={positionedGlyphs:[],lineOffset:0};Se.positionedLines[di]=cr;const ir=cr.positionedGlyphs;let fr=0;if(!yi.length()){ui+=je,++di;continue}let Lr=0,gn=0;for(let Vi=0;Vi<yi.length();Vi++){const wr=yi.getSection(Vi),ys=yi.getSectionIndex(Vi),kr=yi.getCharCode(Vi);let Ii=wr.scale,Tr=null,Gi=null,Wr=null,dr=Fr,Hr=0;const sn=!(He===Yn.horizontal||!Ct&&!Ge(kr)||Ct&&(xp[kr]||(lr=kr,n(lr)||h(lr)||_(lr)||de(lr)||et(lr))));if(wr.imageName){const on=ft[wr.imageName];if(!on)continue;Wr=wr.imageName,Se.iconsInText=Se.iconsInText||!0,Gi=on.paddedRect;const Er=on.displaySize;Ii=Ii*Fr/oi,Tr={width:Er[0],height:Er[1],left:1,top:-3,advance:sn?Er[1]:Er[0],localGlyph:!1},Hr=gi?-Tr.height*Ii:si*Fr-17-Er[1]*Ii,dr=Tr.advance;const $s=(sn?Er[0]:Er[1])*Ii-Fr*si;$s>0&&$s>fr&&(fr=$s)}else{const on=Ne[wr.fontStack];if(!on)continue;on[kr]&&(Gi=on[kr]);const Er=Ve[wr.fontStack];if(!Er)continue;const $s=Er.glyphs[kr];if(!$s)continue;if(Tr=$s.metrics,dr=kr!==8203?Fr:0,gi){const mu=Er.ascender!==void 0?Math.abs(Er.ascender):0,nf=Er.descender!==void 0?Math.abs(Er.descender):0,sf=(mu+nf)*Ii;Lr<sf&&(Lr=sf,gn=(mu-nf)/2*Ii),Hr=-mu*Ii}else Hr=(si-Ii)*Fr-17}sn?(Se.verticalizable=!0,ir.push({glyph:kr,imageName:Wr,x:zi,y:ui+Hr,vertical:sn,scale:Ii,localGlyph:Tr.localGlyph,fontStack:wr.fontStack,sectionIndex:ys,metrics:Tr,rect:Gi}),zi+=dr*Ii+vt):(ir.push({glyph:kr,imageName:Wr,x:zi,y:ui+Hr,vertical:sn,scale:Ii,localGlyph:Tr.localGlyph,fontStack:wr.fontStack,sectionIndex:ys,metrics:Tr,rect:Gi}),zi+=Tr.advance*Ii+vt)}ir.length!==0&&(hi=Math.max(zi-vt,hi),gi?i1(ir,nt,fr,gn,je*si/2):i1(ir,nt,fr,0,je/2)),zi=0;const yn=je*si+fr;cr.lineOffset=Math.max(fr,$i),ui+=yn,++di}var lr;const er=ui,{horizontalAlign:br,verticalAlign:Zr}=dg(at);(function(yi,si,$i,cr,ir,fr){const Lr=(si-$i)*ir,gn=-fr*cr;for(const yn of yi)for(const Vi of yn.positionedGlyphs)Vi.x+=Lr,Vi.y+=gn})(Se.positionedLines,nt,br,Zr,hi,er),Se.top+=-Zr*er,Se.bottom=Se.top+er,Se.left+=-br*hi,Se.right=Se.left+hi,Se.hasBaseline=gi}(Ee,e,s,c,ie,y,v,T,P,A,D,G),!function(Se){for(const Ve of Se)if(Ve.positionedGlyphs.length!==0)return!1;return!0}(we)&&Ee}const xp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},XC={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Qv(r,e,s,c,f,p){if(e.imageName){const y=c[e.imageName];return y?y.displaySize[0]*e.scale*Fr/p+f:0}{const y=s[e.fontStack],v=y&&y.glyphs[r];return v?v.metrics.advance*e.scale+f:0}}function Jv(r,e,s,c){const f=Math.pow(r-e,2);return c?r<e?f/2:2*f:f+Math.abs(s)*s}function KC(r,e,s){let c=0;return r===10&&(c-=1e4),s&&(c+=150),r!==40&&r!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function e1(r,e,s,c,f,p){let y=null,v=Jv(e,s,f,p);for(const T of c){const A=Jv(e-T.x,s,f,p)+T.badness;A<=v&&(y=T,v=A)}return{index:r,x:e,priorBreak:y,badness:v}}function t1(r){return r?t1(r.priorBreak).concat(r.index):[]}function fg(r,e,s,c,f,p,y){if(p!=="point")return[];if(!r)return[];const v=[],T=function(D,U,j,G,K,ie){let le=0;for(let ge=0;ge<D.length();ge++){const we=D.getSection(ge);le+=Qv(D.getCharCode(ge),we,G,K,U,ie)}return le/Math.max(1,Math.ceil(le/j))}(r,e,s,c,f,y),A=r.text.indexOf("\u200B")>=0;let M=0;for(let D=0;D<r.length();D++){const U=r.getSection(D),j=r.getCharCode(D);if(xp[j]||(M+=Qv(j,U,c,f,e,y)),D<r.length()-1){const G=!((P=j)<11904||!(N(P)||O(P)||Fe(P)||se(P)||J(P)||x(P)||$(P)||I(P)||he(P)||Y(P)||H(P)||Ye(P)||z(P)||E(P)||b(P)||Q(P)||L(P)||Me(P)||ae(P)||oe(P)));(XC[j]||G||U.imageName)&&v.push(e1(D+1,M,T,v,KC(j,r.getCharCode(D+1),G&&A),!1))}}var P;return t1(e1(r.length(),M,T,v,0,!0))}function dg(r){let e=.5,s=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function i1(r,e,s,c,f){if(!(e||s||c||f))return;const p=r.length-1,y=r[p],v=(y.x+y.metrics.advance*y.scale)*e;for(let T=0;T<=p;T++)r[T].x-=v,r[T].y+=s+c+f}function YC(r,e,s){const{horizontalAlign:c,verticalAlign:f}=dg(s),p=e[0]-r.displaySize[0]*c,y=e[1]-r.displaySize[1]*f;return{image:r,top:y,bottom:y+r.displaySize[1],left:p,right:p+r.displaySize[0]}}function r1(r,e,s,c,f,p){const y=r.image;let v;if(y.content){const K=y.content,ie=y.pixelRatio||1;v=[K[0]/ie,K[1]/ie,y.displaySize[0]-K[2]/ie,y.displaySize[1]-K[3]/ie]}const T=e.left*p,A=e.right*p;let M,P,D,U;s==="width"||s==="both"?(U=f[0]+T-c[3],P=f[0]+A+c[1]):(U=f[0]+(T+A-y.displaySize[0])/2,P=U+y.displaySize[0]);const j=e.top*p,G=e.bottom*p;return s==="height"||s==="both"?(M=f[1]+j-c[0],D=f[1]+G+c[2]):(M=f[1]+(j+G-y.displaySize[1])/2,D=M+y.displaySize[1]),{image:y,top:M,right:P,bottom:D,left:U,collisionPadding:v}}class $o extends k{constructor(e,s,c,f,p){super(e,s),this.angle=f,this.z=c,p!==void 0&&(this.segment=p)}clone(){return new $o(this.x,this.y,this.z,this.angle,this.segment)}}function n1(r,e,s,c,f){if(e.segment===void 0)return!0;let p=e,y=e.segment+1,v=0;for(;v>-s/2;){if(y--,y<0)return!1;v-=r[y].dist(p),p=r[y]}v+=r[y].dist(r[y+1]),y++;const T=[];let A=0;for(;v<s/2;){const M=r[y],P=r[y+1];if(!P)return!1;let D=r[y-1].angleTo(M)-M.angleTo(P);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:v,angleDelta:D}),A+=D;v-T[0].distance>c;)A-=T.shift().angleDelta;if(A>f)return!1;y++,v+=M.dist(P)}return!0}function s1(r){let e=0;for(let s=0;s<r.length-1;s++)e+=r[s].dist(r[s+1]);return e}function o1(r,e,s){return r?.6*e*s:0}function a1(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function QC(r,e,s,c,f,p){const y=o1(s,f,p),v=a1(s,c)*p;let T=0;const A=s1(r)/2;for(let M=0;M<r.length-1;M++){const P=r[M],D=r[M+1],U=P.dist(D);if(T+U>A){const j=(A-T)/U,G=vi(P.x,D.x,j),K=vi(P.y,D.y,j),ie=new $o(G,K,0,D.angleTo(P),M);return!y||n1(r,ie,v,y,e)?ie:void 0}T+=U}}function JC(r,e,s,c,f,p,y,v,T){const A=o1(c,p,y),M=a1(c,f),P=M*y,D=r[0].x===0||r[0].x===T||r[0].y===0||r[0].y===T;return e-P<e/4&&(e=P+e/4),l1(r,D?e/2*v%e:(M/2+2*p)*y*v%e,e,A,s,P,D,!1,T)}function l1(r,e,s,c,f,p,y,v,T){const A=p/2,M=s1(r);let P=0,D=e-s,U=[];for(let j=0;j<r.length-1;j++){const G=r[j],K=r[j+1],ie=G.dist(K),le=K.angleTo(G);for(;D+s<P+ie;){D+=s;const ge=(D-P)/ie,we=vi(G.x,K.x,ge),Ee=vi(G.y,K.y,ge);if(we>=0&&we<T&&Ee>=0&&Ee<T&&D-A>=0&&D+A<=M){const Se=new $o(we,Ee,0,le,j);Se._round(),c&&!n1(r,Se,p,c,f)||U.push(Se)}}P+=ie}return v||U.length||y||(U=l1(r,P/2,s,c,f,p,y,!0,T)),U}function c1(r,e,s,c,f){const p=[];for(let y=0;y<r.length;y++){const v=r[y];let T;for(let A=0;A<v.length-1;A++){let M=v[A],P=v[A+1];M.x<e&&P.x<e||(M.x<e?M=new k(e,M.y+(e-M.x)/(P.x-M.x)*(P.y-M.y))._round():P.x<e&&(P=new k(e,M.y+(e-M.x)/(P.x-M.x)*(P.y-M.y))._round()),M.y<s&&P.y<s||(M.y<s?M=new k(M.x+(s-M.y)/(P.y-M.y)*(P.x-M.x),s)._round():P.y<s&&(P=new k(M.x+(s-M.y)/(P.y-M.y)*(P.x-M.x),s)._round()),M.x>=c&&P.x>=c||(M.x>=c?M=new k(c,M.y+(c-M.x)/(P.x-M.x)*(P.y-M.y))._round():P.x>=c&&(P=new k(c,M.y+(c-M.x)/(P.x-M.x)*(P.y-M.y))._round()),M.y>=f&&P.y>=f||(M.y>=f?M=new k(M.x+(f-M.y)/(P.y-M.y)*(P.x-M.x),f)._round():P.y>=f&&(P=new k(M.x+(f-M.y)/(P.y-M.y)*(P.x-M.x),f)._round()),T&&M.equals(T[T.length-1])||(T=[M],p.push(T)),T.push(P)))))}}return p}Et("Anchor",$o);const Yh=1e20;function u1(r,e,s,c,f,p,y,v,T){for(let A=e;A<e+c;A++)h1(r,s*p+A,p,f,y,v,T);for(let A=s;A<s+f;A++)h1(r,A*p+e,1,c,y,v,T)}function h1(r,e,s,c,f,p,y){p[0]=0,y[0]=-Yh,y[1]=Yh,f[0]=r[e];for(let v=1,T=0,A=0;v<c;v++){f[v]=r[e+v*s];const M=v*v;do{const P=p[T];A=(f[v]-f[P]+M-P*P)/(v-P)/2}while(A<=y[T]&&--T>-1);T++,p[T]=v,y[T]=A,y[T+1]=Yh}for(let v=0,T=0;v<c;v++){for(;y[T+1]<v;)T++;const A=p[T],M=v-A;r[e+v*s]=f[A]+M*M}}const pg={none:0,ideographs:1,all:2};class uu{constructor(e,s,c){this.requestManager=e,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,s){const c=[];for(const f in e)for(const p of e[f])c.push({stack:f,id:p});Oe(c,({stack:f,id:p},y)=>{let v=this.entries[f];v||(v=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=v.glyphs[p];if(T!==void 0)return void y(null,{stack:f,id:p,glyph:T});if(T=this._tinySDF(v,f,p),T)return v.glyphs[p]=T,void y(null,{stack:f,id:p,glyph:T});const A=Math.floor(p/256);if(256*A>65535)return void y(new Error("glyphs > 65535 not supported"));if(v.ranges[A])return void y(null,{stack:f,id:p,glyph:T});let M=v.requests[A];M||(M=v.requests[A]=[],uu.loadGlyphRange(f,A,this.url,this.requestManager,(P,D)=>{if(D){v.ascender=D.ascender,v.descender=D.descender;for(const U in D.glyphs)this._doesCharSupportLocalGlyph(+U)||(v.glyphs[+U]=D.glyphs[+U]);v.ranges[A]=!0}for(const U of M)U(P,D);delete v.requests[A]})),M.push((P,D)=>{P?y(P):D&&y(null,{stack:f,id:p,glyph:D.glyphs[p]||null})})},(f,p)=>{if(f)s(f);else if(p){const y={};for(const{stack:v,id:T,glyph:A}of p)y[v]===void 0&&(y[v]={}),y[v].glyphs===void 0&&(y[v].glyphs={}),y[v].glyphs[T]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},y[v].ascender=this.entries[v].ascender,y[v].descender=this.entries[v].descender;s(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==pg.none&&(this.localGlyphMode===pg.all?!!this.localFontFamily:!!this.localFontFamily&&(Y(e)||ne(e)||z(e)||L(e))||I(e))}_tinySDF(e,s,c){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(c))return;let p=e.tinySDF;if(!p){let G="400";/bold/i.test(s)?G="900":/medium/i.test(s)?G="500":/light/i.test(s)&&(G="200"),p=e.tinySDF=new uu.TinySDF({fontFamily:f,fontWeight:G,fontSize:48,buffer:6,radius:16}),p.fontWeight=G}if(this.localGlyphs[p.fontWeight][c])return this.localGlyphs[p.fontWeight][c];const y=String.fromCharCode(c),{data:v,width:T,height:A,glyphWidth:M,glyphHeight:P,glyphLeft:D,glyphTop:U,glyphAdvance:j}=p.draw(y);return this.localGlyphs[p.fontWeight][c]={id:c,bitmap:new Ta({width:T,height:A},v),metrics:{width:M/2,height:P/2,left:D/2,top:U/2-27,advance:j/2,localGlyph:!0}}}}function f1(r,e,s,c){const f=[],p=r.image,y=p.pixelRatio,v=p.paddedRect.w-2,T=p.paddedRect.h-2,A=r.right-r.left,M=r.bottom-r.top,P=p.stretchX||[[0,v]],D=p.stretchY||[[0,T]],U=(je,at)=>je+at[1]-at[0],j=P.reduce(U,0),G=D.reduce(U,0),K=v-j,ie=T-G;let le=0,ge=j,we=0,Ee=G,Se=0,Ve=K,Ne=0,ft=ie;if(p.content&&c){const je=p.content;le=vp(P,0,je[0]),we=vp(D,0,je[1]),ge=vp(P,je[0],je[2]),Ee=vp(D,je[1],je[3]),Se=je[0]-le,Ne=je[1]-we,Ve=je[2]-je[0]-ge,ft=je[3]-je[1]-Ee}const ot=(je,at,pt,He)=>{const vt=bp(je.stretch-le,ge,A,r.left),Ct=wp(je.fixed-Se,Ve,je.stretch,j),oi=bp(at.stretch-we,Ee,M,r.top),zi=wp(at.fixed-Ne,ft,at.stretch,G),ui=bp(pt.stretch-le,ge,A,r.left),hi=wp(pt.fixed-Se,Ve,pt.stretch,j),nt=bp(He.stretch-we,Ee,M,r.top),gi=wp(He.fixed-Ne,ft,He.stretch,G),di=new k(vt,oi),lr=new k(ui,oi),er=new k(ui,nt),br=new k(vt,nt),Zr=new k(Ct/y,zi/y),yi=new k(hi/y,gi/y),si=e*Math.PI/180;if(si){const ir=Math.sin(si),fr=Math.cos(si),Lr=[fr,-ir,ir,fr];di._matMult(Lr),lr._matMult(Lr),br._matMult(Lr),er._matMult(Lr)}const $i=je.stretch+je.fixed,cr=at.stretch+at.fixed;return{tl:di,tr:lr,bl:br,br:er,tex:{x:p.paddedRect.x+1+$i,y:p.paddedRect.y+1+cr,w:pt.stretch+pt.fixed-$i,h:He.stretch+He.fixed-cr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zr,pixelOffsetBR:yi,minFontScaleX:Ve/y/A,minFontScaleY:ft/y/M,isSDF:s}};if(c&&(p.stretchX||p.stretchY)){const je=d1(P,K,j),at=d1(D,ie,G);for(let pt=0;pt<je.length-1;pt++){const He=je[pt],vt=je[pt+1];for(let Ct=0;Ct<at.length-1;Ct++)f.push(ot(He,at[Ct],vt,at[Ct+1]))}}else f.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:T+1}));return f}function vp(r,e,s){let c=0;for(const f of r)c+=Math.max(e,Math.min(s,f[1]))-Math.max(e,Math.min(s,f[0]));return c}function d1(r,e,s){const c=[{fixed:-1,stretch:0}];for(const[f,p]of r){const y=c[c.length-1];c.push({fixed:f-y.stretch,stretch:y.stretch}),c.push({fixed:f-y.stretch,stretch:y.stretch+(p-f)})}return c.push({fixed:e+1,stretch:s}),c}function bp(r,e,s,c){return r/e*s+c}function wp(r,e,s,c){return r-e*s/c}function eI(r,e,s,c){const f=e+r.positionedLines[c].lineOffset;return c===0?s+f/2:s+(f+(e+r.positionedLines[c-1].lineOffset))/2}uu.loadGlyphRange=function(r,e,s,c,f){const p=256*e,y=p+255,v=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",r).replace("{range}",`${p}-${y}`),_c.Glyphs);ll(v,(T,A)=>{if(T)f(T);else if(A){const M={},P=function(D){return new Xh(D).readFields(ZC,{})}(A);for(const D of P.glyphs)M[D.id]=D;f(null,{glyphs:M,ascender:P.ascender,descender:P.descender})}})},uu.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:s=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:p="normal",fontStyle:y="normal"}){this.buffer=e,this.cutoff=c,this.radius=s;const v=this.size=r+4*e,T=this._createCanvas(v),A=this.ctx=T.getContext("2d",{willReadFrequently:!0});A.font=`${y} ${p} ${r}px ${f}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:p}=this.ctx.measureText(r),y=Math.floor(s),v=Math.min(this.size-this.buffer,Math.ceil(p-f)),T=Math.min(this.size-this.buffer,Math.ceil(s)+Math.ceil(c)),A=v+2*this.buffer,M=T+2*this.buffer,P=A*M,D=new Uint8ClampedArray(P),U={data:D,width:A,height:M,glyphWidth:v,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(v===0||T===0)return U;const{ctx:j,buffer:G,gridInner:K,gridOuter:ie}=this;j.clearRect(G,G,v,T),j.fillText(r,G,G+y+1);const le=j.getImageData(G,G,v,T);ie.fill(Yh,0,P),K.fill(0,0,P);for(let ge=0;ge<T;ge++)for(let we=0;we<v;we++){const Ee=le.data[4*(ge*v+we)+3]/255;if(Ee===0)continue;const Se=(ge+G)*A+we+G;if(Ee===1)ie[Se]=0,K[Se]=Yh;else{const Ve=.5-Ee;ie[Se]=Ve>0?Ve*Ve:0,K[Se]=Ve<0?Ve*Ve:0}}u1(ie,0,0,A,M,A,this.f,this.v,this.z),u1(K,G,G,v,T,A,this.f,this.v,this.z);for(let ge=0;ge<P;ge++){const we=Math.sqrt(ie[ge])-Math.sqrt(K[ge]);D[ge]=Math.round(255-255*(we/this.radius+this.cutoff))}return U}};class tI{constructor(e=[],s=iI){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:c}=this,f=s[e];for(;e>0;){const p=e-1>>1,y=s[p];if(c(f,y)>=0)break;s[e]=y,e=p}s[e]=f}_down(e){const{data:s,compare:c}=this,f=this.length>>1,p=s[e];for(;e<f;){let y=1+(e<<1),v=s[y];const T=y+1;if(T<this.length&&c(s[T],v)<0&&(y=T,v=s[T]),c(v,p)>=0)break;s[e]=v,e=y}s[e]=p}}function iI(r,e){return r<e?-1:r>e?1:0}function rI(r,e=1,s=!1){let c=1/0,f=1/0,p=-1/0,y=-1/0;const v=r[0];for(let U=0;U<v.length;U++){const j=v[U];(!U||j.x<c)&&(c=j.x),(!U||j.y<f)&&(f=j.y),(!U||j.x>p)&&(p=j.x),(!U||j.y>y)&&(y=j.y)}const T=Math.min(p-c,y-f);let A=T/2;const M=new tI([],nI);if(T===0)return new k(c,f);for(let U=c;U<p;U+=T)for(let j=f;j<y;j+=T)M.push(new hu(U+A,j+A,A,r));let P=function(U){let j=0,G=0,K=0;const ie=U[0];for(let le=0,ge=ie.length,we=ge-1;le<ge;we=le++){const Ee=ie[le],Se=ie[we],Ve=Ee.x*Se.y-Se.x*Ee.y;G+=(Ee.x+Se.x)*Ve,K+=(Ee.y+Se.y)*Ve,j+=3*Ve}return new hu(G/j,K/j,0,U)}(r),D=M.length;for(;M.length;){const U=M.pop();(U.d>P.d||!P.d)&&(P=U,s&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,D)),U.max-P.d<=e||(A=U.h/2,M.push(new hu(U.p.x-A,U.p.y-A,A,r)),M.push(new hu(U.p.x+A,U.p.y-A,A,r)),M.push(new hu(U.p.x-A,U.p.y+A,A,r)),M.push(new hu(U.p.x+A,U.p.y+A,A,r)),D+=4)}return s&&(console.log(`num probes: ${D}`),console.log(`best distance: ${P.d}`)),P.p}function nI(r,e){return e.max-r.max}function hu(r,e,s,c){this.p=new k(r,e),this.h=s,this.d=function(f,p){let y=!1,v=1/0;for(let T=0;T<p.length;T++){const A=p[T];for(let M=0,P=A.length,D=P-1;M<P;D=M++){const U=A[M],j=A[D];U.y>f.y!=j.y>f.y&&f.x<(j.x-U.x)*(f.y-U.y)/(j.y-U.y)+U.x&&(y=!y),v=Math.min(v,bv(f,U,j))}}return(y?1:-1)*Math.sqrt(v)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const mg=Number.POSITIVE_INFINITY,sI=Math.sqrt(2);function p1(r,e){return e[1]!==mg?function(s,c,f){let p=0,y=0;switch(c=Math.abs(c),f=Math.abs(f),s){case"top-right":case"top-left":case"top":y=f-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-f}switch(s){case"top-right":case"bottom-right":case"right":p=-c;break;case"top-left":case"bottom-left":case"left":p=c}return[p,y]}(r,e[0],e[1]):function(s,c){let f=0,p=0;c<0&&(c=0);const y=c/sI;switch(s){case"top-right":case"top-left":p=y-7;break;case"bottom-right":case"bottom-left":p=7-y;break;case"bottom":p=7-c;break;case"top":p=c-7}switch(s){case"top-right":case"bottom-right":f=-y;break;case"top-left":case"bottom-left":f=y;break;case"left":f=c;break;case"right":f=-c}return[f,p]}(r,e[0])}function oI(r,e,s,c,f,p,y,v,T,A){r.createArrays(),r.tilePixelRatio=ti/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const M=r.layers[0].layout,P=r.layers[0]._unevaluatedLayout._values,D={};if(r.textSizeData.kind==="composite"){const{minZoom:G,maxZoom:K}=r.textSizeData;D.compositeTextSizes=[P["text-size"].possiblyEvaluate(new $t(G),v),P["text-size"].possiblyEvaluate(new $t(K),v)]}if(r.iconSizeData.kind==="composite"){const{minZoom:G,maxZoom:K}=r.iconSizeData;D.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new $t(G),v),P["icon-size"].possiblyEvaluate(new $t(K),v)]}D.layoutTextSize=P["text-size"].possiblyEvaluate(new $t(T+1),v),D.layoutIconSize=P["icon-size"].possiblyEvaluate(new $t(T+1),v),D.textMaxSize=P["text-size"].possiblyEvaluate(new $t(18),v);const U=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",j=M.get("text-size");for(const G of r.features){const K=M.get("text-font").evaluate(G,{},v).join(","),ie=j.evaluate(G,{},v),le=D.layoutTextSize.evaluate(G,{},v),ge=(D.layoutIconSize.evaluate(G,{},v),{horizontal:{},vertical:void 0}),we=G.text;let Ee,Se=[0,0];if(we){const ft=we.toString(),ot=M.get("text-letter-spacing").evaluate(G,{},v)*Fr,je=M.get("text-line-height").evaluate(G,{},v)*Fr,at=De(ft)?ot:0,pt=M.get("text-anchor").evaluate(G,{},v),He=M.get("text-variable-anchor");if(!He){const hi=M.get("text-radial-offset").evaluate(G,{},v);Se=hi?p1(pt,[hi*Fr,mg]):M.get("text-offset").evaluate(G,{},v).map(nt=>nt*Fr)}let vt=U?"center":M.get("text-justify").evaluate(G,{},v);const Ct=M.get("symbol-placement"),oi=Ct==="point",zi=Ct==="point"?M.get("text-max-width").evaluate(G,{},v)*Fr:0,ui=hi=>{r.allowVerticalPlacement&&Ue(ft)&&(ge.vertical=hg(we,e,s,f,K,zi,je,pt,hi,at,Se,Yn.vertical,!0,Ct,le,ie))};if(!U&&He){const hi=vt==="auto"?He.map(gi=>_g(gi)):[vt];let nt=!1;for(let gi=0;gi<hi.length;gi++){const di=hi[gi];if(!ge.horizontal[di])if(nt)ge.horizontal[di]=ge.horizontal[0];else{const lr=hg(we,e,s,f,K,zi,je,"center",di,at,Se,Yn.horizontal,!1,Ct,le,ie);lr&&(ge.horizontal[di]=lr,nt=lr.positionedLines.length===1)}}ui("left")}else{if(vt==="auto"&&(vt=_g(pt)),oi||M.get("text-writing-mode").indexOf("horizontal")>=0||!Ue(ft)){const hi=hg(we,e,s,f,K,zi,je,pt,vt,at,Se,Yn.horizontal,!1,Ct,le,ie);hi&&(ge.horizontal[vt]=hi)}ui(Ct==="point"?"left":vt)}}let Ve=!1;if(G.icon&&G.icon.name){const ft=c[G.icon.name];ft&&(Ee=YC(f[G.icon.name],M.get("icon-offset").evaluate(G,{},v),M.get("icon-anchor").evaluate(G,{},v)),Ve=ft.sdf,r.sdfIcons===void 0?r.sdfIcons=ft.sdf:r.sdfIcons!==ft.sdf&&pi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ft.pixelRatio!==r.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}const Ne=_1(ge.horizontal)||ge.vertical;r.iconsInText||(r.iconsInText=!!Ne&&Ne.iconsInText),(Ne||Ee)&&aI(r,G,ge,Ee,c,D,le,0,Se,Ve,y,v,A)}p&&r.generateCollisionDebugBuffers(T,r.collisionBoxArray)}function _g(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function aI(r,e,s,c,f,p,y,v,T,A,M,P,D){let U=p.textMaxSize.evaluate(e,{},P);U===void 0&&(U=y);const j=r.layers[0].layout,G=j.get("icon-offset").evaluate(e,{},P),K=_1(s.horizontal)||s.vertical,ie=y/24,le=r.tilePixelRatio*U/24,ge=r.tilePixelRatio*j.get("symbol-spacing"),we=j.get("text-padding")*r.tilePixelRatio,Ee=j.get("icon-padding")*r.tilePixelRatio,Se=me(j.get("text-max-angle")),Ve=j.get("text-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Ne=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",ft=j.get("symbol-placement"),ot=ge/2,je=j.get("icon-text-fit");let at;c&&je!=="none"&&(r.allowVerticalPlacement&&s.vertical&&(at=r1(c,s.vertical,je,j.get("icon-text-fit-padding"),G,ie)),K&&(c=r1(c,K,je,j.get("icon-text-fit-padding"),G,ie)));const pt=(He,vt,Ct)=>{if(vt.x<0||vt.x>=ti||vt.y<0||vt.y>=ti)return;const{x:oi,y:zi,z:ui}=D.projectTilePoint(vt.x,vt.y,Ct),hi=new $o(oi,zi,ui,0,void 0);(function(nt,gi,di,lr,er,br,Zr,yi,si,$i,cr,ir,fr,Lr,gn,yn,Vi,wr,ys,kr,Ii,Tr,Gi,Wr,dr){const Hr=nt.addToLineVertexArray(gi,lr);let sn,on,Er,$s,mu,nf,sf,Y1=0,Q1=0,J1=0,eb=0,Fg=-1,Lg=-1;const go={};let tb=Nh(""),Og=0,Bg=0;if(si._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Og,Bg]=si.layout.get("text-offset").evaluate(Ii,{},dr).map(Pn=>Pn*Fr):(Og=si.layout.get("text-radial-offset").evaluate(Ii,{},dr)*Fr,Bg=mg),nt.allowVerticalPlacement&&er.vertical){const Pn=er.vertical;if(gn)nf=gg(Pn),yi&&(sf=gg(yi));else{const Dn=si.layout.get("text-rotate").evaluate(Ii,{},dr)+90;Er=Tp($i,di,gi,cr,ir,fr,Pn,Lr,Dn,yn),yi&&($s=Tp($i,di,gi,cr,ir,fr,yi,wr,Dn))}}if(br){const Pn=si.layout.get("icon-rotate").evaluate(Ii,{},dr),Dn=si.layout.get("icon-text-fit")!=="none",of=f1(br,Pn,Gi,Dn),Ng=yi?f1(yi,Pn,Gi,Dn):void 0;on=Tp($i,di,gi,cr,ir,fr,br,wr,Pn),Y1=4*of.length;const ib=nt.iconSizeData;let Vl=null;ib.kind==="source"?(Vl=[fo*si.layout.get("icon-size").evaluate(Ii,{},dr)],Vl[0]>Sa&&pi(`${nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ib.kind==="composite"&&(Vl=[fo*Tr.compositeIconSizes[0].evaluate(Ii,{},dr),fo*Tr.compositeIconSizes[1].evaluate(Ii,{},dr)],(Vl[0]>Sa||Vl[1]>Sa)&&pi(`${nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),nt.addSymbols(nt.icon,of,Vl,kr,ys,Ii,!1,di,gi,Hr.lineStartIndex,Hr.lineLength,-1,Wr,dr),Fg=nt.icon.placedSymbolArray.length-1,Ng&&(Q1=4*Ng.length,nt.addSymbols(nt.icon,Ng,Vl,kr,ys,Ii,Yn.vertical,di,gi,Hr.lineStartIndex,Hr.lineLength,-1,Wr,dr),Lg=nt.icon.placedSymbolArray.length-1)}for(const Pn in er.horizontal){const Dn=er.horizontal[Pn];sn||(tb=Nh(Dn.text),gn?mu=gg(Dn):sn=Tp($i,di,gi,cr,ir,fr,Dn,Lr,si.layout.get("text-rotate").evaluate(Ii,{},dr),yn));const of=Dn.positionedLines.length===1;if(J1+=m1(nt,di,gi,Dn,Zr,si,gn,Ii,yn,Hr,er.vertical?Yn.horizontal:Yn.horizontalOnly,of?Object.keys(er.horizontal):[Pn],go,Fg,Tr,Wr,dr),of)break}er.vertical&&(eb+=m1(nt,di,gi,er.vertical,Zr,si,gn,Ii,yn,Hr,Yn.vertical,["vertical"],go,Lg,Tr,Wr,dr));let ka=-1;const Ug=(Pn,Dn)=>Pn?Math.max(Pn,Dn):Dn;ka=Ug(mu,ka),ka=Ug(nf,ka),ka=Ug(sf,ka);const LI=ka>-1?1:0;nt.glyphOffsetArray.length>=Aa.MAX_GLYPHS&&pi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ii.sortKey!==void 0&&nt.addToSortKeyRanges(nt.symbolInstances.length,Ii.sortKey),nt.symbolInstances.emplaceBack(di.x,di.y,di.z,gi.x,gi.y,go.right>=0?go.right:-1,go.center>=0?go.center:-1,go.left>=0?go.left:-1,go.vertical>=0?go.vertical:-1,Fg,Lg,tb,sn!==void 0?sn:nt.collisionBoxArray.length,sn!==void 0?sn+1:nt.collisionBoxArray.length,Er!==void 0?Er:nt.collisionBoxArray.length,Er!==void 0?Er+1:nt.collisionBoxArray.length,on!==void 0?on:nt.collisionBoxArray.length,on!==void 0?on+1:nt.collisionBoxArray.length,$s||nt.collisionBoxArray.length,$s?$s+1:nt.collisionBoxArray.length,cr,J1,eb,Y1,Q1,LI,0,Og,Bg,ka)})(r,vt,hi,He,s,c,f,at,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,we,Ve,T,0,Ee,Ne,G,e,p,A,M,P)};if(ft==="line")for(const He of c1(e.geometry,0,0,ti,ti)){const vt=JC(He,ge,Se,s.vertical||K,c,24,le,r.overscaling,ti);for(const Ct of vt){const oi=K;oi&&lI(r,oi.text,ot,Ct)||pt(He,Ct,P)}}else if(ft==="line-center"){for(const He of e.geometry)if(He.length>1){const vt=QC(He,Se,s.vertical||K,c,24,le);vt&&pt(He,vt,P)}}else if(e.type==="Polygon")for(const He of rg(e.geometry,0)){const vt=rI(He,16);pt(He[0],new $o(vt.x,vt.y,0,0,void 0),P)}else if(e.type==="LineString")for(const He of e.geometry)pt(He,new $o(He[0].x,He[0].y,0,0,void 0),P);else if(e.type==="Point")for(const He of e.geometry)for(const vt of He)pt([vt],new $o(vt.x,vt.y,0,0,void 0),P)}const Sa=32640;function m1(r,e,s,c,f,p,y,v,T,A,M,P,D,U,j,G,K){const ie=function(we,Ee,Se,Ve,Ne,ft,ot,je){const at=[];if(Ee.positionedLines.length===0)return at;const pt=Ve.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,He=function(ui){const hi=ui[0],nt=ui[1],gi=hi*nt;return gi>0?[hi,-nt]:gi<0?[-hi,nt]:hi===0?[nt,hi]:[nt,-hi]}(Se);let vt=Math.abs(Ee.top-Ee.bottom);for(const ui of Ee.positionedLines)vt-=ui.lineOffset;const Ct=Ee.positionedLines.length,oi=vt/Ct;let zi=Ee.top-Se[1];for(let ui=0;ui<Ct;++ui){const hi=Ee.positionedLines[ui];zi=eI(Ee,oi,zi,ui);for(const nt of hi.positionedGlyphs){if(!nt.rect)continue;const gi=nt.rect||{};let di=4,lr=!0,er=1,br=0;if(nt.imageName){const Gi=ot[nt.imageName];if(!Gi)continue;if(Gi.sdf){pi("SDF images are not supported in formatted text and will be ignored.");continue}lr=!1,er=Gi.pixelRatio,di=1/er}const Zr=(Ne||je)&&nt.vertical,yi=nt.metrics.advance*nt.scale/2,si=nt.metrics,$i=nt.rect;if($i===null)continue;je&&Ee.verticalizable&&(br=nt.imageName?yi-nt.metrics.width*nt.scale/2:0);const cr=Ne?[nt.x+yi,nt.y]:[0,0];let ir=[0,0],fr=[0,0],Lr=!1;Ne||(Zr?(fr=[nt.x+yi+He[0],nt.y+He[1]-br],Lr=!0):ir=[nt.x+yi+Se[0],nt.y+Se[1]-br]);const gn=$i.w*nt.scale/(er*(nt.localGlyph?2:1)),yn=$i.h*nt.scale/(er*(nt.localGlyph?2:1));let Vi,wr,ys,kr;if(Zr){const Gi=nt.y-zi,Wr=new k(-yi,yi-Gi),dr=-Math.PI/2,Hr=new k(...fr);Vi=new k(-yi+ir[0],ir[1]),Vi._rotateAround(dr,Wr)._add(Hr),Vi.x+=-Gi+yi,Vi.y-=(si.left-di)*nt.scale;const sn=nt.imageName?si.advance*nt.scale:Fr*nt.scale,on=String.fromCharCode(nt.glyph);FC(on)?Vi.x+=(1-di)*nt.scale:LC(on)?Vi.x+=sn-si.height*nt.scale+(-di-1)*nt.scale:Vi.x+=nt.imageName||si.width+2*di===$i.w&&si.height+2*di===$i.h?(sn-yn)/2:(sn-(si.height+2*di)*nt.scale)/2,wr=new k(Vi.x,Vi.y-gn),ys=new k(Vi.x+yn,Vi.y),kr=new k(Vi.x+yn,Vi.y-gn)}else{const Gi=(si.left-di)*nt.scale-yi+ir[0],Wr=(-si.top-di)*nt.scale+ir[1],dr=Gi+gn,Hr=Wr+yn;Vi=new k(Gi,Wr),wr=new k(dr,Wr),ys=new k(Gi,Hr),kr=new k(dr,Hr)}if(pt){let Gi;Gi=Ne?new k(0,0):Lr?new k(He[0],He[1]):new k(Se[0],Se[1]),Vi._rotateAround(pt,Gi),wr._rotateAround(pt,Gi),ys._rotateAround(pt,Gi),kr._rotateAround(pt,Gi)}const Ii=new k(0,0),Tr=new k(0,0);at.push({tl:Vi,tr:wr,bl:ys,br:kr,tex:gi,writingMode:Ee.writingMode,glyphOffset:cr,sectionIndex:nt.sectionIndex,isSDF:lr,pixelOffsetTL:Ii,pixelOffsetBR:Tr,minFontScaleX:0,minFontScaleY:0})}}return at}(0,c,T,p,y,v,f,r.allowVerticalPlacement),le=r.textSizeData;let ge=null;le.kind==="source"?(ge=[fo*p.layout.get("text-size").evaluate(v,{},K)],ge[0]>Sa&&pi(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):le.kind==="composite"&&(ge=[fo*j.compositeTextSizes[0].evaluate(v,{},K),fo*j.compositeTextSizes[1].evaluate(v,{},K)],(ge[0]>Sa||ge[1]>Sa)&&pi(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,ie,ge,T,y,v,M,e,s,A.lineStartIndex,A.lineLength,U,G,K);for(const we of P)D[we]=r.text.placedSymbolArray.length-1;return 4*ie.length}function _1(r){for(const e in r)return r[e];return null}function Tp(r,e,s,c,f,p,y,v,T,A){let M=y.top,P=y.bottom,D=y.left,U=y.right;const j=y.collisionPadding;if(j&&(D-=j[0],M-=j[1],U+=j[2],P+=j[3]),T){const G=new k(D,M),K=new k(U,M),ie=new k(D,P),le=new k(U,P),ge=me(T);let we=new k(0,0);A&&(we=new k(A[0],A[1])),G._rotateAround(ge,we),K._rotateAround(ge,we),ie._rotateAround(ge,we),le._rotateAround(ge,we),D=Math.min(G.x,K.x,ie.x,le.x),U=Math.max(G.x,K.x,ie.x,le.x),M=Math.min(G.y,K.y,ie.y,le.y),P=Math.max(G.y,K.y,ie.y,le.y)}return r.emplaceBack(e.x,e.y,e.z,s.x,s.y,D,M,U,P,v,c,f,p),r.length-1}function gg(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function lI(r,e,s,c){const f=r.compareText;if(e in f){const p=f[e];for(let y=p.length-1;y>=0;y--)if(c.dist(p[y])<s)return!0}else f[e]=[];return f[e].push(c),!1}const cI=Bl.VectorTileFeature.types,uI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ep(r,e,s,c,f,p,y,v,T,A,M,P,D,U,j,G){const K=M?Math.min(Sa,Math.round(M[0])):0,ie=M?Math.min(Sa,Math.round(M[1])):0;r.emplaceBack(e,s,Math.round(32*y),Math.round(32*v),T,A,(K<<1)+(P?1:0),ie,16*D,16*U,256*j,256*G,c,f,p,0)}function yg(r,e,s){r.emplaceBack(e.x,e.y,s),r.emplaceBack(e.x,e.y,s),r.emplaceBack(e.x,e.y,s),r.emplaceBack(e.x,e.y,s)}function hI(r){for(const e of r.sections)if(ut(e.text))return!0;return!1}class xg{constructor(e){this.layoutVertexArray=new D_,this.indexArray=new Xn,this.programConfigurations=e,this.segments=new or,this.dynamicLayoutVertexArray=new Qc,this.opacityVertexArray=new z_,this.placedSymbolArray=new ev}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,s,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,IC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,MC.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,uI,!0),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Et("SymbolBuffers",xg);class vg{constructor(e,s,c){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new c,this.segments=new or,this.collisionVertexArray=new L_,this.collisionVertexArrayExt=new Qc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,kC.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,PC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Et("CollisionBuffers",vg);class Aa{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=q([]),this.placementViewportMatrix=q([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ag(this.zoom,s["text-size"]),this.iconSizeData=ag(this.zoom,s["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),p=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(y=>Yn[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new xg(new Fl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new xg(new Fl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new rv,this.lineVertexArray=new nv,this.symbolInstances=new iv}calculateGlyphDependencies(e,s,c,f,p){for(let y=0;y<e.length;y++)if(s[e.charCodeAt(y)]=!0,f&&p){const v=Hh[e.charAt(y)];v&&(s[v.charCodeAt(0)]=!0)}}populate(e,s,c,f){const p=this.layers[0],y=p.layout,v=y.get("text-font"),T=y.get("text-field"),A=y.get("icon-image"),M=(T.value.kind!=="constant"||T.value.value instanceof qt&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),P=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,D=y.get("symbol-sort-key");if(this.features=[],!M&&!P)return;const U=s.iconDependencies,j=s.glyphDependencies,G=s.availableImages,K=new $t(this.zoom);for(const{feature:ie,id:le,index:ge,sourceLayerIndex:we}of e){const Ee=p._featureFilter.needGeometry,Se=Ol(ie,Ee);if(!p._featureFilter.filter(K,Se,c))continue;let Ve,Ne;if(Ee||(Se.geometry=jo(ie,c,f)),M){const ot=p.getValueAndResolveTokens("text-field",Se,c,G),je=qt.factory(ot);hI(je)&&(this.hasRTLText=!0),(!this.hasRTLText||In()==="unavailable"||this.hasRTLText&&ci.isParsed())&&(Ve=RC(je,p,Se))}if(P){const ot=p.getValueAndResolveTokens("icon-image",Se,c,G);Ne=ot instanceof Sn?ot:Sn.fromString(ot)}if(!Ve&&!Ne)continue;const ft=this.sortFeaturesByKey?D.evaluate(Se,{},c):void 0;if(this.features.push({id:le,text:Ve,icon:Ne,index:ge,sourceLayerIndex:we,geometry:Se.geometry,properties:ie.properties,type:cI[ie.type],sortKey:ft}),Ne&&(U[Ne.name]=!0),Ve){const ot=v.evaluate(Se,{},c).join(","),je=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Yn.vertical)>=0;for(const at of Ve.sections)if(at.image)U[at.image.name]=!0;else{const pt=Ue(Ve.toString()),He=at.fontStack||ot,vt=j[He]=j[He]||{};this.calculateGlyphDependencies(at.text,vt,je,this.allowVerticalPlacement,pt)}}}y.get("symbol-placement")==="line"&&(this.features=function(ie){const le={},ge={},we=[];let Ee=0;function Se(ot){we.push(ie[ot]),Ee++}function Ve(ot,je,at){const pt=ge[ot];return delete ge[ot],ge[je]=pt,we[pt].geometry[0].pop(),we[pt].geometry[0]=we[pt].geometry[0].concat(at[0]),pt}function Ne(ot,je,at){const pt=le[je];return delete le[je],le[ot]=pt,we[pt].geometry[0].shift(),we[pt].geometry[0]=at[0].concat(we[pt].geometry[0]),pt}function ft(ot,je,at){const pt=at?je[0][je[0].length-1]:je[0][0];return`${ot}:${pt.x}:${pt.y}`}for(let ot=0;ot<ie.length;ot++){const je=ie[ot],at=je.geometry,pt=je.text?je.text.toString():null;if(!pt){Se(ot);continue}const He=ft(pt,at),vt=ft(pt,at,!0);if(He in ge&&vt in le&&ge[He]!==le[vt]){const Ct=Ne(He,vt,at),oi=Ve(He,vt,we[Ct].geometry);delete le[He],delete ge[vt],ge[ft(pt,we[oi].geometry,!0)]=oi,we[Ct].geometry=null}else He in ge?Ve(He,vt,at):vt in le?Ne(He,vt,at):(Se(ot),le[He]=Ee-1,ge[vt]=Ee-1)}return we.filter(ot=>ot.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,le)=>ie.sortKey-le.sortKey)}update(e,s,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,c,f),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,c,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const c=this.lineVertexArray.length;if(e.segment!==void 0){let f=e.dist(s[e.segment+1]),p=e.dist(s[e.segment]);const y={};for(let v=e.segment+1;v<s.length;v++)y[v]={x:s[v].x,y:s[v].y,tileUnitDistanceFromAnchor:f},v<s.length-1&&(f+=s[v+1].dist(s[v]));for(let v=e.segment||0;v>=0;v--)y[v]={x:s[v].x,y:s[v].y,tileUnitDistanceFromAnchor:p},v>0&&(p+=s[v-1].dist(s[v]));for(let v=0;v<s.length;v++){const T=y[v];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,s,c,f,p,y,v,T,A,M,P,D,U,j){const G=e.indexArray,K=e.layoutVertexArray,ie=e.segments.prepareSegment(4*s.length,K,G,this.canOverlap?y.sortKey:void 0),le=this.glyphOffsetArray.length,ge=ie.vertexLength,we=this.allowVerticalPlacement&&v===Yn.vertical?Math.PI/2:0,Ee=y.text&&y.text.sections;for(let Se=0;Se<s.length;Se++){const{tl:Ve,tr:Ne,bl:ft,br:ot,tex:je,pixelOffsetTL:at,pixelOffsetBR:pt,minFontScaleX:He,minFontScaleY:vt,glyphOffset:Ct,isSDF:oi,sectionIndex:zi}=s[Se],ui=ie.vertexLength,hi=Ct[1];Ep(K,T.x,T.y,T.z,A.x,A.y,Ve.x,hi+Ve.y,je.x,je.y,c,oi,at.x,at.y,He,vt),Ep(K,T.x,T.y,T.z,A.x,A.y,Ne.x,hi+Ne.y,je.x+je.w,je.y,c,oi,pt.x,at.y,He,vt),Ep(K,T.x,T.y,T.z,A.x,A.y,ft.x,hi+ft.y,je.x,je.y+je.h,c,oi,at.x,pt.y,He,vt),Ep(K,T.x,T.y,T.z,A.x,A.y,ot.x,hi+ot.y,je.x+je.w,je.y+je.h,c,oi,pt.x,pt.y,He,vt),yg(e.dynamicLayoutVertexArray,T,we),G.emplaceBack(ui,ui+1,ui+2),G.emplaceBack(ui+1,ui+2,ui+3),ie.vertexLength+=4,ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ct[0]),Se!==s.length-1&&zi===s[Se+1].sectionIndex||e.programConfigurations.populatePaintArrays(K.length,y,y.index,{},U,j,Ee&&Ee[zi])}e.placedSymbolArray.emplaceBack(T.x,T.y,T.z,A.x,A.y,le,this.glyphOffsetArray.length-le,ge,M,P,A.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],v,0,!1,0,D,0)}_commitLayoutVertex(e,s,c,f,p,y,v){e.emplaceBack(s,c,f,p,y,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,s,c,f,p,y,v){const T=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),A=T.vertexLength,M=v.tileAnchorX,P=v.tileAnchorY;for(let U=0;U<4;U++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-e.padding,-e.padding),c.collisionVertexArrayExt.emplaceBack(s,e.padding,-e.padding),c.collisionVertexArrayExt.emplaceBack(s,e.padding,e.padding),c.collisionVertexArrayExt.emplaceBack(s,-e.padding,e.padding),this._commitLayoutVertex(c.layoutVertexArray,f,p,y,M,P,new k(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,p,y,M,P,new k(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,p,y,M,P,new k(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,f,p,y,M,P,new k(e.x1,e.y2)),T.vertexLength+=4;const D=c.indexArray;D.emplaceBack(A,A+1),D.emplaceBack(A+1,A+2),D.emplaceBack(A+2,A+3),D.emplaceBack(A+3,A),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,s,c,f,p,y){for(let v=f;v<p;v++){const T=c.get(v),A=this.getSymbolInstanceTextSize(e,y,s,v);this._addCollisionDebugVertices(T,A,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(e,s,c,f,p,y){for(let v=f;v<p;v++){const T=c.get(v),A=this.getSymbolInstanceIconSize(e,s,v);this._addCollisionDebugVertices(T,A,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}generateCollisionDebugBuffers(e,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vg(Jd,Gv.members,ba),this.iconCollisionBox=new vg(Jd,Gv.members,ba);const c=ou(this.iconSizeData,e),f=ou(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(f,e,s,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,e,s,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,e,s,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,e,s,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,s,c,f){const p=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:f),y=gp(this.textSizeData,e,p)/Fr;return this.tilePixelRatio*y}getSymbolInstanceIconSize(e,s,c){const f=this.icon.placedSymbolArray.get(c),p=gp(this.iconSizeData,e,f);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,s,c){e.emplaceBack(s,-c,-c),e.emplaceBack(s,c,-c),e.emplaceBack(s,c,c),e.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(e,s,c,f,p,y){for(let v=f;v<p;v++){const T=c.get(v),A=this.getSymbolInstanceTextSize(e,y,s,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,T.padding)}}_updateIconDebugCollisionBoxes(e,s,c,f,p){for(let y=f;y<p;y++){const v=c.get(y),T=this.getSymbolInstanceIconSize(e,s,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,v.padding)}}updateCollisionDebugBuffers(e,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=ou(this.iconSizeData,e),f=ou(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(f,e,s,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(f,e,s,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(c,e,s,y.iconBoxStartIndex,y.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,e,s,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,s,c,f,p,y,v,T,A){const M={};for(let P=s;P<c;P++){const D=e.get(P);M.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,padding:D.padding,projectedAnchorX:D.projectedAnchorX,projectedAnchorY:D.projectedAnchorY,projectedAnchorZ:D.projectedAnchorZ,tileAnchorX:D.tileAnchorX,tileAnchorY:D.tileAnchorY},M.textFeatureIndex=D.featureIndex;break}for(let P=f;P<p;P++){const D=e.get(P);M.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,padding:D.padding,projectedAnchorX:D.projectedAnchorX,projectedAnchorY:D.projectedAnchorY,projectedAnchorZ:D.projectedAnchorZ,tileAnchorX:D.tileAnchorX,tileAnchorY:D.tileAnchorY},M.verticalTextFeatureIndex=D.featureIndex;break}for(let P=y;P<v;P++){const D=e.get(P);M.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,padding:D.padding,projectedAnchorX:D.projectedAnchorX,projectedAnchorY:D.projectedAnchorY,projectedAnchorZ:D.projectedAnchorZ,tileAnchorX:D.tileAnchorX,tileAnchorY:D.tileAnchorY},M.iconFeatureIndex=D.featureIndex;break}for(let P=T;P<A;P++){const D=e.get(P);M.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,padding:D.padding,projectedAnchorX:D.projectedAnchorX,projectedAnchorY:D.projectedAnchorY,projectedAnchorZ:D.projectedAnchorZ,tileAnchorX:D.tileAnchorX,tileAnchorY:D.tileAnchorY},M.verticalIconFeatureIndex=D.featureIndex;break}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const c=e.placedSymbolArray.get(s),f=c.vertexStartIndex+4*c.numGlyphs;for(let p=c.vertexStartIndex;p<f;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(e),c=Math.cos(e),f=[],p=[],y=[];for(let v=0;v<this.symbolInstances.length;++v){y.push(v);const T=this.symbolInstances.get(v);f.push(0|Math.round(s*T.tileAnchorX+c*T.tileAnchorY)),p.push(T.featureIndex)}return y.sort((v,T)=>f[v]-f[T]||p[T]-p[v]),y}addToSortKeyRanges(e,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((f,p,y)=>{f>=0&&y.indexOf(f)===p&&this.addIndicesForPlacedSymbol(this.text,f)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Et("SymbolBucket",Aa,{omit:["layers","collisionBoxArray","features","compareText"]}),Aa.MAX_GLYPHS=65535,Aa.addDynamicAttributes=yg;const fI=new Mr({"symbol-placement":new At(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new At(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new At(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Rt(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new At(Be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new At(Be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new At(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new At(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new At(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Rt(Be.layout_symbol["icon-size"]),"icon-text-fit":new At(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new At(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Rt(Be.layout_symbol["icon-image"]),"icon-rotate":new Rt(Be.layout_symbol["icon-rotate"]),"icon-padding":new At(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new At(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new Rt(Be.layout_symbol["icon-offset"]),"icon-anchor":new Rt(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new At(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new At(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new At(Be.layout_symbol["text-rotation-alignment"]),"text-field":new Rt(Be.layout_symbol["text-field"]),"text-font":new Rt(Be.layout_symbol["text-font"]),"text-size":new Rt(Be.layout_symbol["text-size"]),"text-max-width":new Rt(Be.layout_symbol["text-max-width"]),"text-line-height":new Rt(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new Rt(Be.layout_symbol["text-letter-spacing"]),"text-justify":new Rt(Be.layout_symbol["text-justify"]),"text-radial-offset":new Rt(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new At(Be.layout_symbol["text-variable-anchor"]),"text-anchor":new Rt(Be.layout_symbol["text-anchor"]),"text-max-angle":new At(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new At(Be.layout_symbol["text-writing-mode"]),"text-rotate":new Rt(Be.layout_symbol["text-rotate"]),"text-padding":new At(Be.layout_symbol["text-padding"]),"text-keep-upright":new At(Be.layout_symbol["text-keep-upright"]),"text-transform":new Rt(Be.layout_symbol["text-transform"]),"text-offset":new Rt(Be.layout_symbol["text-offset"]),"text-allow-overlap":new At(Be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new At(Be.layout_symbol["text-ignore-placement"]),"text-optional":new At(Be.layout_symbol["text-optional"])});var bg={paint:new Mr({"icon-opacity":new Rt(Be.paint_symbol["icon-opacity"]),"icon-color":new Rt(Be.paint_symbol["icon-color"]),"icon-halo-color":new Rt(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Rt(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Rt(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new At(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new At(Be.paint_symbol["icon-translate-anchor"]),"text-opacity":new Rt(Be.paint_symbol["text-opacity"]),"text-color":new Rt(Be.paint_symbol["text-color"],{runtimeType:ds,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Rt(Be.paint_symbol["text-halo-color"]),"text-halo-width":new Rt(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new Rt(Be.paint_symbol["text-halo-blur"]),"text-translate":new At(Be.paint_symbol["text-translate"]),"text-translate-anchor":new At(Be.paint_symbol["text-translate-anchor"])}),layout:fI};class g1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:io,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Et("FormatSectionOverride",g1,{omit:["defaultValue"]});class Sp extends Us{constructor(e){super(e,bg)}recalculate(e,s){super.recalculate(e,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const p of c)f.indexOf(p)<0&&f.push(p);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,s,c,f){const p=this.layout.get(e).evaluate(s,{},c,f),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||fa(y.value)||!p?p:function(v,T){return T.replace(/{([^{}]+)}/g,(A,M)=>M in v?String(v[M]):"")}(s.properties,p)}createBucket(e){return new Aa(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of bg.paint.overridableProperties){if(!Sp.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),c=new g1(s),f=new Eh(c,s.property.specification);let p=null;p=s.value.kind==="constant"||s.value.kind==="source"?new Cl("source",f):new Sh("composite",f,s.value.zoomStops,s.value._interpolationType),this.paint._values[e]=new nn(s.property,p,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&Sp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const c=e.get("text-field"),f=bg.paint.properties[s];let p=!1;const y=v=>{for(const T of v)if(f.overrides&&f.overrides.hasOverride(T))return void(p=!0)};if(c.value.kind==="constant"&&c.value.value instanceof qt)y(c.value.value.sections);else if(c.value.kind==="source"){const v=A=>{p||(A instanceof no&&nr(A.value)===ro?y(A.value.sections):A instanceof ps?y(A.sections):A.eachChild(v))},T=c.value;T._styleExpression&&v(T._styleExpression.expression)}return p}getProgramConfiguration(e){return new Uo(this,e)}}var dI={paint:new Mr({"background-color":new At(Be.paint_background["background-color"]),"background-pattern":new Lo(Be.paint_background["background-pattern"]),"background-opacity":new At(Be.paint_background["background-opacity"])})},pI={paint:new Mr({"raster-opacity":new At(Be.paint_raster["raster-opacity"]),"raster-hue-rotate":new At(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new At(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new At(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new At(Be.paint_raster["raster-saturation"]),"raster-contrast":new At(Be.paint_raster["raster-contrast"]),"raster-resampling":new At(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new At(Be.paint_raster["raster-fade-duration"])})};class mI extends Us{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var _I={paint:new Mr({"sky-type":new At(Be.paint_sky["sky-type"]),"sky-atmosphere-sun":new At(Be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new At(Be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new At(Be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new At(Be.paint_sky["sky-gradient-radius"]),"sky-gradient":new uo(Be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new At(Be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new At(Be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new At(Be.paint_sky["sky-opacity"])})};function wg(r,e,s){const c=ze(0,0,1),f=mi(Dt());return function(p,y,v){v*=.5;var T=y[0],A=y[1],M=y[2],P=y[3],D=Math.sin(v),U=Math.cos(v);p[0]=T*U-M*D,p[1]=A*U+P*D,p[2]=M*U+T*D,p[3]=P*U-A*D}(f,f,s?-me(r)+Math.PI:me(r)),xi(f,f,-me(e)),Bi(c,c,f),St(c,c)}const gI={circle:class extends Us{constructor(r){super(r,NA)}createBucket(r){return new W_(r)}queryRadius(r){const e=r;return ru("circle-radius",this,e)+ru("circle-stroke-width",this,e)+cp(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,s,c,f,p,y,v){const T=Sv(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s);return Av(r,c,p,y,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,A)}getProgramIds(){return["circle"]}getProgramConfiguration(r){return new Uo(this,r)}},heatmap:class extends Us{createBucket(r){return new Iv(r)}constructor(r){super(r,GA),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=J_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return ru("heatmap-radius",this,r)}queryIntersectsFeature(r,e,s,c,f,p,y,v){const T=this.paint.get("heatmap-radius").evaluate(e,s);return Av(r,c,p,y,v,!0,!0,new k(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(r){return new Uo(this,r)}},hillshade:class extends Us{constructor(r){super(r,qA)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(r){return new Uo(this,r)}},fill:class extends Us{constructor(r){super(r,lC)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),s=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(r){return new Uo(this,r)}recalculate(r,e){super.recalculate(r,e);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new mp(r)}queryRadius(){return cp(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,s,c,f,p){return!r.queryGeometry.isAboveHorizon&&vv(Ev(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Us{constructor(r){super(r,xC)}createBucket(r){return new og(r)}queryRadius(){return cp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(r){return new Uo(this,r)}queryIntersectsFeature(r,e,s,c,f,p,y,v,T){const A=Sv(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,s),P=this.paint.get("fill-extrusion-base").evaluate(e,s),D=[0,0],U=v&&p.elevation,j=p.elevation?p.elevation.exaggeration():1;if(U){const ie=r.tile.getBucket(this).centroidVertexArray,le=T+1;if(le<ie.length){const ge=ie.get(le);D[0]=ge.a_centroid_pos0,D[1]=ge.a_centroid_pos1}}if(D[0]===0&&D[1]===1)return!1;const G=function(ie,le,ge,we,Ee,Se,Ve,Ne,ft){return Se?function(ot,je,at,pt,He,vt,Ct,oi,zi){const ui=[],hi=[],nt=[0,0,0,1];for(const gi of ot){const di=[],lr=[];for(const er of gi){const br=er.x+pt.x,Zr=er.y+pt.y,yi=vC(br,Zr,je,at,vt,Ct,oi,zi);nt[0]=br,nt[1]=Zr,nt[2]=yi.base,nt[3]=1,mt(nt,nt,He),nt[3]=Math.max(nt[3],1e-5);const si=Nv([nt[0]/nt[3],nt[1]/nt[3],nt[2]/nt[3]]);nt[0]=br,nt[1]=Zr,nt[2]=yi.top,nt[3]=1,mt(nt,nt,He),nt[3]=Math.max(nt[3],1e-5);const $i=Nv([nt[0]/nt[3],nt[1]/nt[3],nt[2]/nt[3]]);di.push(si),lr.push($i)}ui.push(di),hi.push(lr)}return[ui,hi]}(ie,le,ge,we,Ee,Se,Ve,Ne,ft):function(ot,je,at,pt,He){const vt=[],Ct=[],oi=He[8]*je,zi=He[9]*je,ui=He[10]*je,hi=He[11]*je,nt=He[8]*at,gi=He[9]*at,di=He[10]*at,lr=He[11]*at;for(const er of ot){const br=[],Zr=[];for(const yi of er){const si=yi.x+pt.x,$i=yi.y+pt.y,cr=He[0]*si+He[4]*$i+He[12],ir=He[1]*si+He[5]*$i+He[13],fr=He[2]*si+He[6]*$i+He[14],Lr=He[3]*si+He[7]*$i+He[15],gn=cr+oi,yn=ir+zi,Vi=fr+ui,wr=Math.max(Lr+hi,1e-5),ys=cr+nt,kr=ir+gi,Ii=fr+di,Tr=Math.max(Lr+lr,1e-5),Gi=new k(gn/wr,yn/wr);Gi.z=Vi/wr,br.push(Gi);const Wr=new k(ys/Tr,kr/Tr);Wr.z=Ii/Tr,Zr.push(Wr)}vt.push(br),Ct.push(Zr)}return[vt,Ct]}(ie,le,ge,we,Ee)}(c,P,M,A,y,U?v:null,D,j,p.center.lat),K=r.queryGeometry;return function(ie,le,ge){let we=1/0;vv(ge,le)&&(we=Uv(ge,le[0]));for(let Ee=0;Ee<le.length;Ee++){const Se=le[Ee],Ve=ie[Ee];for(let Ne=0;Ne<Se.length-1;Ne++){const ft=Se[Ne],ot=[ft,Se[Ne+1],Ve[Ne+1],Ve[Ne],ft];xv(ge,ot)&&(we=Math.min(we,Uv(ge,ot)))}}return we!==1/0&&we}(G[0],G[1],K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends Us{constructor(r){super(r,jv),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof yl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=Vv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new _p(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(r){return new Uo(this,r)}queryRadius(r){const e=r,s=$v(ru("line-width",this,e),ru("line-gap-width",this,e)),c=ru("line-offset",this,e);return s/2+Math.abs(c)+cp(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,s,c,f,p){if(r.queryGeometry.isAboveHorizon)return!1;const y=Ev(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),v=r.pixelToTileUnitsFactor/2*$v(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),T=this.paint.get("line-offset").evaluate(e,s);return T&&(c=function(A,M){const P=[],D=new k(0,0);for(let U=0;U<A.length;U++){const j=A[U],G=[];for(let K=0;K<j.length;K++){const ie=j[K-1],le=j[K],ge=j[K+1],we=K===0?D:le.sub(ie)._unit()._perp(),Ee=K===j.length-1?D:ge.sub(le)._unit()._perp(),Se=we._add(Ee)._unit();Se._mult(1/(Se.x*Ee.x+Se.y*Ee.y)),G.push(Se._mult(M)._add(le))}P.push(G)}return P}(c,T*r.pixelToTileUnitsFactor)),function(A,M,P){for(let D=0;D<M.length;D++){const U=M[D];if(A.length>=3){for(let j=0;j<U.length;j++)if(iu(A,U[j]))return!0}if(LA(A,U,P))return!0}return!1}(y,c,v)}isTileClipped(){return!0}},symbol:Sp,background:class extends Us{constructor(r){super(r,dI)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Us{constructor(r){super(r,pI)}getProgramIds(){return["raster"]}},sky:class extends Us{constructor(r){super(r,_I),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=J_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(r,e){const s=this.paint.get("sky-type");if(s==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),f=!c,p=r.style.light,y=p.properties.get("position");return f&&p.properties.get("anchor")==="viewport"&&pi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?wg(y.azimuthal,90-y.polar,e):wg(c[0],90-c[1],e)}if(s==="gradient"){const c=this.paint.get("sky-gradient-center");return wg(c[0],90-c[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:y1,HTMLCanvasElement:x1,HTMLVideoElement:v1,ImageData:b1,ImageBitmap:Ap}=R;class Cp{constructor(e,s,c,f){this.context=e,this.format=c,this.texture=e.gl.createTexture(),this.update(s,f)}update(e,s,c){const{width:f,height:p}=e,{context:y}=this,{gl:v}=y;if(v.bindTexture(v.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!s||s.premultiply!==!1)),c||this.size&&this.size[0]===f&&this.size[1]===p){const{x:T,y:A}=c||{x:0,y:0};e instanceof y1||e instanceof x1||e instanceof v1||e instanceof b1||Ap&&e instanceof Ap?v.texSubImage2D(v.TEXTURE_2D,0,T,A,v.RGBA,v.UNSIGNED_BYTE,e):v.texSubImage2D(v.TEXTURE_2D,0,T,A,f,p,v.RGBA,v.UNSIGNED_BYTE,e.data)}else this.size=[f,p],e instanceof y1||e instanceof x1||e instanceof v1||e instanceof b1||Ap&&e instanceof Ap?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,e):v.texImage2D(v.TEXTURE_2D,0,this.format,f,p,0,this.format,v.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(e,s){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:e),this.filter=e),s!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Tg{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.image=new Ta({width:e,height:s}),this.positions={},this.uploaded=!1}getDash(e,s){const c=this.getKey(e,s);return this.positions[c]}trim(){const e=this.width,s=this.height=Xt(this.nextRow);this.image.resize({width:e,height:s})}getKey(e,s){return e.join(",")+s}getDashRanges(e,s,c){const f=[];let p=e.length%2==1?-e[e.length-1]*c:0,y=e[0]*c,v=!0;f.push({left:p,right:y,isDash:v,zeroLength:e[0]===0});let T=e[0];for(let A=1;A<e.length;A++){v=!v;const M=e[A];p=T*c,T+=M,y=T*c,f.push({left:p,right:y,isDash:v,zeroLength:M===0})}return f}addRoundDash(e,s,c){const f=s/2;for(let p=-c;p<=c;p++){const y=this.width*(this.nextRow+c+p);let v=0,T=e[v];for(let A=0;A<this.width;A++){A/T.right>1&&(T=e[++v]);const M=Math.abs(A-T.left),P=Math.abs(A-T.right),D=Math.min(M,P);let U;const j=p/c*(f+1);if(T.isDash){const G=f-Math.abs(j);U=Math.sqrt(D*D+G*G)}else U=f-Math.sqrt(D*D+j*j);this.image.data[y+A]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(e,s){for(let T=e.length-1;T>=0;--T){const A=e[T],M=e[T+1];A.zeroLength?e.splice(T,1):M&&M.isDash===A.isDash&&(M.left=A.left,e.splice(T,1))}const c=e[0],f=e[e.length-1];c.isDash===f.isDash&&(c.left=f.left-this.width,f.right=c.right+this.width);const p=this.width*this.nextRow;let y=0,v=e[y];for(let T=0;T<this.width;T++){T/v.right>1&&(v=e[++y]);const A=Math.abs(T-v.left),M=Math.abs(T-v.right),P=Math.min(A,M);this.image.data[p+T]=Math.max(0,Math.min(255,(v.isDash?P:-P)+s+128))}}addDash(e,s){const c=this.getKey(e,s);if(this.positions[c])return this.positions[c];const f=s==="round",p=f?7:0,y=2*p+1;if(this.nextRow+y>this.height)return pi("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let M=0;M<e.length;M++)e[M]<0&&(pi("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),v+=e[M];if(v!==0){const M=this.width/v,P=this.getDashRanges(e,this.width,M);f?this.addRoundDash(P,M,p):this.addRegularDash(P,s==="square"?.5*M:0)}const T=this.nextRow+p;this.nextRow+=y;const A={tl:[T,p],br:[v,0]};return this.positions[c]=A,A}}Et("LineAtlas",Tg);class yI{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const xI=R.performance;function w1(r){const e=r?r.url.toString():void 0;return xI.getEntriesByName(e)}class vI{constructor(){this.tasks={},this.taskQueue=[],_r(["process"],this),this.invoker=new yI(this.process),this.nextId=0}add(e,s){const c=this.nextId++,f=function({type:p,isSymbolTile:y,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||y?p!=="parseTile"||y?p==="parseTile"&&y?300-v:p==="maybePrepare"&&y?400-v:500:200-v:100-v}(s);if(f===0){ls();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:e,metadata:s,priority:f,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){ls();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const s=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let e=null,s=1/0;for(let f=0;f<this.taskQueue.length;f++){const p=this.tasks[this.taskQueue[f]];p.priority<s&&(s=p.priority,e=f)}if(e===null)return null;const c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}function T1(r,e,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[r*c-2*Math.PI*6378137/2,e*c-2*Math.PI*6378137/2]}class Ip{constructor(e,s,c){this.z=e,this.x=s,this.y=c,this.key=Qh(0,e,e,s,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s){const c=function(p,y,v){var T=T1(256*p,256*(y=Math.pow(2,v)-y-1),v),A=T1(256*(p+1),256*(y+1),v);return T[0]+","+T[1]+","+A[0]+","+A[1]}(this.x,this.y,this.z),f=function(p,y,v){let T,A="";for(let M=p;M>0;M--)T=1<<M-1,A+=(y&T?1:0)+(v&T?2:0);return A}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Eg{constructor(e,s){this.wrap=e,this.canonical=s,this.key=Qh(e,s.z,s.z,s.x,s.y)}}class _n{constructor(e,s,c,f,p){this.overscaledZ=e,this.wrap=s,this.canonical=new Ip(c,+f,+p),this.key=s===0&&e===c?this.canonical.key:Qh(s,e,c,f,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const s=this.canonical.z-e;return e>this.canonical.z?new _n(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _n(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s=!0){if(this.overscaledZ===e&&s)return this.key;if(e>this.canonical.z)return Qh(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-e;return Qh(this.wrap*+s,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new _n(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new _n(s,this.wrap,s,c,f),new _n(s,this.wrap,s,c+1,f),new _n(s,this.wrap,s,c,f+1),new _n(s,this.wrap,s,c+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new _n(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new _n(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Eg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Qh(r,e,s,c,f){const p=1<<Math.min(s,22);let y=p*(f%p)+c%p;return r&&s<22&&(y+=p*p*((r<0?-2*r-1:2*r)%(1<<2*(22-s)))),16*(32*y+s)+(e-s)}Et("CanonicalTileID",Ip),Et("OverscaledTileID",_n,{omit:["projMatrix"]});class fu{constructor(e,s,c){this.func=e,this.mask=s,this.range=c}}fu.ReadOnly=!1,fu.ReadWrite=!0,fu.disabled=new fu(519,fu.ReadOnly,[0,1]);const Sg=7680;class Ag{constructor(e,s,c,f,p,y){this.test=e,this.ref=s,this.mask=c,this.fail=f,this.depthFail=p,this.pass=y}}Ag.disabled=new Ag({func:519,mask:0},0,0,Sg,Sg,Sg);class po{constructor(e,s,c){this.blendFunction=e,this.blendColor=s,this.mask=c}}po.Replace=[1,0],po.disabled=new po(po.Replace,fi.transparent,[!1,!1,!1,!1]),po.unblended=new po(po.Replace,fi.transparent,[!0,!0,!0,!0]),po.alphaBlended=new po([1,771],fi.transparent,[!0,!0,!0,!0]);const Cg=1029,Ig=2305;class Vs{constructor(e,s,c){this.enable=e,this.mode=s,this.frontFace=c}}Vs.disabled=new Vs(!1,Cg,Ig),Vs.backCCW=new Vs(!0,Cg,Ig),Vs.backCW=new Vs(!0,Cg,2304),Vs.frontCW=new Vs(!0,1028,2304),Vs.frontCCW=new Vs(!0,1028,Ig);class E1{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const c=e[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class S1{constructor(e,s,c,f,p){this.type="Feature",this._vectorTileFeature=e,e._z=s,e._x=c,e._y=f,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(e[s]=this[s]);return e}}class bI{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,c){const f=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},dt(this.stateChanges[e][f],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==f&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][f]===null){this.deletedStates[e][f]={};for(const p in this.state[e][f])c[p]||(this.deletedStates[e][f][p]=null)}else for(const p in c)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][p]===null&&delete this.deletedStates[e][f][p]}removeFeatureState(e,s,c){if(this.deletedStates[e]===null)return;const f=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&s!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][c]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(c in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][c]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}getState(e,s){const c=String(s),f=dt({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(p===null)return{};for(const y in p)delete f[y]}return f}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const p={};for(const y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),dt(this.state[f][y],this.stateChanges[f][y]),p[y]=this.state[f][y];c[f]=p}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const p={};if(this.deletedStates[f]===null)for(const y in this.state[f])p[y]={},this.state[f][y]={};else for(const y in this.deletedStates[f]){if(this.deletedStates[f][y]===null)this.state[f][y]={};else for(const v of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][v];p[y]=this.state[f][y]}c[f]=c[f]||{},dt(c[f],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const f in e)e[f].setFeatureState(c,s)}}class A1{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,s){const c=this.toIdx(e,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,s){return this.leaves[this.toIdx(e,s)]}toIdx(e,s){return s*this.size+e}}function C1(r,e,s,c){let f=0,p=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(c[y])<1e-15){if(s[y]<r[y]||s[y]>e[y])return null}else{const v=1/c[y];let T=(r[y]-s[y])*v,A=(e[y]-s[y])*v;if(T>A){const M=T;T=A,A=M}if(T>f&&(f=T),A<p&&(p=A),f>p)return null}return f}function I1(r,e,s,c,f,p,y,v,T,A,M){const P=c-r,D=f-e,U=p-s,j=y-r,G=v-e,K=T-s,ie=M[1]*K-M[2]*G,le=M[2]*j-M[0]*K,ge=M[0]*G-M[1]*j,we=P*ie+D*le+U*ge;if(Math.abs(we)<1e-15)return null;const Ee=1/we,Se=A[0]-r,Ve=A[1]-e,Ne=A[2]-s,ft=(Se*ie+Ve*le+Ne*ge)*Ee;if(ft<0||ft>1)return null;const ot=Ve*U-Ne*D,je=Ne*P-Se*U,at=Se*D-Ve*P,pt=(M[0]*ot+M[1]*je+M[2]*at)*Ee;return pt<0||ft+pt>1?null:(j*ot+G*je+K*at)*Ee}function M1(r,e,s){return(r-e)/(s-e)}function k1(r,e,s,c,f,p,y,v,T){const A=1<<s,M=p-c,P=y-f,D=(r+1)/A*M+c,U=(e+0)/A*P+f,j=(e+1)/A*P+f;v[0]=(r+0)/A*M+c,v[1]=U,T[0]=D,T[1]=j}class P1{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(p){const y=Math.ceil(Math.log2(p.dim/8)),v=[];let T=Math.ceil(Math.pow(2,y));const A=1/T,M=(U,j,G,K,ie)=>{const le=K?1:0,ge=(U+1)*G-le,we=j*G,Ee=(j+1)*G-le;ie[0]=U*G,ie[1]=we,ie[2]=ge,ie[3]=Ee};let P=new A1(T);const D=[];for(let U=0;U<T*T;U++){M(U%T,Math.floor(U/T),A,!1,D);const j=Ca(D[0],D[1],p),G=Ca(D[2],D[1],p),K=Ca(D[2],D[3],p),ie=Ca(D[0],D[3],p);P.minimums.push(Math.min(j,G,K,ie)),P.maximums.push(Math.max(j,G,K,ie)),P.leaves.push(1)}for(v.push(P),T/=2;T>=1;T/=2){const U=v[v.length-1];P=new A1(T);for(let j=0;j<T*T;j++){M(j%T,Math.floor(j/T),2,!0,D);const G=U.getElevation(D[0],D[1]),K=U.getElevation(D[2],D[1]),ie=U.getElevation(D[2],D[3]),le=U.getElevation(D[0],D[3]),ge=U.isLeaf(D[0],D[1]),we=U.isLeaf(D[2],D[1]),Ee=U.isLeaf(D[2],D[3]),Se=U.isLeaf(D[0],D[3]),Ve=Math.min(G.min,K.min,ie.min,le.min),Ne=Math.max(G.max,K.max,ie.max,le.max),ft=ge&&we&&Ee&&Se;P.maximums.push(Ne),P.minimums.push(Ve),P.leaves.push(Ne-Ve<=5&&ft?1:0)}v.push(P)}return v}(this.dem),c=s.length-1,f=s[c];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(e,s,c,f,p,y,v=1){return C1([e,s,-100],[c,f,this.maximums[0]*v],p,y)}raycast(e,s,c,f,p,y,v=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,s,c,f,p,y,v);if(T==null)return null;const A=[],M=[],P=[],D=[],U=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;U.length>0;){const{idx:j,t:G,nodex:K,nodey:ie,depth:le}=U.pop();if(this.leaves[j]){k1(K,ie,le,e,s,c,f,P,D);const we=1<<le,Ee=(K+0)/we,Se=(K+1)/we,Ve=(ie+0)/we,Ne=(ie+1)/we,ft=Ca(Ee,Ve,this.dem)*v,ot=Ca(Se,Ve,this.dem)*v,je=Ca(Se,Ne,this.dem)*v,at=Ca(Ee,Ne,this.dem)*v,pt=I1(P[0],P[1],ft,D[0],P[1],ot,D[0],D[1],je,p,y),He=I1(D[0],D[1],je,P[0],D[1],at,P[0],P[1],ft,p,y),vt=Math.min(pt!==null?pt:Number.MAX_VALUE,He!==null?He:Number.MAX_VALUE);if(vt!==Number.MAX_VALUE)return vt;{const Ct=gt([],p,y,G);if(D1(ft,ot,at,je,M1(Ct[0],P[0],D[0]),M1(Ct[1],P[1],D[1]))>=Ct[2])return G}continue}let ge=0;for(let we=0;we<this._siblingOffset.length;we++){k1((K<<1)+this._siblingOffset[we][0],(ie<<1)+this._siblingOffset[we][1],le+1,e,s,c,f,P,D),P[2]=-100,D[2]=this.maximums[this.childOffsets[j]+we]*v;const Ee=C1(P,D,p,y);if(Ee!=null){const Se=Ee;A[we]=Se;let Ve=!1;for(let Ne=0;Ne<ge&&!Ve;Ne++)Se>=A[M[Ne]]&&(M.splice(Ne,0,we),Ve=!0);Ve||(M[ge]=we),ge++}}for(let we=0;we<ge;we++){const Ee=M[we];U.push({idx:this.childOffsets[j]+Ee,t:A[Ee],nodex:(K<<1)+this._siblingOffset[Ee][0],nodey:(ie<<1)+this._siblingOffset[Ee][1],depth:le+1})}}return null}_addNode(e,s,c){return this.minimums.push(e),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,s,c,f,p){if(e[f].isLeaf(s,c)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const y=f-1,v=e[y];let T,A=0;for(let M=0;M<this._siblingOffset.length;M++){const P=2*s+this._siblingOffset[M][0],D=2*c+this._siblingOffset[M][1],U=v.getElevation(P,D),j=v.isLeaf(P,D),G=this._addNode(U.min,U.max,j);j&&(A|=1<<M),T||(T=G)}for(let M=0;M<this._siblingOffset.length;M++)A&1<<M||this._construct(e,2*s+this._siblingOffset[M][0],2*c+this._siblingOffset[M][1],y,T+M)}}function D1(r,e,s,c,f,p){return vi(vi(r,s,p),vi(e,c,p),f)}function Ca(r,e,s){const c=s.dim,f=Xe(r*c-.5,0,c-1),p=Xe(e*c-.5,0,c-1),y=Math.floor(f),v=Math.floor(p),T=Math.min(y+1,c-1),A=Math.min(v+1,c-1);return D1(s.get(y,v),s.get(T,v),s.get(y,A),s.get(T,A),f-y,p-v)}const z1={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Mp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,s,c,f=!1,p=!1){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return pi(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const y=this.dim=s.height-2;if(this.data=new Uint32Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=f,!f){for(let v=0;v<y;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(y,v)]=this.data[this._idx(y-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,y)]=this.data[this._idx(v,y-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(y,-1)]=this.data[this._idx(y-1,0)],this.data[this._idx(-1,y)]=this.data[this._idx(0,y-1)],this.data[this._idx(y,y)]=this.data[this._idx(y-1,y-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new P1(this)}get(e,s,c=!1){const f=new Uint8Array(this.data.buffer);c&&(e=Xe(e,-1,this.dim),s=Xe(s,-1,this.dim));const p=4*this._idx(e,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[p],f[p+1],f[p+2])}static getUnpackVector(e){return z1[e]}get unpackVector(){return z1[this.encoding]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}_unpackMapbox(e,s,c){return(256*e*256+256*s+c)/10-1e4}_unpackTerrarium(e,s,c){return 256*e+s+c/256-32768}static pack(e,s){const c=[0,0,0,0],f=Mp.getUnpackVector(s);let p=Math.floor((e+f[3])/f[2]);return c[2]=p%256,p=Math.floor(p/256),c[1]=p%256,p=Math.floor(p/256),c[0]=p,c}getPixels(){return new Kn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,s,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=s*this.dim,p=s*this.dim+this.dim,y=c*this.dim,v=c*this.dim+this.dim;switch(s){case-1:f=p-1;break;case 1:p=f+1}switch(c){case-1:y=v-1;break;case 1:v=y+1}const T=-s*this.dim,A=-c*this.dim;for(let M=y;M<v;M++)for(let P=f;P<p;P++)this.data[this._idx(P,M)]=e.data[this._idx(P+T,M+A)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Et("DEMData",Mp),Et("DemMinMaxQuadTree",P1,{omit:["dem"]});class wI{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,c){const f=e.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const p={value:s,timeout:void 0};if(c!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},c)),this.data[f].push(p),this.order.push(f),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const c=e.wrapped().key,f=s===void 0?0:this.data[c].indexOf(s),p=this.data[c][f];return this.data[c].splice(f,1),p.timeout&&clearTimeout(p.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(p.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const c in this.data)for(const f of this.data[c])e(f.value)||s.push(f);for(const c of s)this.remove(c.value.tileID,c)}}class Ul extends eo{constructor(e,s,c){super(),this.id=e,this._onlySymbols=c,s.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new wI(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new bI}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,s){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return Tt(this._tiles).map(e=>e.tileID).sort(R1).map(e=>e.key)}getRenderableIds(e){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,e)&&s.push(this._tiles[c]);return e?s.sort((c,f)=>{const p=c.tileID,y=f.tileID,v=new k(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),T=new k(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-y.overscaledZ||T.y-v.y||T.x-v.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(R1).map(c=>c.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,s){const c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,e,s)))}_tileLoaded(e,s,c,f){if(f)if(e.state="errored",f.status!==404)this._source.fire(new yc(f,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=fn.now(),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Js("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const s=this.getRenderableIds();for(let f=0;f<s.length;f++){const p=s[f];if(e.neighboringTiles&&e.neighboringTiles[p]){const y=this.getTileByID(p);c(e,y),c(y,e)}}function c(f,p){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=p.tileID.canonical.x-f.tileID.canonical.x;const v=p.tileID.canonical.y-f.tileID.canonical.y,T=Math.pow(2,f.tileID.canonical.z),A=p.tileID.key;y===0&&v===0||Math.abs(v)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),p.dem&&f.dem&&(f.dem.backfillBorder(p.dem,y,v),f.neighboringTiles&&f.neighboringTiles[A]&&(f.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,c,f){for(const p in this._tiles){let y=this._tiles[p];if(f[p]||!y.hasData()||y.tileID.overscaledZ<=s||y.tileID.overscaledZ>c)continue;let v=y.tileID;for(;y&&y.tileID.overscaledZ>s+1;){const A=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[A.key],y&&y.hasData()&&(v=A)}let T=v;for(;T.overscaledZ>s;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){f[v.key]=v;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const c=this._loadedParentTiles[e.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=e.overscaledZ-1;c>=s;c--){const f=e.scaledTo(c),p=this._getLoadedTile(f);if(p)return p}}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,s){s=s||this._source.tileSize;const c=Math.ceil(e.width/s)+1,f=Math.ceil(e.height/s)+1,p=Math.floor(c*f*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(v)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const c={};for(const f in this._tiles){const p=this._tiles[f];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),c[p.tileID.key]=p}this._tiles=c;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(e,s,c){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let f;this.updateCacheSize(e,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new _n(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(f=e.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(v=>this._source.hasTile(v)))):f=[];const p=this._updateRetainedTiles(f);if(F1(this._source.type)&&f.length!==0){const v={},T={},A=Object.keys(p);for(const P of A){const D=p[P],U=this._tiles[P];if(!U||U.fadeEndTime&&U.fadeEndTime<=fn.now())continue;const j=this.findLoadedParent(D,Math.max(D.overscaledZ-Ul.maxOverzooming,this._source.minzoom));j&&(this._addTile(j.tileID),v[j.tileID.key]=j.tileID),T[P]=D}const M=f[f.length-1].overscaledZ;for(const P in this._tiles){const D=this._tiles[P];if(p[P]||!D.hasData())continue;let U=D.tileID;for(;U.overscaledZ>M;){U=U.scaledTo(U.overscaledZ-1);const j=this._tiles[U.key];if(j&&j.hasData()&&T[U.key]){p[P]=D.tileID;break}}}for(const P in v)p[P]||(this._coveredTiles[P]=!0,p[P]=v[P])}for(const v in p)this._tiles[v].clearFadeHold();const y=function(v,T){const A=[];for(const M in v)M in T||A.push(M);return A}(this._tiles,p);for(const v of y){const T=this._tiles[v];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const s={};if(e.length===0)return s;const c={},f=e.reduce((A,M)=>Math.min(A,M.overscaledZ),1/0),p=e[0].overscaledZ,y=Math.max(p-Ul.maxOverzooming,this._source.minzoom),v=Math.max(p+Ul.maxUnderzooming,this._source.minzoom),T={};for(const A of e){const M=this._addTile(A);s[A.key]=A,M.hasData()||f<this._source.maxzoom&&(T[A.key]=A)}this._retainLoadedChildren(T,f,v,s);for(const A of e){let M=this._tiles[A.key];if(M.hasData())continue;if(A.canonical.z>=this._source.maxzoom){const D=A.children(this._source.maxzoom)[0],U=this.getTile(D);if(U&&U.hasData()){s[D.key]=D;continue}}else{const D=A.children(this._source.maxzoom);if(s[D[0].key]&&s[D[1].key]&&s[D[2].key]&&s[D[3].key])continue}let P=M.wasRequested();for(let D=A.overscaledZ-1;D>=y;--D){const U=A.scaledTo(D);if(c[U.key]||(c[U.key]=!0,M=this.getTile(U),!M&&P&&(M=this._addTile(U)),M&&(s[U.key]=U,P=M.wasRequested(),M.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let c,f=this._tiles[e].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}s.push(f.key);const p=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(p),c)break;f=p}for(const p of s)this._loadedParentTiles[p]=c}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const c=Boolean(s);if(!c){const f=this.map?this.map.painter:null,p=this._source.type==="raster"||this._source.type==="raster-dem";s=new kg(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,f,p),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))}return s?(s.uses++,this._tiles[e.key]=s,c||this._source.fire(new Js("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const c=s.getExpiryTimeout();c&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},c))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,s,c){const f=[],p=this.transform;if(!p)return f;for(const y in this._tiles){const v=this._tiles[y];if(c&&v.clearQueryDebugViz(),v.holdingForFade())continue;const T=e.containsTile(v,p,s);T&&f.push(T)}return f}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(c=>this._tiles[c].tileID);for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(F1(this._source.type))for(const e in this._tiles){const s=this._tiles[e];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=fn.now())return!0}return!1}setFeatureState(e,s,c){this._state.updateState(e=e||"_geojsonTileLayer",s,c)}removeFeatureState(e,s,c){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,c)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,c){const f=this._tiles[e];f&&f.setDependencies(s,c)}reloadTilesForDependencies(e,s){for(const c in this._tiles)this._tiles[c].hasDependency(e,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(e,s))}_preloadTiles(e,s){const c=new Map,f=Array.isArray(e)?e:[e],p=this.map.painter.terrain,y=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const A of f){const M=A.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const P of M)c.set(P.key,P);this.usedForTerrain&&A.updateElevation(!1)}const v=Array.from(c.values()),T=this._source.type==="raster"||this._source.type==="raster-dem";Oe(v,(A,M)=>{const P=new kg(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,T);this._loadTile(P,D=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),M(D,P)})},s)}}function R1(r,e){const s=Math.abs(2*r.wrap)-+(r.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||c-s||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x}function F1(r){return r==="raster"||r==="image"||r==="video"}Ul.maxOverzooming=10,Ul.maxUnderzooming=3;class kp{constructor(e,s,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(e,s,c){const f=c||e.findDEMTileFor(s);if(!f||!f.dem)return;const p=f.dem,y=f.tileID,v=1<<s.canonical.z-y.canonical.z;return new kp(f,f.tileSize/ti/v,[(s.canonical.x/v-y.canonical.x)*p.dim,(s.canonical.y/v-y.canonical.y)*p.dim])}tileCoordToPixel(e,s){const c=s*this._scale+this._offset[1],f=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(c);return new k(f,p)}getElevationAt(e,s,c,f){const p=e*this._scale+this._offset[0],y=s*this._scale+this._offset[1],v=Math.floor(p),T=Math.floor(y),A=this._dem;return f=!!f,c?vi(vi(A.get(v,T,f),A.get(v,T+1,f),y-T),vi(A.get(v+1,T,f),A.get(v+1,T+1,f),y-T),p-v):A.get(v,T,f)}getElevationAtPixel(e,s,c){return this._dem.get(e,s,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ns(1,e)*this._dem.stride}}class L1{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new kl(ti,16,0),this.featureIndexArray=new ov,this.promoteId=s}insert(e,s,c,f,p,y=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,p,y);const T=this.grid;for(let A=0;A<s.length;A++){const M=s[A],P=[1/0,1/0,-1/0,-1/0];for(let D=0;D<M.length;D++){const U=M[D];P[0]=Math.min(P[0],U.x),P[1]=Math.min(P[1],U.y),P[2]=Math.max(P[2],U.x),P[3]=Math.max(P[3],U.y)}P[0]<ti&&P[1]<ti&&P[2]>=0&&P[3]>=0&&T.insert(v,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Bl.VectorTile(new Xh(this.rawTileData)).layers,this.sourceLayerCoder=new E1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,s,c,f){this.loadVTLayers();const p=e.params||{},y=Zc(p.filter),v=e.tileResult,T=e.transform,A=v.bufferedTilespaceBounds,M=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,(j,G,K,ie)=>Tv(v.bufferedTilespaceGeometry,j,G,K,ie));M.sort(TI);let P=null;T.elevation&&M.length>0&&(P=kp.create(T.elevation,this.tileID));const D={};let U;for(let j=0;j<M.length;j++){const G=M[j];if(G===U)continue;U=G;const K=this.featureIndexArray.get(G);let ie=null;this.loadMatchingFeature(D,K,y,p.layers,p.availableImages,s,c,f,(le,ge,we,Ee=0)=>(ie||(ie=jo(le,this.tileID.canonical,e.tileTransform)),ge.queryIntersectsFeature(v,le,we,ie,this.z,e.transform,e.pixelPosMatrix,P,Ee)))}return D}loadMatchingFeature(e,s,c,f,p,y,v,T,A){const{featureIndex:M,bucketIndex:P,sourceLayerIndex:D,layoutVertexArrayOffset:U}=s,j=this.bucketLayerIDs[P];if(f&&!function(le,ge){for(let we=0;we<le.length;we++)if(ge.indexOf(le[we])>=0)return!0;return!1}(f,j))return;const G=this.sourceLayerCoder.decode(D),K=this.vtLayers[G].feature(M);if(c.needGeometry){const le=Ol(K,!0);if(!c.filter(new $t(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!c.filter(new $t(this.tileID.overscaledZ),K))return;const ie=this.getId(K,G);for(let le=0;le<j.length;le++){const ge=j[le];if(f&&f.indexOf(ge)<0)continue;const we=y[ge];if(!we)continue;let Ee={};ie!==void 0&&T&&(Ee=T.getState(we.sourceLayer||"_geojsonTileLayer",ie));const Se=dt({},v[ge]);Se.paint=O1(Se.paint,we.paint,K,Ee,p),Se.layout=O1(Se.layout,we.layout,K,Ee,p);const Ve=!A||A(K,we,Ee,U);if(!Ve)continue;const Ne=new S1(K,this.z,this.x,this.y,ie);Ne.layer=Se;let ft=e[ge];ft===void 0&&(ft=e[ge]=[]),ft.push({featureIndex:M,feature:Ne,intersectionZ:Ve})}}lookupSymbolFeatures(e,s,c,f,p,y,v,T){const A={};this.loadVTLayers();const M=Zc(p);for(const P of e)this.loadMatchingFeature(A,{bucketIndex:c,sourceLayerIndex:f,featureIndex:P,layoutVertexArrayOffset:0},M,y,v,T,s);return A}loadFeature(e){const{featureIndex:s,sourceLayerIndex:c}=e;this.loadVTLayers();const f=this.sourceLayerCoder.decode(c),p=this.vtFeatures[f];if(p[s])return p[s];const y=this.vtLayers[f].feature(s);return p[s]=y,y}hasLayer(e){for(const s of this.bucketLayerIDs)for(const c of s)if(e===c)return!0;return!1}getId(e,s){let c=e.id;return this.promoteId&&(c=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof c=="boolean"&&(c=Number(c))),c}}function O1(r,e,s,c,f){return Vn(r,(p,y)=>{const v=e instanceof Fo?e.get(y):null;return v&&v.evaluate?v.evaluate(s,c,f):v})}function TI(r,e){return e-r}Et("FeatureIndex",L1,{omit:["rawTileData","sourceLayerCoder"]});var EI=Yi([{name:"a_pos",type:"Int16",components:2}]);const gs=32,mo=33,Ia=new Uint16Array(8184);for(let r=0;r<2046;r++){let e=r+2,s=0,c=0,f=0,p=0,y=0,v=0;for(1&e?f=p=y=gs:s=c=v=gs;(e>>=1)>1;){const A=s+f>>1,M=c+p>>1;1&e?(f=s,p=c,s=y,c=v):(s=f,c=p,f=y,p=v),y=A,v=M}const T=4*r;Ia[T+0]=s,Ia[T+1]=c,Ia[T+2]=f,Ia[T+3]=p}const _o=new Uint16Array(2178),Ma=new Uint8Array(1089),Pp=new Uint16Array(1089);function B1(r){return r===0?-.03125:r===32?.03125:0}var Mg=Yi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const U1={type:2,extent:ti,loadGeometry:()=>[[new k(0,0),new k(8193,0),new k(8193,8193),new k(0,8193),new k(0,0)]]};class kg{constructor(e,s,c,f,p){this.tileID=e,this.uid=Wt(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(e){const s=e+this.timeAdded;s<fn.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=du(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,s,c){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(f,p){const y={};if(!p)return y;for(const v of f){const T=v.layerIds.map(A=>p.getLayer(A)).filter(Boolean);if(T.length!==0){v.layers=T,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(A=>T.filter(M=>M.id===A)[0]));for(const A of T)y[A.id]=v}}return y}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const p=this.buckets[f];if(p instanceof Aa){if(this.hasSymbolBuckets=!0,!c)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const p=this.buckets[f];if(p instanceof Aa&&p.hasRTLText){this.hasRTLText=!0,ci.isLoading()||ci.isLoaded()||In()!=="deferred"||Hn();break}}this.queryPadding=0;for(const f in this.buckets){const p=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(f).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new V_}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Cp(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Cp(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Cp(e,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,c,f,p,y,v,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:v,transform:y,params:p,tileTransform:this.tileTransform},e,s,c):{}}querySourceFeatures(e,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),p=s?s.sourceLayer:"",y=f._geojsonTileLayer||f[p];if(!y)return;const v=Zc(s&&s.filter),{z:T,x:A,y:M}=this.tileID.canonical,P={z:T,x:A,y:M};for(let D=0;D<y.length;D++){const U=y.feature(D);if(v.needGeometry){const K=Ol(U,!0);if(!v.filter(new $t(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!v.filter(new $t(this.tileID.overscaledZ),U))continue;const j=c.getId(U,p),G=new S1(U,T,A,M,j);G.tile=P,e.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const c=ia(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(s)if(this.expirationTime<s)f=!0;else{const p=this.expirationTime-s;p?this.expirationTime=c+Math.max(p,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!s)return;const c=this.latestFeatureIndex.loadVTLayers(),f=s.style.listImages();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const y=this.buckets[p],v=y.layers[0].sourceLayer||"_geojsonTileLayer",T=c[v],A=e[v];if(!T||!A||Object.keys(A).length===0)continue;if(y.update(A,T,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof _p||y instanceof mp){const P=s.style._getSourceCache(y.layers[0].source);s._terrain&&s._terrain.enabled&&P&&y.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(P.id,this.tileID)}const M=s&&s.style&&s.style.getLayer(p);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<fn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=fn.now()+e}setDependencies(e,s){const c={};for(const f of s)c[f]=!0;this.dependencies[e]=c}hasDependency(e,s){for(const c of e){const f=this.dependencies[c];if(f){for(const p of s)if(f[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const c=jo(U1,this.tileID.canonical,this.tileTransform)[0],f=new Kc,p=new tp;for(let y=0;y<c.length;y++){const{x:v,y:T}=c[y];f.emplaceBack(v,T),p.emplaceBack(y)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(f,Mg.members),this._tileDebugSegments=or.simpleSegment(0,0,f.length,p.length)}_makeTileBoundsBuffers(e,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const c=jo(U1,this.tileID.canonical,this.tileTransform)[0];let f,p;if(this.isRaster){const y=function(v,T){const A=du(v,T),M=Math.pow(2,v.z);for(let K=0;K<mo;K++)for(let ie=0;ie<mo;ie++){const le=No((v.x+(ie+B1(ie))/gs)/M),ge=_s((v.y+(K+B1(K))/gs)/M),we=T.project(le,ge),Ee=K*mo+ie;_o[2*Ee+0]=Math.round((we.x*A.scale-A.x)*ti),_o[2*Ee+1]=Math.round((we.y*A.scale-A.y)*ti)}Ma.fill(0),Pp.fill(0);for(let K=2045;K>=0;K--){const ie=4*K,le=Ia[ie+0],ge=Ia[ie+1],we=Ia[ie+2],Ee=Ia[ie+3],Se=le+we>>1,Ve=ge+Ee>>1,Ne=Se+Ve-ge,ft=Ve+le-Se,ot=ge*mo+le,je=Ee*mo+we,at=Ve*mo+Se,pt=Math.hypot((_o[2*ot+0]+_o[2*je+0])/2-_o[2*at+0],(_o[2*ot+1]+_o[2*je+1])/2-_o[2*at+1])>=16;if(Ma[at]=Ma[at]||(pt?1:0),K<1022){const He=(ge+ft>>1)*mo+(le+Ne>>1),vt=(Ee+ft>>1)*mo+(we+Ne>>1);Ma[at]=Ma[at]||Ma[He]||Ma[vt]}}const P=new Yc,D=new Xn;let U=0;function j(K,ie){const le=ie*mo+K;return Pp[le]===0&&(P.emplaceBack(_o[2*le+0],_o[2*le+1],K*ti/gs,ie*ti/gs),Pp[le]=++U),Pp[le]-1}function G(K,ie,le,ge,we,Ee){const Se=K+le>>1,Ve=ie+ge>>1;if(Math.abs(K-we)+Math.abs(ie-Ee)>1&&Ma[Ve*mo+Se])G(we,Ee,K,ie,Se,Ve),G(le,ge,we,Ee,Se,Ve);else{const Ne=j(K,ie),ft=j(le,ge),ot=j(we,Ee);D.emplaceBack(Ne,ft,ot)}}return G(0,0,gs,gs,gs,0),G(gs,gs,0,0,0,gs),{vertices:P,indices:D}}(this.tileID.canonical,s);f=y.vertices,p=y.indices}else{f=new Yc,p=new Xn;for(const{x:v,y:T}of c)f.emplaceBack(v,T,0,0);const y=up(f.int16,void 0,4);for(let v=0;v<y.length;v+=3)p.emplaceBack(y[v],y[v+1],y[v+2])}this._tileBoundsBuffer=e.createVertexBuffer(f,Mg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=or.simpleSegment(0,0,f.length,p.length)}}const SI=Yi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),AI=Yi([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:N1}=SI;function Nl(r,e){const s=r.fovAboveCenter,c=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,f=(r._camera.position[2]*r.worldSize-c)/Math.cos(r._pitch),p=Math.sin(s)*f/Math.sin(Math.max(Math.PI/2-r._pitch-s,.01)),y=Math.sin(r._pitch)*p+f;return Math.min(1.01*y,f*(1/r._horizonShift))}const Pg=ti/Math.PI/2,Mn=-Pg,kn=Pg,CI=[new js([Mn,Mn,Mn],[kn,kn,kn]),new js([Mn,Mn,Mn],[0,0,kn]),new js([0,Mn,Mn],[kn,0,kn]),new js([Mn,0,Mn],[0,kn,kn]),new js([0,0,Mn],[kn,kn,kn])];function Dp(r){if(r.z<=1)return CI[r.z+2*r.y+r.x];const[e,s]=j1(r),c=[zp(e[0],e[1]),zp(e[0],s[1]),zp(s[0],e[1]),zp(s[0],s[1])],f=[kn,kn,kn],p=[Mn,Mn,Mn];for(const y of c)f[0]=Math.min(f[0],y[0]),f[1]=Math.min(f[1],y[1]),f[2]=Math.min(f[2],y[2]),p[0]=Math.max(p[0],y[0]),p[1]=Math.max(p[1],y[1]),p[2]=Math.max(p[2],y[2]);return new js(f,p)}function j1(r){const e=Math.pow(2,r.z),s=r.x/e,c=(r.x+1)/e,f=(r.y+1)/e;return[[_s(r.y/e),No(s)],[_s(f),No(c)]]}function Dg(r,e,s,c){return s=me(s),c||(c=Pg),[r*Math.sin(s)*c,-e*c,r*Math.cos(s)*c]}function zp(r,e,s){return Dg(Math.cos(me(r)),Math.sin(me(r)),e,s)}function V1(r){return 16383/Math.max(...rr([],r.max,r.min))}function $1(r){const e=q(new Float64Array(16)),s=1/V1(r);return pe(e,e,r.min),xe(e,e,[s,s,s]),e}function G1(r,e,s){const c=e/(2*Math.PI),f=function(y){const v=ti/(2*Math.PI);return y/(2*Math.PI)/v}(e);if(!s){const y=Xe(r.center.lat,-85.051129,ho);s=[eu(r.center.lng)*e,tu(y)*e]}const p=q(new Float64Array(16));return pe(p,p,[s[0],s[1],-c]),xe(p,p,[f,f,f]),fe(p,p,me(-r._center.lat)),Te(p,p,me(-r._center.lng)),p}class zg{constructor(e){const s=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(s,!0),this.gridSegments=or.simpleSegment(0,0,4225,8192);const c=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(c,!0),this.poleSegments=or.simpleSegment(0,0,66,64);const f=new Uh;f.emplaceBack(-1,1,1,0,0,0,0),f.emplaceBack(1,1,1,0,0,1,0),f.emplaceBack(1,-1,1,0,0,1,1),f.emplaceBack(-1,-1,1,0,0,0,1);const p=new Xn;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(f,AI.members),this.atmosphereIndexBuffer=e.createIndexBuffer(p),this.atmosphereSegments=or.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,s,c){const f=new Uh,p=s/Math.PI/2;f.emplaceBack(0,-p,0,0,0,.5,c?0:1);const y=360/e,v=Math.cos(me(85)),T=Math.sin(me(85));for(let M=0;M<=64;M++){const P=M/64,D=Dg(v,T,0*(1-(A=P))+y*A,p);f.emplaceBack(D[0],D[1],D[2],0,0,P,c?0:1)}var A;return f}_createPoleTriangleIndices(){const e=new Xn;for(let s=0;s<=64;s++)e.emplaceBack(0,s+1,s+2);return e}static createGridVertices(e){const s=Math.pow(2,e.z),c=(T,A,M)=>T*(1-M)+A*M,[f,p]=j1(e),y=new Uh,v=function(T){const A=q(new Float64Array(16)),M=V1(T);var P,D;return xe(A,A,[M,M,M]),pe(A,A,((P=[])[0]=-(D=T.min)[0],P[1]=-D[1],P[2]=-D[2],P)),A}(Dp(e));y.reserve(4096);for(let T=0;T<65;T++){const A=c(f[0],p[0],T/64),M=tu(A),P=M*s-e.y,D=Math.sin(me(A)),U=Math.cos(me(A));for(let j=0;j<65;j++){const G=j/64,K=c(f[1],p[1],G),ie=Dg(U,D,K);Pt(ie,ie,v);const le=eu(K);y.emplaceBack(ie[0],ie[1],ie[2],le,M,G,P)}}return y}_createGridIndices(){const e=new Xn,s=(c,f)=>{const p=65*f+c;e.emplaceBack(p+1,p,p+65),e.emplaceBack(p+65,p+65+1,p+1)};for(let c=0;c<64;c++)for(let f=0;f<64;f++)s(f,c);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const s=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(s),this.wireframeSegments=or.simpleSegment(0,0,4096,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new ba,s=(c,f)=>{const p=65*f+c;e.emplaceBack(p,p+1),e.emplaceBack(p,p+65),e.emplaceBack(p,p+65+1)};for(let c=0;c<64;c++)for(let f=0;f<64;f++)s(f,c);return e}}function du(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const s=Math.pow(2,-r.z),c=r.x*s,f=(r.x+1)*s,p=r.y*s,y=(r.y+1)*s,v=No(c),T=No(f),A=_s(p),M=_s(y),P=e.project(v,A),D=e.project(T,A),U=e.project(T,M),j=e.project(v,M);let G=Math.min(P.x,D.x,U.x,j.x),K=Math.min(P.y,D.y,U.y,j.y),ie=Math.max(P.x,D.x,U.x,j.x),le=Math.max(P.y,D.y,U.y,j.y);const ge=s/16;function we(Se,Ve,Ne,ft,ot,je){const at=(Ne+ot)/2,pt=(ft+je)/2,He=e.project(No(at),_s(pt)),vt=Math.max(0,G-He.x,K-He.y,He.x-ie,He.y-le);G=Math.min(G,He.x),ie=Math.max(ie,He.x),K=Math.min(K,He.y),le=Math.max(le,He.y),vt>ge&&(we(Se,He,Ne,ft,at,pt),we(He,Ve,at,pt,ot,je))}we(P,D,c,p,f,p),we(D,U,f,p,f,y),we(U,j,f,y,c,y),we(j,P,c,y,c,p),G-=ge,K-=ge,ie+=ge,le+=ge;const Ee=1/Math.max(ie-G,le-K);return{scale:Ee,x:G*Ee,y:K*Ee,x2:ie*Ee,y2:le*Ee,projection:e}}class q1{constructor(e){const s={},c=[];for(const v in e){const T=e[v],A=s[v]={};for(const M in T.glyphs){const P=T.glyphs[+M];if(!P||P.bitmap.width===0||P.bitmap.height===0)continue;const D=P.metrics.localGlyph?2:1,U={x:0,y:0,w:P.bitmap.width+2*D,h:P.bitmap.height+2*D};c.push(U),A[M]=U}}const{w:f,h:p}=cg(c),y=new Ta({width:f||1,height:p||1});for(const v in e){const T=e[v];for(const A in T.glyphs){const M=T.glyphs[+A];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const P=s[v][A],D=M.metrics.localGlyph?2:1;Ta.copy(M.bitmap,y,{x:0,y:0},{x:P.x+D,y:P.y+D},M.bitmap)}}this.image=y,this.positions=s}}Et("GlyphAtlas",q1);class II{constructor(e){this.tileID=new _n(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=du(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,s,c,f,p){this.status="parsing",this.data=e,this.collisionBoxArray=new V_;const y=new E1(Object.keys(e.layers).sort()),v=new L1(this.tileID,this.promoteId);v.bucketLayerIDs=[];const T={},A=new Tg(256,256),M={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:A,availableImages:c},P=s.familiesBySource[this.source];for(const Ee in P){const Se=e.layers[Ee];if(!Se)continue;let Ve=!1,Ne=!1;for(const je of P[Ee])je[0].type==="symbol"?Ve=!0:Ne=!0;if(this.isSymbolTile===!0&&!Ve||this.isSymbolTile===!1&&!Ne)continue;Se.version===1&&pi(`Vector tile source "${this.source}" layer "${Ee}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ft=y.encode(Ee),ot=[];for(let je=0;je<Se.length;je++){const at=Se.feature(je),pt=v.getId(at,Ee);ot.push({feature:at,id:pt,index:je,sourceLayerIndex:ft})}for(const je of P[Ee]){const at=je[0];this.isSymbolTile!==void 0&&at.type==="symbol"!==this.isSymbolTile||at.minzoom&&this.zoom<Math.floor(at.minzoom)||at.maxzoom&&this.zoom>=at.maxzoom||at.visibility!=="none"&&(Rg(je,this.zoom,c),(T[at.id]=at.createBucket({index:v.bucketLayerIDs.length,layers:je,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ft,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:c})).populate(ot,M,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(je.map(pt=>pt.id)))}}let D,U,j,G;A.trim();const K={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ie=Vn(M.glyphDependencies,Ee=>Object.keys(Ee).map(Number));Object.keys(ie).length?f.send("getGlyphs",{uid:this.uid,stacks:ie},(Ee,Se)=>{D||(D=Ee,U=Se,we.call(this))},void 0,!1,K):U={};const le=Object.keys(M.iconDependencies);le.length?f.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"icons"},(Ee,Se)=>{D||(D=Ee,j=Se,we.call(this))},void 0,!1,K):j={};const ge=Object.keys(M.patternDependencies);function we(){if(D)return p(D);if(U&&j&&G){const Ee=new q1(U),Se=new Yv(j,G);for(const Ve in T){const Ne=T[Ve];Ne instanceof Aa?(Rg(Ne.layers,this.zoom,c),oI(Ne,U,Ee.positions,j,Se.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection),Ne.projection=this.projection.name):Ne.hasPattern&&(Ne instanceof _p||Ne instanceof mp||Ne instanceof og)&&(Rg(Ne.layers,this.zoom,c),Ne.addFeatures(M,this.tileID.canonical,Se.patternPositions,c))}this.status="done",p(null,{buckets:Tt(T).filter(Ve=>!Ve.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ee.image,lineAtlas:A,imageAtlas:Se,glyphMap:this.returnDependencies?U:null,iconMap:this.returnDependencies?j:null,glyphPositions:this.returnDependencies?Ee.positions:null})}}ge.length?f.send("getImages",{icons:ge,source:this.source,tileID:this.tileID,type:"patterns"},(Ee,Se)=>{D||(D=Ee,G=Se,we.call(this))},void 0,!1,K):G={},we.call(this)}}function Rg(r,e,s){const c=new $t(e);for(const f of r)f.recalculate(c,s)}class Z1{constructor(e){this.entries={},this.scheduler=e}request(e,s,c,f){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[y,v]=p.result;return this.scheduler?this.scheduler.add(()=>{f(y,v)},s):f(y,v),()=>{}}return p.callbacks.push(f),p.cancel||(p.cancel=c((y,v)=>{p.result=[y,v];for(const T of p.callbacks)this.scheduler?this.scheduler.add(()=>{T(y,v)},s):T(y,v);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(y=>y!==f),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function W1(r,e,s){const c=JSON.stringify(r.request);return r.data&&(this.deduped.entries[c]={result:[null,r.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},f=>{const p=ll(r.request,(y,v,T,A)=>{y?f(y):v&&f(null,{vectorTile:s?void 0:new Bl.VectorTile(new Xh(v)),rawData:v,cacheControl:T,expires:A})});return()=>{p.cancel(),f()}},e)}const MI=q(new Float64Array(16));class jl{constructor(e,s){this._tr=e,this._worldSize=s}createInversionMatrix(){return MI}createTileMatrix(e){let s,c,f;const p=e.canonical,y=q(new Float64Array(16)),v=this._tr.projection;if(v.isReprojectedInTileSpace){const T=du(p,v);s=1,c=T.x+e.wrap*T.scale,f=T.y,xe(y,y,[s/T.scale,s/T.scale,this._tr.pixelsPerMeter/this._worldSize])}else s=this._worldSize/this._tr.zoomScale(p.z),c=(p.x+Math.pow(2,p.z)*e.wrap)*s,f=p.y*s;return pe(y,y,[c,f,0]),xe(y,y,[s/ti,s/ti,1]),y}pointCoordinate(e,s,c){const f=this._tr.horizonLineFromTop(!1),p=new k(e,Math.max(f,s));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(p,c))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var kI={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Zt(this.parallels,this.constants.parallels))return;const r=Math.sin(me(this.parallels[0])),e=(r+Math.sin(me(this.parallels[1])))/2,s=1+r*(2*e-r),c=Math.sqrt(s)/e;this.constants={n:e,c:s,r0:c,parallels:this.parallels}},project(r,e){this.initializeConstants();const s=me(r-this.center[0]),c=me(e),{n:f,c:p,r0:y}=this.constants,v=Math.sqrt(p-2*f*Math.sin(c))/f;return{x:v*Math.sin(s*f),y:v*Math.cos(s*f)-y,z:0}},unproject(r,e){this.initializeConstants();const{n:s,c,r0:f}=this.constants,p=f+e;let y=Math.atan2(r,Math.abs(p))*Math.sign(p);p*s<0&&(y-=Math.PI*Math.sign(r)*Math.sign(p));const v=me(this.center[0])*s;y=ve(y,-Math.PI-v,Math.PI-v);const T=Re(y/s)+this.center[0],A=Math.asin(Xe((c-(r*r+p*p)*s*s)/(2*s),-1,1)),M=Xe(Re(A),-85.051129,ho);return new Ci(T,M)},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>Ns(1,r)*e,farthestPixelDistance(r){return Nl(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new jl(r,e)};const Jh=1.340264,ef=-.081106,tf=893e-6,rf=.003796,Rp=Math.sqrt(3)/2;var PI={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(r,e){e=e/180*Math.PI,r=r/180*Math.PI;const s=Math.asin(Rp*Math.sin(e)),c=s*s,f=c*c*c;return{x:.5*(r*Math.cos(s)/(Rp*(Jh+3*ef*c+f*(7*tf+9*rf*c)))/Math.PI+.5),y:1-.5*(s*(Jh+ef*c+f*(tf+rf*c))/Math.PI+1),z:0}},unproject(r,e){r=(2*r-.5)*Math.PI;let s=e=(2*(1-e)-1)*Math.PI,c=s*s,f=c*c*c;for(let A,M,P,D=0;D<12&&(M=s*(Jh+ef*c+f*(tf+rf*c))-e,P=Jh+3*ef*c+f*(7*tf+9*rf*c),A=M/P,s=Xe(s-A,-Math.PI/3,Math.PI/3),c=s*s,f=c*c*c,!(Math.abs(A)<1e-12));++D);const p=Rp*r*(Jh+3*ef*c+f*(7*tf+9*rf*c))/Math.cos(s),y=Math.asin(Math.sin(s)/Rp),v=Xe(180*p/Math.PI,-180,180),T=Xe(180*y/Math.PI,-85.051129,ho);return new Ci(v,T)},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>Ns(1,r)*e,farthestPixelDistance(r){return Nl(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new jl(r,e)},DI={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(r,e)=>({x:.5+r/360,y:.5-e/360,z:0}),unproject(r,e){const s=360*(r-.5),c=Xe(360*(.5-e),-85.051129,ho);return new Ci(s,c)},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>Ns(1,r)*e,farthestPixelDistance(r){return Nl(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new jl(r,e)};const pu=Math.PI/2;function Fp(r){return Math.tan((pu+r)/2)}var zI={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Zt(this.parallels,this.constants.parallels))return;const r=me(this.parallels[0]),e=me(this.parallels[1]),s=Math.cos(r),c=r===e?Math.sin(r):Math.log(s/Math.cos(e))/Math.log(Fp(e)/Fp(r)),f=s*Math.pow(Fp(r),c)/c;this.constants={n:c,f,parallels:this.parallels}},project(r,e){this.initializeConstants(),e=me(e),r=me(r-this.center[0]);const s=1e-6,{n:c,f}=this.constants;f>0?e<-pu+s&&(e=-pu+s):e>pu-s&&(e=pu-s);const p=f/Math.pow(Fp(e),c),y=p*Math.sin(c*r),v=f-p*Math.cos(c*r);return{x:.5*(y/Math.PI+.5),y:1-.5*(v/Math.PI+.5),z:0}},unproject(r,e){this.initializeConstants(),r=(2*r-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:s,f:c}=this.constants,f=c-e,p=Math.sign(f),y=Math.sign(s)*Math.sqrt(r*r+f*f);let v=Math.atan2(r,Math.abs(f))*p;f*s<0&&(v-=Math.PI*Math.sign(r)*p);const T=Xe(Re(v/s)+this.center[0],-180,180),A=Xe(Re(2*Math.atan(Math.pow(c/y,1/s))-pu),-85.051129,ho);return new Ci(T,A)},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>Ns(1,r)*e,farthestPixelDistance(r){return Nl(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new jl(r,e)},RI={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(r,e)=>({x:eu(r),y:tu(e),z:0}),unproject(r,e){const s=No(r),c=_s(e);return new Ci(s,c)},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>Ns(1,r)*e,farthestPixelDistance(r){return Nl(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new jl(r,e)};const H1=me(ho);var FI={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(r,e){const s=(e=me(e))*e,c=s*s;return{x:.5*((r=me(r))*(.8707-.131979*s+c*(c*(.003971*s-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+s*(.015085+c*(.028874*s-.044475-.005916*c)))/Math.PI+1),z:0}},unproject(r,e){r=(2*r-.5)*Math.PI;let s=e=(2*(1-e)-1)*Math.PI,c=25,f=0,p=s*s;do{p=s*s;const T=p*p;f=(s*(1.007226+p*(.015085+T*(.028874*p-.044475-.005916*T)))-e)/(1.007226+p*(.045255+T*(.259866*p-.311325-.005916*11*T))),s=Xe(s-f,-H1,H1)}while(Math.abs(f)>1e-6&&--c>0);p=s*s;const y=Xe(Re(r/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),v=Re(s);return new Ci(y,v)},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>Ns(1,r)*e,farthestPixelDistance(r){return Nl(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new jl(r,e)};const X1=me(ho),K1={albers:kI,equalEarth:PI,equirectangular:DI,lambertConformalConic:zI,mercator:RI,naturalEarth:FI,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(r,e){e=me(e),r=me(r);const s=Math.cos(e),c=2/Math.PI,f=Math.acos(s*Math.cos(r/2)),p=Math.sin(f)/f,y=.5*(r*c+2*s*Math.sin(r/2)/p)||0,v=.5*(e+Math.sin(e)/p)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}},unproject(r,e){let s=r=(2*r-.5)*Math.PI,c=e=(2*(1-e)-1)*Math.PI,f=25;const p=1e-6;let y=0,v=0;do{const T=Math.cos(c),A=Math.sin(c),M=2*A*T,P=A*A,D=T*T,U=Math.cos(s/2),j=Math.sin(s/2),G=2*U*j,K=j*j,ie=1-D*U*U,le=ie?1/ie:0,ge=ie?Math.acos(T*U)*Math.sqrt(1/ie):0,we=.5*(2*ge*T*j+2*s/Math.PI)-r,Ee=.5*(ge*A+c)-e,Se=.5*le*(D*K+ge*T*U*P)+1/Math.PI,Ve=le*(G*M/4-ge*A*j),Ne=.125*le*(M*j-ge*A*D*G),ft=.5*le*(P*U+ge*K*T)+.5,ot=Ve*Ne-ft*Se;y=(Ee*Ve-we*ft)/ot,v=(we*Ne-Ee*Se)/ot,s=Xe(s-y,-Math.PI,Math.PI),c=Xe(c-v,-X1,X1)}while((Math.abs(y)>p||Math.abs(v)>p)&&--f>0);return new Ci(Re(s),Re(c))},projectTilePoint:(r,e)=>({x:r,y:e,z:0}),locationPoint:(r,e)=>r._coordinatePoint(r.locationCoordinate(e),!1),pixelsPerMeter:(r,e)=>Ns(1,r)*e,farthestPixelDistance(r){return Nl(r,this.pixelsPerMeter(r.center.lat,r.worldSize))},createTileTransform:(r,e)=>new jl(r,e)}};a.ARRAY_TYPE=Z,a.AUTH_ERR_MSG=ke,a.Aabb=js,a.Actor=class{constructor(r,e,s){this.target=r,this.parent=e,this.mapId=s,this.callbacks={},this.cancelCallbacks={},_r(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ls()?r:R,this.scheduler=new vI}send(r,e,s,c,f=!1,p){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=p,this.callbacks[y]=s);const v=cs(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:r,hasCallback:!!s,targetMapId:c,mustQueue:f,sourceMapId:this.mapId,data:zl(e,v)},v),{cancel:()=>{s&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(r){const e=r.data,s=e.id;if(s&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(e.mustQueue||ls()){const c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,e),c&&c.metadata||{type:"message"})}else this.processTask(s,e)}processTask(r,e){if(e.type==="<response>"){const s=this.callbacks[r];delete this.callbacks[r],s&&(e.error?s(co(e.error)):s(null,co(e.data)))}else{const s=cs(this.globalScope)?void 0:[],c=e.hasCallback?(p,y)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:p?zl(p):null,data:zl(y,s)},s)}:p=>{},f=co(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,f,c);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],f.source)[p[1]](f,c)}else c(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Ip,a.Color=fi,a.ColorMode=po,a.CullFaceMode=Vs,a.DEMData=Mp,a.DataConstantProperty=At,a.DedupedRequest=Z1,a.DepthMode=fu,a.EXTENT=ti,a.Elevation=class{getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,s=!0){e==null&&(e=null);const c=this._source();if(!c||r.y<0||r.y>1)return e;const f=c.getSource().maxzoom,p=1<<f,y=Math.floor(r.x),v=r.x-y,T=new _n(f,y,f,Math.floor(v*p),Math.floor(r.y*p)),A=this.findDEMTileFor(T);if(!A||!A.dem)return e;const M=A.dem,P=1<<A.tileID.canonical.z,D=(v*P-A.tileID.canonical.x)*M.dim,U=(r.y*P-A.tileID.canonical.y)*M.dim,j=Math.floor(D),G=Math.floor(U);return(s?this.exaggeration():1)*vi(vi(M.get(j,G),M.get(j,G+1),U-G),vi(M.get(j+1,G),M.get(j+1,G+1),U-G),D-j)}getAtTileOffset(r,e,s){const c=1<<r.canonical.z;return this.getAtPointOrZero(new ap(r.wrap+(r.canonical.x+e/ti)/c,(r.canonical.y+s/ti)/c))}getAtTileOffsetFunc(r,e){return s=>{const c=this.getAtTileOffset(r,s.x,s.y),f=e.upVector(r.canonical,s.x,s.y);return Qe(f,f,c*e.upVectorScale(r.canonical)),f}}getForTilePoints(r,e,s,c){const f=kp.create(this,r,c);return!!f&&(e.forEach(p=>{p[2]=this.exaggeration()*f.getElevationAt(p[0],p[1],s)}),!0)}getMinMaxForTile(r){const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const s=e.dem.tree,c=e.tileID,f=1<<r.canonical.z-c.canonical.z;let p=r.canonical.x/f-c.canonical.x,y=r.canonical.y/f-c.canonical.y,v=0;for(let T=0;T<r.canonical.z-c.canonical.z&&!s.leaves[v];T++){p*=2,y*=2;const A=2*Math.floor(y)+Math.floor(p);v=s.childOffsets[v]+A,p%=1,y%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,s){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=yc,a.EvaluationParameters=$t,a.Event=Js,a.Evented=eo,a.Frustum=K_,a.GLOBE_ZOOM_THRESHOLD_MAX=6,a.GlobeSharedBuffers=zg,a.GlyphManager=uu,a.ImagePosition=ug,a.LineAtlas=Tg,a.LngLat=Ci,a.LngLatBounds=Ll,a.LocalGlyphMode=pg,a.MAX_MERCATOR_LATITUDE=ho,a.MercatorCoordinate=ap,a.ONE_EM=Fr,a.OverscaledTileID=_n,a.Properties=Mr,a.RGBAImage=Kn,a.Ray=class{constructor(r,e){this.pos=r,this.dir=e}intersectsPlane(r,e,s){const c=bt(e,this.dir);if(Math.abs(c)<1e-6)return!1;const f=((r[0]-this.pos[0])*e[0]+(r[1]-this.pos[1])*e[1]+(r[2]-this.pos[2])*e[2])/c;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(r,e,s){if(function(D,U){var j=D[0],G=D[1],K=D[2],ie=U[0],le=U[1],ge=U[2];return Math.abs(j-ie)<=W*Math.max(1,Math.abs(j),Math.abs(ie))&&Math.abs(G-le)<=W*Math.max(1,Math.abs(G),Math.abs(le))&&Math.abs(K-ge)<=W*Math.max(1,Math.abs(K),Math.abs(ge))}(this.pos,r)||e===0)return s[0]=s[1]=s[2]=0,!1;const[c,f,p]=this.dir,y=this.pos[0]-r[0],v=this.pos[1]-r[1],T=this.pos[2]-r[2],A=c*c+f*f+p*p,M=2*(y*c+v*f+T*p),P=M*M-4*A*(y*y+v*v+T*T-e*e);if(P<0){const D=Math.max(-M/2,0),U=y+c*D,j=v+f*D,G=T+p*D,K=Math.hypot(U,j,G);return s[0]=U*e/K,s[1]=j*e/K,s[2]=G*e/K,!1}{const D=(-M-Math.sqrt(P))/(2*A);if(D<0){const U=Math.hypot(y,v,T);return s[0]=y*e/U,s[1]=v*e/U,s[2]=T*e/U,!1}return s[0]=y+c*D,s[1]=v+f*D,s[2]=T+p*D,!0}}},a.RequestManager=class{constructor(r,e,s){this._transformRequestFn=r,this._customAccessToken=e,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const r=function(){let e="";for(let s=0;s<10;s++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ye,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,e){return this._transformRequestFn&&this._transformRequestFn(r,e)||{url:r}}normalizeStyleURL(r,e){if(!$e(r))return r;const s=Mt(r);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeGlyphsURL(r,e){if(!$e(r))return r;const s=Mt(r);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeSourceURL(r,e){if(!$e(r))return r;const s=Mt(r);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||e)}normalizeSpriteURL(r,e,s,c){const f=Mt(r);return $e(r)?(f.path=`/styles/v1${f.path}/sprite${e}${s}`,this._makeAPIURL(f,this._customAccessToken||c)):(f.path+=`${e}${s}`,Ft(f))}normalizeTileURL(r,e,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!$e(r))return r;const c=Mt(r);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||s&&c.authority!=="raster"&&s===512?"@2x":""}${V.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${B.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${B.TILE_URL_VERSION}${c.path}`);const f=this._customAccessToken||function(p){for(const y of p){const v=y.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(c.params)||B.ACCESS_TOKEN;return B.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,f)}canonicalizeTileURL(r,e){const s=Mt(r);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return r;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${B.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${B.TILE_URL_VERSION}/`,"")}`;let f=s.params;return e&&(f=f.filter(p=>!p.match(/^access_token=/))),f.length&&(c+=`?${f.join("&")}`),c}canonicalizeTileset(r,e){const s=!!e&&$e(e),c=[];for(const f of r.tiles||[])We(f)?c.push(this.canonicalizeTileURL(f,s)):c.push(f);return c}_makeAPIURL(r,e){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=Mt(B.API_URL);if(r.protocol=c.protocol,r.authority=c.authority,r.protocol==="http"){const f=r.params.indexOf("secure");f>=0&&r.params.splice(f,1)}if(c.path!=="/"&&(r.path=`${c.path}${r.path}`),!B.REQUIRE_ACCESS_TOKEN)return Ft(r);if(e=e||B.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return r.params=r.params.filter(f=>f.indexOf("access_token")===-1),r.params.push(`access_token=${e||""}`),Ft(r)}},a.ResourceType=_c,a.SegmentVector=or,a.SourceCache=Ul,a.StencilMode=Ag,a.StructArrayLayout1ui2=tp,a.StructArrayLayout2f1f2i16=F_,a.StructArrayLayout2i4=Kc,a.StructArrayLayout2ui4=ba,a.StructArrayLayout3f12=Qc,a.StructArrayLayout3ui6=Xn,a.StructArrayLayout4i8=Yc,a.Texture=Cp,a.Tile=kg,a.Transitionable=pn,a.Uniform1f=sp,a.Uniform1i=class extends Oo{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},a.Uniform2f=class extends Oo{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},a.Uniform3f=class extends Oo{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},a.Uniform4f=hv,a.UniformColor=fv,a.UniformMatrix2f=class extends Oo{constructor(r,e){super(r,e),this.current=AA}set(r){for(let e=0;e<4;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}},a.UniformMatrix3f=class extends Oo{constructor(r,e){super(r,e),this.current=SA}set(r){for(let e=0;e<9;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},a.UniformMatrix4f=class extends Oo{constructor(r,e){super(r,e),this.current=EA}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},a.UnwrappedTileID=Eg,a.ValidationError=xt,a.VectorTileWorkerSource=class extends eo{constructor(r,e,s,c,f){super(),this.actor=r,this.layerIndex=e,this.availableImages=s,this.loadVectorData=f||W1,this.loading={},this.loaded={},this.deduped=new Z1(r.scheduler),this.isSpriteLoaded=c,this.scheduler=r.scheduler}loadTile(r,e){const s=r.uid,c=r&&r.request,f=c&&c.collectResourceTiming,p=this.loading[s]=new II(r);p.abort=this.loadVectorData(r,(y,v)=>{const T=!this.loading[s];if(delete this.loading[s],T||y||!v)return p.status="done",T||(this.loaded[s]=p),e(y);const A=v.rawData,M={};v.expires&&(M.expires=v.expires),v.cacheControl&&(M.cacheControl=v.cacheControl),p.vectorTile=v.vectorTile||new Bl.VectorTile(new Xh(A));const P=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(D,U)=>{if(D||!U)return e(D);const j={};if(f){const G=w1(c);G.length>0&&(j.resourceTiming=JSON.parse(JSON.stringify(G)))}e(null,dt({rawTileData:A.slice(0)},U,M,j))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[s]=p})}reloadTile(r,e){const s=this.loaded,c=r.uid,f=this;if(s&&s[c]){const p=s[c];p.showCollisionBoxes=r.showCollisionBoxes,p.enableTerrain=!!r.enableTerrain,p.projection=r.projection;const y=(v,T)=>{const A=p.reloadCallback;A&&(delete p.reloadCallback,p.parse(p.vectorTile,f.layerIndex,this.availableImages,f.actor,A)),e(v,T)};p.status==="parsing"?p.reloadCallback=y:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(r,e){const s=r.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),e()}removeTile(r,e){const s=this.loaded,c=r.uid;s&&s[c]&&delete s[c],e()}},a.WritingMode=Yn,a.ZoomHistory=m,a.add=lt,a.addDynamicAttributes=yg,a.adjoint=function(r,e){var s=e[0],c=e[1],f=e[2],p=e[3],y=e[4],v=e[5],T=e[6],A=e[7],M=e[8];return r[0]=y*M-v*A,r[1]=f*A-c*M,r[2]=c*v-f*y,r[3]=v*T-p*M,r[4]=s*M-f*T,r[5]=f*p-s*v,r[6]=p*A-y*T,r[7]=c*T-s*A,r[8]=s*y-c*p,r},a.asyncAll=Oe,a.bezier=_t,a.bindAll=_r,a.boundsAttributes=Mg,a.bufferConvexPolygon=function(r,e){const s=[];for(let c=0;c<r.length;c++){const f=ve(c-1,-1,r.length-1),p=ve(c+1,-1,r.length-1),y=r[c],v=r[p],T=r[f].sub(y).unit(),A=v.sub(y).unit(),M=A.angleWithSep(T.x,T.y),P=T.add(A).unit().mult(-1*e/Math.sin(M/2));s.push(y.add(P))}return s},a.cacheEntryPossiblyAdded=function(r){mc++,mc>ah&&(r.getActor().send("enforceCacheSizeLimit",dd),mc=0)},a.calculateGlobeMatrix=G1,a.calculateGlobeMercatorMatrix=function(r){const e=r.worldSize,s=Xe(r.center.lat,-85.051129,ho),c=new k(eu(r.center.lng)*e,tu(s)*e),f=Ns(1,r.center.lat)*e,p=r.pixelsPerMeter,y=e/(f/r.pixelsPerMeter),v=q(new Float64Array(16));return pe(v,v,[c.x,c.y,0]),xe(v,v,[y,y,p]),v},a.clamp=Xe,a.clearTileCache=function(r){const e=R.caches.delete(Cr);r&&e.catch(r).then(()=>r())},a.clipLine=c1,a.clone=function(r){var e=new Z(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},a.clone$1=$r,a.collisionCircleLayout=DC,a.config=B,a.conjugate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},a.create=function(){var r=new Z(16);return Z!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},a.create$1=X,a.createExpression=Al,a.createLayout=Yi,a.createStyleLayer=function(r){return r.type==="custom"?new mI(r):new gI[r.type](r)},a.cross=Ti,a.degToRad=me,a.div=function(r,e,s){return r[0]=e[0]/s[0],r[1]=e[1]/s[1],r[2]=e[2]/s[2],r},a.dot=bt,a.ease=wt,a.easeCubicInOut=rt,a.emitValidationErrors=Kd,a.endsWith=hn,a.enforceCacheSizeLimit=function(r){ol(),us&&us.then(e=>{e.keys().then(s=>{for(let c=0;c<s.length-r;c++)e.delete(s[c])})})},a.evaluateSizeForFeature=gp,a.evaluateSizeForZoom=ou,a.evaluateVariableOffset=p1,a.evented=rn,a.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},a.exactEquals$1=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]},a.exported=fn,a.exported$1=V,a.extend=dt,a.extend$1=to,a.filterObject=Tn,a.fromMat4=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},a.fromQuat=function(r,e){var s=e[0],c=e[1],f=e[2],p=e[3],y=s+s,v=c+c,T=f+f,A=s*y,M=c*y,P=c*v,D=f*y,U=f*v,j=f*T,G=p*y,K=p*v,ie=p*T;return r[0]=1-P-j,r[1]=M+ie,r[2]=D-K,r[3]=0,r[4]=M-ie,r[5]=1-A-j,r[6]=U+G,r[7]=0,r[8]=D+K,r[9]=U-G,r[10]=1-A-P,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},a.fromRotation=function(r,e){var s=Math.sin(e),c=Math.cos(e);return r[0]=c,r[1]=s,r[2]=0,r[3]=-s,r[4]=c,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},a.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},a.furthestTileCorner=function(r){const e=Math.round((r+45+360)%360/90)%4;return tt[e]},a.getAABBPointSquareDist=function(r,e,s){let c=0;for(let f=0;f<2;++f){const p=s?s[f]:0;r[f]>p&&(c+=(r[f]-p)*(r[f]-p)),e[f]<p&&(c+=(p-e[f])*(p-e[f]))}return c},a.getAnchorAlignment=dg,a.getAnchorJustification=_g,a.getBounds=function(r){let e=1/0,s=1/0,c=-1/0,f=-1/0;for(const p of r)e=Math.min(e,p.x),s=Math.min(s,p.y),c=Math.max(c,p.x),f=Math.max(f,p.y);return{min:new k(e,s),max:new k(c,f)}},a.getColumn=function(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]},a.getImage=md,a.getJSON=function(r,e){return Gn(dt(r,{type:"json"}),e)},a.getMapSessionAPI=Qs,a.getPerformanceMeasurement=w1,a.getProjection=function(r){const e=K1[r.name];if(!e)throw new Error(`Invalid projection name: ${r.name}`);return e.conic?function(s,c){if(c.parallels&&Math.abs(c.parallels[0]+c.parallels[1])<.01){let f=function(p){const y=Math.max(.01,Math.cos(me(p))),v=1/(2*Math.max(Math.PI*y,1/y));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(T,A){const M=me(T)*y,P=Math.sin(me(A))/y;return{x:M*v+.5,y:-P*v+.5,z:0}},unproject(T,A){const M=-(A-.5)/v,P=Xe(Re((T-.5)/v)/y,-180,180),D=Math.asin(Xe(M*y,-1,1)),U=Xe(Re(D),-85.051129,ho);return new Ci(P,U)}}}(c.parallels[0]);if(c.name==="lambertConformalConic"){const{project:p,unproject:y}=K1.mercator;f={wrap:!0,supportsWorldCopies:!0,project:p,unproject:y}}return dt({},s,c,f)}return dt({},s,c)}(e,r):e},a.getRTLTextPluginStatus=In,a.getReferrer=ch,a.getTilePoint=function(r,{x:e,y:s},c=0){return new k(((e-c)*r.scale-r.x)*ti,(s*r.scale-r.y)*ti)},a.getTileVec3=function(r,e,s=0){return ze(((e.x-s)*r.scale-r.x)*ti,(e.y*r.scale-r.y)*ti,gv(e.z,e.y))},a.getVideo=function(r,e){const s=R.document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let c=0;c<r.length;c++){const f=R.document.createElement("source");pd(r[c])||(s.crossOrigin="Anonymous"),f.src=r[c],s.appendChild(f)}return{cancel:()=>{}}},a.globeBuffersForTileMesh=function(r,e,s,c){const f=r.context,p=r.transform;let y=e.globeGridBuffer,v=e.globePoleBuffer;if(!y){const T=zg.createGridVertices(s.canonical);y=e.globeGridBuffer=f.createVertexBuffer(T,N1,!1)}if(!v){const T=zg.createPoleTriangleVertices(c,p.tileSize*c,s.canonical.y===0);v=e.globePoleBuffer=f.createVertexBuffer(T,N1,!1)}return[y,v]},a.globeDenormalizeECEF=$1,a.globeMatrixForTile=function(r,e){const s=$1(Dp(r)),c=((f=new Float64Array(16))[0]=(p=e)[0],f[1]=p[1],f[2]=p[2],f[3]=p[3],f[4]=p[4],f[5]=p[5],f[6]=p[6],f[7]=p[7],f[8]=p[8],f[9]=p[9],f[10]=p[10],f[11]=p[11],f[12]=p[12],f[13]=p[13],f[14]=p[14],f[15]=p[15],f);var f,p;return Ie(c,c,s),c},a.globePoleMatrixForTile=function(r,e,s){const c=q(new Float64Array(16)),f=Math.pow(2,r.z),p=(r.x-f/2)/f*Math.PI*2,y=s.point,v=s.worldSize/(s.tileSize*f);return pe(c,c,[y.x,y.y,-s.worldSize/Math.PI/2]),xe(c,c,[v,v,v]),fe(c,c,me(-s._center.lat)),Te(c,c,me(-s._center.lng)),Te(c,c,p),e&&xe(c,c,[1,-1,1]),c},a.globeTileBounds=Dp,a.globeToMercatorTransition=function(r){return st(5,6,r)},a.identity=q,a.identity$1=mi,a.invert=function(r,e){var s=e[0],c=e[1],f=e[2],p=e[3],y=e[4],v=e[5],T=e[6],A=e[7],M=e[8],P=e[9],D=e[10],U=e[11],j=e[12],G=e[13],K=e[14],ie=e[15],le=s*v-c*y,ge=s*T-f*y,we=s*A-p*y,Ee=c*T-f*v,Se=c*A-p*v,Ve=f*A-p*T,Ne=M*G-P*j,ft=M*K-D*j,ot=M*ie-U*j,je=P*K-D*G,at=P*ie-U*G,pt=D*ie-U*K,He=le*pt-ge*at+we*je+Ee*ot-Se*ft+Ve*Ne;return He?(r[0]=(v*pt-T*at+A*je)*(He=1/He),r[1]=(f*at-c*pt-p*je)*He,r[2]=(G*Ve-K*Se+ie*Ee)*He,r[3]=(D*Se-P*Ve-U*Ee)*He,r[4]=(T*ot-y*pt-A*ft)*He,r[5]=(s*pt-f*ot+p*ft)*He,r[6]=(K*we-j*Ve-ie*ge)*He,r[7]=(M*Ve-D*we+U*ge)*He,r[8]=(y*at-v*ot+A*Ne)*He,r[9]=(c*ot-s*at-p*Ne)*He,r[10]=(j*Se-G*we+ie*le)*He,r[11]=(P*we-M*Se-U*le)*He,r[12]=(v*ft-y*je-T*Ne)*He,r[13]=(s*je-c*ft+f*Ne)*He,r[14]=(G*ge-j*Ee-K*le)*He,r[15]=(M*Ee-P*ge+D*le)*He,r):null},a.isMapAuthenticated=function(r){return zs.has(r)},a.isMapboxURL=$e,a.latFromMercatorY=_s,a.len=It,a.length=qe,a.length$1=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},a.loadVectorTile=W1,a.makeRequest=Gn,a.mercatorXfromLng=eu,a.mercatorYfromLat=tu,a.mercatorZfromAltitude=Ns,a.mul=Ie,a.mul$1=it,a.multiply=function(r,e,s){var c=e[0],f=e[1],p=e[2],y=e[3],v=e[4],T=e[5],A=e[6],M=e[7],P=e[8],D=s[0],U=s[1],j=s[2],G=s[3],K=s[4],ie=s[5],le=s[6],ge=s[7],we=s[8];return r[0]=D*c+U*y+j*A,r[1]=D*f+U*v+j*M,r[2]=D*p+U*T+j*P,r[3]=G*c+K*y+ie*A,r[4]=G*f+K*v+ie*M,r[5]=G*p+K*T+ie*P,r[6]=le*c+ge*y+we*A,r[7]=le*f+ge*v+we*M,r[8]=le*p+ge*T+we*P,r},a.multiply$1=ue,a.multiply$2=be,a.nextPowerOfTwo=Xt,a.normalize=St,a.normalize$1=function(r,e){var s=e[0],c=e[1],f=e[2],p=e[3],y=s*s+c*c+f*f+p*p;return y>0&&(y=1/Math.sqrt(y)),r[0]=s*y,r[1]=c*y,r[2]=f*y,r[3]=p*y,r},a.number=vi,a.ortho=function(r,e,s,c,f,p,y){var v=1/(e-s),T=1/(c-f),A=1/(p-y);return r[0]=-2*v,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*T,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*A,r[11]=0,r[12]=(e+s)*v,r[13]=(f+c)*T,r[14]=(y+p)*A,r[15]=1,r},a.pbf=Xh,a.perspective=function(r,e,s,c,f){var p,y=1/Math.tan(e/2);return r[0]=y/s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,f!=null&&f!==1/0?(r[10]=(f+c)*(p=1/(c-f)),r[14]=2*f*c*p):(r[10]=-1,r[14]=-2*c),r},a.pick=function(r,e){const s={};for(let c=0;c<e.length;c++){const f=e[c];f in r&&(s[f]=r[f])}return s},a.plugin=ci,a.pointGeometry=k,a.polygonIntersectsBox=Tv,a.polygonIntersectsPolygon=xv,a.polygonizeBounds=function(r,e,s=0,c=!0){const f=new k(s,s),p=r.sub(f),y=e.add(f),v=[p,new k(y.x,p.y),y,new k(p.x,y.y)];return c&&v.push(p),v},a.posAttributes=EI,a.postMapLoadEvent=ki,a.postTurnstileEvent=Li,a.potpack=cg,a.prevPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},a.radToDeg=Re,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(r){return r({pluginStatus:jt,pluginURL:Jt}),rn.on("pluginStateChange",r),r},a.removeAuthState=function(r){zs.delete(r)},a.renderColorRamp=J_,a.rotateX=fe,a.rotateX$1=xi,a.rotateY=Te,a.rotateZ=function(r,e,s){var c=Math.sin(s),f=Math.cos(s),p=e[0],y=e[1],v=e[2],T=e[3],A=e[4],M=e[5],P=e[6],D=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*f+A*c,r[1]=y*f+M*c,r[2]=v*f+P*c,r[3]=T*f+D*c,r[4]=A*f-p*c,r[5]=M*f-y*c,r[6]=P*f-v*c,r[7]=D*f-T*c,r},a.rotateZ$1=function(r,e,s){s*=.5;var c=e[0],f=e[1],p=e[2],y=e[3],v=Math.sin(s),T=Math.cos(s);return r[0]=c*T+f*v,r[1]=f*T-c*v,r[2]=p*T+y*v,r[3]=y*T-p*v,r},a.scale=xe,a.scale$1=function(r,e,s){return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=e[3]*s,r},a.scale$2=Qe,a.scaleAndAdd=gt,a.setCacheLimits=function(r,e){dd=r,ah=e},a.setColumn=function(r,e,s){r[4*e+0]=s[0],r[4*e+1]=s[1],r[4*e+2]=s[2],r[4*e+3]=s[3]},a.setRTLTextPlugin=function(r,e,s=!1){if(jt===zt||jt===Vt||jt===wi)throw new Error("setRTLTextPlugin cannot be called multiple times.");Jt=fn.resolveURL(r),jt=zt,Pi=e,hr(),s||Hn()},a.smoothstep=st,a.spec=Be,a.storeAuthState=function(r,e){e?zs.add(r):zs.delete(r)},a.sub=rr,a.subtract=ct,a.symbolSize=zC,a.tileAABB=function(r,e,s,c,f,p,y,v,T){if(T.name==="globe"){const U=Dp(new Eg(p,new Ip(s,c,f)).canonical).getCorners(),j=Number.MAX_VALUE,G=[-j,-j,-j],K=[j,j,j],ie=G1(r,e);for(let le=0;le<U.length;le++)Pt(U[le],U[le],ie),M=K,P=U[le],(A=K)[0]=Math.min(M[0],P[0]),A[1]=Math.min(M[1],P[1]),A[2]=Math.min(M[2],P[2]),Ze(G,G,U[le]);return new js(K,G)}var A,M,P;const D=du({z:s,x:c,y:f},T);return new js([(p+D.x/D.scale)*e,e*(D.y/D.scale),y],[(p+D.x2/D.scale)*e,e*(D.y2/D.scale),v])},a.tileTransform=du,a.transformMat3=function(r,e,s){var c=e[0],f=e[1],p=e[2];return r[0]=c*s[0]+f*s[3]+p*s[6],r[1]=c*s[1]+f*s[4]+p*s[7],r[2]=c*s[2]+f*s[5]+p*s[8],r},a.transformMat4=Pt,a.transformMat4$1=mt,a.transformQuat=Bi,a.translate=pe,a.transpose=function(r,e){if(r===e){var s=e[1],c=e[2],f=e[5];r[1]=e[3],r[2]=e[6],r[3]=s,r[5]=e[7],r[6]=c,r[7]=f}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r},a.triggerPluginCompletionEvent=ji,a.uniqueId=Wt,a.validateCustomStyleLayer=function(r){const e=[],s=r.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFog=M_,a.validateLight=ga,a.validateStyle=_a,a.values=Tt,a.vectorTile=Bl,a.version=w,a.warnOnce=pi,a.window=R,a.wrap=ve}),d(["./shared"],function(a){function w(te){const B=typeof te;if(B==="number"||B==="boolean"||B==="string"||te==null)return JSON.stringify(te);if(Array.isArray(te)){let re="[";for(const _e of te)re+=`${w(_e)},`;return`${re}]`}const V=Object.keys(te).sort();let ee="{";for(let re=0;re<V.length;re++)ee+=`${JSON.stringify(V[re])}:${w(te[V[re]])},`;return`${ee}}`}function S(te){let B="";for(const V of a.refProperties)B+=`/${w(te[V])}`;return B}class C{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,V){for(const re of B)this._layerConfigs[re.id]=re,(this._layers[re.id]=a.createStyleLayer(re)).compileFilter(),this.keyCache[re.id]&&delete this.keyCache[re.id];for(const re of V)delete this.keyCache[re],delete this._layerConfigs[re],delete this._layers[re];this.familiesBySource={};const ee=function(re,_e){const Ae={};for(let ye=0;ye<re.length;ye++){const ke=_e&&_e[re[ye].id]||S(re[ye]);_e&&(_e[re[ye].id]=ke);let $e=Ae[ke];$e||($e=Ae[ke]=[]),$e.push(re[ye])}const Ce=[];for(const ye in Ae)Ce.push(Ae[ye]);return Ce}(a.values(this._layerConfigs),this.keyCache);for(const re of ee){const _e=re.map(We=>this._layers[We.id]),Ae=_e[0];if(Ae.visibility==="none")continue;const Ce=Ae.source||"";let ye=this.familiesBySource[Ce];ye||(ye=this.familiesBySource[Ce]={});const ke=Ae.sourceLayer||"_geojsonTileLayer";let $e=ye[ke];$e||($e=ye[ke]=[]),$e.push(_e)}}}const{ImageBitmap:k}=a.window;class F{loadTile(B,V){const{uid:ee,encoding:re,rawImageData:_e,padding:Ae,buildQuadTree:Ce}=B,ye=k&&_e instanceof k?this.getImageData(_e,Ae):_e;V(null,new a.DEMData(ee,ye,re,Ae<1,Ce))}getImageData(B,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);const ee=this.offscreenCanvasContext.getImageData(-V,-V,B.width+2*V,B.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:ee.width,height:ee.height},ee.data)}}var R=function te(B,V){var ee,re=B&&B.type;if(re==="FeatureCollection")for(ee=0;ee<B.features.length;ee++)te(B.features[ee],V);else if(re==="GeometryCollection")for(ee=0;ee<B.geometries.length;ee++)te(B.geometries[ee],V);else if(re==="Feature")te(B.geometry,V);else if(re==="Polygon")W(B.coordinates,V);else if(re==="MultiPolygon")for(ee=0;ee<B.coordinates.length;ee++)W(B.coordinates[ee],V);return B};function W(te,B){if(te.length!==0){Z(te[0],B);for(var V=1;V<te.length;V++)Z(te[V],!B)}}function Z(te,B){for(var V=0,ee=0,re=0,_e=te.length,Ae=_e-1;re<_e;Ae=re++){var Ce=(te[re][0]-te[Ae][0])*(te[Ae][1]+te[re][1]),ye=V+Ce;ee+=Math.abs(V)>=Math.abs(Ce)?V-ye+Ce:Ce-ye+V,V=ye}V+ee>=0!=!!B&&te.reverse()}const X=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class q{constructor(B){this._feature=B,this.extent=a.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(this._feature.type===1){const B=[];for(const V of this._feature.geometry)B.push([new a.pointGeometry(V[0],V[1])]);return B}{const B=[];for(const V of this._feature.geometry){const ee=[];for(const re of V)ee.push(new a.pointGeometry(re[0],re[1]));B.push(ee)}return B}}toGeoJSON(B,V,ee){return X.call(this,B,V,ee)}}class ue{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=B.length,this._features=B}feature(B){return new q(this._features[B])}}var pe=a.vectorTile.VectorTileFeature,xe=fe;function fe(te,B){this.options=B||{},this.features=te,this.length=te.length}function Te(te,B){this.id=typeof te.id=="number"?te.id:void 0,this.type=te.type,this.rawGeometry=te.type===1?[te.geometry]:te.geometry,this.properties=te.tags,this.extent=B||4096}fe.prototype.feature=function(te){return new Te(this.features[te],this.options.extent)},Te.prototype.loadGeometry=function(){var te=this.rawGeometry;this.geometry=[];for(var B=0;B<te.length;B++){for(var V=te[B],ee=[],re=0;re<V.length;re++)ee.push(new a.pointGeometry(V[re][0],V[re][1]));this.geometry.push(ee)}return this.geometry},Te.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var te=this.geometry,B=1/0,V=-1/0,ee=1/0,re=-1/0,_e=0;_e<te.length;_e++)for(var Ae=te[_e],Ce=0;Ce<Ae.length;Ce++){var ye=Ae[Ce];B=Math.min(B,ye.x),V=Math.max(V,ye.x),ee=Math.min(ee,ye.y),re=Math.max(re,ye.y)}return[B,ee,V,re]},Te.prototype.toGeoJSON=pe.prototype.toGeoJSON;var Ie=Pe,Le=xe;function Pe(te){var B=new a.pbf;return function(V,ee){for(var re in V.layers)ee.writeMessage(3,qe,V.layers[re])}(te,B),B.finish()}function qe(te,B){var V;B.writeVarintField(15,te.version||1),B.writeStringField(1,te.name||""),B.writeVarintField(5,te.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<te.length;V++)ee.feature=te.feature(V),B.writeMessage(2,ze,ee);var re=ee.keys;for(V=0;V<re.length;V++)B.writeStringField(3,re[V]);var _e=ee.values;for(V=0;V<_e.length;V++)B.writeMessage(4,Qe,_e[V])}function ze(te,B){var V=te.feature;V.id!==void 0&&B.writeVarintField(1,V.id),B.writeMessage(2,lt,te),B.writeVarintField(3,V.type),B.writeMessage(4,Ze,V)}function lt(te,B){var V=te.feature,ee=te.keys,re=te.values,_e=te.keycache,Ae=te.valuecache;for(var Ce in V.properties){var ye=V.properties[Ce],ke=_e[Ce];if(ye!==null){ke===void 0&&(ee.push(Ce),_e[Ce]=ke=ee.length-1),B.writeVarint(ke);var $e=typeof ye;$e!=="string"&&$e!=="boolean"&&$e!=="number"&&(ye=JSON.stringify(ye));var We=$e+":"+ye,Je=Ae[We];Je===void 0&&(re.push(ye),Ae[We]=Je=re.length-1),B.writeVarint(Je)}}}function ct(te,B){return(B<<3)+(7&te)}function be(te){return te<<1^te>>31}function Ze(te,B){for(var V=te.loadGeometry(),ee=te.type,re=0,_e=0,Ae=V.length,Ce=0;Ce<Ae;Ce++){var ye=V[Ce],ke=1;ee===1&&(ke=ye.length),B.writeVarint(ct(1,ke));for(var $e=ee===3?ye.length-1:ye.length,We=0;We<$e;We++){We===1&&ee!==1&&B.writeVarint(ct(2,$e-1));var Je=ye[We].x-re,Mt=ye[We].y-_e;B.writeVarint(be(Je)),B.writeVarint(be(Mt)),re+=Je,_e+=Mt}ee===3&&B.writeVarint(ct(7,1))}}function Qe(te,B){var V=typeof te;V==="string"?B.writeStringField(1,te):V==="boolean"?B.writeBooleanField(7,te):V==="number"&&(te%1!=0?B.writeDoubleField(3,te):te<0?B.writeSVarintField(6,te):B.writeVarintField(5,te))}function gt(te,B,V,ee,re,_e){if(re-ee<=V)return;const Ae=ee+re>>1;St(te,B,Ae,ee,re,_e%2),gt(te,B,V,ee,Ae-1,_e+1),gt(te,B,V,Ae+1,re,_e+1)}function St(te,B,V,ee,re,_e){for(;re>ee;){if(re-ee>600){const ke=re-ee+1,$e=V-ee+1,We=Math.log(ke),Je=.5*Math.exp(2*We/3),Mt=.5*Math.sqrt(We*Je*(ke-Je)/ke)*($e-ke/2<0?-1:1);St(te,B,V,Math.max(ee,Math.floor(V-$e*Je/ke+Mt)),Math.min(re,Math.floor(V+(ke-$e)*Je/ke+Mt)),_e)}const Ae=B[2*V+_e];let Ce=ee,ye=re;for(bt(te,B,ee,V),B[2*re+_e]>Ae&&bt(te,B,ee,re);Ce<ye;){for(bt(te,B,Ce,ye),Ce++,ye--;B[2*Ce+_e]<Ae;)Ce++;for(;B[2*ye+_e]>Ae;)ye--}B[2*ee+_e]===Ae?bt(te,B,ee,ye):(ye++,bt(te,B,ye,re)),ye<=V&&(ee=ye+1),V<=ye&&(re=ye-1)}}function bt(te,B,V,ee){Ti(te,V,ee),Ti(B,2*V,2*ee),Ti(B,2*V+1,2*ee+1)}function Ti(te,B,V){const ee=te[B];te[B]=te[V],te[V]=ee}function Pt(te,B,V,ee){const re=te-V,_e=B-ee;return re*re+_e*_e}Ie.fromVectorTileJs=Pe,Ie.fromGeojsonVt=function(te,B){B=B||{};var V={};for(var ee in te)V[ee]=new xe(te[ee].features,B),V[ee].name=ee,V[ee].version=B.version,V[ee].extent=B.extent;return Pe({layers:V})},Ie.GeoJSONWrapper=Le;const Bi=te=>te[0],Ei=te=>te[1];class rr{constructor(B,V=Bi,ee=Ei,re=64,_e=Float64Array){this.nodeSize=re,this.points=B;const Ae=B.length<65536?Uint16Array:Uint32Array,Ce=this.ids=new Ae(B.length),ye=this.coords=new _e(2*B.length);for(let ke=0;ke<B.length;ke++)Ce[ke]=ke,ye[2*ke]=V(B[ke]),ye[2*ke+1]=ee(B[ke]);gt(Ce,ye,re,0,Ce.length-1,0)}range(B,V,ee,re){return function(_e,Ae,Ce,ye,ke,$e,We){const Je=[0,_e.length-1,0],Mt=[];let Ft,Lt;for(;Je.length;){const Bt=Je.pop(),Qt=Je.pop(),Li=Je.pop();if(Qt-Li<=We){for(let Ni=Li;Ni<=Qt;Ni++)Ft=Ae[2*Ni],Lt=Ae[2*Ni+1],Ft>=Ce&&Ft<=ke&&Lt>=ye&&Lt<=$e&&Mt.push(_e[Ni]);continue}const Ui=Math.floor((Li+Qt)/2);Ft=Ae[2*Ui],Lt=Ae[2*Ui+1],Ft>=Ce&&Ft<=ke&&Lt>=ye&&Lt<=$e&&Mt.push(_e[Ui]);const ki=(Bt+1)%2;(Bt===0?Ce<=Ft:ye<=Lt)&&(Je.push(Li),Je.push(Ui-1),Je.push(ki)),(Bt===0?ke>=Ft:$e>=Lt)&&(Je.push(Ui+1),Je.push(Qt),Je.push(ki))}return Mt}(this.ids,this.coords,B,V,ee,re,this.nodeSize)}within(B,V,ee){return function(re,_e,Ae,Ce,ye,ke){const $e=[0,re.length-1,0],We=[],Je=ye*ye;for(;$e.length;){const Mt=$e.pop(),Ft=$e.pop(),Lt=$e.pop();if(Ft-Lt<=ke){for(let ki=Lt;ki<=Ft;ki++)Pt(_e[2*ki],_e[2*ki+1],Ae,Ce)<=Je&&We.push(re[ki]);continue}const Bt=Math.floor((Lt+Ft)/2),Qt=_e[2*Bt],Li=_e[2*Bt+1];Pt(Qt,Li,Ae,Ce)<=Je&&We.push(re[Bt]);const Ui=(Mt+1)%2;(Mt===0?Ae-ye<=Qt:Ce-ye<=Li)&&($e.push(Lt),$e.push(Bt-1),$e.push(Ui)),(Mt===0?Ae+ye>=Qt:Ce+ye>=Li)&&($e.push(Bt+1),$e.push(Ft),$e.push(Ui))}return We}(this.ids,this.coords,B,V,ee,this.nodeSize)}}const it={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:te=>te},It=Math.fround||(mt=new Float32Array(1),te=>(mt[0]=+te,mt[0]));var mt;class Dt{constructor(B){this.options=tt(Object.create(it),B),this.trees=new Array(this.options.maxZoom+1)}load(B){const{log:V,minZoom:ee,maxZoom:re,nodeSize:_e}=this.options;V&&console.time("total time");const Ae=`prepare ${B.length} points`;V&&console.time(Ae),this.points=B;let Ce=[];for(let ye=0;ye<B.length;ye++)B[ye].geometry&&Ce.push(xi(B[ye],ye));this.trees[re+1]=new rr(Ce,rt,_t,_e,Float32Array),V&&console.timeEnd(Ae);for(let ye=re;ye>=ee;ye--){const ke=+Date.now();Ce=this._cluster(Ce,ye),this.trees[ye]=new rr(Ce,rt,_t,_e,Float32Array),V&&console.log("z%d: %d clusters in %dms",ye,Ce.length,+Date.now()-ke)}return V&&console.timeEnd("total time"),this}getClusters(B,V){let ee=((B[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,B[1]));let _e=B[2]===180?180:((B[2]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)ee=-180,_e=180;else if(ee>_e){const $e=this.getClusters([ee,re,180,Ae],V),We=this.getClusters([-180,re,_e,Ae],V);return $e.concat(We)}const Ce=this.trees[this._limitZoom(V)],ye=Ce.range(ce(ee),me(Ae),ce(_e),me(re)),ke=[];for(const $e of ye){const We=Ce.points[$e];ke.push(We.numPoints?Zt(We):this.points[We.index])}return ke}getChildren(B){const V=this._getOriginId(B),ee=this._getOriginZoom(B),re="No cluster with the specified id.",_e=this.trees[ee];if(!_e)throw new Error(re);const Ae=_e.points[V];if(!Ae)throw new Error(re);const Ce=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),ye=_e.within(Ae.x,Ae.y,Ce),ke=[];for(const $e of ye){const We=_e.points[$e];We.parentId===B&&ke.push(We.numPoints?Zt(We):this.points[We.index])}if(ke.length===0)throw new Error(re);return ke}getLeaves(B,V,ee){const re=[];return this._appendLeaves(re,B,V=V||10,ee=ee||0,0),re}getTile(B,V,ee){const re=this.trees[this._limitZoom(B)],_e=Math.pow(2,B),{extent:Ae,radius:Ce}=this.options,ye=Ce/Ae,ke=(ee-ye)/_e,$e=(ee+1+ye)/_e,We={features:[]};return this._addTileFeatures(re.range((V-ye)/_e,ke,(V+1+ye)/_e,$e),re.points,V,ee,_e,We),V===0&&this._addTileFeatures(re.range(1-ye/_e,ke,1,$e),re.points,_e,ee,_e,We),V===_e-1&&this._addTileFeatures(re.range(0,ke,ye/_e,$e),re.points,-1,ee,_e,We),We.features.length?We:null}getClusterExpansionZoom(B){let V=this._getOriginZoom(B)-1;for(;V<=this.options.maxZoom;){const ee=this.getChildren(B);if(V++,ee.length!==1)break;B=ee[0].properties.cluster_id}return V}_appendLeaves(B,V,ee,re,_e){const Ae=this.getChildren(V);for(const Ce of Ae){const ye=Ce.properties;if(ye&&ye.cluster?_e+ye.point_count<=re?_e+=ye.point_count:_e=this._appendLeaves(B,ye.cluster_id,ee,re,_e):_e<re?_e++:B.push(Ce),B.length===ee)break}return _e}_addTileFeatures(B,V,ee,re,_e,Ae){for(const Ce of B){const ye=V[Ce],ke=ye.numPoints;let $e,We,Je;if(ke)$e=Gt(ye),We=ye.x,Je=ye.y;else{const Lt=this.points[ye.index];$e=Lt.properties,We=ce(Lt.geometry.coordinates[0]),Je=me(Lt.geometry.coordinates[1])}const Mt={type:1,geometry:[[Math.round(this.options.extent*(We*_e-ee)),Math.round(this.options.extent*(Je*_e-re))]],tags:$e};let Ft;ke?Ft=ye.id:this.options.generateId?Ft=ye.index:this.points[ye.index].id&&(Ft=this.points[ye.index].id),Ft!==void 0&&(Mt.id=Ft),Ae.features.push(Mt)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(+B,this.options.maxZoom+1))}_cluster(B,V){const ee=[],{radius:re,extent:_e,reduce:Ae,minPoints:Ce}=this.options,ye=re/(_e*Math.pow(2,V));for(let ke=0;ke<B.length;ke++){const $e=B[ke];if($e.zoom<=V)continue;$e.zoom=V;const We=this.trees[V+1],Je=We.within($e.x,$e.y,ye),Mt=$e.numPoints||1;let Ft=Mt;for(const Lt of Je){const Bt=We.points[Lt];Bt.zoom>V&&(Ft+=Bt.numPoints||1)}if(Ft>Mt&&Ft>=Ce){let Lt=$e.x*Mt,Bt=$e.y*Mt,Qt=Ae&&Mt>1?this._map($e,!0):null;const Li=(ke<<5)+(V+1)+this.points.length;for(const Ui of Je){const ki=We.points[Ui];if(ki.zoom<=V)continue;ki.zoom=V;const Ni=ki.numPoints||1;Lt+=ki.x*Ni,Bt+=ki.y*Ni,ki.parentId=Li,Ae&&(Qt||(Qt=this._map($e,!0)),Ae(Qt,this._map(ki)))}$e.parentId=Li,ee.push(mi(Lt/Ft,Bt/Ft,Li,Ft,Qt))}else if(ee.push($e),Ft>1)for(const Lt of Je){const Bt=We.points[Lt];Bt.zoom<=V||(Bt.zoom=V,ee.push(Bt))}}return ee}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,V){if(B.numPoints)return V?tt({},B.properties):B.properties;const ee=this.points[B.index].properties,re=this.options.map(ee);return V&&re===ee?tt({},re):re}}function mi(te,B,V,ee,re){return{x:It(te),y:It(B),zoom:1/0,id:V,parentId:-1,numPoints:ee,properties:re}}function xi(te,B){const[V,ee]=te.geometry.coordinates;return{x:It(ce(V)),y:It(me(ee)),zoom:1/0,index:B,parentId:-1}}function Zt(te){return{type:"Feature",id:te.id,properties:Gt(te),geometry:{type:"Point",coordinates:[(B=te.x,360*(B-.5)),Re(te.y)]}};var B}function Gt(te){const B=te.numPoints,V=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B;return tt(tt({},te.properties),{cluster:!0,cluster_id:te.id,point_count:B,point_count_abbreviated:V})}function ce(te){return te/360+.5}function me(te){const B=Math.sin(te*Math.PI/180),V=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return V<0?0:V>1?1:V}function Re(te){const B=(180-360*te)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function tt(te,B){for(const V in B)te[V]=B[V];return te}function rt(te){return te.x}function _t(te){return te.y}function wt(te,B,V,ee){for(var re,_e=ee,Ae=V-B>>1,Ce=V-B,ye=te[B],ke=te[B+1],$e=te[V],We=te[V+1],Je=B+3;Je<V;Je+=3){var Mt=Xe(te[Je],te[Je+1],ye,ke,$e,We);if(Mt>_e)re=Je,_e=Mt;else if(Mt===_e){var Ft=Math.abs(Je-Ae);Ft<Ce&&(re=Je,Ce=Ft)}}_e>ee&&(re-B>3&&wt(te,B,re,ee),te[re+2]=_e,V-re>3&&wt(te,re,V,ee))}function Xe(te,B,V,ee,re,_e){var Ae=re-V,Ce=_e-ee;if(Ae!==0||Ce!==0){var ye=((te-V)*Ae+(B-ee)*Ce)/(Ae*Ae+Ce*Ce);ye>1?(V=re,ee=_e):ye>0&&(V+=Ae*ye,ee+=Ce*ye)}return(Ae=te-V)*Ae+(Ce=B-ee)*Ce}function st(te,B,V,ee){var re={id:te===void 0?null:te,type:B,geometry:V,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(_e){var Ae=_e.geometry,Ce=_e.type;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")ve(_e,Ae);else if(Ce==="Polygon"||Ce==="MultiLineString")for(var ye=0;ye<Ae.length;ye++)ve(_e,Ae[ye]);else if(Ce==="MultiPolygon")for(ye=0;ye<Ae.length;ye++)for(var ke=0;ke<Ae[ye].length;ke++)ve(_e,Ae[ye][ke])}(re),re}function ve(te,B){for(var V=0;V<B.length;V+=3)te.minX=Math.min(te.minX,B[V]),te.minY=Math.min(te.minY,B[V+1]),te.maxX=Math.max(te.maxX,B[V]),te.maxY=Math.max(te.maxY,B[V+1])}function Oe(te,B,V,ee){if(B.geometry){var re=B.geometry.coordinates,_e=B.geometry.type,Ae=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),Ce=[],ye=B.id;if(V.promoteId?ye=B.properties[V.promoteId]:V.generateId&&(ye=ee||0),_e==="Point")Tt(re,Ce);else if(_e==="MultiPoint")for(var ke=0;ke<re.length;ke++)Tt(re[ke],Ce);else if(_e==="LineString")dt(re,Ce,Ae,!1);else if(_e==="MultiLineString"){if(V.lineMetrics){for(ke=0;ke<re.length;ke++)dt(re[ke],Ce=[],Ae,!1),te.push(st(ye,"LineString",Ce,B.properties));return}Nt(re,Ce,Ae,!1)}else if(_e==="Polygon")Nt(re,Ce,Ae,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(ke=0;ke<B.geometry.geometries.length;ke++)Oe(te,{id:ye,geometry:B.geometry.geometries[ke],properties:B.properties},V,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ke=0;ke<re.length;ke++){var $e=[];Nt(re[ke],$e,Ae,!0),Ce.push($e)}}te.push(st(ye,_e,Ce,B.properties))}}function Tt(te,B){B.push(Wt(te[0])),B.push(li(te[1])),B.push(0)}function dt(te,B,V,ee){for(var re,_e,Ae=0,Ce=0;Ce<te.length;Ce++){var ye=Wt(te[Ce][0]),ke=li(te[Ce][1]);B.push(ye),B.push(ke),B.push(0),Ce>0&&(Ae+=ee?(re*ke-ye*_e)/2:Math.sqrt(Math.pow(ye-re,2)+Math.pow(ke-_e,2))),re=ye,_e=ke}var $e=B.length-3;B[2]=1,wt(B,0,$e,V),B[$e+2]=1,B.size=Math.abs(Ae),B.start=0,B.end=B.size}function Nt(te,B,V,ee){for(var re=0;re<te.length;re++){var _e=[];dt(te[re],_e,V,ee),B.push(_e)}}function Wt(te){return te/360+.5}function li(te){var B=Math.sin(te*Math.PI/180),V=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return V<0?0:V>1?1:V}function Xt(te,B,V,ee,re,_e,Ae,Ce){if(ee/=B,_e>=(V/=B)&&Ae<ee)return te;if(Ae<V||_e>=ee)return null;for(var ye=[],ke=0;ke<te.length;ke++){var $e=te[ke],We=$e.geometry,Je=$e.type,Mt=re===0?$e.minX:$e.minY,Ft=re===0?$e.maxX:$e.maxY;if(Mt>=V&&Ft<ee)ye.push($e);else if(!(Ft<V||Mt>=ee)){var Lt=[];if(Je==="Point"||Je==="MultiPoint")Si(We,Lt,V,ee,re);else if(Je==="LineString")_r(We,Lt,V,ee,re,!1,Ce.lineMetrics);else if(Je==="MultiLineString")Vn(We,Lt,V,ee,re,!1);else if(Je==="Polygon")Vn(We,Lt,V,ee,re,!0);else if(Je==="MultiPolygon")for(var Bt=0;Bt<We.length;Bt++){var Qt=[];Vn(We[Bt],Qt,V,ee,re,!0),Qt.length&&Lt.push(Qt)}if(Lt.length){if(Ce.lineMetrics&&Je==="LineString"){for(Bt=0;Bt<Lt.length;Bt++)ye.push(st($e.id,Je,Lt[Bt],$e.tags));continue}Je!=="LineString"&&Je!=="MultiLineString"||(Lt.length===1?(Je="LineString",Lt=Lt[0]):Je="MultiLineString"),Je!=="Point"&&Je!=="MultiPoint"||(Je=Lt.length===3?"Point":"MultiPoint"),ye.push(st($e.id,Je,Lt,$e.tags))}}}return ye.length?ye:null}function Si(te,B,V,ee,re){for(var _e=0;_e<te.length;_e+=3){var Ae=te[_e+re];Ae>=V&&Ae<=ee&&(B.push(te[_e]),B.push(te[_e+1]),B.push(te[_e+2]))}}function _r(te,B,V,ee,re,_e,Ae){for(var Ce,ye,ke=hn(te),$e=re===0?$r:gr,We=te.start,Je=0;Je<te.length-3;Je+=3){var Mt=te[Je],Ft=te[Je+1],Lt=te[Je+2],Bt=te[Je+3],Qt=te[Je+4],Li=re===0?Mt:Ft,Ui=re===0?Bt:Qt,ki=!1;Ae&&(Ce=Math.sqrt(Math.pow(Mt-Bt,2)+Math.pow(Ft-Qt,2))),Li<V?Ui>V&&(ye=$e(ke,Mt,Ft,Bt,Qt,V),Ae&&(ke.start=We+Ce*ye)):Li>ee?Ui<ee&&(ye=$e(ke,Mt,Ft,Bt,Qt,ee),Ae&&(ke.start=We+Ce*ye)):Tn(ke,Mt,Ft,Lt),Ui<V&&Li>=V&&(ye=$e(ke,Mt,Ft,Bt,Qt,V),ki=!0),Ui>ee&&Li<=ee&&(ye=$e(ke,Mt,Ft,Bt,Qt,ee),ki=!0),!_e&&ki&&(Ae&&(ke.end=We+Ce*ye),B.push(ke),ke=hn(te)),Ae&&(We+=Ce)}var Ni=te.length-3;Mt=te[Ni],Ft=te[Ni+1],Lt=te[Ni+2],(Li=re===0?Mt:Ft)>=V&&Li<=ee&&Tn(ke,Mt,Ft,Lt),Ni=ke.length-3,_e&&Ni>=3&&(ke[Ni]!==ke[0]||ke[Ni+1]!==ke[1])&&Tn(ke,ke[0],ke[1],ke[2]),ke.length&&B.push(ke)}function hn(te){var B=[];return B.size=te.size,B.start=te.start,B.end=te.end,B}function Vn(te,B,V,ee,re,_e){for(var Ae=0;Ae<te.length;Ae++)_r(te[Ae],B,V,ee,re,_e,!1)}function Tn(te,B,V,ee){te.push(B),te.push(V),te.push(ee)}function $r(te,B,V,ee,re,_e){var Ae=(_e-B)/(ee-B);return te.push(_e),te.push(V+(re-V)*Ae),te.push(1),Ae}function gr(te,B,V,ee,re,_e){var Ae=(_e-V)/(re-V);return te.push(B+(ee-B)*Ae),te.push(_e),te.push(1),Ae}function pi(te,B){for(var V=[],ee=0;ee<te.length;ee++){var re,_e=te[ee],Ae=_e.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")re=Gr(_e.geometry,B);else if(Ae==="MultiLineString"||Ae==="Polygon"){re=[];for(var Ce=0;Ce<_e.geometry.length;Ce++)re.push(Gr(_e.geometry[Ce],B))}else if(Ae==="MultiPolygon")for(re=[],Ce=0;Ce<_e.geometry.length;Ce++){for(var ye=[],ke=0;ke<_e.geometry[Ce].length;ke++)ye.push(Gr(_e.geometry[Ce][ke],B));re.push(ye)}V.push(st(_e.id,Ae,re,_e.tags))}return V}function Gr(te,B){var V=[];V.size=te.size,te.start!==void 0&&(V.start=te.start,V.end=te.end);for(var ee=0;ee<te.length;ee+=3)V.push(te[ee]+B,te[ee+1],te[ee+2]);return V}function ta(te,B){if(te.transformed)return te;var V,ee,re,_e=1<<te.z,Ae=te.x,Ce=te.y;for(V=0;V<te.features.length;V++){var ye=te.features[V],ke=ye.geometry,$e=ye.type;if(ye.geometry=[],$e===1)for(ee=0;ee<ke.length;ee+=2)ye.geometry.push(ls(ke[ee],ke[ee+1],B,_e,Ae,Ce));else for(ee=0;ee<ke.length;ee++){var We=[];for(re=0;re<ke[ee].length;re+=2)We.push(ls(ke[ee][re],ke[ee][re+1],B,_e,Ae,Ce));ye.geometry.push(We)}}return te.transformed=!0,te}function ls(te,B,V,ee,re,_e){return[Math.round(V*(te*ee-re)),Math.round(V*(B*ee-_e))]}function ia(te,B,V,ee,re){for(var _e=B===re.maxZoom?0:re.tolerance/((1<<B)*re.extent),Ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:ee,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ce=0;Ce<te.length;Ce++){Ae.numFeatures++,Po(Ae,te[Ce],_e,re);var ye=te[Ce].minX,ke=te[Ce].minY,$e=te[Ce].maxX,We=te[Ce].maxY;ye<Ae.minX&&(Ae.minX=ye),ke<Ae.minY&&(Ae.minY=ke),$e>Ae.maxX&&(Ae.maxX=$e),We>Ae.maxY&&(Ae.maxY=We)}return Ae}function Po(te,B,V,ee){var re=B.geometry,_e=B.type,Ae=[];if(_e==="Point"||_e==="MultiPoint")for(var Ce=0;Ce<re.length;Ce+=3)Ae.push(re[Ce]),Ae.push(re[Ce+1]),te.numPoints++,te.numSimplified++;else if(_e==="LineString")Ds(Ae,re,te,V,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(Ce=0;Ce<re.length;Ce++)Ds(Ae,re[Ce],te,V,_e==="Polygon",Ce===0);else if(_e==="MultiPolygon")for(var ye=0;ye<re.length;ye++){var ke=re[ye];for(Ce=0;Ce<ke.length;Ce++)Ds(Ae,ke[Ce],te,V,!0,Ce===0)}if(Ae.length){var $e=B.tags||null;if(_e==="LineString"&&ee.lineMetrics){for(var We in $e={},B.tags)$e[We]=B.tags[We];$e.mapbox_clip_start=re.start/re.size,$e.mapbox_clip_end=re.end/re.size}var Je={geometry:Ae,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:$e};B.id!==null&&(Je.id=B.id),te.features.push(Je)}}function Ds(te,B,V,ee,re,_e){var Ae=ee*ee;if(ee>0&&B.size<(re?Ae:ee))V.numPoints+=B.length/3;else{for(var Ce=[],ye=0;ye<B.length;ye+=3)(ee===0||B[ye+2]>Ae)&&(V.numSimplified++,Ce.push(B[ye]),Ce.push(B[ye+1])),V.numPoints++;re&&function(ke,$e){for(var We=0,Je=0,Mt=ke.length,Ft=Mt-2;Je<Mt;Ft=Je,Je+=2)We+=(ke[Je]-ke[Ft])*(ke[Je+1]+ke[Ft+1]);if(We>0===$e)for(Je=0,Mt=ke.length;Je<Mt/2;Je+=2){var Lt=ke[Je],Bt=ke[Je+1];ke[Je]=ke[Mt-2-Je],ke[Je+1]=ke[Mt-1-Je],ke[Mt-2-Je]=Lt,ke[Mt-1-Je]=Bt}}(Ce,_e),te.push(Ce)}}function $n(te,B){var V=(B=this.options=function(re,_e){for(var Ae in _e)re[Ae]=_e[Ae];return re}(Object.create(this.options),B)).debug;if(V&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(re,_e){var Ae=[];if(re.type==="FeatureCollection")for(var Ce=0;Ce<re.features.length;Ce++)Oe(Ae,re.features[Ce],_e,Ce);else Oe(Ae,re.type==="Feature"?re:{geometry:re},_e);return Ae}(te,B);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ee=function(re,_e){var Ae=_e.buffer/_e.extent,Ce=re,ye=Xt(re,1,-1-Ae,Ae,0,-1,2,_e),ke=Xt(re,1,1-Ae,2+Ae,0,-1,2,_e);return(ye||ke)&&(Ce=Xt(re,1,-Ae,1+Ae,0,-1,2,_e)||[],ye&&(Ce=pi(ye,1).concat(Ce)),ke&&(Ce=Ce.concat(pi(ke,-1)))),Ce}(ee,B)).length&&this.splitTile(ee,0,0,0),V&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ys(te,B,V){return 32*((1<<te)*V+B)+te}function cs(te,B){const V=te.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const ee=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!ee)return B(null,null);const re=new ue(ee.features);let _e=Ie(re);_e.byteOffset===0&&_e.byteLength===_e.buffer.byteLength||(_e=new Uint8Array(_e)),B(null,{vectorTile:re,rawData:_e.buffer})}$n.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},$n.prototype.splitTile=function(te,B,V,ee,re,_e,Ae){for(var Ce=[te,B,V,ee],ye=this.options,ke=ye.debug;Ce.length;){ee=Ce.pop(),V=Ce.pop(),B=Ce.pop(),te=Ce.pop();var $e=1<<B,We=Ys(B,V,ee),Je=this.tiles[We];if(!Je&&(ke>1&&console.time("creation"),Je=this.tiles[We]=ia(te,B,V,ee,ye),this.tileCoords.push({z:B,x:V,y:ee}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,V,ee,Je.numFeatures,Je.numPoints,Je.numSimplified),console.timeEnd("creation"));var Mt="z"+B;this.stats[Mt]=(this.stats[Mt]||0)+1,this.total++}if(Je.source=te,re){if(B===ye.maxZoom||B===re)continue;var Ft=1<<re-B;if(V!==Math.floor(_e/Ft)||ee!==Math.floor(Ae/Ft))continue}else if(B===ye.indexMaxZoom||Je.numPoints<=ye.indexMaxPoints)continue;if(Je.source=null,te.length!==0){ke>1&&console.time("clipping");var Lt,Bt,Qt,Li,Ui,ki,Ni=.5*ye.buffer/ye.extent,Qs=.5-Ni,zs=.5+Ni,Cr=1+Ni;Lt=Bt=Qt=Li=null,Ui=Xt(te,$e,V-Ni,V+zs,0,Je.minX,Je.maxX,ye),ki=Xt(te,$e,V+Qs,V+Cr,0,Je.minX,Je.maxX,ye),te=null,Ui&&(Lt=Xt(Ui,$e,ee-Ni,ee+zs,1,Je.minY,Je.maxY,ye),Bt=Xt(Ui,$e,ee+Qs,ee+Cr,1,Je.minY,Je.maxY,ye),Ui=null),ki&&(Qt=Xt(ki,$e,ee-Ni,ee+zs,1,Je.minY,Je.maxY,ye),Li=Xt(ki,$e,ee+Qs,ee+Cr,1,Je.minY,Je.maxY,ye),ki=null),ke>1&&console.timeEnd("clipping"),Ce.push(Lt||[],B+1,2*V,2*ee),Ce.push(Bt||[],B+1,2*V,2*ee+1),Ce.push(Qt||[],B+1,2*V+1,2*ee),Ce.push(Li||[],B+1,2*V+1,2*ee+1)}}},$n.prototype.getTile=function(te,B,V){var ee=this.options,re=ee.extent,_e=ee.debug;if(te<0||te>24)return null;var Ae=1<<te,Ce=Ys(te,B=(B%Ae+Ae)%Ae,V);if(this.tiles[Ce])return ta(this.tiles[Ce],re);_e>1&&console.log("drilling down to z%d-%d-%d",te,B,V);for(var ye,ke=te,$e=B,We=V;!ye&&ke>0;)ke--,$e=Math.floor($e/2),We=Math.floor(We/2),ye=this.tiles[Ys(ke,$e,We)];return ye&&ye.source?(_e>1&&console.log("found parent tile z%d-%d-%d",ke,$e,We),_e>1&&console.time("drilling down"),this.splitTile(ye.source,ke,$e,We,te,B,V),_e>1&&console.timeEnd("drilling down"),this.tiles[Ce]?ta(this.tiles[Ce],re):null):null};class ra extends a.VectorTileWorkerSource{constructor(B,V,ee,re,_e){super(B,V,ee,re,cs),_e&&(this.loadGeoJSON=_e)}loadData(B,V){const ee=B&&B.request,re=ee&&ee.collectResourceTiming;this.loadGeoJSON(B,(_e,Ae)=>{if(_e||!Ae)return V(_e);if(typeof Ae!="object")return V(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{R(Ae,!0);try{if(B.filter){const ye=a.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map($e=>`${$e.key}: ${$e.message}`).join(", "));const ke=Ae.features.filter($e=>ye.value.evaluate({zoom:0},$e));Ae={type:"FeatureCollection",features:ke}}this._geoJSONIndex=B.cluster?new Dt(function({superclusterOptions:ye,clusterProperties:ke}){if(!ke||!ye)return ye;const $e={},We={},Je={accumulated:null,zoom:0},Mt={properties:null},Ft=Object.keys(ke);for(const Lt of Ft){const[Bt,Qt]=ke[Lt],Li=a.createExpression(Qt),Ui=a.createExpression(typeof Bt=="string"?[Bt,["accumulated"],["get",Lt]]:Bt);$e[Lt]=Li.value,We[Lt]=Ui.value}return ye.map=Lt=>{Mt.properties=Lt;const Bt={};for(const Qt of Ft)Bt[Qt]=$e[Qt].evaluate(Je,Mt);return Bt},ye.reduce=(Lt,Bt)=>{Mt.properties=Bt;for(const Qt of Ft)Je.accumulated=Lt[Qt],Lt[Qt]=We[Qt].evaluate(Je,Mt)},ye}(B)).load(Ae.features):function(ye,ke){return new $n(ye,ke)}(Ae,B.geojsonVtOptions)}catch(ye){return V(ye)}this.loaded={};const Ce={};if(re){const ye=a.getPerformanceMeasurement(ee);ye&&(Ce.resourceTiming={},Ce.resourceTiming[B.source]=JSON.parse(JSON.stringify(ye)))}V(null,Ce)}})}reloadTile(B,V){const ee=this.loaded;return ee&&ee[B.uid]?super.reloadTile(B,V):this.loadTile(B,V)}loadGeoJSON(B,V){if(B.request)a.getJSON(B.request,V);else{if(typeof B.data!="string")return V(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(B.data))}catch{return V(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(B,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(ee){V(ee)}}getClusterChildren(B,V){try{V(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(ee){V(ee)}}getClusterLeaves(B,V){try{V(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(ee){V(ee)}}}class fn{constructor(B){this.self=B,this.actor=new a.Actor(B,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:ra},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,ee)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=ee},this.self.registerRTLTextPlugin=V=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=V.applyArabicShaping,a.plugin.processBidirectionalText=V.processBidirectionalText,a.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(B,V,ee){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B],ee()}checkIfReady(B,V,ee){ee()}setReferrer(B,V){this.referrer=V}spriteLoaded(B,V){this.isSpriteLoaded[B]=V;for(const ee in this.workerSources[B]){const re=this.workerSources[B][ee];for(const _e in re)re[_e]instanceof a.VectorTileWorkerSource&&(re[_e].isSpriteLoaded=V,re[_e].fire(new a.Event("isSpriteLoaded")))}}setImages(B,V,ee){this.availableImages[B]=V;for(const re in this.workerSources[B]){const _e=this.workerSources[B][re];for(const Ae in _e)_e[Ae].availableImages=V}ee()}enableTerrain(B,V,ee){this.terrain=V,ee()}setProjection(B,V){this.projections[B]=a.getProjection(V)}setLayers(B,V,ee){this.getLayerIndex(B).replace(V),ee()}updateLayers(B,V,ee){this.getLayerIndex(B).update(V.layers,V.removedIds),ee()}loadTile(B,V,ee){const re=this.enableTerrain?a.extend({enableTerrain:this.terrain},V):V;re.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,V.type,V.source).loadTile(re,ee)}loadDEMTile(B,V,ee){const re=this.enableTerrain?a.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(B,V.source).loadTile(re,ee)}reloadTile(B,V,ee){const re=this.enableTerrain?a.extend({enableTerrain:this.terrain},V):V;re.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,V.type,V.source).reloadTile(re,ee)}abortTile(B,V,ee){this.getWorkerSource(B,V.type,V.source).abortTile(V,ee)}removeTile(B,V,ee){this.getWorkerSource(B,V.type,V.source).removeTile(V,ee)}removeSource(B,V,ee){if(!this.workerSources[B]||!this.workerSources[B][V.type]||!this.workerSources[B][V.type][V.source])return;const re=this.workerSources[B][V.type][V.source];delete this.workerSources[B][V.type][V.source],re.removeSource!==void 0?re.removeSource(V,ee):ee()}loadWorkerSource(B,V,ee){try{this.self.importScripts(V.url),ee()}catch(re){ee(re.toString())}}syncRTLPluginState(B,V,ee){try{a.plugin.setState(V);const re=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&re!=null){this.self.importScripts(re);const _e=a.plugin.isParsed();ee(_e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${re}`),_e)}}catch(re){ee(re.toString())}}getAvailableImages(B){let V=this.availableImages[B];return V||(V=[]),V}getLayerIndex(B){let V=this.layerIndexes[B];return V||(V=this.layerIndexes[B]=new C),V}getWorkerSource(B,V,ee){return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][V]||(this.workerSources[B][V]={}),this.workerSources[B][V][ee]||(this.workerSources[B][V][ee]=new this.workerSourceTypes[V]({send:(re,_e,Ae,Ce,ye,ke)=>{this.actor.send(re,_e,Ae,B,ye,ke)},scheduler:this.actor.scheduler},this.getLayerIndex(B),this.getAvailableImages(B),this.isSpriteLoaded[B])),this.workerSources[B][V][ee]}getDEMWorkerSource(B,V){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][V]||(this.demWorkerSources[B][V]=new F),this.demWorkerSources[B][V]}enforceCacheSizeLimit(B,V){a.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(B,V,ee){ee(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new fn(self)),fn}),d(["./shared"],function(a){var w=S;function S(m){return!function(n){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,b=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(b);try{x=new Worker(E),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(E),_}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var b=x.getImageData(0,0,1,1);return b&&b.width===_.width}()?(C[h=n&&n.failIfMajorPerformanceCaveat]===void 0&&(C[h]=function(_){var x,b=function(E){var I=document.createElement("canvas"),z=Object.create(S.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=E,I.getContext("webgl",z)||I.getContext("experimental-webgl",z)}(_);if(!b)return!1;try{x=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!x||b.isContextLost())&&(b.shaderSource(x,"void main() {}"),b.compileShader(x),b.getShaderParameter(x,b.COMPILE_STATUS)===!0)}(h)),C[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(m)}var C={};function k(m,n){var h=n[0],_=n[1],x=n[2],b=n[3],E=h*b-x*_;return E?(m[0]=b*(E=1/E),m[1]=-_*E,m[2]=-x*E,m[3]=h*E,m):null}function F(m,n){if(Array.isArray(m)){if(!Array.isArray(n)||m.length!==n.length)return!1;for(let h=0;h<m.length;h++)if(!F(m[h],n[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&n!==null){if(typeof n!="object"||Object.keys(m).length!==Object.keys(n).length)return!1;for(const h in m)if(!F(m[h],n[h]))return!1;return!0}return m===n}S.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const R={create:function(m,n,h){const _=a.window.document.createElement(m);return n!==void 0&&(_.className=n),h&&h.appendChild(_),_},createSVG:function(m,n,h){const _=a.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const x of Object.keys(n))_.setAttributeNS(null,x,n[x]);return h&&h.appendChild(_),_}},W=a.window.document&&a.window.document.documentElement.style,Z=W&&W.userSelect!==void 0?"userSelect":"WebkitUserSelect";let X;R.disableDrag=function(){W&&Z&&(X=W[Z],W[Z]="none")},R.enableDrag=function(){W&&Z&&(W[Z]=X)};const q=function(m){m.preventDefault(),m.stopPropagation(),a.window.removeEventListener("click",q,!0)};function ue(m,n,h){const _=m.offsetWidth===n.width?1:m.offsetWidth/n.width;return new a.pointGeometry((h.clientX-n.left)*_,(h.clientY-n.top)*_)}function pe(m){const{userImage:n}=m;return!!(n&&n.render&&n.render())&&(m.data.replace(new Uint8Array(n.data.buffer)),!0)}R.suppressClick=function(){a.window.addEventListener("click",q,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",q,!0)},0)},R.mousePos=function(m,n){const h=m.getBoundingClientRect();return ue(m,h,n)},R.touchPos=function(m,n){const h=m.getBoundingClientRect(),_=[];for(let x=0;x<n.length;x++)_.push(ue(m,h,n[x]));return _},R.mouseButton=function(m){return a.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button};class xe extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}getImage(n){return this.images[n]}addImage(n,h){this._validate(n,h)&&(this.images[n]=h)}_validate(n,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),_=!1),_}_validateStretch(n,h){if(!n)return!0;let _=0;for(const x of n){if(x[0]<_||x[1]<x[0]||h<x[1])return!1;_=x[1]}return!0}_validateContent(n,h){return!(n&&(n.length!==4||n[0]<0||h.data.width<n[0]||n[1]<0||h.data.height<n[1]||n[2]<0||h.data.width<n[2]||n[3]<0||h.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,h){h.version=this.images[n].version+1,this.images[n]=h,this.updatedImages[n]=!0}removeImage(n){const h=this.images[n];delete this.images[n],delete this.patterns[n],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,h){let _=!0;if(!this.isLoaded())for(const x of n)this.images[x]||(_=!1);this.isLoaded()||_?this._notify(n,h):this.requestors.push({ids:n,callback:h})}_notify(n,h){const _={};for(const x of n){this.images[x]||this.fire(new a.Event("styleimagemissing",{id:x}));const b=this.images[x];b?_[x]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:a.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:n,height:h}=this.atlasImage;return{width:n,height:h}}getPattern(n){const h=this.patterns[n],_=this.getImage(n);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},b=new a.ImagePosition(x,_);this.patterns[n]={bin:x,position:b}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const h=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(n,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const b in this.patterns)n.push(this.patterns[b].bin);const{w:h,h:_}=a.potpack(n),x=this.atlasImage;x.resize({width:h||1,height:_||1});for(const b in this.patterns){const{bin:E}=this.patterns[b],I=E.x+1,z=E.y+1,L=this.images[b].data,O=L.width,N=L.height;a.RGBAImage.copy(L,x,{x:0,y:0},{x:I,y:z},{width:O,height:N}),a.RGBAImage.copy(L,x,{x:0,y:N-1},{x:I,y:z-1},{width:O,height:1}),a.RGBAImage.copy(L,x,{x:0,y:0},{x:I,y:z+N},{width:O,height:1}),a.RGBAImage.copy(L,x,{x:O-1,y:0},{x:I-1,y:z},{width:1,height:N}),a.RGBAImage.copy(L,x,{x:0,y:0},{x:I+O,y:z},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const h of n){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];pe(_)&&this.updateImage(h,_)}}}const fe=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(m,n){return function([h,_,x]){const b=a.degToRad(_+90),E=a.degToRad(x);return{x:h*Math.cos(b)*Math.sin(E),y:h*Math.sin(b)*Math.sin(E),z:h*Math.cos(E),azimuthal:_,polar:x}}(m.expression.evaluate(n))}interpolate(m,n,h){return{x:a.number(m.x,n.x,h),y:a.number(m.y,n.y,h),z:a.number(m.z,n.z,h),azimuthal:a.number(m.azimuthal,n.azimuthal,h),polar:a.number(m.polar,n.polar,h)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),Te="-transition";class Ie extends a.Evented{constructor(n){super(),this._transitionable=new a.Transitionable(fe),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,h={}){if(!this._validate(a.validateLight,n,h))for(const _ in n){const x=n[_];a.endsWith(_,Te)?this._transitionable.setTransition(_.slice(0,-Te.length),x):this._transitionable.setValue(_,x)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,h,_){return(!_||_.validate!==!1)&&a.emitValidationErrors(this,n.call(a.validateStyle,a.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const Le=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)}),Pe="-transition";class qe extends a.Evented{constructor(n,h){super(),this._transitionable=new a.Transitionable(Le),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(n){for(const h in n){const _=n[h];a.endsWith(h,Pe)?this._transitionable.setTransition(h.slice(0,-Pe.length),_):this._transitionable.setValue(h,_)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function ze(m,n,h,_){const x=a.smoothstep(45,65,h),[b,E]=lt(m,_),I=a.length(n);let z=1-Math.min(1,Math.exp((I-b)/(E-b)*-6));return z*=z*z,z=Math.min(1,1.00747*z),z*x*m.alpha}function lt(m,n){const h=.5/Math.tan(.5*n);return[m.range[0]+h,m.range[1]+h]}const ct=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"])}),be="-transition";class Ze extends a.Evented{constructor(n,h){super(),this._transitionable=new a.Transitionable(ct),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,h={}){if(!this._validate(a.validateFog,n,h))for(const _ in n){const x=n[_];a.endsWith(_,be)?this._transitionable.setTransition(_.slice(0,-be.length),x):this._transitionable.setValue(_,x)}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return a.smoothstep(45,65,n)*h.a}getOpacityAtLatLng(n,h){return this._transform.projection.supportsFog?function(_,x,b){const E=a.MercatorCoordinate.fromLngLat(x),I=b.elevation?b.elevation.getAtPointOrZero(E):0,z=[E.x,E.y,I];return a.transformMat4(z,z,b.mercatorFogMatrix),ze(_,z,b.pitch,b._fov)}(this.state,n,h):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?lt(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,h,_){return(!_||_.validate!==!1)&&a.emitValidationErrors(this,n.call(a.validateStyle,a.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Qe{constructor(n,h){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const _=this.workerPool.acquire(this.id);for(let x=0;x<_.length;x++){const b=new Qe.Actor(_[x],h,this.id);b.name=`Worker ${x}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,h,_){a.asyncAll(this.actors,(x,b)=>{x.send(n,h,b)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function gt(m,n,h){return n*(a.EXTENT/(m.tileSize*Math.pow(2,h-m.tileID.overscaledZ)))}Qe.Actor=a.Actor;class St{constructor(n,h,_){this.context=n;const x=n.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ti{constructor(n,h,_,x){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),n.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,h){for(let _=0;_<this.attributes.length;_++){const x=h.attributes[this.attributes[_].name];x!==void 0&&n.enableVertexAttribArray(x)}}setVertexAttribPointers(n,h,_){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],E=h.attributes[b.name];E!==void 0&&n.vertexAttribPointer(E,b.components,n[bt[b.type]],!1,this.itemSize,b.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Pt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Bi extends Pt{getDefault(){return a.Color.transparent}set(n){const h=this.current;(n.r!==h.r||n.g!==h.g||n.b!==h.b||n.a!==h.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ei extends Pt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class rr extends Pt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class it extends Pt{getDefault(){return[!0,!0,!0,!0]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||n[2]!==h[2]||n[3]!==h[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class It extends Pt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class mt extends Pt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Dt extends Pt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const h=this.current;(n.func!==h.func||n.ref!==h.ref||n.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class mi extends Pt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||n[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class xi extends Pt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;n?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=n,this.dirty=!1}}class Zt extends Pt{getDefault(){return[0,1]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Gt extends Pt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;n?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=n,this.dirty=!1}}class ce extends Pt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class me extends Pt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;n?h.enable(h.BLEND):h.disable(h.BLEND),this.current=n,this.dirty=!1}}class Re extends Pt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class tt extends Pt{getDefault(){return a.Color.transparent}set(n){const h=this.current;(n.r!==h.r||n.g!==h.g||n.b!==h.b||n.a!==h.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class rt extends Pt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class _t extends Pt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;n?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=n,this.dirty=!1}}class wt extends Pt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Xe extends Pt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class st extends Pt{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class ve extends Pt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Oe extends Pt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||n[2]!==h[2]||n[3]!==h[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Tt extends Pt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class dt extends Pt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Nt extends Pt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Wt extends Pt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class li extends Pt{getDefault(){return null}set(n){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Xt extends Pt{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Si extends Pt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class _r extends Pt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class hn extends Pt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Vn extends Pt{constructor(n,h){super(n),this.context=n,this.parent=h}getDefault(){return null}}class Tn extends Vn{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class $r extends Vn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class gr extends $r{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class pi{constructor(n,h,_,x){this.context=n,this.width=h,this.height=_;const b=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Tn(n,b),x&&(this.depthAttachment=new $r(n,b))}destroy(){const n=this.context.gl,h=this.colorAttachment.get();if(h&&n.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&n.deleteRenderbuffer(_)}n.deleteFramebuffer(this.framebuffer)}}class Gr{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Bi(this),this.clearDepth=new Ei(this),this.clearStencil=new rr(this),this.colorMask=new it(this),this.depthMask=new It(this),this.stencilMask=new mt(this),this.stencilFunc=new Dt(this),this.stencilOp=new mi(this),this.stencilTest=new xi(this),this.depthRange=new Zt(this),this.depthTest=new Gt(this),this.depthFunc=new ce(this),this.blend=new me(this),this.blendFunc=new Re(this),this.blendColor=new tt(this),this.blendEquation=new rt(this),this.cullFace=new _t(this),this.cullFaceSide=new wt(this),this.frontFace=new Xe(this),this.program=new st(this),this.activeTexture=new ve(this),this.viewport=new Oe(this),this.bindFramebuffer=new Tt(this),this.bindRenderbuffer=new dt(this),this.bindTexture=new Nt(this),this.bindVertexBuffer=new Wt(this),this.bindElementBuffer=new li(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Xt(this),this.pixelStoreUnpack=new Si(this),this.pixelStoreUnpackPremultiplyAlpha=new _r(this),this.pixelStoreUnpackFlipY=new hn(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,h){return new St(this,n,h)}createVertexBuffer(n,h,_){return new Ti(this,n,h,_)}createRenderbuffer(n,h,_){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,n,h,_),this.bindRenderbuffer.set(null),b}createFramebuffer(n,h,_){return new pi(this,n,h,_)}clear({color:n,depth:h,stencil:_}){const x=this.gl;let b=0;n&&(b|=x.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),_!==void 0&&(b|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){F(n.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ta{constructor(n,h,_,x){this.screenBounds=n,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(b=>x.pointCoordinate3D(b)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(n,h){let _,x;if(n instanceof a.pointGeometry||typeof n[0]=="number"){const b=a.pointGeometry.convert(n);_=[a.pointGeometry.convert(n)],x=h.isPointAboveHorizon(b)}else{const b=a.pointGeometry.convert(n[0]),E=a.pointGeometry.convert(n[1]);_=[b,E],x=a.polygonizeBounds(b,E).every(I=>h.isPointAboveHorizon(I))}return new ta(_,h.getCameraPoint(),x,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const h=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],x=a.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(x[3]=this.cameraPoint)),a.bufferConvexPolygon(x,n)}containsTile(n,h,_){const x=n.queryPadding+1,b=n.tileID.wrap,E=_?this._bufferedCameraMercator(x,h).map(H=>a.getTilePoint(n.tileTransform,H,b)):this._bufferedScreenMercator(x,h).map(H=>a.getTilePoint(n.tileTransform,H,b)),I=this.screenGeometryMercator.map(H=>a.getTileVec3(n.tileTransform,H,b)),z=I.map(H=>new a.pointGeometry(H[0],H[1])),L=h.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),O=a.getTileVec3(n.tileTransform,L,b),N=I.map(H=>{const J=a.sub(H,H,O);return a.normalize(J,J),new a.Ray(O,J)}),$=gt(n,1,h.zoom);if(a.polygonIntersectsBox(E,0,0,a.EXTENT,a.EXTENT))return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:N,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(Q=a.getBounds(E),Q.min.x=a.clamp(Q.min.x,0,a.EXTENT),Q.min.y=a.clamp(Q.min.y,0,a.EXTENT),Q.max.x=a.clamp(Q.max.x,0,a.EXTENT),Q.max.y=a.clamp(Q.max.y,0,a.EXTENT),Q),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:$};var Q}_bufferedScreenMercator(n,h){const _=ls(n);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{const x=this.bufferedScreenGeometry(n).map(b=>h.pointCoordinate3D(b));return this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(n,h){const _=ls(n);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{const x=this.bufferedCameraGeometry(n).map(b=>h.pointCoordinate3D(b));return this._cameraRaycastCache[_]=x,x}}}function ls(m){return 100*m|0}function ia(m,n,h){const _=function(x,b){if(x)return h(x);if(b){const E=a.pick(a.extend(b,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(E.vectorLayers=b.vector_layers,E.vectorLayerIds=E.vectorLayers.map(I=>I.id)),E.tiles=n.canonicalizeTileset(E,m.url),h(null,E)}};return m.url?a.getJSON(n.transformRequest(n.normalizeSourceURL(m.url),a.ResourceType.Source),_):a.exported.frame(()=>_(null,m))}class Po{constructor(n,h,_){this.bounds=a.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const h=Math.pow(2,n.z),_=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*h),x=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*h),b=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*h),E=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*h);return n.x>=_&&n.x<b&&n.y>=x&&n.y<E}}class Ds extends a.Evented{constructor(n,h,_,x){super(),this.id=n,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},h),a.extend(this,a.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ia(this._options,this.map._requestManager,(n,h)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new a.ErrorEvent(n)):h&&(a.extend(this,h),h.bounds&&(this.tileBounds=new Po(h.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(h.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,h){const _=a.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);n.request=a.getImage(this.map._requestManager.transformRequest(x,a.ResourceType.Tile),(b,E,I,z)=>{if(delete n.request,n.aborted)n.state="unloaded",h(null);else if(b)n.state="errored",h(b);else if(E){this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:I,expires:z});const L=this.map.painter.context,O=L.gl;n.texture=this.map.painter.getTileTexture(E.width),n.texture?n.texture.update(E,{useMipmap:!0}):(n.texture=new a.Texture(L,E,O.RGBA,{useMipmap:!0}),n.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE),L.extTextureFilterAnisotropic&&O.texParameterf(O.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax)),n.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(n,h){n.request&&(n.request.cancel(),delete n.request),h()}unloadTile(n,h){n.texture&&this.map.painter.saveTileTexture(n.texture),h()}hasTransition(){return!1}}let $n;function Ys(m,n,h,_,x,b,E,I){const z=[m,h,x,n,_,b,1,1,1],L=[E,I,1],O=a.adjoint([],z),[N,$,Q]=a.transformMat3(L,L,a.transpose(O,O));return a.multiply(z,[N,0,0,0,$,0,0,0,Q],z)}class cs extends a.Evented{constructor(n,h,_,x){super(),this.id=n,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=h}load(n,h){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(_,x)=>{this._loaded=!0,_?this.fire(new a.ErrorEvent(_)):x&&(this.image=a.exported.getImageData(x),this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}setCoordinates(n){this.coordinates=n,delete this._boundsArray;const h=n.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let x=1/0,b=1/0,E=-1/0,I=-1/0;for(const N of _)x=Math.min(x,N.x),b=Math.min(b,N.y),E=Math.max(E,N.x),I=Math.max(I,N.y);const z=Math.max(E-x,I-b),L=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),O=Math.pow(2,L);return new a.CanonicalTileID(L,Math.floor((x+E)/2*O),Math.floor((b+I)/2*O))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const n=a.tileTransform(this.tileID,this.map.transform.projection),[h,_,x,b]=this.coordinates.map(E=>{const I=n.projection.project(E[0],E[1]);return a.getTilePoint(n,I)._round()});return this.perspectiveTransform=function(E,I,z,L,O,N,$,Q,H,J){const he=Ys(0,0,E,0,0,I,E,I),Y=Ys(z,L,O,N,$,Q,H,J);return a.multiply(Y,a.adjoint(he,he),Y),[Y[6]/Y[8]*E/a.EXTENT,Y[7]/Y[8]*I/a.EXTENT]}(this.width,this.height,h.x,h.y,_.x,_.y,b.x,b.y,x.x,x.y),this._boundsArray=new a.StructArrayLayout4i8,this._boundsArray.emplaceBack(h.x,h.y,0,0),this._boundsArray.emplaceBack(_.x,_.y,a.EXTENT,0),this._boundsArray.emplaceBack(b.x,b.y,0,a.EXTENT),this._boundsArray.emplaceBack(x.x,x.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,h=n.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,a.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new a.Texture(n,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const _ in this.tiles){const x=this.tiles[_];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture)}}loadTile(n,h){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},h(null)):(n.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ra={vector:class extends a.Evented{constructor(m,n,h,_){if(super(),this.id=m,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(n,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ia(this._options,this.map._requestManager,(m,n)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new a.ErrorEvent(m)):n&&(a.extend(this,n),n.bounds&&(this.tileBounds=new Po(n.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}onAdd(m){this.map=m,this.load()}setSourceProperty(m){this._tileJSONRequest&&this._tileJSONRequest.cancel(),m();const n=this.map.style._getSourceCaches(this.id);for(const h of n)h.clearTiles();this.load()}setTiles(m){return this.setSourceProperty(()=>{this._options.tiles=m}),this}setUrl(m){return this.setSourceProperty(()=>{this.url=m,this._options.url=m}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(m,n){const h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(h,a.ResourceType.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:m.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,m.actor&&m.state!=="expired")m.state==="loading"?m.reloadCallback=n:m.request=m.actor.send("reloadTile",_,x.bind(this));else if(m.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)m.request=m.actor.send("loadTile",_,x.bind(this),void 0,!0);else{const b=a.loadVectorTile.call({deduped:this._deduped},_,(E,I)=>{E||!I?x.call(this,E):(_.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},m.actor&&m.actor.send("loadTile",_,x.bind(this),void 0,!0))},!0);m.request={cancel:b}}function x(b,E){return delete m.request,m.aborted?n(null):b&&b.status!==404?n(b):(E&&E.resourceTiming&&(m.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&m.setExpiryData(E),m.loadVectorData(E,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(m.reloadCallback&&(this.loadTile(m,m.reloadCallback),m.reloadCallback=null)))}}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.actor&&m.actor.send("abortTile",{uid:m.uid,type:this.type,source:this.id})}unloadTile(m){m.unloadVectorData(),m.actor&&m.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Ds,"raster-dem":class extends Ds{constructor(m,n,h,_){super(m,n,h,_),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(m,n){const h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,b){x&&(m.state="errored",n(x)),b&&(m.dem=b,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",n(null))}m.request=a.getImage(this.map._requestManager.transformRequest(h,a.ResourceType.Tile),function(x,b,E,I){if(delete m.request,m.aborted)m.state="unloaded",n(null);else if(x)m.state="errored",n(x);else if(b){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:E,expires:I});const z=a.window.ImageBitmap&&b instanceof a.window.ImageBitmap&&($n==null&&($n=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),$n),L=1-(b.width-a.prevPowerOfTwo(b.width))/2;L<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const O=z?b:a.exported.getImageData(b,L),N={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:O,encoding:this.encoding,padding:L};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",N,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const n=m.canonical,h=Math.pow(2,n.z),_=(n.x-1+h)%h,x=n.x===0?m.wrap-1:m.wrap,b=(n.x+1+h)%h,E=n.x+1===h?m.wrap+1:m.wrap,I={};return I[new a.OverscaledTileID(m.overscaledZ,x,n.z,_,n.y).key]={backfilled:!1},I[new a.OverscaledTileID(m.overscaledZ,E,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(I[new a.OverscaledTileID(m.overscaledZ,x,n.z,_,n.y-1).key]={backfilled:!1},I[new a.OverscaledTileID(m.overscaledZ,m.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},I[new a.OverscaledTileID(m.overscaledZ,E,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<h&&(I[new a.OverscaledTileID(m.overscaledZ,x,n.z,_,n.y+1).key]={backfilled:!1},I[new a.OverscaledTileID(m.overscaledZ,m.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},I[new a.OverscaledTileID(m.overscaledZ,E,n.z,b,n.y+1).key]={backfilled:!1}),I}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends a.Evented{constructor(m,n,h,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=n.data,this._options=a.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const x=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*x,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*x,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*x,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},n),this}getClusterChildren(m,n){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},n),this}getClusterLeaves(m,n,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:n,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=a.extend({},this.workerOptions),n=this._data;typeof n=="string"?(m.request=this.map._requestManager.transformRequest(a.exported.resolveURL(n),a.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new a.ErrorEvent(h));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),this.fire(new a.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,n){const h=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(h,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,x)=>(delete m.request,m.unloadVectorData(),m.aborted?n(null):_?n(_):(m.loadVectorData(x,this.map.painter,h==="reloadTile"),n(null))),void 0,h==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends cs{constructor(m,n,h,_){super(m,n,h,_),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const n of m.urls)this.urls.push(this.map._requestManager.transformRequest(n,a.ResourceType.Source).url);a.getVideo(this.urls,(n,h)=>{this._loaded=!0,n?this.fire(new a.ErrorEvent(n)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const n=this.video.seekable;m<n.start(0)||m>n.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,n=m.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(m,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,a.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2));for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:cs,canvas:class extends cs{constructor(m,n,h,_){super(m,n,h,_),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(b=>typeof b!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,h=n.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,a.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(n,this.canvas,h.RGBA,{premultiply:!0});for(const _ in this.tiles){const x=this.tiles[_];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}}},fn=function(m,n,h,_){const x=new ra[n.type](m,n,h,_);if(x.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${x.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],x),x};function te(m,n){const h=a.identity([]);return a.scale(h,h,[.5*m.width,.5*-m.height,1]),a.translate(h,h,[1,-1,0]),a.multiply$1(h,h,m.calculateProjMatrix(n.toUnwrapped()))}function B(m,n,h,_,x,b,E,I=!1){const z=m.tilesIn(_,E,I);z.sort(ee);const L=[];for(const N of z)L.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(n,h,m._state,N,x,b,te(m.transform,N.tile.tileID),I)});const O=function(N){const $={},Q={};for(const H of N){const J=H.queryResults,he=H.wrappedTileID,Y=Q[he]=Q[he]||{};for(const oe in J){const ae=J[oe],ne=Y[oe]=Y[oe]||{},se=$[oe]=$[oe]||[];for(const de of ae)ne[de.featureIndex]||(ne[de.featureIndex]=!0,se.push(de))}}return $}(L);for(const N in O)O[N].forEach($=>{const Q=$.feature,H=m.getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=H});return O}function V(m,n){const h=m.getRenderableIds().map(b=>m.getTileByID(b)),_=[],x={};for(let b=0;b<h.length;b++){const E=h[b],I=E.tileID.canonical.key;x[I]||(x[I]=!0,E.querySourceFeatures(_,n))}return _}function ee(m,n){const h=m.tileID,_=n.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function re(){return co.workerClass!=null?new co.workerClass:new a.window.Worker(co.workerUrl)}const _e="mapboxgl_preloaded_worker_pool";class Ae{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Ae.workerCount;)this.workers.push(new re);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_e]}numActive(){return Object.keys(this.active).length}}let Ce;function ye(){return Ce||(Ce=new Ae),Ce}function ke(m,n){const h={};for(const _ in m)_!=="ref"&&(h[_]=m[_]);return a.refProperties.forEach(_=>{_ in n&&(h[_]=n[_])}),h}function $e(m){m=m.slice();const n=Object.create(null);for(let h=0;h<m.length;h++)n[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=ke(m[h],n[m[h].ref]));return m}Ae.workerCount=2;const We={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Je(m,n,h){h.push({command:We.addSource,args:[m,n[m]]})}function Mt(m,n,h){n.push({command:We.removeSource,args:[m]}),h[m]=!0}function Ft(m,n,h,_){Mt(m,h,_),Je(m,n,h)}function Lt(m,n,h){let _;for(_ in m[h])if(m[h].hasOwnProperty(_)&&_!=="data"&&!F(m[h][_],n[h][_]))return!1;for(_ in n[h])if(n[h].hasOwnProperty(_)&&_!=="data"&&!F(m[h][_],n[h][_]))return!1;return!0}function Bt(m,n,h,_,x,b){let E;for(E in n=n||{},m=m||{})m.hasOwnProperty(E)&&(F(m[E],n[E])||h.push({command:b,args:[_,E,n[E],x]}));for(E in n)n.hasOwnProperty(E)&&!m.hasOwnProperty(E)&&(F(m[E],n[E])||h.push({command:b,args:[_,E,n[E],x]}))}function Qt(m){return m.id}function Li(m,n){return m[n.id]=n,m}class Ui{constructor(n,h){this.reset(n,h)}reset(n,h){this.points=n||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=a.clamp(n,0,1);let h=1,_=this._distances[h];const x=n*this.paddedLength+this.padding;for(;_<x&&h<this._distances.length;)_=this._distances[++h];const b=h-1,E=this._distances[b],I=_-E,z=I>0?(x-E)/I:0;return this.points[b].mult(1-z).add(this.points[h].mult(z))}}class ki{constructor(n,h,_){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/_),this.yCellCount=Math.ceil(h/_);for(let E=0;E<this.xCellCount*this.yCellCount;E++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=h,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,h,_,x,b){this._forEachCell(h,_,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(n,h,_,x){this._forEachCell(h-x,_-x,h+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(h),this.circles.push(_),this.circles.push(x)}_insertBoxCell(n,h,_,x,b,E){this.boxCells[b].push(E)}_insertCircleCell(n,h,_,x,b,E){this.circleCells[b].push(E)}_query(n,h,_,x,b,E){if(_<0||n>this.width||x<0||h>this.height)return!b&&[];const I=[];if(n<=0&&h<=0&&this.width<=_&&this.height<=x){if(b)return!0;for(let z=0;z<this.boxKeys.length;z++)I.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const L=this.circles[3*z],O=this.circles[3*z+1],N=this.circles[3*z+2];I.push({key:this.circleKeys[z],x1:L-N,y1:O-N,x2:L+N,y2:O+N})}return E?I.filter(E):I}return this._forEachCell(n,h,_,x,this._queryCell,I,{hitTest:b,seenUids:{box:{},circle:{}}},E),b?I.length>0:I}_queryCircle(n,h,_,x,b){const E=n-_,I=n+_,z=h-_,L=h+_;if(I<0||E>this.width||L<0||z>this.height)return!x&&[];const O=[];return this._forEachCell(E,z,I,L,this._queryCellCircle,O,{hitTest:x,circle:{x:n,y:h,radius:_},seenUids:{box:{},circle:{}}},b),x?O.length>0:O}query(n,h,_,x,b){return this._query(n,h,_,x,!1,b)}hitTest(n,h,_,x,b){return this._query(n,h,_,x,!0,b)}hitTestCircle(n,h,_,x){return this._queryCircle(n,h,_,!0,x)}_queryCell(n,h,_,x,b,E,I,z){const L=I.seenUids,O=this.boxCells[b];if(O!==null){const $=this.bboxes;for(const Q of O)if(!L.box[Q]){L.box[Q]=!0;const H=4*Q;if(n<=$[H+2]&&h<=$[H+3]&&_>=$[H+0]&&x>=$[H+1]&&(!z||z(this.boxKeys[Q]))){if(I.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[Q],x1:$[H],y1:$[H+1],x2:$[H+2],y2:$[H+3]})}}}const N=this.circleCells[b];if(N!==null){const $=this.circles;for(const Q of N)if(!L.circle[Q]){L.circle[Q]=!0;const H=3*Q;if(this._circleAndRectCollide($[H],$[H+1],$[H+2],n,h,_,x)&&(!z||z(this.circleKeys[Q]))){if(I.hitTest)return E.push(!0),!0;{const J=$[H],he=$[H+1],Y=$[H+2];E.push({key:this.circleKeys[Q],x1:J-Y,y1:he-Y,x2:J+Y,y2:he+Y})}}}}}_queryCellCircle(n,h,_,x,b,E,I,z){const L=I.circle,O=I.seenUids,N=this.boxCells[b];if(N!==null){const Q=this.bboxes;for(const H of N)if(!O.box[H]){O.box[H]=!0;const J=4*H;if(this._circleAndRectCollide(L.x,L.y,L.radius,Q[J+0],Q[J+1],Q[J+2],Q[J+3])&&(!z||z(this.boxKeys[H])))return E.push(!0),!0}}const $=this.circleCells[b];if($!==null){const Q=this.circles;for(const H of $)if(!O.circle[H]){O.circle[H]=!0;const J=3*H;if(this._circlesCollide(Q[J],Q[J+1],Q[J+2],L.x,L.y,L.radius)&&(!z||z(this.circleKeys[H])))return E.push(!0),!0}}}_forEachCell(n,h,_,x,b,E,I,z){const L=this._convertToXCellCoord(n),O=this._convertToYCellCoord(h),N=this._convertToXCellCoord(_),$=this._convertToYCellCoord(x);for(let Q=L;Q<=N;Q++)for(let H=O;H<=$;H++)if(b.call(this,n,h,_,x,this.xCellCount*H+Q,E,I,z))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,h,_,x,b,E){const I=x-n,z=b-h,L=_+E;return L*L>I*I+z*z}_circleAndRectCollide(n,h,_,x,b,E,I){const z=(E-x)/2,L=Math.abs(n-(x+z));if(L>z+_)return!1;const O=(I-b)/2,N=Math.abs(h-(b+O));if(N>O+_)return!1;if(L<=z||N<=O)return!0;const $=L-z,Q=N-O;return $*$+Q*Q<=_*_}}const Ni=Math.tan(85*Math.PI/180);function Qs(m,n,h,_,x,b){let E=a.create();if(h){if(x.projection.name==="globe")E=a.calculateGlobeMatrix(x,x.worldSize/x._projectionScaler,[0,0]),a.multiply$1(E,E,a.globeDenormalizeECEF(a.globeTileBounds(n)));else{const I=k([],b);E[0]=I[0],E[1]=I[1],E[4]=I[2],E[5]=I[3]}_||a.rotateZ(E,E,x.angle)}else a.multiply$1(E,x.labelPlaneMatrix,m);return E}function zs(m,n,h,_,x,b){if(h){if(x.projection.name==="globe"){const E=Qs(m,n,h,_,x,b);return a.invert(E,E),a.multiply$1(E,m,E),E}{const E=a.clone(m),I=a.identity([]);return I[0]=b[0],I[1]=b[1],I[4]=b[2],I[5]=b[3],a.multiply$1(E,E,I),_||a.rotateZ(E,E,-x.angle),E}}return x.glCoordMatrix}function Cr(m,n,h=0){const _=[m.x,m.y,h,1];h?a.transformMat4$1(_,_,n):ll(_,_,n);const x=_[3];return{point:new a.pointGeometry(_[0]/x,_[1]/x),signedDistanceFromCamera:x}}function us(m,n){return Math.min(.5+m/n*.5,1.5)}function pc(m,n){const h=m[0]/m[3],_=m[1]/m[3];return h>=-n[0]&&h<=n[0]&&_>=-n[1]&&_<=n[1]}function dd(m,n,h,_,x,b,E,I,z,L){const O=h.transform,N=_?m.textSizeData:m.iconSizeData,$=a.evaluateSizeForZoom(N,h.transform.zoom),Q=[256/h.width*2+1,256/h.height*2+1],H=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;H.clear();const J=m.lineVertexArray,he=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,Y=h.transform.width/h.transform.height;let oe=!1;for(let ae=0;ae<he.length;ae++){const ne=he.get(ae);if(ne.writingMode!==a.WritingMode.vertical||oe||ae!==0&&he.get(ae-1).writingMode===a.WritingMode.horizontal||(oe=!0),ne.hidden||ne.writingMode===a.WritingMode.vertical&&!oe){Gn(ne.numGlyphs,H);continue}oe=!1;const se=new a.pointGeometry(ne.tileAnchorX,ne.tileAnchorY),de=z?z(se):[0,0,0],Me=O.projection.projectTilePoint(se.x,se.y,L.canonical),Fe=[Me.x+de[0],Me.y+de[1],Me.z+de[2]],ht=[...Fe,1];if(a.transformMat4$1(ht,ht,n),!pc(ht,Q)){Gn(ne.numGlyphs,H);continue}const et=us(h.transform.cameraToCenterDistance,ht[3]),Ye=a.evaluateSizeForFeature(N,$,ne),Ue=E?Ye/et:Ye*et,De=Cr(new a.pointGeometry(Fe[0],Fe[1]),x,Fe[2]);if(De.signedDistanceFromCamera<=0){Gn(ne.numGlyphs,H);continue}let Ke={};const Ge=E?null:z,kt=lh(ne,Ue,!1,I,n,x,b,m.glyphOffsetArray,J,H,De.point,se,Ke,Y,Ge,O.projection,L);oe=kt.useVertical,Ge&&kt.needsFlipping&&(Ke={}),(kt.notEnoughRoom||oe||kt.needsFlipping&&lh(ne,Ue,!0,I,n,x,b,m.glyphOffsetArray,J,H,De.point,se,Ke,Y,Ge,O.projection,L).notEnoughRoom)&&Gn(ne.numGlyphs,H)}_?m.text.dynamicLayoutVertexBuffer.updateData(H):m.icon.dynamicLayoutVertexBuffer.updateData(H)}function ah(m,n,h,_,x,b,E,I,z,L,O,N,$,Q,H){const J=I.glyphStartIndex+I.numGlyphs,he=I.lineStartIndex,Y=I.lineStartIndex+I.lineLength,oe=n.getoffsetX(I.glyphStartIndex),ae=n.getoffsetX(J-1),ne=al(m*oe,h,_,x,b,E,I.segment,he,Y,z,L,O,N,$,!0,Q,H);if(!ne)return null;const se=al(m*ae,h,_,x,b,E,I.segment,he,Y,z,L,O,N,$,!0,Q,H);return se?{first:ne,last:se}:null}function ol(m,n,h,_){return m.writingMode===a.WritingMode.horizontal&&Math.abs(h.y-n.y)>Math.abs(h.x-n.x)*_?{useVertical:!0}:m.writingMode===a.WritingMode.vertical?n.y<h.y?{needsFlipping:!0}:null:m.flipState!==0&&function(x,b,E){const I=(b.x-x.x)*E;return I===0||Math.abs((b.y-x.y)/I)>Ni}(n,h,_)?m.flipState===1?{needsFlipping:!0}:null:n.x>h.x?{needsFlipping:!0}:null}function lh(m,n,h,_,x,b,E,I,z,L,O,N,$,Q,H,J,he){const Y=n/24,oe=m.lineOffsetX*Y,ae=m.lineOffsetY*Y;let ne;if(m.numGlyphs>1){const se=m.glyphStartIndex+m.numGlyphs,de=m.lineStartIndex,Me=m.lineStartIndex+m.lineLength,Fe=ah(Y,I,oe,ae,h,O,N,m,z,b,$,H,!1,J,he);if(!Fe)return{notEnoughRoom:!0};const ht=Cr(Fe.first.point,E).point,et=Cr(Fe.last.point,E).point;if(_&&!h){const Ye=ol(m,ht,et,Q);if(m.flipState=Ye&&Ye.needsFlipping?1:2,Ye)return Ye}ne=[Fe.first];for(let Ye=m.glyphStartIndex+1;Ye<se-1;Ye++)ne.push(al(Y*I.getoffsetX(Ye),oe,ae,h,O,N,m.segment,de,Me,z,b,$,H,!1,!1,J,he));ne.push(Fe.last)}else{if(_&&!h){const de=Cr(N,x).point,Me=m.lineStartIndex+m.segment+1,Fe=new a.pointGeometry(z.getx(Me),z.gety(Me)),ht=Cr(Fe,x),et=ol(m,de,ht.signedDistanceFromCamera>0?ht.point:_c(N,Fe,de,1,x,void 0,J,he.canonical),Q);if(m.flipState=et&&et.needsFlipping?1:2,et)return et}const se=al(Y*I.getoffsetX(m.glyphStartIndex),oe,ae,h,O,N,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,z,b,$,H,!1,!1,J,he);if(!se)return{notEnoughRoom:!0};ne=[se]}for(const se of ne)a.addDynamicAttributes(L,se.point,se.angle);return{}}function mc(m,n,h,_,x){const b=_.projectTilePoint(m.x,m.y,n);if(!x)return Cr(b,h,b.z);const E=x(m);return Cr(new a.pointGeometry(b.x+E[0],b.y+E[1]),h,b.z+E[2])}function _c(m,n,h,_,x,b,E,I){const z=mc(m.add(m.sub(n)._unit()),I,x,E,b).point,L=h.sub(z);return h.add(L._mult(_/L.mag()))}function al(m,n,h,_,x,b,E,I,z,L,O,N,$,Q,H,J,he){const Y=_?m-n:m+n;let oe=Y>0?1:-1,ae=0;_&&(oe*=-1,ae=Math.PI),oe<0&&(ae+=Math.PI);let ne=oe>0?I+E:I+E+1,se=x,de=x,Me=0,Fe=0;const ht=Math.abs(Y),et=[],Ye=[];let Ue=b;const De=()=>{const ut=ne-oe;return Me===0?b:new a.pointGeometry(L.getx(ut),L.gety(ut))},Ke=()=>_c(De(),Ue,de,ht-Me+1,O,$,J,he.canonical);for(;Me+Fe<=ht;){if(ne+=oe,ne<I||ne>=z)return null;if(de=se,et.push(se),Q&&Ye.push(Ue||De()),se=N[ne],se===void 0){Ue=new a.pointGeometry(L.getx(ne),L.gety(ne));const ut=mc(Ue,he.canonical,O,J,$);se=ut.signedDistanceFromCamera>0?N[ne]=ut.point:Ke()}else Ue=null;Me+=Fe,Fe=de.dist(se)}H&&$&&(Ue=Ue||new a.pointGeometry(L.getx(ne),L.gety(ne)),N[ne]=se=N[ne]===void 0?se:Ke(),Fe=de.dist(se));const Ge=(ht-Me)/Fe,kt=se.sub(de),Ot=kt.mult(Ge)._add(de);h&&Ot._add(kt._unit()._perp()._mult(h*oe));const Ht=ae+Math.atan2(se.y-de.y,se.x-de.x);return et.push(Ot),Q&&(Ue=Ue||new a.pointGeometry(L.getx(ne),L.gety(ne)),Ye.push(function(ut,zt,Vt){const wi=1-Vt;return new a.pointGeometry(ut.x*wi+zt.x*Vt,ut.y*wi+zt.y*Vt)}(Ye.length>0?Ye[Ye.length-1]:Ue,Ue,Ge))),{point:Ot,angle:Ht,path:et,tilePath:Ye}}const ch=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Gn(m,n){for(let h=0;h<m;h++){const _=n.length;n.resize(_+4),n.float32.set(ch,3*_)}}function ll(m,n,h){const _=n[0],x=n[1];return m[0]=h[0]*_+h[4]*x+h[12],m[1]=h[1]*_+h[5]*x+h[13],m[3]=h[3]*_+h[7]*x+h[15],m}const hs=100;class g_{constructor(n,h,_=new ki(n.width+200,n.height+200,25),x=new ki(n.width+200,n.height+200,25)){this.transform=n,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+hs,this.screenBottomBoundary=n.height+hs,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=h}placeCollisionBox(n,h,_,x,b,E,I){let z=h.projectedAnchorX,L=h.projectedAnchorY,O=h.projectedAnchorZ;const N=h.elevation,$=h.tileID;if(N&&$){const ne=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),se=ne.upVector($.canonical,h.tileAnchorX,h.tileAnchorY),de=ne.upVectorScale($.canonical);z+=se[0]*N*de,L+=se[1]*N*de,O+=se[2]*N*de}const Q=this.projectAndGetPerspectiveRatio(E,z,L,O,h.tileID),H=b*Q.perspectiveRatio,J=(h.x1*n+_.x-h.padding)*H+Q.point.x,he=(h.y1*n+_.y-h.padding)*H+Q.point.y,Y=(h.x2*n+_.x+h.padding)*H+Q.point.x,oe=(h.y2*n+_.y+h.padding)*H+Q.point.y,ae=Q.perspectiveRatio<=.55||Q.aboveHorizon;return!this.isInsideGrid(J,he,Y,oe)||!x&&this.grid.hitTest(J,he,Y,oe,I)||ae?{box:[],offscreen:!1}:{box:[J,he,Y,oe],offscreen:this.isOffscreen(J,he,Y,oe)}}placeCollisionCircles(n,h,_,x,b,E,I,z,L,O,N,$,Q,H){const J=[],he=this.transform.elevation,Y=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),oe=he?he.getAtTileOffsetFunc(H,Y):Ge=>[0,0,0],ae=new a.pointGeometry(h.tileAnchorX,h.tileAnchorY),ne=this.transform.projection.projectTilePoint(h.tileAnchorX,h.tileAnchorY,H.canonical),se=oe(ae),de=[ne.x+se[0],ne.y+se[1],ne.z+se[2]],Me=this.projectAndGetPerspectiveRatio(E,de[0],de[1],de[2],H),{perspectiveRatio:Fe}=Me,ht=(O?b/Fe:b*Fe)/a.ONE_EM,et=Cr(new a.pointGeometry(de[0],de[1]),I,de[2]).point,Ye=Me.signedDistanceFromCamera>0?ah(ht,x,h.lineOffsetX*ht,h.lineOffsetY*ht,!1,et,ae,h,_,I,{},he&&!O?oe:null,O&&!!he,this.transform.projection,H):null;let Ue=!1,De=!1,Ke=!0;if(Ye&&!Me.aboveHorizon){const Ge=.5*$*Fe+Q,kt=new a.pointGeometry(-100,-100),Ot=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ht=new Ui,ut=Ye.first,zt=Ye.last;let Vt=[];for(let jt=ut.path.length-1;jt>=1;jt--)Vt.push(ut.path[jt]);for(let jt=1;jt<zt.path.length;jt++)Vt.push(zt.path[jt]);const wi=2.5*Ge;if(z){const jt=Vt.map(he?(Jt,ji)=>{const hr=oe(ji<ut.path.length-1?ut.tilePath[ut.path.length-1-ji]:zt.tilePath[ji-ut.path.length+2]);return Cr(Jt,z,hr[2])}:Jt=>Cr(Jt,z));Vt=jt.some(Jt=>Jt.signedDistanceFromCamera<=0)?[]:jt.map(Jt=>Jt.point)}let Pi=[];if(Vt.length>0){const jt=Vt[0].clone(),Jt=Vt[0].clone();for(let ji=1;ji<Vt.length;ji++)jt.x=Math.min(jt.x,Vt[ji].x),jt.y=Math.min(jt.y,Vt[ji].y),Jt.x=Math.max(Jt.x,Vt[ji].x),Jt.y=Math.max(Jt.y,Vt[ji].y);Pi=jt.x>=kt.x&&Jt.x<=Ot.x&&jt.y>=kt.y&&Jt.y<=Ot.y?[Vt]:Jt.x<kt.x||jt.x>Ot.x||Jt.y<kt.y||jt.y>Ot.y?[]:a.clipLine([Vt],kt.x,kt.y,Ot.x,Ot.y)}for(const jt of Pi){Ht.reset(jt,.25*Ge);let Jt=0;Jt=Ht.length<=.5*Ge?1:Math.ceil(Ht.paddedLength/wi)+1;for(let ji=0;ji<Jt;ji++){const hr=ji/Math.max(Jt-1,1),rn=Ht.lerp(hr),In=rn.x+hs,Hn=rn.y+hs;J.push(In,Hn,Ge,0);const ci=In-Ge,$t=Hn-Ge,ni=In+Ge,Ji=Hn+Ge;if(Ke=Ke&&this.isOffscreen(ci,$t,ni,Ji),De=De||this.isInsideGrid(ci,$t,ni,Ji),!n&&this.grid.hitTestCircle(In,Hn,Ge,N)&&(Ue=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Ue}}}}return{circles:!L&&Ue||!De?[]:J,offscreen:Ke,collisionDetected:Ue}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let _=1/0,x=1/0,b=-1/0,E=-1/0;for(const O of n){const N=new a.pointGeometry(O.x+hs,O.y+hs);_=Math.min(_,N.x),x=Math.min(x,N.y),b=Math.max(b,N.x),E=Math.max(E,N.y),h.push(N)}const I=this.grid.query(_,x,b,E).concat(this.ignoredGrid.query(_,x,b,E)),z={},L={};for(const O of I){const N=O.key;if(z[N.bucketInstanceId]===void 0&&(z[N.bucketInstanceId]={}),z[N.bucketInstanceId][N.featureIndex])continue;const $=[new a.pointGeometry(O.x1,O.y1),new a.pointGeometry(O.x2,O.y1),new a.pointGeometry(O.x2,O.y2),new a.pointGeometry(O.x1,O.y2)];a.polygonIntersectsPolygon(h,$)&&(z[N.bucketInstanceId][N.featureIndex]=!0,L[N.bucketInstanceId]===void 0&&(L[N.bucketInstanceId]=[]),L[N.bucketInstanceId].push(N.featureIndex))}return L}insertCollisionBox(n,h,_,x,b){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,h,_,x,b){const E=h?this.ignoredGrid:this.grid,I={bucketInstanceId:_,featureIndex:x,collisionGroupID:b};for(let z=0;z<n.length;z+=4)E.insertCircle(I,n[z],n[z+1],n[z+2])}projectAndGetPerspectiveRatio(n,h,_,x,b){const E=[h,_,x||0,1];let I=!1;if(x||this.transform.pitch>0){a.transformMat4$1(E,E,n);let z=!1;this.fogState&&b&&(z=function(L,O,N,$,Q,H){const J=H.calculateFogTileMatrix(Q),he=[O,N,$];return a.transformMat4(he,he,J),ze(L,he,H.pitch,H._fov)}(this.fogState,h,_,x||0,b.toUnwrapped(),this.transform)>.9),I=E[2]>E[3]||z}else ll(E,E,n);return{point:new a.pointGeometry((E[0]/E[3]+1)/2*this.transform.width+hs,(-E[1]/E[3]+1)/2*this.transform.height+hs),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/E[3]*.5,1.5),signedDistanceFromCamera:E[3],aboveHorizon:I}}isOffscreen(n,h,_,x){return _<hs||n>=this.screenRightBoundary||x<hs||h>this.screenBottomBoundary}isInsideGrid(n,h,_,x){return _>=0&&n<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const n=a.identity([]);return a.translate(n,n,[-100,-100,0]),n}}class pd{constructor(n,h,_,x){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?h:-h))):x&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class na{constructor(n,h,_,x,b,E=!1){this.text=new pd(n?n.text:null,h,_,b),this.icon=new pd(n?n.icon:null,h,x,b),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class sa{constructor(n,h,_,x=!1){this.text=n,this.icon=h,this.skipFade=_,this.clipped=x}}class cl{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class md{constructor(n,h,_,x,b){this.bucketInstanceId=n,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=b}}class _d{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const h=++this.maxGroupID;this.collisionGroups[n]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[n]}}function gc(m,n,h,_,x){const{horizontalAlign:b,verticalAlign:E}=a.getAnchorAlignment(m),I=-(b-.5)*n,z=-(E-.5)*h,L=a.evaluateVariableOffset(m,_);return new a.pointGeometry(I+L[0]*x,z+L[1]*x)}function Js(m,n,h,_,x){const b=new a.pointGeometry(m,n);return h&&b._rotate(_?x:-x),b}class yc{constructor(n,h,_,x,b){this.transform=n.clone(),this.collisionIndex=new g_(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new _d(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,h,_,x){const b=_.getBucket(h),E=_.latestFeatureIndex;if(!b||!E||h.id!==b.layerIds[0])return;const I=b.layers[0].layout,z=_.collisionBoxArray,L=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),O=_.tileSize/a.EXTENT,N=_.tileID.toUnwrapped(),$=this.transform.calculateProjMatrix(N),Q=I.get("text-pitch-alignment")==="map",H=I.get("text-rotation-alignment")==="map";h.compileFilter();const J=h.dynamicFilter(),he=h.dynamicFilterNeedsFeature(),Y=this.transform.calculatePixelsToTileUnitsMatrix(_),oe=Qs($,_.tileID.canonical,Q,H,this.transform,Y);let ae=null;if(Q){const de=zs($,_.tileID.canonical,Q,H,this.transform,Y);ae=a.multiply$1([],this.transform.labelPlaneMatrix,de)}let ne=null;J&&_.latestFeatureIndex&&(ne={unwrappedTileID:N,dynamicFilter:J,dynamicFilterNeedsFeature:he,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new md(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,_.tileID);const se={bucket:b,layout:I,posMatrix:$,textLabelPlaneMatrix:oe,labelToScreenMatrix:ae,clippingData:ne,scale:L,textPixelRatio:O,holdingForFade:_.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(x)for(const de of b.sortKeyRanges){const{sortKey:Me,symbolInstanceStart:Fe,symbolInstanceEnd:ht}=de;n.push({sortKey:Me,symbolInstanceStart:Fe,symbolInstanceEnd:ht,parameters:se})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:se})}attemptAnchorPlacement(n,h,_,x,b,E,I,z,L,O,N,$,Q,H,J,he,Y,oe){const ae=[$.textOffset0,$.textOffset1],ne=gc(n,_,x,ae,b),se=this.collisionIndex.placeCollisionBox(b,h,Js(ne.x,ne.y,E,I,this.transform.angle),N,z,L,O.predicate);if((!he||this.collisionIndex.placeCollisionBox(H.getSymbolInstanceIconSize(oe,this.transform.zoom,Q),he,Js(ne.x,ne.y,E,I,this.transform.angle),N,z,L,O.predicate).box.length!==0)&&se.box.length>0){let de;return this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(de=this.prevPlacement.variableOffsets[$.crossTileID].anchor),this.variableOffsets[$.crossTileID]={textOffset:ae,width:_,height:x,anchor:n,textScale:b,prevAnchor:de},this.markUsedJustification(H,n,$,J),H.allowVerticalPlacement&&(this.markUsedOrientation(H,J,$),this.placedOrientations[$.crossTileID]=J),{shift:ne,placedGlyphBoxes:se}}}placeLayerBucketPart(n,h,_,x){const{bucket:b,layout:E,posMatrix:I,textLabelPlaneMatrix:z,labelToScreenMatrix:L,clippingData:O,textPixelRatio:N,holdingForFade:$,collisionBoxArray:Q,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:J,collisionGroup:he}=n.parameters,Y=E.get("text-optional"),oe=E.get("icon-optional"),ae=E.get("text-allow-overlap"),ne=E.get("icon-allow-overlap"),se=E.get("text-rotation-alignment")==="map",de=E.get("text-pitch-alignment")==="map",Me=E.get("icon-text-fit")!=="none",Fe=E.get("symbol-z-order")==="viewport-y",ht=ae&&(ne||!b.hasIconData()||oe),et=ne&&(ae||!b.hasTextData()||Y);!b.collisionArrays&&Q&&b.deserializeCollisionBoxes(Q),_&&x&&b.updateCollisionDebugBuffers(this.transform.zoom,Q);const Ye=(Ue,De,Ke)=>{if(O){const ci={zoom:this.transform.zoom,pitch:this.transform.pitch};let $t=null;if(O.dynamicFilterNeedsFeature){const ni=this.retainedQueryData[b.bucketInstanceId];$t=O.featureIndex.loadFeature({featureIndex:Ue.featureIndex,bucketIndex:ni.bucketIndex,sourceLayerIndex:ni.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(ci,$t,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new a.pointGeometry(Ue.tileAnchorX,Ue.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[Ue.crossTileID]=new sa(!1,!1,!1,!0),void(h[Ue.crossTileID]=!0)}if(h[Ue.crossTileID])return;if($)return void(this.placements[Ue.crossTileID]=new sa(!1,!1,!1));let Ge=!1,kt=!1,Ot=!0,Ht=null,ut={box:null,offscreen:null},zt={box:null,offscreen:null},Vt=null,wi=null,Pi=null,jt=0,Jt=0,ji=0;Ke.textFeatureIndex?jt=Ke.textFeatureIndex:Ue.useRuntimeCollisionCircles&&(jt=Ue.featureIndex),Ke.verticalTextFeatureIndex&&(Jt=Ke.verticalTextFeatureIndex);const hr=ci=>{ci.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||ci.elevation)&&(ci.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,ci.tileAnchorX,ci.tileAnchorY):0)},rn=Ke.textBox;if(rn){hr(rn);const ci=ni=>{let Ji=a.WritingMode.horizontal;if(b.allowVerticalPlacement&&!ni&&this.prevPlacement){const pn=this.prevPlacement.placedOrientations[Ue.crossTileID];pn&&(this.placedOrientations[Ue.crossTileID]=pn,Ji=pn,this.markUsedOrientation(b,Ji,Ue))}return Ji},$t=(ni,Ji)=>{if(b.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&Ke.verticalTextBox){for(const pn of b.writingModes)if(pn===a.WritingMode.vertical?(ut=Ji(),zt=ut):ut=ni(),ut&&ut.box&&ut.box.length)break}else ut=ni()};if(E.get("text-variable-anchor")){let ni=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ue.crossTileID]){const Oi=this.prevPlacement.variableOffsets[Ue.crossTileID];ni.indexOf(Oi.anchor)>0&&(ni=ni.filter(mn=>mn!==Oi.anchor),ni.unshift(Oi.anchor))}const Ji=(Oi,mn,Rl)=>{const nn=b.getSymbolInstanceTextSize(H,Ue,this.transform.zoom,De),Fo=(Oi.x2-Oi.x1)*nn+2*Oi.padding,At=(Oi.y2-Oi.y1)*nn+2*Oi.padding,Rt=Me&&!ne?mn:null;Rt&&hr(Rt);let vr={box:[],offscreen:!1};const Lo=ae?2*ni.length:ni.length;for(let uo=0;uo<Lo;++uo){const Mr=this.attemptAnchorPlacement(ni[uo%ni.length],Oi,Fo,At,nn,se,de,N,I,he,uo>=ni.length,Ue,De,b,Rl,Rt,H,J);if(Mr&&(vr=Mr.placedGlyphBoxes,vr&&vr.box&&vr.box.length)){Ge=!0,Ht=Mr.shift;break}}return vr};$t(()=>Ji(rn,Ke.iconBox,a.WritingMode.horizontal),()=>{const Oi=Ke.verticalTextBox;return Oi&&hr(Oi),b.allowVerticalPlacement&&!(ut&&ut.box&&ut.box.length)&&Ue.numVerticalGlyphVertices>0&&Oi?Ji(Oi,Ke.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),ut&&(Ge=ut.box,Ot=ut.offscreen);const pn=ci(ut&&ut.box);if(!Ge&&this.prevPlacement){const Oi=this.prevPlacement.variableOffsets[Ue.crossTileID];Oi&&(this.variableOffsets[Ue.crossTileID]=Oi,this.markUsedJustification(b,Oi.anchor,Ue,pn))}}else{const ni=(Ji,pn)=>{const Oi=b.getSymbolInstanceTextSize(H,Ue,this.transform.zoom,De),mn=this.collisionIndex.placeCollisionBox(Oi,Ji,new a.pointGeometry(0,0),ae,N,I,he.predicate);return mn&&mn.box&&mn.box.length&&(this.markUsedOrientation(b,pn,Ue),this.placedOrientations[Ue.crossTileID]=pn),mn};$t(()=>ni(rn,a.WritingMode.horizontal),()=>{const Ji=Ke.verticalTextBox;return b.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&Ji?(hr(Ji),ni(Ji,a.WritingMode.vertical)):{box:null,offscreen:null}}),ci(ut&&ut.box&&ut.box.length)}}if(Vt=ut,Ge=Vt&&Vt.box&&Vt.box.length>0,Ot=Vt&&Vt.offscreen,Ue.useRuntimeCollisionCircles){const ci=b.text.placedSymbolArray.get(Ue.centerJustifiedTextSymbolIndex>=0?Ue.centerJustifiedTextSymbolIndex:Ue.verticalPlacedTextSymbolIndex),$t=a.evaluateSizeForFeature(b.textSizeData,H,ci),ni=E.get("text-padding");wi=this.collisionIndex.placeCollisionCircles(ae,ci,b.lineVertexArray,b.glyphOffsetArray,$t,I,z,L,_,de,he.predicate,Ue.collisionCircleDiameter*$t/a.ONE_EM,ni,this.retainedQueryData[b.bucketInstanceId].tileID),Ge=ae||wi.circles.length>0&&!wi.collisionDetected,Ot=Ot&&wi.offscreen}if(Ke.iconFeatureIndex&&(ji=Ke.iconFeatureIndex),Ke.iconBox){const ci=$t=>{hr($t);const ni=Me&&Ht?Js(Ht.x,Ht.y,se,de,this.transform.angle):new a.pointGeometry(0,0),Ji=b.getSymbolInstanceIconSize(J,this.transform.zoom,De);return this.collisionIndex.placeCollisionBox(Ji,$t,ni,ne,N,I,he.predicate)};zt&&zt.box&&zt.box.length&&Ke.verticalIconBox?(Pi=ci(Ke.verticalIconBox),kt=Pi.box.length>0):(Pi=ci(Ke.iconBox),kt=Pi.box.length>0),Ot=Ot&&Pi.offscreen}const In=Y||Ue.numHorizontalGlyphVertices===0&&Ue.numVerticalGlyphVertices===0,Hn=oe||Ue.numIconVertices===0;if(In||Hn?Hn?In||(kt=kt&&Ge):Ge=kt&&Ge:kt=Ge=kt&&Ge,Ge&&Vt&&Vt.box&&this.collisionIndex.insertCollisionBox(Vt.box,E.get("text-ignore-placement"),b.bucketInstanceId,zt&&zt.box&&Jt?Jt:jt,he.ID),kt&&Pi&&this.collisionIndex.insertCollisionBox(Pi.box,E.get("icon-ignore-placement"),b.bucketInstanceId,ji,he.ID),wi&&(Ge&&this.collisionIndex.insertCollisionCircles(wi.circles,E.get("text-ignore-placement"),b.bucketInstanceId,jt,he.ID),_)){const ci=b.bucketInstanceId;let $t=this.collisionCircleArrays[ci];$t===void 0&&($t=this.collisionCircleArrays[ci]=new cl);for(let ni=0;ni<wi.circles.length;ni+=4)$t.circles.push(wi.circles[ni+0]),$t.circles.push(wi.circles[ni+1]),$t.circles.push(wi.circles[ni+2]),$t.circles.push(wi.collisionDetected?1:0)}this.placements[Ue.crossTileID]=new sa(Ge||ht,kt||et,Ot||b.justReloaded),h[Ue.crossTileID]=!0};if(Fe){const Ue=b.getSortedSymbolIndexes(this.transform.angle);for(let De=Ue.length-1;De>=0;--De){const Ke=Ue[De];Ye(b.symbolInstances.get(Ke),Ke,b.collisionArrays[Ke])}}else for(let Ue=n.symbolInstanceStart;Ue<n.symbolInstanceEnd;Ue++)Ye(b.symbolInstances.get(Ue),Ue,b.collisionArrays[Ue]);if(_&&b.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[b.bucketInstanceId];a.invert(Ue.invProjMatrix,I),Ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(n,h,_,x){let b;b=x===a.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(h)];const E=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const I of E)I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=b>=0&&I!==b?0:_.crossTileID)}markUsedOrientation(n,h,_){const x=h===a.WritingMode.horizontal||h===a.WritingMode.horizontalOnly?h:0,b=h===a.WritingMode.vertical?h:0,E=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const I of E)n.text.placedSymbolArray.get(I).placedOrientation=x;_.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const x=h?h.symbolFadeChange(n):1,b=h?h.opacities:{},E=h?h.variableOffsets:{},I=h?h.placedOrientations:{};for(const z in this.placements){const L=this.placements[z],O=b[z];O?(this.opacities[z]=new na(O,x,L.text,L.icon,null,L.clipped),_=_||L.text!==O.text.placed||L.icon!==O.icon.placed):(this.opacities[z]=new na(null,x,L.text,L.icon,L.skipFade,L.clipped),_=_||L.text||L.icon)}for(const z in b){const L=b[z];if(!this.opacities[z]){const O=new na(L,x,!1,!1);O.isHidden()||(this.opacities[z]=O,_=_||L.text.placed||L.icon.placed)}}for(const z in E)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=E[z]);for(const z in I)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=I[z]);_?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:n)}updateLayerOpacities(n,h){const _={};for(const x of h){const b=x.getBucket(n);b&&x.latestFeatureIndex&&n.id===b.layerIds[0]&&this.updateBucketOpacities(b,_,x.collisionBoxArray)}}updateBucketOpacities(n,h,_){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const x=n.layers[0].layout,b=!!n.layers[0].dynamicFilter(),E=new na(null,0,!1,!1,!0),I=x.get("text-allow-overlap"),z=x.get("icon-allow-overlap"),L=x.get("text-variable-anchor"),O=x.get("text-rotation-alignment")==="map",N=x.get("text-pitch-alignment")==="map",$=x.get("icon-text-fit")!=="none",Q=new na(null,0,I&&(z||!n.hasIconData()||x.get("icon-optional")),z&&(I||!n.hasTextData()||x.get("text-optional")),!0);!n.collisionArrays&&_&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(_);const H=(he,Y,oe)=>{for(let ae=0;ae<Y/4;ae++)he.opacityVertexArray.emplaceBack(oe)};let J=0;for(let he=0;he<n.symbolInstances.length;he++){const Y=n.symbolInstances.get(he),{numHorizontalGlyphVertices:oe,numVerticalGlyphVertices:ae,crossTileID:ne}=Y;let se=this.opacities[ne];h[ne]?se=E:se||(se=Q,this.opacities[ne]=se),h[ne]=!0;const de=oe>0||ae>0,Me=Y.numIconVertices>0,Fe=this.placedOrientations[Y.crossTileID],ht=Fe===a.WritingMode.vertical,et=Fe===a.WritingMode.horizontal||Fe===a.WritingMode.horizontalOnly;if(!de&&!Me||se.isHidden()||J++,de){const Ye=xc(se.text);H(n.text,oe,ht?io:Ye),H(n.text,ae,et?io:Ye);const Ue=se.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(Ge=>{Ge>=0&&(n.text.placedSymbolArray.get(Ge).hidden=Ue||ht?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=Ue||et?1:0);const De=this.variableOffsets[Y.crossTileID];De&&this.markUsedJustification(n,De.anchor,Y,Fe);const Ke=this.placedOrientations[Y.crossTileID];Ke&&(this.markUsedJustification(n,"left",Y,Ke),this.markUsedOrientation(n,Ke,Y))}if(Me){const Ye=xc(se.icon);Y.placedIconSymbolIndex>=0&&(H(n.icon,Y.numIconVertices,ht?io:Ye),n.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=se.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&(H(n.icon,Y.numVerticalIconVertices,et?io:Ye),n.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=se.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Ye=n.collisionArrays[he];if(Ye){let Ue=new a.pointGeometry(0,0),De=!0;if(Ye.textBox||Ye.verticalTextBox){if(L){const Ge=this.variableOffsets[ne];Ge?(Ue=gc(Ge.anchor,Ge.width,Ge.height,Ge.textOffset,Ge.textScale),O&&Ue._rotate(N?this.transform.angle:-this.transform.angle)):De=!1}b&&(De=!se.clipped),Ye.textBox&&eo(n.textCollisionBox.collisionVertexArray,se.text.placed,!De||ht,Ue.x,Ue.y),Ye.verticalTextBox&&eo(n.textCollisionBox.collisionVertexArray,se.text.placed,!De||et,Ue.x,Ue.y)}const Ke=De&&Boolean(!et&&Ye.verticalIconBox);Ye.iconBox&&eo(n.iconCollisionBox.collisionVertexArray,se.icon.placed,Ke,$?Ue.x:0,$?Ue.y:0),Ye.verticalIconBox&&eo(n.iconCollisionBox.collisionVertexArray,se.icon.placed,!Ke,$?Ue.x:0,$?Ue.y:0)}}}if(n.fullyClipped=J===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const he=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=he.invProjMatrix,n.placementViewportMatrix=he.viewportMatrix,n.collisionCircleArray=he.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>n}setStale(){this.stale=!0}}function eo(m,n,h,_,x){m.emplaceBack(n?1:0,h?1:0,_||0,x||0),m.emplaceBack(n?1:0,h?1:0,_||0,x||0),m.emplaceBack(n?1:0,h?1:0,_||0,x||0),m.emplaceBack(n?1:0,h?1:0,_||0,x||0)}const Be=Math.pow(2,25),xt=Math.pow(2,24),gd=Math.pow(2,17),to=Math.pow(2,16),tr=Math.pow(2,9),Rs=Math.pow(2,8),fs=Math.pow(2,1);function xc(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const n=m.placed?1:0,h=Math.floor(127*m.opacity);return h*Be+n*xt+h*gd+n*to+h*tr+n*Rs+h*fs+n}const io=0;class yt{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,h,_,x,b){const E=this._bucketParts;for(;this._currentTileIndex<n.length;)if(h.getBucketParts(E,x,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((I,z)=>I.sortKey-z.sortKey));this._currentPartIndex<E.length;){const I=E[this._currentPartIndex];if(h.placeLayerBucketPart(I,this._seenCrossTileIDs,_,I.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class ri{constructor(n,h,_,x,b,E,I,z){this.placement=new yc(n,b,E,I,z),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(n,h,_){const x=a.exported.now(),b=()=>{const E=a.exported.now()-x;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=h[n[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=I)&&(!E.maxzoom||E.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new yt(E)),this._inProgressLayer.continuePlacement(_[E.source],this.placement,this._showCollisionBoxes,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Kt=512/a.EXTENT/2;class ds{constructor(n,h,_){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let x=0;x<h.length;x++){const b=h.get(x),E=b.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,n)})}}getScaledCoordinates(n,h){const _=Kt/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*a.EXTENT+n.tileAnchorX)*_),y:Math.floor((h.canonical.y*a.EXTENT+n.tileAnchorY)*_)}}findMatches(n,h,_){const x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let b=0;b<n.length;b++){const E=n.get(b);if(E.crossTileID)continue;const I=this.indexedSymbolInstances[E.key];if(!I)continue;const z=this.getScaledCoordinates(E,h);for(const L of I)if(Math.abs(L.coord.x-z.x)<=x&&Math.abs(L.coord.y-z.y)<=x&&!_[L.crossTileID]){_[L.crossTileID]=!0,E.crossTileID=L.crossTileID;break}}}}class oa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const h=Math.round((n-this.lng)/360);if(h!==0)for(const _ in this.indexes){const x=this.indexes[_],b={};for(const E in x){const I=x[E];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+h),b[I.tileID.key]=I}this.indexes[_]=b}this.lng=n}addBucket(n,h,_){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const x=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>n.overscaledZ)for(const I in E){const z=E[I];z.tileID.isChildOf(n)&&z.findMatches(h.symbolInstances,n,x)}else{const I=E[n.scaledTo(Number(b)).key];I&&I.findMatches(h.symbolInstances,n,x)}}for(let b=0;b<h.symbolInstances.length;b++){const E=h.symbolInstances.get(b);E.crossTileID||(E.crossTileID=_.generate(),x[E.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new ds(n,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(n,h){for(const _ in h.indexedSymbolInstances)for(const x of h.indexedSymbolInstances[_])delete this.usedCrossTileIDs[n][x.crossTileID]}removeStaleBuckets(n){let h=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const b in x)n[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[b]),delete x[b],h=!0)}return h}}class ul{constructor(){this.layerIndexes={},this.crossTileIDs=new oa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,h,_,x){let b=this.layerIndexes[n.id];b===void 0&&(b=this.layerIndexes[n.id]=new Yt);let E=!1;const I={};x.name!=="globe"&&b.handleWrapJump(_);for(const z of h){const L=z.getBucket(n);L&&n.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(z.tileID,L,this.crossTileIDs)&&(E=!0),I[L.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(E=!0),E}pruneUnusedLayers(n){const h={};n.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const ro=(m,n)=>a.emitValidationErrors(m,n&&n.filter(h=>h.identifier!=="source.canvas")),hl=a.pick(We,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),En=a.pick(We,["setCenter","setZoom","setBearing","setPitch"]),Ki=function(){const m={},n=a.spec.$version;for(const h in a.spec.$root){const _=a.spec.$root[h];if(_.required){let x=null;x=h==="version"?n:_.type==="array"?[]:{},x!=null&&(m[h]=x)}}return m}(),y_={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class en extends a.Evented{constructor(n,h={}){super(),this.map=n,this.dispatcher=new Qe(ye(),this),this.imageManager=new xe,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(n._requestManager,h.localFontFamily?a.LocalGlyphMode.all:h.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.lineAtlas=new a.LineAtlas(256,512),this.crossTileSymbolIndex=new ul,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const _=this;this._rtlTextPluginCallback=en.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(b,E)=>{if(a.triggerPluginCompletionEvent(b),E&&E.every(I=>I))for(const I in _._sourceCaches){const z=_._sourceCaches[I],L=z.getSource().type;L!=="vector"&&L!=="geojson"||z.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const b=this.getSource(x.sourceId);if(b&&b.vectorLayerIds)for(const E in this._layers){const I=this._layers[E];I.source===b.id&&this._validateLayer(I)}})}loadURL(n,h={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const _=typeof h.validate=="boolean"?h.validate:!a.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,h.accessToken);const x=this.map._requestManager.transformRequest(n,a.ResourceType.Style);this._request=a.getJSON(x,(b,E)=>{this._request=null,b?this.fire(new a.ErrorEvent(b)):E&&this._load(E,_)})}loadJSON(n,h={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(n,h.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Ki,!1)}_updateLayerCount(n,h){const _=h?1:-1;n.is3D()&&(this._num3DLayers+=_),n.type==="circle"&&(this._numCircleLayers+=_),n.type==="symbol"&&(this._numSymbolLayers+=_)}_load(n,h){if(h&&ro(this,a.validateStyle(n)))return;this._loaded=!0,this.stylesheet=n,this.updateProjection();for(const x in n.sources)this.addSource(x,n.sources[x],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const _=$e(this.stylesheet.layers);this._order=_.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of _)x=a.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ie(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const n=this.map.transform.projection,h=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),_=this.map.transform.projection;if(this._loaded&&(_.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),h){if(_.isReprojectedInTileSpace||n.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(n){this._spriteRequest=function(h,_,x){let b,E,I;const z=a.exported.devicePixelRatio>1?"@2x":"";let L=a.getJSON(_.transformRequest(_.normalizeSpriteURL(h,z,".json"),a.ResourceType.SpriteJSON),($,Q)=>{L=null,I||(I=$,b=Q,N())}),O=a.getImage(_.transformRequest(_.normalizeSpriteURL(h,z,".png"),a.ResourceType.SpriteImage),($,Q)=>{O=null,I||(I=$,E=Q,N())});function N(){if(I)x(I);else if(b&&E){const $=a.exported.getImageData(E),Q={};for(const H in b){const{width:J,height:he,x:Y,y:oe,sdf:ae,pixelRatio:ne,stretchX:se,stretchY:de,content:Me}=b[H],Fe=new a.RGBAImage({width:J,height:he});a.RGBAImage.copy($,Fe,{x:Y,y:oe},{x:0,y:0},{width:J,height:he}),Q[H]={data:Fe,pixelRatio:ne,sdf:ae,stretchX:se,stretchY:de,content:Me}}x(null,Q)}}return{cancel(){L&&(L.cancel(),L=null),O&&(O.cancel(),O=null)}}}(n,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new a.ErrorEvent(h));else if(_)for(const x in _)this.imageManager.addImage(x,_[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(n){const h=this.getSource(n.source);if(!h)return;const _=n.sourceLayer;_&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(_)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const h=[];for(const _ of n){const x=this._layers[_];x.type!=="custom"&&h.push(x.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&y_[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const h=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(x.length||b.length)&&this._updateWorkerLayers(x,b);for(const E in this._updatedSources){const I=this._updatedSources[E];I==="reload"?this._reloadSource(E):I==="clear"&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const _={};for(const x in this._sourceCaches){const b=this._sourceCaches[x];_[x]=b.used,b.used=!1}for(const x of this._order){const b=this._layers[x];if(b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)){const I=this._getLayerSourceCache(b);I&&(I.used=!0)}const E=this.map.painter;if(E){const I=b.getProgramIds();if(!I)continue;const z=b.getProgramConfiguration(n.zoom);for(const L of I)E.useProgram(L,z)}}for(const x in _){const b=this._sourceCaches[x];_[x]!==b.used&&b.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),ro(this,a.validateStyle(n)))return!1;(n=a.clone$1(n)).layers=$e(n.layers);const h=function(x,b){if(!x)return[{command:We.setStyle,args:[b]}];let E=[];try{if(!F(x.version,b.version))return[{command:We.setStyle,args:[b]}];F(x.center,b.center)||E.push({command:We.setCenter,args:[b.center]}),F(x.zoom,b.zoom)||E.push({command:We.setZoom,args:[b.zoom]}),F(x.bearing,b.bearing)||E.push({command:We.setBearing,args:[b.bearing]}),F(x.pitch,b.pitch)||E.push({command:We.setPitch,args:[b.pitch]}),F(x.sprite,b.sprite)||E.push({command:We.setSprite,args:[b.sprite]}),F(x.glyphs,b.glyphs)||E.push({command:We.setGlyphs,args:[b.glyphs]}),F(x.transition,b.transition)||E.push({command:We.setTransition,args:[b.transition]}),F(x.light,b.light)||E.push({command:We.setLight,args:[b.light]}),F(x.fog,b.fog)||E.push({command:We.setFog,args:[b.fog]}),F(x.projection,b.projection)||E.push({command:We.setProjection,args:[b.projection]});const I={},z=[];(function(N,$,Q,H){let J;for(J in $=$||{},N=N||{})N.hasOwnProperty(J)&&($.hasOwnProperty(J)||Mt(J,Q,H));for(J in $)$.hasOwnProperty(J)&&(N.hasOwnProperty(J)?F(N[J],$[J])||(N[J].type==="geojson"&&$[J].type==="geojson"&&Lt(N,$,J)?Q.push({command:We.setGeoJSONSourceData,args:[J,$[J].data]}):Ft(J,$,Q,H)):Je(J,$,Q))})(x.sources,b.sources,z,I);const L=[];x.layers&&x.layers.forEach(N=>{I[N.source]?E.push({command:We.removeLayer,args:[N.id]}):L.push(N)});let O=x.terrain;O&&I[O.source]&&(E.push({command:We.setTerrain,args:[void 0]}),O=void 0),E=E.concat(z),F(O,b.terrain)||E.push({command:We.setTerrain,args:[b.terrain]}),function(N,$,Q){$=$||[];const H=(N=N||[]).map(Qt),J=$.map(Qt),he=N.reduce(Li,{}),Y=$.reduce(Li,{}),oe=H.slice(),ae=Object.create(null);let ne,se,de,Me,Fe,ht,et;for(ne=0,se=0;ne<H.length;ne++)de=H[ne],Y.hasOwnProperty(de)?se++:(Q.push({command:We.removeLayer,args:[de]}),oe.splice(oe.indexOf(de,se),1));for(ne=0,se=0;ne<J.length;ne++)de=J[J.length-1-ne],oe[oe.length-1-ne]!==de&&(he.hasOwnProperty(de)?(Q.push({command:We.removeLayer,args:[de]}),oe.splice(oe.lastIndexOf(de,oe.length-se),1)):se++,ht=oe[oe.length-ne],Q.push({command:We.addLayer,args:[Y[de],ht]}),oe.splice(oe.length-ne,0,de),ae[de]=!0);for(ne=0;ne<J.length;ne++)if(de=J[ne],Me=he[de],Fe=Y[de],!ae[de]&&!F(Me,Fe))if(F(Me.source,Fe.source)&&F(Me["source-layer"],Fe["source-layer"])&&F(Me.type,Fe.type)){for(et in Bt(Me.layout,Fe.layout,Q,de,null,We.setLayoutProperty),Bt(Me.paint,Fe.paint,Q,de,null,We.setPaintProperty),F(Me.filter,Fe.filter)||Q.push({command:We.setFilter,args:[de,Fe.filter]}),F(Me.minzoom,Fe.minzoom)&&F(Me.maxzoom,Fe.maxzoom)||Q.push({command:We.setLayerZoomRange,args:[de,Fe.minzoom,Fe.maxzoom]}),Me)Me.hasOwnProperty(et)&&et!=="layout"&&et!=="paint"&&et!=="filter"&&et!=="metadata"&&et!=="minzoom"&&et!=="maxzoom"&&(et.indexOf("paint.")===0?Bt(Me[et],Fe[et],Q,de,et.slice(6),We.setPaintProperty):F(Me[et],Fe[et])||Q.push({command:We.setLayerProperty,args:[de,et,Fe[et]]}));for(et in Fe)Fe.hasOwnProperty(et)&&!Me.hasOwnProperty(et)&&et!=="layout"&&et!=="paint"&&et!=="filter"&&et!=="metadata"&&et!=="minzoom"&&et!=="maxzoom"&&(et.indexOf("paint.")===0?Bt(Me[et],Fe[et],Q,de,et.slice(6),We.setPaintProperty):F(Me[et],Fe[et])||Q.push({command:We.setLayerProperty,args:[de,et,Fe[et]]}))}else Q.push({command:We.removeLayer,args:[de]}),ht=oe[oe.lastIndexOf(de)+1],Q.push({command:We.addLayer,args:[Fe,ht]})}(L,b.layers,E)}catch(I){console.warn("Unable to compute style diff:",I),E=[{command:We.setStyle,args:[b]}]}return E}(this.serialize(),n).filter(x=>!(x.command in En));if(h.length===0)return!1;const _=h.filter(x=>!(x.command in hl));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);return h.forEach(x=>{x.command!=="setTransition"&&this[x.command].apply(this,x.args)}),this.stylesheet=n,this.updateProjection(),!0}addImage(n,h){if(this.getImage(n))return this.fire(new a.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(n,h),this._afterImageUpdated(n)}updateImage(n,h){this.imageManager.updateImage(n,h)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new a.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,h,_={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.validateStyle.source,`sources.${n}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const x=fn(n,h,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:x.serialize(),sourceId:n}));const b=E=>{const I=(E?"symbol:":"other:")+n,z=this._sourceCaches[I]=new a.SourceCache(I,x,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[n]=z,z.style=this,z.onAdd(this.map)};b(!1),h.type!=="vector"&&h.type!=="geojson"||b(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const h=this.getSource(n);if(h===void 0)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===n)return this.fire(new a.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new a.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(n);for(const x of _)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,h){this._checkLoaded(),this.getSource(n).setData(h),this._changed=!0}getSource(n){const h=this._getSourceCache(n);return h&&h.getSource()}addLayer(n,h,_={}){this._checkLoaded();const x=n.id;if(this.getLayer(x))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let b;if(n.type==="custom"){if(ro(this,a.validateCustomStyleLayer(n)))return;b=a.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(x,n.source),n=a.clone$1(n),n=a.extend(n,{source:x})),this._validate(a.validateStyle.layer,`layers.${x}`,n,{arrayIndex:-1},_))return;b=a.createStyleLayer(n),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(E,0,x),this._layerOrderChanged=!0,this._layers[x]=b;const I=this._getLayerSourceCache(b);if(this._removedLayers[x]&&b.source&&I&&b.type!=="custom"){const z=this._removedLayers[x];delete this._removedLayers[x],z.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",I.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,h){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===h)return;const _=this._order.indexOf(n);this._order.splice(_,1);const x=h?this._order.indexOf(h):this._order.length;h&&x===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(x,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const h=this._layers[n];if(!h)return void this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(n);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=h,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const h in this._layers)if(this._layers[h].type===n)return!0;return!1}setLayerZoomRange(n,h,_){this._checkLoaded();const x=this.getLayer(n);x?x.minzoom===h&&x.maxzoom===_||(h!=null&&(x.minzoom=h),_!=null&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,h,_={}){this._checkLoaded();const x=this.getLayer(n);if(x){if(!F(x.filter,h))return h==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(a.validateStyle.filter,`layers.${x.id}.filter`,h,{layerType:x.type},_)||(x.filter=a.clone$1(h),this._updateLayer(x)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){return a.clone$1(this.getLayer(n).filter)}setLayoutProperty(n,h,_,x={}){this._checkLoaded();const b=this.getLayer(n);b?F(b.getLayoutProperty(h),_)||(b.setLayoutProperty(h,_,x),this._updateLayer(b)):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,h){const _=this.getLayer(n);if(_)return _.getLayoutProperty(h);this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,h,_,x={}){this._checkLoaded();const b=this.getLayer(n);b?F(b.getPaintProperty(h),_)||(b.setPaintProperty(h,_,x)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,h){return this.getLayer(n).getPaintProperty(h)}setFeatureState(n,h){this._checkLoaded();const _=n.source,x=n.sourceLayer,b=this.getSource(_);if(b===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const E=b.type;if(E==="geojson"&&x)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!x)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const I=this._getSourceCaches(_);for(const z of I)z.setFeatureState(x,n.id,h)}removeFeatureState(n,h){this._checkLoaded();const _=n.source,x=this.getSource(_);if(x===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const b=x.type,E=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!E)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const I=this._getSourceCaches(_);for(const z of I)z.removeFeatureState(E,n.id,h)}getFeatureState(n){this._checkLoaded();const h=n.source,_=n.sourceLayer,x=this.getSource(h);if(x!==void 0){if(x.type!=="vector"||_)return n.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,n.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();n[_.id]||(n[_.id]=_.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const h=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&h&&h.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",h.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const h=E=>this._layers[E].type==="fill-extrusion",_={},x=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(h(I)){_[I]=E;for(const z of n){const L=z[I];if(L)for(const O of L)x.push(O)}}}x.sort((E,I)=>I.intersectionZ-E.intersectionZ);const b=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(h(I))for(let z=x.length-1;z>=0;z--){const L=x[z].feature;if(_[L.layer.id]<E)break;b.push(L),x.pop()}else for(const z of n){const L=z[I];if(L)for(const O of L)b.push(O.feature)}}return b}queryRenderedFeatures(n,h,_){h&&h.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const z of h.layers){const L=this._layers[z];if(!L)return this.fire(new a.ErrorEvent(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];x[L.source]=!0}}const b=[];h.availableImages=this._availableImages;const E=h&&h.layers?h.layers.some(z=>{const L=this.getLayer(z);return L&&L.is3D()}):this.has3DLayers(),I=ta.createFromScreenPoints(n,_);for(const z in this._sourceCaches){const L=this._sourceCaches[z].getSource().id;h.layers&&!x[L]||b.push(B(this._sourceCaches[z],this._layers,this._serializedLayers,I,h,_,E,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(z,L,O,N,$,Q,H){const J={},he=Q.queryRenderedSymbols(N),Y=[];for(const oe of Object.keys(he).map(Number))Y.push(H[oe]);Y.sort(ee);for(const oe of Y){const ae=oe.featureIndex.lookupSymbolFeatures(he[oe.bucketInstanceId],L,oe.bucketIndex,oe.sourceLayerIndex,$.filter,$.layers,$.availableImages,z);for(const ne in ae){const se=J[ne]=J[ne]||[],de=ae[ne];de.sort((Me,Fe)=>{const ht=oe.featureSortOrder;if(ht){const et=ht.indexOf(Me.featureIndex);return ht.indexOf(Fe.featureIndex)-et}return Fe.featureIndex-Me.featureIndex});for(const Me of de)se.push(Me)}}for(const oe in J)J[oe].forEach(ae=>{const ne=ae.feature,se=O(z[oe]).getFeatureState(ne.layer["source-layer"],ne.id);ne.source=ne.layer.source,ne.layer["source-layer"]&&(ne.sourceLayer=ne.layer["source-layer"]),ne.state=se});return J}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),I.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(n,h){h&&h.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(n);let x=[];for(const b of _)x=x.concat(V(b,h));return x}addSourceType(n,h,_){return en.getSourceType(n)?_(new Error(`A source type called "${n}" already exists.`)):(en.setSourceType(n,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(n,h={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const E in n)if(!F(n[E],_[E])){x=!0;break}if(!x)return;const b={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,h),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,h=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(h===1){if(typeof n.source=="object"){const _="terrain-dem-src";this.addSource(_,n.source),n=a.clone$1(n),n=a.extend(n,{source:_})}if(this._validate(a.validateStyle.terrain,"terrain",n))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode)this._createTerrain(n,h);else{const _=this.terrain,x=_.get();for(const b in n)if(!F(n[b],x[b])){_.set(n),this.stylesheet.terrain=n;const E={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const h=this.fog=new Ze(n,this.map.transform);this.stylesheet.fog=n;const _={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();for(const x in n)if(!F(n[x],_[x])){h.set(n),this.stylesheet.fog=n;const b={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(b);break}}else this._createFog(n);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...h)}_createTerrain(n,h){const _=this.terrain=new qe(n,h);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const x={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(x)}_force3DLayerUpdate(){for(const n in this._layers){const h=this._layers[n];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const h=this._layers[n];h.type==="symbol"&&this._updateLayer(h)}}_validate(n,h,_,x,b={}){return(!b||b.validate!==!1)&&ro(this,n.call(a.validateStyle,a.extend({key:h,style:this.serialize(),value:_,styleSpec:a.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const h=this._getSourceCaches(n);for(const _ of h)_.clearTiles()}_reloadSource(n){const h=this._getSourceCaches(n);for(const _ of h)_.resume(),_.reload()}_updateSources(n){for(const h in this._sourceCaches)this._sourceCaches[h].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const h=this._sourceCaches[n];h.resume(),h.reload()}}_updatePlacement(n,h,_,x,b=!1){let E=!1,I=!1;const z={};for(const L of this._order){const O=this._layers[L];if(O.type!=="symbol")continue;if(!z[O.source]){const $=this._getLayerSourceCache(O);if(!$)continue;z[O.source]=$.getRenderableIds(!0).map(Q=>$.getTileByID(Q)).sort((Q,H)=>H.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(H.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(O,z[O.source],n.center.lng,n.projection);E=E||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),n.zoom))&&(this.pauseablePlacement=new ri(n,this._order,b,h,_,x,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),I=!0),E&&this.pauseablePlacement.placement.setStale()),I||E)for(const L of this._order){const O=this._layers[L];O.type==="symbol"&&this.placement.updateLayerOpacities(O,z[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const x=b=>{b&&b.setDependencies(h.tileID.key,h.type,h.icons)};x(this._otherSourceCaches[h.source]),x(this._symbolSourceCaches[h.source])}getGlyphs(n,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(n,h,_){return a.makeRequest(h,_)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const h=[];return this._otherSourceCaches[n]&&h.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&h.push(this._symbolSourceCaches[n]),h}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}en.getSourceType=function(m){return ra[m]},en.setSourceType=function(m,n){ra[m]=n},en.registerForPluginStateChange=a.registerForPluginStateChange;var vc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,aa="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let la={},ca={};la=qt("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),ca=qt(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const fi=qt(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}
#ifdef PROJECTION_GLOBE_VIEW
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),bc=vc;var uh={background:qt(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:qt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:qt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:qt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:qt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:qt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:qt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:qt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:qt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:qt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:qt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:qt(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:qt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:qt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:qt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:qt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:qt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:qt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:qt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:qt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:qt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:qt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,aa),skyboxGradient:qt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,aa),skyboxCapture:qt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:qt(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:qt(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function qt(m,n,h){const _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E=m.match(x),I=n.match(x),z=vc.match(x);let L=I?I.concat(E):E;h||(la.staticUniforms&&(L=la.staticUniforms.concat(L)),ca.staticUniforms&&(L=ca.staticUniforms.concat(L))),L&&(L=L.concat(z));const O={};return{fragmentSource:m=m.replace(_,(N,$,Q,H,J)=>(O[J]=!0,$==="define"?`
#ifndef HAS_UNIFORM_u_${J}
varying ${Q} ${H} ${J};
#else
uniform ${Q} ${H} u_${J};
#endif
`:`
#ifdef HAS_UNIFORM_u_${J}
    ${Q} ${H} ${J} = u_${J};
#endif
`)),vertexSource:n=n.replace(_,(N,$,Q,H,J)=>{const he=H==="float"?"vec2":"vec4",Y=J.match(/color/)?"color":he;return O[J]?$==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${Q} ${he} a_${J};
varying ${Q} ${H} ${J};
#else
uniform ${Q} ${H} u_${J};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${Q} ${H} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = unpack_mix_${Y}(a_${J}, u_${J}_t);
#else
    ${Q} ${H} ${J} = u_${J};
#endif
`:$==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${Q} ${he} a_${J};
#else
uniform ${Q} ${H} u_${J};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${Q} ${H} ${J} = a_${J};
#else
    ${Q} ${H} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${Q} ${H} ${J} = unpack_mix_${Y}(a_${J}, u_${J}_t);
#else
    ${Q} ${H} ${J} = u_${J};
#endif
`}),staticAttributes:b,staticUniforms:L}}class Sn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,h,_,x,b,E,I,z){this.context=n;let L=this.boundPaintVertexBuffers.length!==x.length;for(let O=0;!L&&O<x.length;O++)this.boundPaintVertexBuffers[O]!==x[O]&&(L=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===_&&!L&&this.boundIndexBuffer===b&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===z?(n.bindVertexArrayOES.set(this.vao),I&&I.bind(),b&&b.dynamicDraw&&b.bind(),z&&z.bind()):this.freshBind(h,_,x,b,E,I,z)}freshBind(n,h,_,x,b,E,I){let z;const L=n.numAttributes,O=this.context,N=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=n,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=I;else{z=O.currentNumAttributes||0;for(let $=L;$<z;$++)N.disableVertexAttribArray($)}h.enableAttributes(N,n);for(const $ of _)$.enableAttributes(N,n);E&&E.enableAttributes(N,n),I&&I.enableAttributes(N,n),h.bind(),h.setVertexAttribPointers(N,n,b);for(const $ of _)$.bind(),$.setVertexAttribPointers(N,n,b);E&&(E.bind(),E.setVertexAttribPointers(N,n,b)),x&&x.bind(),I&&(I.bind(),I.setVertexAttribPointers(N,n,b)),O.currentNumAttributes=L}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function yd(m,n){const h=Math.pow(2,n.canonical.z),_=n.canonical.y;return[new a.MercatorCoordinate(0,_/h).toLngLat().lat,new a.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function wc(m,n,h,_,x,b,E){const I=m.context,z=I.gl,L=h.fbo;if(!L)return;m.prepareDrawTile(n);const O=m.useProgram("hillshade");I.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,L.colorAttachment.get());const N=((J,he,Y,oe)=>{const ae=Y.paint.get("hillshade-shadow-color"),ne=Y.paint.get("hillshade-highlight-color"),se=Y.paint.get("hillshade-accent-color");let de=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);Y.paint.get("hillshade-illumination-anchor")==="viewport"&&(de-=J.transform.angle);const Me=!J.options.moving;return{u_matrix:oe||J.transform.calculateProjMatrix(he.tileID.toUnwrapped(),Me),u_image:0,u_latrange:yd(0,he.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),de],u_shadow:ae,u_highlight:ne,u_accent:se}})(m,h,_,m.terrain?n.projMatrix:null);m.prepareDrawProgram(I,O,n.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:Q,tileBoundsSegments:H}=m.getTileBoundsBuffers(h);O.draw(I,z.TRIANGLES,x,b,E,a.CullFaceMode.disabled,N,_.id,$,Q,H)}function nr(m,n,h){if(!n.needsDEMTextureUpload)return;const _=m.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||m.getTileTexture(h.stride);const b=h.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new a.Texture(_,b,x.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function fl(m,n,h,_,x,b){const E=m.context,I=E.gl;if(!n.dem)return;const z=n.dem;if(E.activeTexture.set(I.TEXTURE1),nr(m,n,z),!n.demTexture)return;n.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);const L=z.dim;E.activeTexture.set(I.TEXTURE0);let O=n.fbo;if(!O){const H=new a.Texture(E,{width:L,height:L,data:null},I.RGBA);H.bind(I.LINEAR,I.CLAMP_TO_EDGE),O=n.fbo=E.createFramebuffer(L,L,!0),O.colorAttachment.set(H.texture)}E.bindFramebuffer.set(O.framebuffer),E.viewport.set([0,0,L,L]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:$,tileBoundsSegments:Q}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(E,I.TRIANGLES,_,x,b,a.CullFaceMode.disabled,((H,J)=>{const he=J.stride,Y=a.create();return a.ortho(Y,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(Y,Y,[0,-a.EXTENT,0]),{u_matrix:Y,u_image:1,u_dimension:[he,he],u_zoom:H.overscaledZ,u_unpack:J.unpackVector}})(n.tileID,z),h.id,N,$,Q),n.needsHillshadePrepare=!1}const no=(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_image0:new a.Uniform1i(m,n.u_image0),u_skirt_height:new a.Uniform1f(m,n.u_skirt_height)}),yr=(m,n)=>({u_matrix:m,u_image0:0,u_skirt_height:n}),Tc=(m,n,h,_,x)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:n,u_merc_matrix:h,u_zoom_transition:_,u_merc_center:x,u_image0:0});function An(m,n){return m!=null&&n!=null&&!(!m.hasData()||!n.hasData())&&m.demTexture!=null&&n.demTexture!=null&&m.tileID.key!==n.tileID.key}const ps=new class{constructor(){this.operations={}}newMorphing(m,n,h,_,x){if(m in this.operations){const b=this.operations[m];b.to.tileID.key!==h.tileID.key&&(b.queued=h)}else this.operations[m]={startTime:_,phase:0,duration:x,from:n,to:h,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const n=this.operations[m];return{from:n.from,to:n.to,phase:n.phase}}update(m){for(const n in this.operations){const h=this.operations[n];for(h.phase=(m-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,m)){delete this.operations[n];break}}}_nextOp(m,n){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=n,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Do={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function x_(m,n){const h=1<<m.z;return!n&&(m.x===0||m.x===h-1)||m.y===0||m.y===h-1}const ms=m=>({u_matrix:m});function xd(m,n,h,_,x){if(x>0){const b=a.exported.now(),E=(b-m.timeAdded)/x,I=n?(b-n.timeAdded)/x:-1,z=h.getSource(),L=_.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),O=!n||Math.abs(n.tileID.overscaledZ-L)>Math.abs(m.tileID.overscaledZ-L),N=O&&m.refreshedUponExpiration?1:a.clamp(O?E:1-I,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),n?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class vd extends a.SourceCache{constructor(n){const h={type:"raster-dem",maxzoom:n.transform.maxZoom},_=new Qe(ye(),null),x=fn("mock-dem",h,_,n.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,h){n.state="loaded",h(null)}}class dn extends a.SourceCache{constructor(n){const h=fn("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new Qe(ye(),null),n.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,h,_){if(n.freezeTileCoverage)return;this.transform=n;const x=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,E)=>{if(b[E.key]="",!this._tiles[E.key]){const I=new a.Tile(E,this._source.tileSize*E.overscaleFactor(),n.tileZoom);I.state="loaded",this._tiles[E.key]=I}return b},{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const h=this.proxyCachedFBO[n];if(h!==void 0){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class dl extends a.OverscaledTileID{constructor(n,h,_){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class so extends a.Elevation{constructor(n,h){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,x,b]=function(z){const L=new a.StructArrayLayout4i8,O=new a.StructArrayLayout3ui6,N=131;L.reserve(17161),O.reserve(33800);const $=a.EXTENT/128,Q=a.EXTENT+$/2,H=Q+$;for(let he=-$;he<H;he+=$)for(let Y=-$;Y<H;Y+=$){const oe=Y<0||Y>Q||he<0||he>Q?24575:0,ae=a.clamp(Math.round(Y),0,a.EXTENT),ne=a.clamp(Math.round(he),0,a.EXTENT);L.emplaceBack(ae+oe,ne,ae,ne)}const J=(he,Y)=>{const oe=Y*N+he;O.emplaceBack(oe+1,oe,oe+N),O.emplaceBack(oe+N,oe+N+1,oe+1)};for(let he=1;he<129;he++)for(let Y=1;Y<129;Y++)J(Y,he);return[0,129].forEach(he=>{for(let Y=0;Y<130;Y++)J(Y,he),J(he,Y)}),[L,O,32768]}(),E=n.context;this.gridBuffer=E.createVertexBuffer(_,a.boundsAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(x),this.gridSegments=a.SegmentVector.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,_.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new dn(h.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,0,a.EXTENT,0,a.EXTENT,0,1);const I=E.gl;this._overlapStencilMode=new a.StencilMode({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new vd(h.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,h,_){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const x=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const b=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(h,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),h.updateElevation(!_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=h.getIds().map(z=>{const L=h.getTileByID(z).tileID;return L.projMatrix=_.calculateProjMatrix(L.toUnwrapped()),L});(function(z,L){const O=L.transform.pointCoordinate(L.transform.getCameraPoint()),N=new a.pointGeometry(O.x,O.y);z.sort(($,Q)=>{if(Q.overscaledZ-$.overscaledZ)return Q.overscaledZ-$.overscaledZ;const H=new a.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),J=new a.pointGeometry(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),he=N.mult(1<<$.canonical.z);return he.x-=.5,he.y-=.5,he.distSqr(H)-he.distSqr(J)})})(x,this.painter),this._previousZoom=_.zoom;const b=this.proxyToSource||{};this.proxyToSource={},x.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const z in E){const L=E[z];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,n[z],b),L.usedForTerrain))continue;const O=n[z];L.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[h.id]=x.map(z=>new dl(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const I={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const L=this.terrainTileForTile[z.key];if(!L)continue;const O=L.tileID.key;O in I||(this._visibleDemTiles.push(L),I[O]=O)}}_assignTerrainTiles(n){this._initializing||n.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const n=this.painter.context,h=n.gl;for(const _ in this.terrainTileForTile){const x=this.terrainTileForTile[_],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(n.activeTexture.set(h.TEXTURE1),nr(this.painter,x,b))}}_prepareDemTileUniforms(n,h,_,x){if(!h||h.demTexture==null)return!1;const b=n.tileID.canonical,E=Math.pow(2,h.tileID.canonical.z-b.z),I=x||"";return _[`u_dem_tl${I}`]=[b.x*E%1,b.y*E%1],_[`u_dem_scale${I}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,h=n.gl;if(!this._emptyDepthBufferTexture){const _={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new a.Texture(n,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const h=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;const b=x.dem.tree.minimums[0];return b>0&&n++,_+b},0);return n?h/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,h=n.gl;n.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),x={width:1,height:1,data:new Uint8Array(a.DEMData.pack(_,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new a.Texture(n,x,h.RGBA,{premultiply:!1}),b}setupElevationDraw(n,h,_){const x=this.painter.context,b=x.gl,E=(I=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(I),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var I;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();const z=this.painter.transform,L=z.projection.createTileTransform(z,z.worldSize),O=n.tileID.canonical;E.u_tile_tl_up=L.upVector(O,0,0),E.u_tile_tr_up=L.upVector(O,a.EXTENT,0),E.u_tile_br_up=L.upVector(O,a.EXTENT,a.EXTENT),E.u_tile_bl_up=L.upVector(O,0,a.EXTENT),E.u_tile_up_scale=L.upVectorScale(O);let N=null,$=null,Q=1;if(_&&_.morphing&&this._useVertexMorphing){const H=_.morphing.srcDemTile,J=_.morphing.dstDemTile;Q=_.morphing.phase,H&&J&&(this._prepareDemTileUniforms(n,H,E,"_prev")&&($=H),this._prepareDemTileUniforms(n,J,E)&&(N=J))}if($&&N?(x.activeTexture.set(b.TEXTURE2),N.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),x.activeTexture.set(b.TEXTURE4),$.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),E.u_dem_lerp=Q):(N=this.terrainTileForTile[n.tileID.key],x.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(n,N,E)?N.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),x.activeTexture.set(b.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&N){const H=(1<<N.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=H}_&&_.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(x,E)}renderToBackBuffer(n){const h=this.painter,_=this.painter.context;n.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),this.renderingToTexture=!1,function(x,b,E,I,z){if(x.transform.projection.name==="globe")(function(L,O,N,$,Q){const H=L.context,J=H.gl;let he,Y;const oe=L.options.showTerrainWireframe?2:0,ae=(Ye,Ue)=>{if(Y===Ye)return;const De=[];Ue&&De.push(Do[oe]),De.push(Do[Ye]),De.push("PROJECTION_GLOBE_VIEW"),he=L.useProgram("globeRaster",null,De),Y=Ye},ne=L.colorModeForRenderPass(),se=new a.DepthMode(J.LEQUAL,a.DepthMode.ReadWrite,L.depthRangeFor3D);ps.update(Q);const de=L.transform,Me=a.calculateGlobeMatrix(de,de.worldSize),Fe=a.calculateGlobeMercatorMatrix(de),ht=[a.mercatorXfromLng(de.center.lng),a.mercatorYfromLat(de.center.lat)],et=L.globeSharedBuffers;(oe?[!1,!0]:[!1]).forEach(Ye=>{Y=-1;const Ue=Ye?J.LINES:J.TRIANGLES;for(const De of $){const Ke=N.getTile(De),Ge=Math.pow(2,De.canonical.z),[kt,Ot]=a.globeBuffersForTileMesh(L,Ke,De,Ge),Ht=a.StencilMode.disabled,ut=O.prevTerrainTileForTile[De.key],zt=O.terrainTileForTile[De.key];An(ut,zt)&&ps.newMorphing(De.key,ut,zt,Q,250),H.activeTexture.set(J.TEXTURE0),Ke.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Vt=ps.getMorphValuesForProxy(De.key),wi=Vt?1:0,Pi={};Vt&&a.extend$1(Pi,{morphing:{srcDemTile:Vt.from,dstDemTile:Vt.to,phase:a.easeCubicInOut(Vt.phase)}});const jt=a.globeMatrixForTile(De.canonical,Me),Jt=Tc(de.projMatrix,jt,Fe,a.globeToMercatorTransition(de.zoom),ht);if(ae(wi,Ye),O.setupElevationDraw(Ke,he,Pi),L.prepareDrawProgram(H,he,De.toUnwrapped()),et){const[ji,hr]=Ye?et.getWirefameBuffer(L.context):[et.gridIndexBuffer,et.gridSegments];he.draw(H,Ue,se,Ht,ne,a.CullFaceMode.backCCW,Jt,"globe_raster",kt,ji,hr)}if(!Ye){const ji=[De.canonical.y===0?a.globePoleMatrixForTile(De.canonical,!1,de):null,De.canonical.y===Ge-1?a.globePoleMatrixForTile(De.canonical,!0,de):null];for(const hr of ji){if(!hr)continue;const rn=Tc(de.projMatrix,hr,hr,0,ht);et&&he.draw(H,Ue,se,Ht,ne,a.CullFaceMode.disabled,rn,"globe_pole_raster",Ot,et.poleIndexBuffer,et.poleSegments)}}}})})(x,b,E,I,z);else{const L=x.context,O=L.gl;let N,$;const Q=x.options.showTerrainWireframe?2:0,H=(ae,ne)=>{if($===ae)return;const se=[Do[ae]];ne&&se.push(Do[Q]),N=x.useProgram("terrainRaster",null,se),$=ae},J=x.colorModeForRenderPass(),he=new a.DepthMode(O.LEQUAL,a.DepthMode.ReadWrite,x.depthRangeFor3D);ps.update(z);const Y=x.transform,oe=6*Math.pow(1.5,22-Y.zoom)*b.exaggeration();(Q?[!1,!0]:[!1]).forEach(ae=>{$=-1;const ne=ae?O.LINES:O.TRIANGLES,[se,de]=ae?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const Me of I){const Fe=E.getTile(Me),ht=a.StencilMode.disabled,et=b.prevTerrainTileForTile[Me.key],Ye=b.terrainTileForTile[Me.key];An(et,Ye)&&ps.newMorphing(Me.key,et,Ye,z,250),L.activeTexture.set(O.TEXTURE0),Fe.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST);const Ue=ps.getMorphValuesForProxy(Me.key),De=Ue?1:0;let Ke;Ue&&(Ke={morphing:{srcDemTile:Ue.from,dstDemTile:Ue.to,phase:a.easeCubicInOut(Ue.phase)}});const Ge=yr(Me.projMatrix,x_(Me.canonical,Y.renderWorldCopies)?oe/10:oe);H(De,ae),b.setupElevationDraw(Fe,N,Ke),x.prepareDrawProgram(L,N,Me.toUnwrapped()),N.draw(L,ne,he,ht,J,a.CullFaceMode.backCCW,Ge,"terrain_raster",b.gridBuffer,se,de)}})}}(h,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],E=this._drapedRenderBatches.shift(),I=[],z=h.style.order;let L=0;for(const O of b){const N=x.getTileByID(O.proxyTileKey),$=x.proxyCachedFBO[O.key]?x.proxyCachedFBO[O.key][n]:void 0,Q=$!==void 0?x.renderCache[$]:this.pool[L++],H=$!==void 0;if(N.texture=Q.tex,H&&!Q.dirty){I.push(N.tileID);continue}let J;_.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(_.clear({color:a.Color.transparent,stencil:0}),Q.dirty=!1);for(let he=E.start;he<=E.end;++he){const Y=h.style._layers[z[he]];if(Y.isHidden(h.transform.zoom))continue;const oe=h.style._getLayerSourceCache(Y),ae=oe?this.proxyToSource[O.key][oe.id]:[O];if(!ae)continue;const ne=ae;_.viewport.set([0,0,Q.fb.width,Q.fb.height]),J!==(oe?oe.id:null)&&(this._setupStencil(Q,ae,Y,oe),J=oe?oe.id:null),h.renderLayer(h,oe,Y,ne)}this.renderedToTile?(Q.dirty=!0,I.push(N.tileID)):H||--L,L===5&&(L=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),E.end+1}postRender(){}renderCacheEfficiency(n){const h=n.order.length;if(h===0)return{efficiency:100};let _,x=0,b=0,E=!1;for(let I=0;I<h;++I){const z=n._layers[n.order[I]];this._style.isLayerDraped(z)?(E&&++x,++b):E||(E=!0,_=z.id)}return b===0?{efficiency:100}:{efficiency:100*(1-x/b),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{n=Math.min(n,h.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,h,_){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const E=b.tileID,I=Math.pow(2,E.overscaledZ),{x:z,y:L}=E.canonical,O=z/I,N=(z+1)/I,$=L/I,Q=(L+1)/I;return{minx:O,miny:$,maxx:N,maxy:Q,t:b.dem.tree.raycastRoot(O,$,N,Q,n,h,_),tile:b}});x.sort((b,E)=>(b.t!==null?b.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const b of x){if(b.t==null)return null;const E=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,h,_);if(E!=null)return E}return null}_createFBO(){const n=this.painter.context,h=n.gl,_=this.drapeBufferSize;n.activeTexture.set(h.TEXTURE0);const x=new a.Texture(n,{width:_[0],height:_[1],data:null},h.RGBA);x.bind(h.LINEAR,h.CLAMP_TO_EDGE);const b=n.createFramebuffer(_[0],_[1],!1);return b.colorAttachment.set(x.texture),b.depthAttachment=new gr(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const h=this._style._layers[n],_=h.isHidden(this.painter.transform.zoom),x=h.getCrossfadeParameters(),b=!!x&&x.t!==1,E=h.hasTransition();return h.type!=="custom"&&!_&&(b||E)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof Ds){n=!0;break}if(n)for(let h=0;h<this._style.order.length;++h){const _=this._style._layers[this._style.order[h]],x=_.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(_);if(_.type!=="raster"||x||!b)continue;const E=_.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const z=this.proxyToSource[I.key][b.id];if(z)for(const L of z){const O=xd(b.getTile(L),b.findLoadedParent(L,0),b,this.painter.transform,E);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(b.id,L)}}}}_setupDrapedRenderBatches(){const n=this._style.order,h=n.length;if(h===0)return;const _=[];let x,b=0,E=this._style._layers[n[b]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++b<h;)E=this._style._layers[n[b]];for(;b<h;++b){const I=this._style._layers[n[b]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?x===void 0&&(x=b):x!==void 0&&(_.push({start:x,end:b-1}),x=void 0))}x!==void 0&&_.push({start:x,end:b-1}),this._drapedRenderBatches=_}_setupRenderCache(n){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const E=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let I=0;I<E.length;++I){const z=Object.values(E[I]);h.renderCachePool.push(...z)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,x=this._tilesDirty;for(let E=_.length-1;E>=0;E--){const I=_[E];if(h.getTileByID(I.key),h.proxyCachedFBO[I.key]!==void 0){const z=n[I.key],L=this.proxyToSource[I.key];let O=0;for(const N in L){const $=L[N],Q=z[N];if(!Q||Q.length!==$.length||$.some((H,J)=>H!==Q[J]||x[N]&&x[N].hasOwnProperty(H.key))){O=-1;break}++O}for(const N in h.proxyCachedFBO[I.key])h.renderCache[h.proxyCachedFBO[I.key][N]].dirty=O<0||O!==Object.values(z).length}}const b=[...this._drapedRenderBatches];b.sort((E,I)=>I.end-I.start-(E.end-E.start));for(const E of b)for(const I of _){if(h.proxyCachedFBO[I.key])continue;let z=h.renderCachePool.pop();z===void 0&&h.renderCache.length<50&&(z=h.renderCache.length,h.renderCache.push(this._createFBO())),z!==void 0&&(h.proxyCachedFBO[I.key]={},h.proxyCachedFBO[I.key][E.start]=z,h.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(n,h,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,E=b.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let I;if(_.isTileClipped())I=h.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(n,h){const _=this.painter,x=this.painter.context,b=x.gl;_._tileClippingMaskIDs={},x.setColorMode(a.ColorMode.disabled),x.setDepthMode(a.DepthMode.disabled);const E=_.useProgram("clippingMask");for(const I of n){const z=_._tileClippingMaskIDs[I.key]=--h;E.draw(x,b.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:b.ALWAYS,mask:0},z,255,b.KEEP,b.KEEP,b.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,ms(I.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(n){const h=this.painter.transform;if(n.x<0||n.x>h.width||n.y<0||n.y>h.height)return null;const _=[n.x,n.y,1,1];a.transformMat4$1(_,_,h.pixelMatrixInverse),a.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const x=h._camera.position,b=a.mercatorZfromAltitude(1,h.center.lat),E=[x[0],x[1],x[2]/b,0],I=a.subtract([],_.slice(0,3),E);a.normalize(I,I);const z=this.raycast(E,I,this._exaggeration);return z!==null&&z?(a.scaleAndAdd(E,E,I,z),E[3]=E[2],E[2]*=b,E):null}drawDepth(){const n=this.painter,h=n.context,_=this.proxySourceCache,x=Math.ceil(n.width),b=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===b||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const E=h.gl,I=h.createFramebuffer(x,b,!0);h.activeTexture.set(E.TEXTURE0);const z=new a.Texture(h,{width:x,height:b,data:null},E.RGBA);z.bind(E.NEAREST,E.CLAMP_TO_EDGE),I.colorAttachment.set(z.texture);const L=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,x,b);I.depthAttachment.set(L),this._depthFBO=I,this._depthTexture=z}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,x,b]),function(E,I,z,L){if(E.transform.projection.name==="globe")return;const O=E.context,N=O.gl;O.clear({depth:1});const $=E.useProgram("terrainDepth"),Q=new a.DepthMode(N.LESS,a.DepthMode.ReadWrite,E.depthRangeFor3D);for(const H of L){const J=z.getTile(H),he=yr(H.projMatrix,0);I.setupElevationDraw(J,$),$.draw(O,N.TRIANGLES,Q,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,he,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(n,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,h,_){if(n.getSource()instanceof cs)return this._setupProxiedCoordsForImageSource(n,h,_);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const x=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let I=0;I<b.length;I++){const z=b[I],L=this._findTileCoveringTileID(z,n);if(L){const O=this._createProxiedId(z,L,_[z.key]&&_[z.key][n.id]);x.push(O),this.proxyToSource[z.key][n.id]=[O]}}let E=!1;for(let I=0;I<h.length;I++){const z=n.getTile(h[I]);if(!z||!z.hasData())continue;const L=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==z.tileID.canonical.z){const O=this.proxyToSource[L.tileID.key][n.id],N=this._createProxiedId(L.tileID,z,_[L.tileID.key]&&_[L.tileID.key][n.id]);O?O.splice(O.length-1,0,N):this.proxyToSource[L.tileID.key][n.id]=[N],x.push(N),E=!0}}this._sourceTilesOverlap[n.id]=E}_setupProxiedCoordsForImageSource(n,h,_){if(!n.getSource().loaded())return;const x=this.proxiedCoords[n.id]=[],b=this.proxyCoords,E=n.getSource(),I=new a.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),z=E.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((O,N)=>(O.min.x=Math.min(O.min.x,N.x-I.x),O.min.y=Math.min(O.min.y,N.y-I.y),O.max.x=Math.max(O.max.x,N.x-I.x),O.max.y=Math.max(O.max.y,N.y-I.y),O),{min:new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(O,N)=>{const $=O.wrap+O.canonical.x/(1<<O.canonical.z),Q=O.canonical.y/(1<<O.canonical.z),H=a.EXTENT/(1<<O.canonical.z),J=N.wrap+N.canonical.x/(1<<N.canonical.z),he=N.canonical.y/(1<<N.canonical.z);return $+H<J+z.min.x||$>J+z.max.x||Q+H<he+z.min.y||Q>he+z.max.y};for(let O=0;O<b.length;O++){const N=b[O];for(let $=0;$<h.length;$++){const Q=n.getTile(h[$]);if(!Q||!Q.hasData()||L(N,Q.tileID))continue;const H=this._createProxiedId(N,Q,_[N.key]&&_[N.key][n.id]),J=this.proxyToSource[N.key][n.id];J?J.push(H):this.proxyToSource[N.key][n.id]=[H],x.push(H)}}}_createProxiedId(n,h,_){let x=this.orthoMatrix;if(_){const b=_.find(E=>E.key===h.tileID.key);if(b)return b}if(h.tileID.key!==n.key){const b=n.canonical.z-h.tileID.canonical.z;let E,I,z;x=a.create();const L=h.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(E=a.EXTENT>>b,I=E*((h.tileID.canonical.x<<b)-n.canonical.x+L),z=E*((h.tileID.canonical.y<<b)-n.canonical.y)):(E=a.EXTENT<<-b,I=a.EXTENT*(h.tileID.canonical.x-(n.canonical.x+L<<-b)),z=a.EXTENT*(h.tileID.canonical.y-(n.canonical.y<<-b))),a.ortho(x,0,E,0,E,0,1),a.translate(x,x,[I,z,0])}return new dl(h.tileID,n.key,x)}_findTileCoveringTileID(n,h){let _=h.getTile(n);if(_&&_.hasData())return _;const x=this._findCoveringTileCache[h.id],b=x[n.key];if(_=b?h.getTileByID(b):null,_&&_.hasData()||b===null)return _;let E=_?_.tileID:n,I=E.overscaledZ;const z=h.getSource().minzoom,L=[];if(!b){const N=h.getSource().maxzoom;if(n.canonical.z>=N){const $=n.canonical.z-N;h.getSource().reparseOverscaled?(I=Math.max(n.canonical.z+2,h.transform.tileZoom),E=new a.OverscaledTileID(I,n.wrap,N,n.canonical.x>>$,n.canonical.y>>$)):$!==0&&(I=N,E=new a.OverscaledTileID(I,n.wrap,N,n.canonical.x>>$,n.canonical.y>>$))}E.key!==n.key&&(L.push(E.key),_=h.getTile(E))}const O=N=>{L.forEach($=>{x[$]=N}),L.length=0};for(I-=1;I>=z&&(!_||!_.hasData());I--){_&&O(_.tileID.key);const N=E.calculateScaledKey(I);if(_=h.getTileByID(N),_&&_.hasData())break;const $=x[N];if($===null)break;$===void 0?L.push(N):_=h.getTileByID($)}return O(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(n){this.renderedToTile=!0}_clearRenderCacheForTile(n,h){let _=this._tilesDirty[n];_||(_=this._tilesDirty[n]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(h){let _,x,b;const E=new a.StructArrayLayout2ui4,I=131;for(x=1;x<129;x++){for(_=1;_<129;_++)b=x*I+_,E.emplaceBack(b,b+1),E.emplaceBack(b,b+I),E.emplaceBack(b+1,b+I),x===128&&E.emplaceBack(b+I,b+I+1);E.emplaceBack(b+1,b+1+I)}return E}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Ec(m){const n=[];for(let h=0;h<m.length;h++){if(m[h]===null)continue;const _=m[h].split(" ");n.push(_.pop())}return n}class pl{static cacheKey(n,h,_){let x=`${n}${_?_.cacheKey:""}`;for(const b of h)x+=`/${b}`;return x}constructor(n,h,_,x,b,E){const I=n.gl;this.program=I.createProgram();const z=Ec(_.staticAttributes),L=x?x.getBinderAttributes():[],O=z.concat(L),N=_.staticUniforms?Ec(_.staticUniforms):[],$=x?x.getBinderUniforms():[],Q=N.concat($),H=[];for(const se of Q)H.indexOf(se)<0&&H.push(se);let J=x?x.defines():[];J=J.concat(E.map(se=>`#define ${se}`));const he=J.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,bc,fi.fragmentSource,ca.fragmentSource,_.fragmentSource).join(`
`),Y=J.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,bc,fi.vertexSource,ca.vertexSource,la.vertexSource,_.vertexSource).join(`
`),oe=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(oe,he),I.compileShader(oe),I.attachShader(this.program,oe);const ae=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(ae,Y),I.compileShader(ae),I.attachShader(this.program,ae),this.attributes={};const ne={};this.numAttributes=O.length;for(let se=0;se<this.numAttributes;se++)O[se]&&(I.bindAttribLocation(this.program,se,O[se]),this.attributes[O[se]]=se);I.linkProgram(this.program),I.deleteShader(ae),I.deleteShader(oe);for(let se=0;se<H.length;se++){const de=H[se];if(de&&!ne[de]){const Me=I.getUniformLocation(this.program,de);Me&&(ne[de]=Me)}}this.fixedUniforms=b(n,ne),this.binderUniforms=x?x.getUniforms(n,ne):[],E.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((se,de)=>({u_dem:new a.Uniform1i(se,de.u_dem),u_dem_prev:new a.Uniform1i(se,de.u_dem_prev),u_dem_unpack:new a.Uniform4f(se,de.u_dem_unpack),u_dem_tl:new a.Uniform2f(se,de.u_dem_tl),u_dem_scale:new a.Uniform1f(se,de.u_dem_scale),u_dem_tl_prev:new a.Uniform2f(se,de.u_dem_tl_prev),u_dem_scale_prev:new a.Uniform1f(se,de.u_dem_scale_prev),u_dem_size:new a.Uniform1f(se,de.u_dem_size),u_dem_lerp:new a.Uniform1f(se,de.u_dem_lerp),u_exaggeration:new a.Uniform1f(se,de.u_exaggeration),u_depth:new a.Uniform1i(se,de.u_depth),u_depth_size_inv:new a.Uniform2f(se,de.u_depth_size_inv),u_meter_to_dem:new a.Uniform1f(se,de.u_meter_to_dem),u_label_plane_matrix_inv:new a.UniformMatrix4f(se,de.u_label_plane_matrix_inv),u_tile_tl_up:new a.Uniform3f(se,de.u_tile_tl_up),u_tile_tr_up:new a.Uniform3f(se,de.u_tile_tr_up),u_tile_br_up:new a.Uniform3f(se,de.u_tile_br_up),u_tile_bl_up:new a.Uniform3f(se,de.u_tile_bl_up),u_tile_up_scale:new a.Uniform1f(se,de.u_tile_up_scale)}))(n,ne)),E.indexOf("FOG")!==-1&&(this.fogUniforms=((se,de)=>({u_fog_matrix:new a.UniformMatrix4f(se,de.u_fog_matrix),u_fog_range:new a.Uniform2f(se,de.u_fog_range),u_fog_color:new a.Uniform4f(se,de.u_fog_color),u_fog_horizon_blend:new a.Uniform1f(se,de.u_fog_horizon_blend),u_fog_temporal_offset:new a.Uniform1f(se,de.u_fog_temporal_offset)}))(n,ne))}setTerrainUniformValues(n,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in h)_[x].set(h[x])}}setFogUniformValues(n,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in h)_[x].location&&_[x].set(h[x])}}draw(n,h,_,x,b,E,I,z,L,O,N,$,Q,H,J,he){const Y=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(_),n.setStencilMode(x),n.setColorMode(b),n.setCullFace(E);for(const ae of Object.keys(this.fixedUniforms))this.fixedUniforms[ae].set(I[ae]);H&&H.setUniforms(n,this.binderUniforms,$,{zoom:Q});const oe={[Y.LINES]:2,[Y.TRIANGLES]:3,[Y.LINE_STRIP]:1}[h];for(const ae of N.get()){const ne=ae.vaos||(ae.vaos={});(ne[z]||(ne[z]=new Sn)).bind(n,this,L,H?H.getPaintVertexBuffers():[],O,ae.vertexOffset,J,he),Y.drawElements(h,ae.primitiveLength*oe,Y.UNSIGNED_SHORT,ae.primitiveOffset*oe*2)}}}function bd(m,n,h){const _=1/gt(h,1,n.transform.tileZoom),x=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,n.transform.tileZoom)/x,E=b*(h.tileID.canonical.x+h.tileID.wrap*x),I=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[_,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[E>>16,I>>16],u_pixel_coord_lower:[65535&E,65535&I]}}const wd=(m,n,h,_)=>{const x=n.style.light,b=x.properties.get("position"),E=[b.x,b.y,b.z],I=a.create$1();x.properties.get("anchor")==="viewport"&&(a.fromRotation(I,-n.transform.angle),a.transformMat3(E,E,I));const z=x.properties.get("color");return{u_matrix:m,u_lightpos:E,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+h,u_opacity:_}},hh=(m,n,h,_,x,b,E)=>a.extend(wd(m,n,h,_),bd(b,n,E),{u_height_factor:-Math.pow(2,x.overscaledZ)/E.tileSize/8}),Td=m=>({u_matrix:m}),fh=(m,n,h,_)=>a.extend(Td(m),bd(h,n,_)),v_=(m,n)=>({u_matrix:m,u_world:n}),Ed=(m,n,h,_,x)=>a.extend(fh(m,n,h,_),{u_world:x}),b_=(m,n,h,_)=>{const x=m.transform;let b;return b=_.paint.get("circle-pitch-alignment")==="map"?x.calculatePixelsToTileUnitsMatrix(h):new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]),{u_camera_to_center_distance:x.cameraToCenterDistance,u_matrix:m.translatePosMatrix(n.projMatrix,h,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:b}},dh=m=>{const n=[];return m.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),m.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},Sd=(m,n,h)=>{const _=a.EXTENT/h.tileSize;return{u_matrix:m,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/_,n.pixelsToGLUnits[1]/_]}},ph=(m,n,h=1)=>({u_matrix:m,u_color:n,u_overlay:0,u_overlay_scale:h}),Ad=(m,n,h,_)=>({u_matrix:m,u_extrude_scale:gt(n,1,h),u_intensity:_}),Cd=(m,n,h,_,x,b)=>{const E=m.transform,I=E.calculatePixelsToTileUnitsMatrix(n),z={u_matrix:ml(m,n,h,x),u_pixels_to_tile_units:I,u_device_pixel_ratio:a.exported.devicePixelRatio,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(_l(h)){const L=ua(n,m.transform);z.u_texsize=n.lineAtlasTexture.size,z.u_scale=[L,_.fromScale,_.toScale],z.u_mix=_.t}return z},zo=(m,n,h,_,x)=>{const b=m.transform,E=ua(n,b);return{u_matrix:ml(m,n,h,x),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:a.exported.devicePixelRatio,u_image:0,u_scale:[E,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ua(m,n){return 1/gt(m,1,n.tileZoom)}function ml(m,n,h,_){return m.translatePosMatrix(_||n.tileID.projMatrix,n,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function _l(m){const n=m.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const Sc=(m,n,h,_,x,b)=>{return{u_matrix:m,u_tl_parent:n,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(I=x.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(E=x.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:Ac(x.paint.get("raster-hue-rotate")),u_perspective_transform:b};var E,I};function Ac(m){m*=Math.PI/180;const n=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*n-h+1)/3,(Math.sqrt(3)*n-h+1)/3]}const Cc=(m,n,h,_,x,b,E,I,z,L,O,N,$,Q)=>{const H=x.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:H.width/H.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:I,u_is_text:+z,u_pitch_with_map:+_,u_texsize:L,u_tile_id:O,u_zoom_transition:N,u_inv_rot_matrix:$,u_merc_center:Q,u_texture:0}},gl=(m,n,h,_,x,b,E,I,z,L,O,N,$,Q,H)=>{const{cameraToCenterDistance:J,_pitch:he}=x.transform;return a.extend(Cc(m,n,h,_,x,b,E,I,z,L,N,$,Q,H),{u_gamma_scale:_?J*Math.cos(x.terrain?0:he):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+O})},yl=(m,n,h,_,x,b,E,I,z,L,O,N,$,Q)=>a.extend(gl(m,n,h,_,x,b,E,I,!0,z,!0,O,N,$,Q),{u_texsize_icon:L,u_texture_icon:1}),vi=(m,n,h)=>({u_matrix:m,u_opacity:n,u_color:h}),Ic=(m,n,h,_,x,b)=>a.extend(function(E,I,z,L){const O=z.imageManager.getPattern(E.from.toString()),N=z.imageManager.getPattern(E.to.toString()),{width:$,height:Q}=z.imageManager.getPixelSize(),H=Math.pow(2,L.tileID.overscaledZ),J=L.tileSize*Math.pow(2,z.transform.tileZoom)/H,he=J*(L.tileID.canonical.x+L.tileID.wrap*H),Y=J*L.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[$,Q],u_mix:I.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/gt(L,1,z.transform.tileZoom),u_pixel_coord_upper:[he>>16,Y>>16],u_pixel_coord_lower:[65535&he,65535&Y]}}(_,b,h,x),{u_matrix:m,u_opacity:n}),Id={fillExtrusion:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_lightpos:new a.Uniform3f(m,n.u_lightpos),u_lightintensity:new a.Uniform1f(m,n.u_lightintensity),u_lightcolor:new a.Uniform3f(m,n.u_lightcolor),u_vertical_gradient:new a.Uniform1f(m,n.u_vertical_gradient),u_opacity:new a.Uniform1f(m,n.u_opacity)}),fillExtrusionPattern:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_lightpos:new a.Uniform3f(m,n.u_lightpos),u_lightintensity:new a.Uniform1f(m,n.u_lightintensity),u_lightcolor:new a.Uniform3f(m,n.u_lightcolor),u_vertical_gradient:new a.Uniform1f(m,n.u_vertical_gradient),u_height_factor:new a.Uniform1f(m,n.u_height_factor),u_image:new a.Uniform1i(m,n.u_image),u_texsize:new a.Uniform2f(m,n.u_texsize),u_pixel_coord_upper:new a.Uniform2f(m,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(m,n.u_pixel_coord_lower),u_scale:new a.Uniform3f(m,n.u_scale),u_fade:new a.Uniform1f(m,n.u_fade),u_opacity:new a.Uniform1f(m,n.u_opacity)}),fill:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix)}),fillPattern:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_image:new a.Uniform1i(m,n.u_image),u_texsize:new a.Uniform2f(m,n.u_texsize),u_pixel_coord_upper:new a.Uniform2f(m,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(m,n.u_pixel_coord_lower),u_scale:new a.Uniform3f(m,n.u_scale),u_fade:new a.Uniform1f(m,n.u_fade)}),fillOutline:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_world:new a.Uniform2f(m,n.u_world)}),fillOutlinePattern:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_world:new a.Uniform2f(m,n.u_world),u_image:new a.Uniform1i(m,n.u_image),u_texsize:new a.Uniform2f(m,n.u_texsize),u_pixel_coord_upper:new a.Uniform2f(m,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(m,n.u_pixel_coord_lower),u_scale:new a.Uniform3f(m,n.u_scale),u_fade:new a.Uniform1f(m,n.u_fade)}),circle:(m,n)=>({u_camera_to_center_distance:new a.Uniform1f(m,n.u_camera_to_center_distance),u_extrude_scale:new a.UniformMatrix2f(m,n.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(m,n.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(m,n.u_matrix)}),collisionBox:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_camera_to_center_distance:new a.Uniform1f(m,n.u_camera_to_center_distance),u_extrude_scale:new a.Uniform2f(m,n.u_extrude_scale)}),collisionCircle:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_inv_matrix:new a.UniformMatrix4f(m,n.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(m,n.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(m,n.u_viewport_size)}),debug:(m,n)=>({u_color:new a.UniformColor(m,n.u_color),u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_overlay:new a.Uniform1i(m,n.u_overlay),u_overlay_scale:new a.Uniform1f(m,n.u_overlay_scale)}),clippingMask:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix)}),heatmap:(m,n)=>({u_extrude_scale:new a.Uniform1f(m,n.u_extrude_scale),u_intensity:new a.Uniform1f(m,n.u_intensity),u_matrix:new a.UniformMatrix4f(m,n.u_matrix)}),heatmapTexture:(m,n)=>({u_image:new a.Uniform1i(m,n.u_image),u_color_ramp:new a.Uniform1i(m,n.u_color_ramp),u_opacity:new a.Uniform1f(m,n.u_opacity)}),hillshade:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_image:new a.Uniform1i(m,n.u_image),u_latrange:new a.Uniform2f(m,n.u_latrange),u_light:new a.Uniform2f(m,n.u_light),u_shadow:new a.UniformColor(m,n.u_shadow),u_highlight:new a.UniformColor(m,n.u_highlight),u_accent:new a.UniformColor(m,n.u_accent)}),hillshadePrepare:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_image:new a.Uniform1i(m,n.u_image),u_dimension:new a.Uniform2f(m,n.u_dimension),u_zoom:new a.Uniform1f(m,n.u_zoom),u_unpack:new a.Uniform4f(m,n.u_unpack)}),line:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_pixels_to_tile_units:new a.UniformMatrix2f(m,n.u_pixels_to_tile_units),u_device_pixel_ratio:new a.Uniform1f(m,n.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(m,n.u_units_to_pixels),u_dash_image:new a.Uniform1i(m,n.u_dash_image),u_gradient_image:new a.Uniform1i(m,n.u_gradient_image),u_image_height:new a.Uniform1f(m,n.u_image_height),u_texsize:new a.Uniform2f(m,n.u_texsize),u_scale:new a.Uniform3f(m,n.u_scale),u_mix:new a.Uniform1f(m,n.u_mix),u_alpha_discard_threshold:new a.Uniform1f(m,n.u_alpha_discard_threshold)}),linePattern:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_texsize:new a.Uniform2f(m,n.u_texsize),u_pixels_to_tile_units:new a.UniformMatrix2f(m,n.u_pixels_to_tile_units),u_device_pixel_ratio:new a.Uniform1f(m,n.u_device_pixel_ratio),u_image:new a.Uniform1i(m,n.u_image),u_units_to_pixels:new a.Uniform2f(m,n.u_units_to_pixels),u_scale:new a.Uniform3f(m,n.u_scale),u_fade:new a.Uniform1f(m,n.u_fade),u_alpha_discard_threshold:new a.Uniform1f(m,n.u_alpha_discard_threshold)}),raster:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_tl_parent:new a.Uniform2f(m,n.u_tl_parent),u_scale_parent:new a.Uniform1f(m,n.u_scale_parent),u_fade_t:new a.Uniform1f(m,n.u_fade_t),u_opacity:new a.Uniform1f(m,n.u_opacity),u_image0:new a.Uniform1i(m,n.u_image0),u_image1:new a.Uniform1i(m,n.u_image1),u_brightness_low:new a.Uniform1f(m,n.u_brightness_low),u_brightness_high:new a.Uniform1f(m,n.u_brightness_high),u_saturation_factor:new a.Uniform1f(m,n.u_saturation_factor),u_contrast_factor:new a.Uniform1f(m,n.u_contrast_factor),u_spin_weights:new a.Uniform3f(m,n.u_spin_weights),u_perspective_transform:new a.Uniform2f(m,n.u_perspective_transform)}),symbolIcon:(m,n)=>({u_is_size_zoom_constant:new a.Uniform1i(m,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(m,n.u_is_size_feature_constant),u_size_t:new a.Uniform1f(m,n.u_size_t),u_size:new a.Uniform1f(m,n.u_size),u_camera_to_center_distance:new a.Uniform1f(m,n.u_camera_to_center_distance),u_pitch:new a.Uniform1f(m,n.u_pitch),u_rotate_symbol:new a.Uniform1i(m,n.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(m,n.u_aspect_ratio),u_fade_change:new a.Uniform1f(m,n.u_fade_change),u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(m,n.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(m,n.u_coord_matrix),u_is_text:new a.Uniform1i(m,n.u_is_text),u_pitch_with_map:new a.Uniform1i(m,n.u_pitch_with_map),u_texsize:new a.Uniform2f(m,n.u_texsize),u_tile_id:new a.Uniform3f(m,n.u_tile_id),u_zoom_transition:new a.Uniform1f(m,n.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(m,n.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(m,n.u_merc_center),u_texture:new a.Uniform1i(m,n.u_texture)}),symbolSDF:(m,n)=>({u_is_size_zoom_constant:new a.Uniform1i(m,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(m,n.u_is_size_feature_constant),u_size_t:new a.Uniform1f(m,n.u_size_t),u_size:new a.Uniform1f(m,n.u_size),u_camera_to_center_distance:new a.Uniform1f(m,n.u_camera_to_center_distance),u_pitch:new a.Uniform1f(m,n.u_pitch),u_rotate_symbol:new a.Uniform1i(m,n.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(m,n.u_aspect_ratio),u_fade_change:new a.Uniform1f(m,n.u_fade_change),u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(m,n.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(m,n.u_coord_matrix),u_is_text:new a.Uniform1i(m,n.u_is_text),u_pitch_with_map:new a.Uniform1i(m,n.u_pitch_with_map),u_texsize:new a.Uniform2f(m,n.u_texsize),u_texture:new a.Uniform1i(m,n.u_texture),u_gamma_scale:new a.Uniform1f(m,n.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(m,n.u_device_pixel_ratio),u_tile_id:new a.Uniform3f(m,n.u_tile_id),u_zoom_transition:new a.Uniform1f(m,n.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(m,n.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(m,n.u_merc_center),u_is_halo:new a.Uniform1i(m,n.u_is_halo)}),symbolTextAndIcon:(m,n)=>({u_is_size_zoom_constant:new a.Uniform1i(m,n.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(m,n.u_is_size_feature_constant),u_size_t:new a.Uniform1f(m,n.u_size_t),u_size:new a.Uniform1f(m,n.u_size),u_camera_to_center_distance:new a.Uniform1f(m,n.u_camera_to_center_distance),u_pitch:new a.Uniform1f(m,n.u_pitch),u_rotate_symbol:new a.Uniform1i(m,n.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(m,n.u_aspect_ratio),u_fade_change:new a.Uniform1f(m,n.u_fade_change),u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(m,n.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(m,n.u_coord_matrix),u_is_text:new a.Uniform1i(m,n.u_is_text),u_pitch_with_map:new a.Uniform1i(m,n.u_pitch_with_map),u_texsize:new a.Uniform2f(m,n.u_texsize),u_texsize_icon:new a.Uniform2f(m,n.u_texsize_icon),u_texture:new a.Uniform1i(m,n.u_texture),u_texture_icon:new a.Uniform1i(m,n.u_texture_icon),u_gamma_scale:new a.Uniform1f(m,n.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(m,n.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(m,n.u_is_halo)}),background:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_opacity:new a.Uniform1f(m,n.u_opacity),u_color:new a.UniformColor(m,n.u_color)}),backgroundPattern:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_opacity:new a.Uniform1f(m,n.u_opacity),u_image:new a.Uniform1i(m,n.u_image),u_pattern_tl_a:new a.Uniform2f(m,n.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(m,n.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(m,n.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(m,n.u_pattern_br_b),u_texsize:new a.Uniform2f(m,n.u_texsize),u_mix:new a.Uniform1f(m,n.u_mix),u_pattern_size_a:new a.Uniform2f(m,n.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(m,n.u_pattern_size_b),u_scale_a:new a.Uniform1f(m,n.u_scale_a),u_scale_b:new a.Uniform1f(m,n.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(m,n.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(m,n.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(m,n.u_tile_units_to_pixels)}),terrainRaster:no,terrainDepth:no,skybox:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_sun_direction:new a.Uniform3f(m,n.u_sun_direction),u_cubemap:new a.Uniform1i(m,n.u_cubemap),u_opacity:new a.Uniform1f(m,n.u_opacity),u_temporal_offset:new a.Uniform1f(m,n.u_temporal_offset)}),skyboxGradient:(m,n)=>({u_matrix:new a.UniformMatrix4f(m,n.u_matrix),u_color_ramp:new a.Uniform1i(m,n.u_color_ramp),u_center_direction:new a.Uniform3f(m,n.u_center_direction),u_radius:new a.Uniform1f(m,n.u_radius),u_opacity:new a.Uniform1f(m,n.u_opacity),u_temporal_offset:new a.Uniform1f(m,n.u_temporal_offset)}),skyboxCapture:(m,n)=>({u_matrix_3f:new a.UniformMatrix3f(m,n.u_matrix_3f),u_sun_direction:new a.Uniform3f(m,n.u_sun_direction),u_sun_intensity:new a.Uniform1f(m,n.u_sun_intensity),u_color_tint_r:new a.Uniform4f(m,n.u_color_tint_r),u_color_tint_m:new a.Uniform4f(m,n.u_color_tint_m),u_luminance:new a.Uniform1f(m,n.u_luminance)}),globeRaster:(m,n)=>({u_proj_matrix:new a.UniformMatrix4f(m,n.u_proj_matrix),u_globe_matrix:new a.UniformMatrix4f(m,n.u_globe_matrix),u_merc_matrix:new a.UniformMatrix4f(m,n.u_merc_matrix),u_zoom_transition:new a.Uniform1f(m,n.u_zoom_transition),u_merc_center:new a.Uniform2f(m,n.u_merc_center),u_image0:new a.Uniform1i(m,n.u_image0)}),globeAtmosphere:(m,n)=>({u_center:new a.Uniform2f(m,n.u_center),u_radius:new a.Uniform1f(m,n.u_radius),u_screen_size:new a.Uniform2f(m,n.u_screen_size),u_pixel_ratio:new a.Uniform1f(m,n.u_pixel_ratio),u_opacity:new a.Uniform1f(m,n.u_opacity),u_fadeout_range:new a.Uniform1f(m,n.u_fadeout_range),u_start_color:new a.Uniform3f(m,n.u_start_color),u_end_color:new a.Uniform3f(m,n.u_end_color)})};let xl;function mh(m,n,h,_,x,b,E){const I=m.context,z=I.gl,L=m.useProgram("collisionBox"),O=[];let N=0,$=0;for(let ae=0;ae<_.length;ae++){const ne=_[ae],se=n.getTile(ne),de=se.getBucket(h);if(!de)continue;let Me=ne.projMatrix;x[0]===0&&x[1]===0||(Me=m.translatePosMatrix(ne.projMatrix,se,x,b));const Fe=E?de.textCollisionBox:de.iconCollisionBox,ht=de.collisionCircleArray;if(ht.length>0){const et=a.create(),Ye=Me;a.mul(et,de.placementInvProjMatrix,m.transform.glCoordMatrix),a.mul(et,et,de.placementViewportMatrix),O.push({circleArray:ht,circleOffset:$,transform:Ye,invTransform:et}),N+=ht.length/4,$=N}Fe&&(m.terrain&&m.terrain.setupElevationDraw(se,L),L.draw(I,z.LINES,a.DepthMode.disabled,a.StencilMode.disabled,m.colorModeForRenderPass(),a.CullFaceMode.disabled,Sd(Me,m.transform,se),h.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,null,m.transform.zoom,null,Fe.collisionVertexBuffer,Fe.collisionVertexBufferExt))}if(!E||!O.length)return;const Q=m.useProgram("collisionCircle"),H=new a.StructArrayLayout2f1f2i16;H.resize(4*N),H._trim();let J=0;for(const ae of O)for(let ne=0;ne<ae.circleArray.length/4;ne++){const se=4*ne,de=ae.circleArray[se+0],Me=ae.circleArray[se+1],Fe=ae.circleArray[se+2],ht=ae.circleArray[se+3];H.emplace(J++,de,Me,Fe,ht,0),H.emplace(J++,de,Me,Fe,ht,1),H.emplace(J++,de,Me,Fe,ht,2),H.emplace(J++,de,Me,Fe,ht,3)}(!xl||xl.length<2*N)&&(xl=function(ae){const ne=2*ae,se=new a.StructArrayLayout3ui6;se.resize(ne),se._trim();for(let de=0;de<ne;de++){const Me=6*de;se.uint16[Me+0]=4*de+0,se.uint16[Me+1]=4*de+1,se.uint16[Me+2]=4*de+2,se.uint16[Me+3]=4*de+2,se.uint16[Me+4]=4*de+3,se.uint16[Me+5]=4*de+0}return se}(N));const he=I.createIndexBuffer(xl,!0),Y=I.createVertexBuffer(H,a.collisionCircleLayout.members,!0);for(const ae of O){const ne={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(oe=m.transform).cameraToCenterDistance,u_viewport_size:[oe.width,oe.height]};Q.draw(I,z.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,m.colorModeForRenderPass(),a.CullFaceMode.disabled,ne,h.id,Y,he,a.SegmentVector.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,m.transform.zoom,null,null,null)}var oe;Y.destroy(),he.destroy()}const Mc=a.identity(new Float32Array(16));function Md(m,n,h,_,x,b){const{horizontalAlign:E,verticalAlign:I}=a.getAnchorAlignment(m),z=-(E-.5)*n,L=-(I-.5)*h,O=a.evaluateVariableOffset(m,_);return new a.pointGeometry((z/x+O[0])*b,(L/x+O[1])*b)}function w_(m,n,h,_,x,b,E,I,z,L,O,N){const $=m.text.placedSymbolArray,Q=m.text.dynamicLayoutVertexArray,H=m.icon.dynamicLayoutVertexArray,J={},he=I.projMatrix,Y=b.elevation,oe=Y?Y.getAtTileOffsetFunc(I,N):ae=>[0,0,0];Q.clear();for(let ae=0;ae<$.length;ae++){const ne=$.get(ae),se=m.allowVerticalPlacement&&!ne.placedOrientation,de=ne.hidden||!ne.crossTileID||se?null:_[ne.crossTileID];if(de){const Me=new a.pointGeometry(ne.tileAnchorX,ne.tileAnchorY),Fe=oe(Me),ht=Cr(Me,h?he:E,Fe[2]),et=us(b.cameraToCenterDistance,ht.signedDistanceFromCamera);let Ye=x.evaluateSizeForFeature(m.textSizeData,L,ne)*et/a.ONE_EM;h&&(Ye*=m.tilePixelRatio/z);const{width:Ue,height:De,anchor:Ke,textOffset:Ge,textScale:kt}=de,Ot=Md(Ke,Ue,De,Ge,kt,Ye),Ht=h?Cr(Me.add(Ot),E,Fe[2]).point:ht.point.add(n?Ot.rotate(-b.angle):Ot),ut=m.allowVerticalPlacement&&ne.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let zt=0;zt<ne.numGlyphs;zt++)a.addDynamicAttributes(Q,Ht,ut);O&&ne.associatedIconIndex>=0&&(J[ne.associatedIconIndex]={shiftedAnchor:Ht,angle:ut})}else Gn(ne.numGlyphs,Q)}if(O){H.clear();const ae=m.icon.placedSymbolArray;for(let ne=0;ne<ae.length;ne++){const se=ae.get(ne);if(se.hidden)Gn(se.numGlyphs,H);else{const de=J[ne];if(de)for(let Me=0;Me<se.numGlyphs;Me++)a.addDynamicAttributes(H,de.shiftedAnchor,de.angle);else Gn(se.numGlyphs,H)}}m.icon.dynamicLayoutVertexBuffer.updateData(H)}m.text.dynamicLayoutVertexBuffer.updateData(Q)}function T_(m,n,h){return h.iconsInText&&n?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function kc(m,n,h,_,x,b,E,I,z,L,O,N){const $=m.context,Q=$.gl,H=m.transform,J=H.projection.createTileTransform(H,H.worldSize),he=I==="map",Y=z==="map",oe=he&&h.layout.get("symbol-placement")!=="point",ae=he&&!Y&&!oe,ne=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let se=!1;const de=m.depthModeForSublayer(0,a.DepthMode.ReadOnly),Me=[a.mercatorXfromLng(H.center.lng),a.mercatorYfromLat(H.center.lat)],Fe=h.layout.get("text-variable-anchor"),ht=H.projection.name==="globe",et=ht?a.globeToMercatorTransition(H.zoom):0,Ye=[],Ue=[];m.terrain&&Y&&Ue.push("PITCH_WITH_MAP_TERRAIN"),ht&&Ue.push("PROJECTION_GLOBE_VIEW"),oe&&Ue.push("PROJECTED_POS_ON_VIEWPORT");for(const De of _){const Ke=n.getTile(De),Ge=Ke.getBucket(h);if(!Ge||Ge.projection!==H.projection.name)continue;const kt=x?Ge.text:Ge.icon;if(!kt||Ge.fullyClipped||!kt.segments.get().length)continue;const Ot=kt.programConfigurations.get(h.id),Ht=x||Ge.sdfIcons,ut=x?Ge.textSizeData:Ge.iconSizeData,zt=Y||H.pitch!==0,Vt=m.useProgram(T_(Ht,x,Ge),Ot,Ue),wi=a.evaluateSizeForZoom(ut,H.zoom),Pi=[De.canonical.x,De.canonical.y,1<<De.canonical.z];let jt,Jt,ji,hr,rn=[0,0],In=null;if(x){if(Jt=Ke.glyphAtlasTexture,ji=Q.LINEAR,jt=Ke.glyphAtlasTexture.size,Ge.iconsInText){rn=Ke.imageAtlasTexture.size,In=Ke.imageAtlasTexture;const vr=ut.kind==="composite"||ut.kind==="camera";hr=zt||m.options.rotating||m.options.zooming||vr?Q.LINEAR:Q.NEAREST}}else{const vr=h.layout.get("icon-size").constantOr(0)!==1||Ge.iconsNeedLinear;Jt=Ke.imageAtlasTexture,ji=Ht||m.options.rotating||m.options.zooming||vr||zt?Q.LINEAR:Q.NEAREST,jt=Ke.imageAtlasTexture.size}const Hn=m.transform.calculatePixelsToTileUnitsMatrix(Ke),ci=Qs(De.projMatrix,Ke.tileID.canonical,Y,he,m.transform,Hn),$t=m.terrain&&Y&&oe?a.invert(new Float32Array(16),ci):Mc,ni=zs(De.projMatrix,Ke.tileID.canonical,Y,he,m.transform,Hn),Ji=Fe&&Ge.hasTextData(),pn=h.layout.get("icon-text-fit")!=="none"&&Ji&&Ge.hasIconData();if(oe){const vr=H.elevation,Lo=vr?vr.getAtTileOffsetFunc(De,J):uo=>[0,0,0];dd(Ge,De.projMatrix,m,x,ci,ni,Y,L,Lo,De)}const Oi=m.translatePosMatrix(De.projMatrix,Ke,b,E),mn=oe||x&&Fe||pn?Mc:ci,Rl=m.translatePosMatrix(ni,Ke,b,E,!0),nn=Ht&&h.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Fo;const At=J.createInversionMatrix(De.toUnwrapped());Fo=Ht?Ge.iconsInText?yl(ut.kind,wi,ae,Y,m,Oi,mn,Rl,jt,rn,Pi,et,At,Me):gl(ut.kind,wi,ae,Y,m,Oi,mn,Rl,x,jt,!0,Pi,et,At,Me):Cc(ut.kind,wi,ae,Y,m,Oi,mn,Rl,x,jt,Pi,et,At,Me);const Rt={program:Vt,buffers:kt,uniformValues:Fo,atlasTexture:Jt,atlasTextureIcon:In,atlasInterpolation:ji,atlasInterpolationIcon:hr,isSDF:Ht,hasHalo:nn,tile:Ke,labelPlaneMatrixInv:$t};if(ne&&Ge.canOverlap){se=!0;const vr=kt.segments.get();for(const Lo of vr)Ye.push({segments:new a.SegmentVector([Lo]),sortKey:Lo.sortKey,state:Rt})}else Ye.push({segments:kt.segments,sortKey:0,state:Rt})}se&&Ye.sort((De,Ke)=>De.sortKey-Ke.sortKey);for(const De of Ye){const Ke=De.state;if(m.terrain&&m.terrain.setupElevationDraw(Ke.tile,Ke.program,{useDepthForOcclusion:!ht,labelPlaneMatrixInv:Ke.labelPlaneMatrixInv}),$.activeTexture.set(Q.TEXTURE0),Ke.atlasTexture.bind(Ke.atlasInterpolation,Q.CLAMP_TO_EDGE),Ke.atlasTextureIcon&&($.activeTexture.set(Q.TEXTURE1),Ke.atlasTextureIcon&&Ke.atlasTextureIcon.bind(Ke.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),Ke.isSDF){const Ge=Ke.uniformValues;Ke.hasHalo&&(Ge.u_is_halo=1,Pc(Ke.buffers,De.segments,h,m,Ke.program,de,O,N,Ge)),Ge.u_is_halo=0}Pc(Ke.buffers,De.segments,h,m,Ke.program,de,O,N,Ke.uniformValues)}}function Pc(m,n,h,_,x,b,E,I,z){const L=_.context;x.draw(L,L.gl.TRIANGLES,b,E,I,a.CullFaceMode.disabled,z,h.id,m.layoutVertexBuffer,m.indexBuffer,n,h.paint,_.transform.zoom,m.programConfigurations.get(h.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Dc(m,n,h,_,x,b,E){const I=m.context.gl,z=h.paint.get("fill-pattern"),L=z&&z.constantOr(1),O=h.getCrossfadeParameters();let N,$,Q,H,J;E?($=L&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=I.LINES):($=L?"fillPattern":"fill",N=I.TRIANGLES);for(const he of _){const Y=n.getTile(he);if(L&&!Y.patternsLoaded())continue;const oe=Y.getBucket(h);if(!oe)continue;m.prepareDrawTile(he);const ae=oe.programConfigurations.get(h.id),ne=m.useProgram($,ae);L&&(m.context.activeTexture.set(I.TEXTURE0),Y.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ae.updatePaintBuffers(O));const se=z.constantOr(null);if(se&&Y.imageAtlas){const Me=Y.imageAtlas,Fe=Me.patternPositions[se.to.toString()],ht=Me.patternPositions[se.from.toString()];Fe&&ht&&ae.setConstantPatternPositions(Fe,ht)}const de=m.translatePosMatrix(he.projMatrix,Y,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){H=oe.indexBuffer2,J=oe.segments2;const Me=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];Q=$==="fillOutlinePattern"&&L?Ed(de,m,O,Y,Me):v_(de,Me)}else H=oe.indexBuffer,J=oe.segments,Q=L?fh(de,m,O,Y):Td(de);m.prepareDrawProgram(m.context,ne,he.toUnwrapped()),ne.draw(m.context,N,x,m.stencilModeForClipping(he),b,a.CullFaceMode.disabled,Q,h.id,oe.layoutVertexBuffer,H,J,h.paint,m.transform.zoom,ae)}}function vl(m,n,h,_,x,b,E){const I=m.context,z=I.gl,L=h.paint.get("fill-extrusion-pattern"),O=L.constantOr(1),N=h.getCrossfadeParameters(),$=h.paint.get("fill-extrusion-opacity");for(const Q of _){const H=n.getTile(Q),J=H.getBucket(h);if(!J)continue;const he=J.programConfigurations.get(h.id),Y=m.useProgram(O?"fillExtrusionPattern":"fillExtrusion",he);if(m.terrain){const de=m.terrain;if(!J.enableTerrain)continue;if(de.setupElevationDraw(H,Y,{useMeterToDem:!0}),kd(I,n,Q,J,h,de),!J.centroidVertexBuffer){const Me=Y.attributes.a_centroid_pos;Me!==void 0&&z.vertexAttrib2f(Me,0,0)}}O&&(m.context.activeTexture.set(z.TEXTURE0),H.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),he.updatePaintBuffers(N));const oe=L.constantOr(null);if(oe&&H.imageAtlas){const de=H.imageAtlas,Me=de.patternPositions[oe.to.toString()],Fe=de.patternPositions[oe.from.toString()];Me&&Fe&&he.setConstantPatternPositions(Me,Fe)}const ae=m.translatePosMatrix(Q.projMatrix,H,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ne=h.paint.get("fill-extrusion-vertical-gradient"),se=O?hh(ae,m,ne,$,Q,N,H):wd(ae,m,ne,$);m.prepareDrawProgram(I,Y,Q.toUnwrapped()),Y.draw(I,I.gl.TRIANGLES,x,b,E,a.CullFaceMode.backCCW,se,h.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,h.paint,m.transform.zoom,he,m.terrain?J.centroidVertexBuffer:null)}}function kd(m,n,h,_,x,b){const E=[Y=>{let oe=Y.canonical.x-1,ae=Y.wrap;return oe<0&&(oe=(1<<Y.canonical.z)-1,ae--),new a.OverscaledTileID(Y.overscaledZ,ae,Y.canonical.z,oe,Y.canonical.y)},Y=>{let oe=Y.canonical.x+1,ae=Y.wrap;return oe===1<<Y.canonical.z&&(oe=0,ae++),new a.OverscaledTileID(Y.overscaledZ,ae,Y.canonical.z,oe,Y.canonical.y)},Y=>new a.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,(Y.canonical.y===0?1<<Y.canonical.z:Y.canonical.y)-1),Y=>new a.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y===(1<<Y.canonical.z)-1?0:Y.canonical.y+1)],I=Y=>{const oe=n.getSource().maxzoom,ae=Me=>{const Fe=n.getTileByID(Me);if(Fe&&Fe.hasData())return Fe.getBucket(x)};let ne,se,de;return(Y.overscaledZ===Y.canonical.z||Y.overscaledZ>=oe)&&(ne=ae(Y.key)),Y.overscaledZ>=oe&&(se=ae(Y.calculateScaledKey(Y.overscaledZ+1))),Y.overscaledZ>oe&&(de=ae(Y.calculateScaledKey(Y.overscaledZ-1))),ne||se||de},z=[0,0,0],L=(Y,oe)=>(z[0]=Math.min(Y.min.y,oe.min.y),z[1]=Math.max(Y.max.y,oe.max.y),z[2]=a.EXTENT-oe.min.x>Y.max.x?oe.min.x-a.EXTENT:Y.max.x,z),O=(Y,oe)=>(z[0]=Math.min(Y.min.x,oe.min.x),z[1]=Math.max(Y.max.x,oe.max.x),z[2]=a.EXTENT-oe.min.y>Y.max.y?oe.min.y-a.EXTENT:Y.max.y,z),N=[(Y,oe)=>L(Y,oe),(Y,oe)=>L(oe,Y),(Y,oe)=>O(Y,oe),(Y,oe)=>O(oe,Y)],$=new a.pointGeometry(0,0);let Q,H,J;const he=(Y,oe,ae,ne,se)=>{const de=[[ne?ae:Y,ne?Y:ae,0],[ne?ae:oe,ne?oe:ae,0]],Me=se<0?a.EXTENT+se:se,Fe=[ne?Me:(Y+oe)/2,ne?(Y+oe)/2:Me,0];return ae===0&&se<0||ae!==0&&se>0?b.getForTilePoints(J,[Fe],!0,H):de.push(Fe),b.getForTilePoints(h,de,!0,Q),Math.max(de[0][2],de[1][2],Fe[2])/b.exaggeration()};for(let Y=0;Y<4;Y++){const oe=_.borders[Y];if(oe.length===0&&(_.borderDone[Y]=!0),_.borderDone[Y])continue;const ae=J=E[Y](h),ne=I(ae);if(!ne||!ne.enableTerrain||(H=b.findDEMTileFor(ae),!H||!H.dem))continue;if(!Q){const Fe=b.findDEMTileFor(h);if(!Fe||!Fe.dem)return;Q=Fe}const se=(Y<2?1:5)-Y,de=ne.borders[se];let Me=0;for(let Fe=0;Fe<oe.length;Fe++){const ht=_.featuresOnBorder[oe[Fe]],et=ht.borders[Y];let Ye;for(;Me<de.length&&(Ye=ne.featuresOnBorder[de[Me]],!(Ye.borders[se][1]>et[0]+3));)ne.borderDone[se]||ne.encodeCentroid(void 0,Ye,!1),Me++;if(Ye&&Me<de.length){const Ue=Me;let De=0;for(;!(Ye.borders[se][0]>et[1]-3)&&(De++,++Me!==de.length);)Ye=ne.featuresOnBorder[de[Me]];if(Ye=ne.featuresOnBorder[de[Ue]],ht.intersectsCount()>1||Ye.intersectsCount()>1||De!==1){De!==1&&(Me=Ue),_.encodeCentroid(void 0,ht,!1),ne.borderDone[se]||ne.encodeCentroid(void 0,Ye,!1);continue}const Ke=N[Y](ht,Ye),Ge=Y%2?a.EXTENT-1:0;$.x=he(Ke[0],Math.min(a.EXTENT-1,Ke[1]),Ge,Y<2,Ke[2]),$.y=0,_.encodeCentroid($,ht,!1),ne.borderDone[se]||ne.encodeCentroid($,Ye,!1)}else _.encodeCentroid(void 0,ht,!1)}_.borderDone[Y]=_.needsCentroidUpdate=!0,ne.borderDone[se]||(ne.borderDone[se]=ne.needsCentroidUpdate=!0)}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(m)}const Pd=new a.Color(1,0,0,1),E_=new a.Color(0,1,0,1),bl=new a.Color(0,0,1,1),wl=new a.Color(1,0,1,1),Dd=new a.Color(0,1,1,1);function tn(m,n,h,_){Ro(m,0,n+h/2,m.transform.width,h,_)}function zc(m,n,h,_){Ro(m,n-h/2,0,h,m.transform.height,_)}function Ro(m,n,h,_,x,b){const E=m.context,I=E.gl;I.enable(I.SCISSOR_TEST),I.scissor(n*a.exported.devicePixelRatio,h*a.exported.devicePixelRatio,_*a.exported.devicePixelRatio,x*a.exported.devicePixelRatio),E.clear({color:b}),I.disable(I.SCISSOR_TEST)}function Rc(m,n,h){const _=m.context,x=_.gl,b=h.projMatrix,E=m.useProgram("debug"),I=n.getTileByID(h.key);m.terrain&&m.terrain.setupElevationDraw(I,E);const z=a.DepthMode.disabled,L=a.StencilMode.disabled,O=m.colorModeForRenderPass(),N="$debug";_.activeTexture.set(x.TEXTURE0),m.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),I._makeDebugTileBoundsBuffers(m.context,m.transform.projection);const $=I._tileDebugBuffer||m.debugBuffer,Q=I._tileDebugIndexBuffer||m.debugIndexBuffer,H=I._tileDebugSegments||m.debugSegments;E.draw(_,x.LINE_STRIP,z,L,O,a.CullFaceMode.disabled,ph(b,a.Color.red),N,$,Q,H);const J=I.latestRawTileData,he=Math.floor((J&&J.byteLength||0)/1024),Y=n.getTile(h).tileSize,oe=512/Math.min(Y,512)*(h.overscaledZ/m.transform.zoom)*.5;let ae=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ae+=` => ${h.overscaledZ}`),function(ne,se){ne.initDebugOverlayCanvas();const de=ne.debugOverlayCanvas,Me=ne.context.gl,Fe=ne.debugOverlayCanvas.getContext("2d");Fe.clearRect(0,0,de.width,de.height),Fe.shadowColor="white",Fe.shadowBlur=2,Fe.lineWidth=1.5,Fe.strokeStyle="white",Fe.textBaseline="top",Fe.font="bold 36px Open Sans, sans-serif",Fe.fillText(se,5,5),Fe.strokeText(se,5,5),ne.debugOverlayTexture.update(de),ne.debugOverlayTexture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE)}(m,`${ae} ${he}kb`),E.draw(_,x.TRIANGLES,z,L,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,ph(b,a.Color.transparent,oe),N,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments)}const _h=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:gh}=_h;function qn(m,n,h,_){m.emplaceBack(n,h,_)}class Fc{constructor(n){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,qn(this.vertexArray,-1,-1,1),qn(this.vertexArray,1,-1,1),qn(this.vertexArray,-1,1,1),qn(this.vertexArray,1,1,1),qn(this.vertexArray,-1,-1,-1),qn(this.vertexArray,1,-1,-1),qn(this.vertexArray,-1,1,-1),qn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,gh),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function oo(m,n,h,_,x,b){const E=m.gl,I=n.paint.get("sky-atmosphere-color"),z=n.paint.get("sky-atmosphere-halo-color"),L=n.paint.get("sky-atmosphere-sun-intensity"),O=((N,$,Q,H,J)=>({u_matrix_3f:N,u_sun_direction:$,u_sun_intensity:Q,u_color_tint_r:[H.r,H.g,H.b,H.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(a.fromMat4([],_),x,L,I,z);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),h.draw(m,E.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,O,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Tl={symbol:function(m,n,h,_,x){if(m.renderPass!=="translucent")return;const b=a.StencilMode.disabled,E=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(I,z,L,O,N,$,Q){const H=z.transform,J=N==="map",he=$==="map",Y=H.projection.createTileTransform(H,H.worldSize);for(const oe of I){const ae=O.getTile(oe),ne=ae.getBucket(L);if(!ne||ne.projection!==H.projection.name||!ne.text||!ne.text.segments.get().length)continue;const se=a.evaluateSizeForZoom(ne.textSizeData,H.zoom),de=z.transform.calculatePixelsToTileUnitsMatrix(ae),Me=Qs(oe.projMatrix,ae.tileID.canonical,he,J,z.transform,de),Fe=L.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(se){const ht=Math.pow(2,H.zoom-ae.tileID.overscaledZ);w_(ne,J,he,Q,a.symbolSize,H,Me,oe,ht,se,Fe,Y)}}}(_,m,h,n,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x),h.paint.get("icon-opacity").constantOr(1)!==0&&kc(m,n,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),b,E),h.paint.get("text-opacity").constantOr(1)!==0&&kc(m,n,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),b,E),n.map.showCollisionBoxes&&(mh(m,n,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),mh(m,n,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,n,h,_){if(m.renderPass!=="translucent")return;const x=h.paint.get("circle-opacity"),b=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),I=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(b.constantOr(1)===0||E.constantOr(1)===0))return;const z=m.context,L=z.gl,O=m.depthModeForSublayer(0,a.DepthMode.ReadOnly),N=a.StencilMode.disabled,$=m.colorModeForRenderPass(),Q=[];for(let J=0;J<_.length;J++){const he=_[J],Y=n.getTile(he),oe=Y.getBucket(h);if(!oe)continue;const ae=oe.programConfigurations.get(h.id),ne=dh(h),se={programConfiguration:ae,program:m.useProgram("circle",ae,ne),layoutVertexBuffer:oe.layoutVertexBuffer,indexBuffer:oe.indexBuffer,uniformValues:b_(m,he,Y,h),tile:Y};if(I){const de=oe.segments.get();for(const Me of de)Q.push({segments:new a.SegmentVector([Me]),sortKey:Me.sortKey,state:se})}else Q.push({segments:oe.segments,sortKey:0,state:se})}I&&Q.sort((J,he)=>J.sortKey-he.sortKey);const H={useDepthForOcclusion:m.transform.projection.name!=="globe"};for(const J of Q){const{programConfiguration:he,program:Y,layoutVertexBuffer:oe,indexBuffer:ae,uniformValues:ne,tile:se}=J.state,de=J.segments;m.terrain&&m.terrain.setupElevationDraw(se,Y,H),m.prepareDrawProgram(z,Y,se.tileID.toUnwrapped()),Y.draw(z,L.TRIANGLES,O,N,$,a.CullFaceMode.disabled,ne,h.id,oe,ae,de,h.paint,m.transform.zoom,he)}},heatmap:function(m,n,h,_){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const x=m.context,b=x.gl,E=a.StencilMode.disabled,I=new a.ColorMode([b.ONE,b.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(z,L,O){const N=z.gl;z.activeTexture.set(N.TEXTURE1),z.viewport.set([0,0,L.width/4,L.height/4]);let $=O.heatmapFbo;if($)N.bindTexture(N.TEXTURE_2D,$.colorAttachment.get()),z.bindFramebuffer.set($.framebuffer);else{const Q=N.createTexture();N.bindTexture(N.TEXTURE_2D,Q),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),$=O.heatmapFbo=z.createFramebuffer(L.width/4,L.height/4,!1),function(H,J,he,Y){const oe=H.gl;oe.texImage2D(oe.TEXTURE_2D,0,oe.RGBA,J.width/4,J.height/4,0,oe.RGBA,H.extRenderToTextureHalfFloat?H.extTextureHalfFloat.HALF_FLOAT_OES:oe.UNSIGNED_BYTE,null),Y.colorAttachment.set(he)}(z,L,Q,$)}})(x,m,h),x.clear({color:a.Color.transparent});for(let z=0;z<_.length;z++){const L=_[z];if(n.hasRenderableParent(L))continue;const O=n.getTile(L),N=O.getBucket(h);if(!N)continue;const $=N.programConfigurations.get(h.id),Q=m.useProgram("heatmap",$),{zoom:H}=m.transform;m.terrain&&m.terrain.setupElevationDraw(O,Q),m.prepareDrawProgram(x,Q,L.toUnwrapped()),Q.draw(x,b.TRIANGLES,a.DepthMode.disabled,E,I,a.CullFaceMode.disabled,Ad(L.projMatrix,O,H,h.paint.get("heatmap-intensity")),h.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,h.paint,m.transform.zoom,$)}x.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(x,b){const E=x.context,I=E.gl,z=b.heatmapFbo;if(!z)return;E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,z.colorAttachment.get()),E.activeTexture.set(I.TEXTURE1);let L=b.colorRampTexture;L||(L=b.colorRampTexture=new a.Texture(E,b.colorRamp,I.RGBA)),L.bind(I.LINEAR,I.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(E,I.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,x.colorModeForRenderPass(),a.CullFaceMode.disabled,((O,N,$,Q)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,b),b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)}(m,h))},line:function(m,n,h,_){if(m.renderPass!=="translucent")return;const x=h.paint.get("line-opacity"),b=h.paint.get("line-width");if(x.constantOr(1)===0||b.constantOr(1)===0)return;const E=m.depthModeForSublayer(0,a.DepthMode.ReadOnly),I=m.colorModeForRenderPass(),z=h.paint.get("line-dasharray"),L=z.constantOr(1),O=h.layout.get("line-cap"),N=h.paint.get("line-pattern"),$=N.constantOr(1),Q=h.paint.get("line-gradient"),H=h.getCrossfadeParameters(),J=$?"linePattern":"line",he=m.context,Y=he.gl,oe=(ne=>{const se=[];_l(ne)&&se.push("RENDER_LINE_DASH"),ne.paint.get("line-gradient")&&se.push("RENDER_LINE_GRADIENT");const de=ne.paint.get("line-pattern").constantOr(1),Me=ne.paint.get("line-opacity").constantOr(1)!==1;return!de&&Me&&se.push("RENDER_LINE_ALPHA_DISCARD"),se})(h);let ae=oe.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(ae=!1);for(const ne of _){const se=n.getTile(ne);if($&&!se.patternsLoaded())continue;const de=se.getBucket(h);if(!de)continue;m.prepareDrawTile(ne);const Me=de.programConfigurations.get(h.id),Fe=m.useProgram(J,Me,oe),ht=N.constantOr(null);if(ht&&se.imageAtlas){const Ge=se.imageAtlas,kt=Ge.patternPositions[ht.to.toString()],Ot=Ge.patternPositions[ht.from.toString()];kt&&Ot&&Me.setConstantPatternPositions(kt,Ot)}const et=z.constantOr(null),Ye=O.constantOr(null);if(!$&&et&&Ye&&se.lineAtlas){const Ge=se.lineAtlas,kt=Ge.getDash(et.to,Ye),Ot=Ge.getDash(et.from,Ye);kt&&Ot&&Me.setConstantPatternPositions(kt,Ot)}const Ue=m.terrain?ne.projMatrix:null,De=$?zo(m,se,h,H,Ue):Cd(m,se,h,H,Ue,de.lineClipsArray.length);if(Q){const Ge=de.gradients[h.id];let kt=Ge.texture;if(h.gradientVersion!==Ge.version){let Ot=256;if(h.stepInterpolant){const Ht=n.getSource().maxzoom,ut=ne.canonical.z===Ht?Math.ceil(1<<m.transform.maxZoom-ne.canonical.z):1;Ot=a.clamp(a.nextPowerOfTwo(de.maxLineLength/a.EXTENT*1024*ut),256,he.maxTextureSize)}Ge.gradient=a.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:Ge.gradient||void 0,clips:de.lineClipsArray}),Ge.texture?Ge.texture.update(Ge.gradient):Ge.texture=new a.Texture(he,Ge.gradient,Y.RGBA),Ge.version=h.gradientVersion,kt=Ge.texture}he.activeTexture.set(Y.TEXTURE1),kt.bind(h.stepInterpolant?Y.NEAREST:Y.LINEAR,Y.CLAMP_TO_EDGE)}L&&(he.activeTexture.set(Y.TEXTURE0),se.lineAtlasTexture.bind(Y.LINEAR,Y.REPEAT),Me.updatePaintBuffers(H)),$&&(he.activeTexture.set(Y.TEXTURE0),se.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Me.updatePaintBuffers(H)),m.prepareDrawProgram(he,Fe,ne.toUnwrapped());const Ke=Ge=>{Fe.draw(he,Y.TRIANGLES,E,Ge,I,a.CullFaceMode.disabled,De,h.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,h.paint,m.transform.zoom,Me,de.layoutVertexBuffer2)};if(ae){const Ge=m.stencilModeForClipping(ne).ref;Ge===0&&m.terrain&&he.clear({stencil:0});const kt={func:Y.EQUAL,mask:255};De.u_alpha_discard_threshold=.8,Ke(new a.StencilMode(kt,Ge,255,Y.KEEP,Y.KEEP,Y.INVERT)),De.u_alpha_discard_threshold=0,Ke(new a.StencilMode(kt,Ge,255,Y.KEEP,Y.KEEP,Y.KEEP))}else Ke(m.stencilModeForClipping(ne))}ae&&(m.resetStencilClippingMasks(),m.terrain&&he.clear({stencil:0}))},fill:function(m,n,h,_){const x=h.paint.get("fill-color"),b=h.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const E=m.colorModeForRenderPass(),I=h.paint.get("fill-pattern"),z=m.opaquePassEnabledForLayer()&&!I.constantOr(1)&&x.constantOr(a.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===z){const L=m.depthModeForSublayer(1,m.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);Dc(m,n,h,_,L,E,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){const L=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);Dc(m,n,h,_,L,E,!0)}},"fill-extrusion":function(m,n,h,_){const x=h.paint.get("fill-extrusion-opacity");if(x!==0&&m.renderPass==="translucent"){const b=new a.DepthMode(m.context.gl.LEQUAL,a.DepthMode.ReadWrite,m.depthRangeFor3D);if(x!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))vl(m,n,h,_,b,a.StencilMode.disabled,a.ColorMode.disabled),vl(m,n,h,_,b,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const E=m.colorModeForRenderPass();vl(m,n,h,_,b,a.StencilMode.disabled,E)}}},hillshade:function(m,n,h,_){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const x=m.context,b=m.depthModeForSublayer(0,a.DepthMode.ReadOnly),E=m.colorModeForRenderPass(),I=m.terrain&&m.terrain.renderingToTexture,[z,L]=m.renderPass!=="translucent"||I?[{},_]:m.stencilConfigForOverlap(_);for(const O of L){const N=n.getTile(O);if(N.needsHillshadePrepare&&m.renderPass==="offscreen")fl(m,N,h,b,a.StencilMode.disabled,E);else if(m.renderPass==="translucent"){const $=I&&m.terrain?m.terrain.stencilModeForRTTOverlap(O):z[O.overscaledZ];wc(m,O,N,h,b,$,E)}}x.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,n,h,_,x,b){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!_.length)return;const E=m.context,I=E.gl,z=n.getSource(),L=m.useProgram("raster"),O=m.colorModeForRenderPass(),N=m.terrain&&m.terrain.renderingToTexture,[$,Q]=z instanceof cs||N?[{},_]:m.stencilConfigForOverlap(_),H=Q[Q.length-1].overscaledZ,J=!m.options.moving;for(const he of Q){const Y=N?a.DepthMode.disabled:m.depthModeForSublayer(he.overscaledZ-H,h.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,I.LESS),oe=he.toUnwrapped(),ae=n.getTile(he);if(N&&(!ae||!ae.hasData()))continue;const ne=N?he.projMatrix:m.transform.calculateProjMatrix(oe,J),se=m.terrain&&N?m.terrain.stencilModeForRTTOverlap(he):$[he.overscaledZ],de=b?0:h.paint.get("raster-fade-duration");ae.registerFadeDuration(de);const Me=n.findLoadedParent(he,0),Fe=xd(ae,Me,n,m.transform,de);let ht,et;m.terrain&&m.terrain.prepareDrawTile(he);const Ye=h.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;E.activeTexture.set(I.TEXTURE0),ae.texture.bind(Ye,I.CLAMP_TO_EDGE),E.activeTexture.set(I.TEXTURE1),Me?(Me.texture.bind(Ye,I.CLAMP_TO_EDGE),ht=Math.pow(2,Me.tileID.overscaledZ-ae.tileID.overscaledZ),et=[ae.tileID.canonical.x*ht%1,ae.tileID.canonical.y*ht%1]):ae.texture.bind(Ye,I.CLAMP_TO_EDGE);const Ue=Sc(ne,et||[0,0],ht||1,Fe,h,z instanceof cs?z.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(E,L,oe),z instanceof cs)L.draw(E,I.TRIANGLES,Y,a.StencilMode.disabled,O,a.CullFaceMode.disabled,Ue,h.id,z.boundsBuffer,m.quadTriangleIndexBuffer,z.boundsSegments);else{const{tileBoundsBuffer:De,tileBoundsIndexBuffer:Ke,tileBoundsSegments:Ge}=m.getTileBoundsBuffers(ae);L.draw(E,I.TRIANGLES,Y,se,O,a.CullFaceMode.disabled,Ue,h.id,De,Ke,Ge)}}m.resetStencilClippingMasks()},background:function(m,n,h,_){const x=h.paint.get("background-color"),b=h.paint.get("background-opacity");if(b===0)return;const E=m.context,I=E.gl,z=m.transform,L=z.tileSize,O=h.paint.get("background-pattern");if(m.isPatternMissing(O))return;const N=!O&&x.a===1&&b===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==N)return;const $=a.StencilMode.disabled,Q=m.depthModeForSublayer(0,N==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),H=m.colorModeForRenderPass(),J=m.useProgram(O?"backgroundPattern":"background");let he,Y=_;Y||(he=m.getBackgroundTiles(),Y=Object.values(he).map(ae=>ae.tileID)),O&&(E.activeTexture.set(I.TEXTURE0),m.imageManager.bind(m.context));const oe=h.getCrossfadeParameters();for(const ae of Y){const ne=ae.toUnwrapped(),se=_?ae.projMatrix:m.transform.calculateProjMatrix(ne);m.prepareDrawTile(ae);const de=n?n.getTile(ae):he?he[ae.key]:new a.Tile(ae,L,z.zoom,m),Me=O?Ic(se,b,m,O,{tileID:ae,tileSize:L},oe):vi(se,b,x);m.prepareDrawProgram(E,J,ne);const{tileBoundsBuffer:Fe,tileBoundsIndexBuffer:ht,tileBoundsSegments:et}=m.getTileBoundsBuffers(de);J.draw(E,I.TRIANGLES,Q,$,H,a.CullFaceMode.disabled,Me,h.id,Fe,ht,et)}},sky:function(m,n,h){const _=m.transform,x=_.projection.name==="mercator"||_.projection.name==="globe"?1:a.smoothstep(7,8,_.zoom),b=h.paint.get("sky-opacity")*x;if(b===0)return;const E=m.context,I=h.paint.get("sky-type"),z=new a.DepthMode(E.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),L=m.frameCounter/1e3%1;I==="atmosphere"?m.renderPass==="offscreen"?h.needsSkyboxCapture(m)&&(function(O,N,$,Q){const H=O.context,J=H.gl;let he=N.skyboxFbo;if(!he){he=N.skyboxFbo=H.createFramebuffer(32,32,!1),N.skyboxGeometry=new Fc(H),N.skyboxTexture=H.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,N.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let ne=0;ne<6;++ne)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(he.framebuffer),H.viewport.set([0,0,32,32]);const Y=N.getCenter(O,!0),oe=O.useProgram("skyboxCapture"),ae=new Float64Array(16);a.identity(ae),a.rotateY(ae,ae,.5*-Math.PI),oo(H,N,oe,ae,Y,0),a.identity(ae),a.rotateY(ae,ae,.5*Math.PI),oo(H,N,oe,ae,Y,1),a.identity(ae),a.rotateX(ae,ae,.5*-Math.PI),oo(H,N,oe,ae,Y,2),a.identity(ae),a.rotateX(ae,ae,.5*Math.PI),oo(H,N,oe,ae,Y,3),a.identity(ae),oo(H,N,oe,ae,Y,4),a.identity(ae),a.rotateY(ae,ae,Math.PI),oo(H,N,oe,ae,Y,5),H.viewport.set([0,0,O.width,O.height])}(m,h),h.markSkyboxValid(m)):m.renderPass==="sky"&&function(O,N,$,Q,H){const J=O.context,he=J.gl,Y=O.transform,oe=O.useProgram("skybox");J.activeTexture.set(he.TEXTURE0),he.bindTexture(he.TEXTURE_CUBE_MAP,N.skyboxTexture);const ae=((ne,se,de,Me,Fe)=>({u_matrix:ne,u_sun_direction:se,u_cubemap:0,u_opacity:Me,u_temporal_offset:Fe}))(Y.skyboxMatrix,N.getCenter(O,!1),0,Q,H);O.prepareDrawProgram(J,oe),oe.draw(J,he.TRIANGLES,$,a.StencilMode.disabled,O.colorModeForRenderPass(),a.CullFaceMode.backCW,ae,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(m,h,z,b,L):I==="gradient"&&m.renderPass==="sky"&&function(O,N,$,Q,H){const J=O.context,he=J.gl,Y=O.transform,oe=O.useProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new Fc(J)),J.activeTexture.set(he.TEXTURE0);let ae=N.colorRampTexture;ae||(ae=N.colorRampTexture=new a.Texture(J,N.colorRamp,he.RGBA)),ae.bind(he.LINEAR,he.CLAMP_TO_EDGE);const ne=((se,de,Me,Fe,ht)=>({u_matrix:se,u_color_ramp:0,u_center_direction:de,u_radius:a.degToRad(Me),u_opacity:Fe,u_temporal_offset:ht}))(Y.skyboxMatrix,N.getCenter(O,!1),N.paint.get("sky-gradient-radius"),Q,H);O.prepareDrawProgram(J,oe),oe.draw(J,he.TRIANGLES,$,a.StencilMode.disabled,O.colorModeForRenderPass(),a.CullFaceMode.backCW,ne,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(m,h,z,b,L)},debug:function(m,n,h){for(let _=0;_<h.length;_++)Rc(m,n,h[_])},custom:function(m,n,h){const _=m.context,x=h.implementation;if(m.transform.projection.unsupportedLayers&&m.transform.projection.unsupportedLayers.includes("custom"))a.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(m.renderPass==="offscreen"){const b=x.prerender;b&&(m.setCustomLayerDefaults(),_.setColorMode(m.colorModeForRenderPass()),b.call(x,_.gl,m.transform.customLayerMatrix()),_.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),_.setColorMode(m.colorModeForRenderPass()),_.setStencilMode(a.StencilMode.disabled);const b=x.renderingMode==="3d"?new a.DepthMode(m.context.gl.LEQUAL,a.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,a.DepthMode.ReadOnly);_.setDepthMode(b),x.render(_.gl,m.transform.customLayerMatrix()),_.setDirty(),m.setBaseState(),_.bindFramebuffer.set(null)}}};class zd{constructor(n,h){this.context=new Gr(n),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ul,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,h){const _=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new so(this,n));const x=this._terrain;this.transform.elevation=_?x:null,x.update(n,this.transform,h)}_updateFog(n){const h=n.fog;if(!h||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,x]=h.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);const b=_+.78*(x-_);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,h){if(this.width=n*a.exported.devicePixelRatio,this.height=h*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const n=this.context,h=new a.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(a.EXTENT,0),h.emplaceBack(0,a.EXTENT),h.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(h,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const _=new a.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(a.EXTENT,0),_.emplaceBack(0,a.EXTENT),_.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=n.createVertexBuffer(_,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const x=new a.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(x,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const b=new a.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(a.EXTENT,0,a.EXTENT,0),b.emplaceBack(0,a.EXTENT,0,a.EXTENT),b.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(b,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const E=new a.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(E);const I=new a.StructArrayLayout1ui2;for(const L of[0,1,3,2,0])I.emplaceBack(L);this.debugIndexBuffer=n.createIndexBuffer(I),this.emptyTexture=new a.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA),this.identityMat=a.create();const z=this.context.gl;this.stencilClearMode=new a.StencilMode({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(a.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,h=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,h.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,ms(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,h,_){if(!h||this.currentStencilSource===h.id||!n.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const z of _)if(this._tileClippingMaskIDs[z.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=h.id;const x=this.context,b=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(a.ColorMode.disabled),x.setDepthMode(a.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of _){const z=h.getTile(I),L=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:N,tileBoundsSegments:$}=this.getTileBoundsBuffers(z);E.draw(x,b.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:b.ALWAYS,mask:0},L,255,b.KEEP,b.KEEP,b.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,ms(I.projMatrix),"$clipping",O,N,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,h=this.context.gl;return new a.StencilMode({func:h.NOTEQUAL,mask:255},n,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const h=this.context.gl;return new a.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(n){const h=this.context.gl,_=n.sort((E,I)=>I.overscaledZ-E.overscaledZ),x=_[_.length-1].overscaledZ,b=_[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let I=0;I<b;I++)E[I+x]=new a.StencilMode({func:h.GEQUAL,mask:255},I+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[E,_]}return[{[x]:a.StencilMode.disabled},_]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([n.CONSTANT_COLOR,n.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(n,h,_){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new a.DepthMode(_||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,h){this.style=n,this.options=h,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const _=this.style.order,x=this.style._sourceCaches;for(const L in x){const O=x[L];O.used&&O.prepare(this.context)}const b={},E={},I={};for(const L in x){const O=x[L];b[L]=O.getVisibleCoordinates(),E[L]=b[L].slice().reverse(),I[L]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<_.length;L++)if(this.style._layers[_[L]].is3D()){this.opaquePassCutoff=L;break}if(this.terrain&&(this.terrain.updateTileBinding(I),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const L of _){const O=this.style._layers[L],N=n._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const $=N?E[N.id]:void 0;(O.type==="custom"||O.isSky()||$&&$.length)&&this.renderLayer(this,N,O,$)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let z=a.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(z=this.style.fog.properties.get("color")),this.context.clear({color:h.showOverdrawInspector?a.Color.black:z,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[_[this.currentLayer]],O=n._getLayerSourceCache(L);if(L.isSky())continue;const N=O?E[O.id]:void 0;this._renderTileClippingMasks(L,O,N),this.renderLayer(this,O,L,N)}if(this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const L=this.style._layers[_[this.currentLayer]],O=n._getLayerSourceCache(L);L.isSky()&&this.renderLayer(this,O,L,O?E[O.id]:void 0)}for(this.transform.projection.name==="globe"&&function(L){const O=L.context,N=O.gl,$=L.transform,Q=new a.DepthMode(N.LEQUAL,a.DepthMode.ReadOnly,[0,1]),H=L.useProgram("globeAtmosphere"),J=$._camera.getWorldToCamera($.worldSize,1),he=$._camera.getCameraToClipPerspective($._fov,$.width/$.height,$._nearZ,$._farZ),Y=a.mul([],J,a.calculateGlobeMatrix($,$.worldSize)),oe=a.mul([],$.labelPlaneMatrix,he),ae=a.transformMat4([],[0,0,0],Y),ne=a.add([],ae,[$.worldSize/Math.PI/2,0,0]),se=a.transformMat4([],ae,oe),de=a.transformMat4([],ne,oe),Me=a.length(a.sub([],de,se)),Fe=1-a.globeToMercatorTransition($.zoom),ht={u_center:se,u_radius:Me,u_screen_size:[$.width,$.height],u_pixel_ratio:a.exported.devicePixelRatio,u_opacity:Fe,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};L.prepareDrawProgram(O,H);const et=L.globeSharedBuffers;et&&H.draw(O,N.TRIANGLES,Q,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,ht,"skybox",et.atmosphereVertexBuffer,et.atmosphereIndexBuffer,et.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const L=this.style._layers[_[this.currentLayer]],O=n._getLayerSourceCache(L);if(L.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(L)){if(L.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const N=O?(L.type==="symbol"?I:E)[O.id]:void 0;this._renderTileClippingMasks(L,O,O?b[O.id]:void 0),this.renderLayer(this,O,L,N),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let L=null;a.values(this.style._layers).forEach(O=>{const N=n._getLayerSourceCache(O);N&&!O.isHidden(this.transform.zoom)&&(!L||L.getSource().maxzoom<N.getSource().maxzoom)&&(L=N)}),L&&this.options.showTileBoundaries&&Tl.debug(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const O=L.transform.padding;tn(L,L.transform.height-(O.top||0),3,Pd),tn(L,O.bottom||0,3,E_),zc(L,O.left||0,3,bl),zc(L,L.transform.width-(O.right||0),3,wl);const N=L.transform.centerPoint;(function($,Q,H,J){Ro($,Q-1,H-10,2,20,J),Ro($,Q-10,H-1,20,2,J)})(L,N.x,L.transform.height-N.y,Dd)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,h,_,x){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(_.type)||Tl[_.type](n,h,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[n.id];_||(_=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}queryGpuTimers(n){const h={};for(const _ in n){const x=n[_],b=this.context.extTimerQuery,E=b.getQueryObjectEXT(x.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(x.query),h[_]=E}return h}translatePosMatrix(n,h,_,x,b){if(!_[0]&&!_[1])return n;const E=b?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(E){const L=Math.sin(E),O=Math.cos(E);_=[_[0]*O-_[1]*L,_[0]*L+_[1]*O]}const I=[b?_[0]:gt(h,_[0],this.transform.zoom),b?_[1]:gt(h,_[1],this.transform.zoom),0],z=new Float32Array(16);return a.translate(z,n,I),z}saveTileTexture(n){const h=this._tileTextures[n.size[0]];h?h.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const h=this._tileTextures[n];return h&&h.length>0?h.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const h=this.imageManager.getPattern(n.from.toString()),_=this.imageManager.getPattern(n.to.toString());return!h||!_}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,_=[];return this.terrain&&!this.terrain.renderingToTexture&&_.push("TERRAIN"),h&&!n&&h.getOpacity(this.transform.pitch)!==0&&_.push("FOG"),n&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(n,h,_){this.cache=this.cache||{};const x=_||[],b=this.currentGlobalDefines().concat(x),E=pl.cacheKey(n,b,h);return this.cache[E]||(this.cache[E]=new pl(this.context,n,uh[n],h,Id[n],b)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(n){this.terrain&&this.terrain.prepareDrawTile(n)}prepareDrawProgram(n,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const b=x.getOpacity(this.transform.pitch);b!==0&&h.setFogUniformValues(n,((E,I,z,L)=>{const O=I.properties.get("color"),N=E.frameCounter/1e3%1,$=[O.r/O.a,O.g/O.a,O.b/O.a,L];return{u_fog_matrix:z?E.transform.calculateFogTileMatrix(z):E.identityMat,u_fog_range:I.getFovAdjustedRange(E.transform._fov),u_fog_color:$,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:N}})(this,x,_,b))}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,h=n.createTexture();return n.bindTexture(n.TEXTURE_2D,h),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const x of _)h[x.key]=n[x.key]||new a.Tile(x,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class Lc{constructor(n=0,h=0,_=0,x=0){if(isNaN(n)||n<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=h,this.left=_,this.right=x}interpolate(n,h,_){return h.top!=null&&n.top!=null&&(this.top=a.number(n.top,h.top,_)),h.bottom!=null&&n.bottom!=null&&(this.bottom=a.number(n.bottom,h.bottom,_)),h.left!=null&&n.left!=null&&(this.left=a.number(n.left,h.left,_)),h.right!=null&&n.right!=null&&(this.right=a.number(n.right,h.right,_)),this}getCenter(n,h){const _=a.clamp((this.left+n-this.right)/2,0,n),x=a.clamp((this.top+h-this.bottom)/2,0,h);return new a.pointGeometry(_,x)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Lc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ao(m,n){const h=a.getColumn(m,3);a.fromQuat(m,n),a.setColumn(m,3,h)}function Rd(m,n){a.setColumn(m,3,[n[0],n[1],n[2],1])}function yh(m,n){const h=a.identity$1([]);return a.rotateZ$1(h,h,-n),a.rotateX$1(h,h,-m),h}function xh(m,n){const h=[m[0],m[1],0],_=[n[0],n[1],0];if(a.length(h)>=1e-15){const E=a.normalize([],h);a.scale$2(_,E,a.dot(_,E)),n[0]=_[0],n[1]=_[1]}const x=a.cross([],n,m);if(a.len(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return yh(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),b)}class Fd{constructor(n,h){this.position=n,this.orientation=h}get position(){return this._position}set position(n){this._position=this._renderWorldCopies?function(h){if(!h)return;const _=Array.isArray(h)?new a.MercatorCoordinate(h[0],h[1],h[2]):h;return _.x=a.wrap(_.x,0,1),_}(n):n}lookAtPoint(n,h){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(n)):0,x=this.position,b=a.MercatorCoordinate.fromLngLat(n,_),E=[b.x-x.x,b.y-x.y,b.z-x.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=xh(E,h)}setPitchBearing(n,h){this.orientation=yh(a.degToRad(n),a.degToRad(-h))}}class vh{constructor(n,h){this._transform=a.identity([]),this._orientation=a.identity$1([]),h&&(this._orientation=h,ao(this._transform,this._orientation)),n&&Rd(this._transform,n)}get mercatorPosition(){const n=this.position;return new a.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=a.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){Rd(this._transform,n)}get orientation(){return this._orientation}set orientation(n){this._orientation=n,ao(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,h){this._orientation=yh(n,h),ao(this._transform,this._orientation)}forward(){const n=a.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=a.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=a.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,h){const _=new Float64Array(16);return a.invert(_,this.getWorldToCamera(n,h)),_}getWorldToCameraPosition(n,h,_){const x=this.position;a.scale$2(x,x,-n);const b=new Float64Array(16);return a.fromScaling(b,[_,_,_]),a.translate(b,b,x),b[10]*=h,b}getWorldToCamera(n,h){const _=new Float64Array(16),x=new Float64Array(4),b=this.position;return a.conjugate(x,this._orientation),a.scale$2(b,b,-n),a.fromQuat(_,x),a.translate(_,_,b),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(n,h,_,x){const b=new Float64Array(16);return a.perspective(b,n,h,_,x),b}getDistanceToElevation(n){const h=n===0?0:a.mercatorZfromAltitude(n,this.position[1]),_=this.forward();return(h-this.position[2])/_[2]}clone(){return new vh([...this.position],[...this.orientation])}}function Ld(m,n){const h=Bc(m),_=function(b,E,I,z,L){const O=new a.LngLat(I.lng-180*Zn,I.lat),N=new a.LngLat(I.lng+180*Zn,I.lat),$=b.project(O.lng,O.lat),Q=b.project(N.lng,N.lat),H=-Math.atan2(Q.y-$.y,Q.x-$.x),J=a.MercatorCoordinate.fromLngLat(I);J.y=a.clamp(J.y,-.999975,.999975);const he=J.toLngLat(),Y=b.project(he.lng,he.lat),oe=a.MercatorCoordinate.fromLngLat(he);oe.x+=Zn;const ae=oe.toLngLat(),ne=b.project(ae.lng,ae.lat),se=wh(ne.x-Y.x,ne.y-Y.y,H),de=a.MercatorCoordinate.fromLngLat(he);de.y+=Zn;const Me=de.toLngLat(),Fe=b.project(Me.lng,Me.lat),ht=wh(Fe.x-Y.x,Fe.y-Y.y,H),et=Math.abs(se.x)/Math.abs(ht.y),Ye=a.identity([]);a.rotateZ(Ye,Ye,-H*(1-(L?0:z)));const Ue=a.identity([]);return a.scale(Ue,Ue,[1,1-(1-et)*z,1]),Ue[4]=-ht.x/ht.y*z,a.rotateZ(Ue,Ue,H),a.multiply$1(Ue,Ye,Ue),Ue}(m.projection,0,m.center,h,n),x=Oc(m);return a.scale(_,_,[x,x,1]),_}function Oc(m){const n=m.projection,h=Bc(m),_=bh(n,m.center),x=bh(n,a.LngLat.convert(n.center));return Math.pow(2,_*h+(1-h)*x)}function Bc(m){const n=m.projection.range;if(!n)return 0;const h=Math.max(m.width,m.height),_=Math.log(h/1024)/Math.LN2;return a.smoothstep(n[0]+_,n[1]+_,m.zoom)}const Zn=1/4e4;function bh(m,n){const h=a.clamp(n.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),_=new a.LngLat(n.lng-180*Zn,h),x=new a.LngLat(n.lng+180*Zn,h),b=m.project(_.lng,h),E=m.project(x.lng,h),I=a.MercatorCoordinate.fromLngLat(_),z=a.MercatorCoordinate.fromLngLat(x),L=E.x-b.x,O=E.y-b.y,N=z.x-I.x,$=z.y-I.y,Q=Math.sqrt((N*N+$*$)/(L*L+O*O));return Math.log(Q)/Math.LN2}function wh(m,n,h){const _=Math.cos(h),x=Math.sin(h);return{x:m*_-n*x,y:m*x+n*_}}class El{constructor(n,h,_,x,b){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=h||22,this._minPitch=_==null?0:_,this._maxPitch=x==null?60:x,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Lc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new vh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const n=new El(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.setProjection(this.getProjection()),n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n.tileSize=this.tileSize,n.setMaxBounds(this.getMaxBounds()),n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._cameraZoom=this._cameraZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,n?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(n){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),n&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(n){n==null&&(n={name:"mercator"}),this.projectionOptions=n;const h=this.projection?this.getProjection():void 0;return this.projection=a.getProjection(n),!F(h,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const h=-n*Math.PI/180;var _;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),function(x,b,E){var I=b[0],z=b[1],L=b[2],O=b[3],N=Math.sin(E),$=Math.cos(E);x[0]=I*$+L*N,x[1]=z*$+O*N,x[2]=I*-N+L*$,x[3]=z*-N+O*$}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const h=a.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(n){const h=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return n===-1?(this._cameraZoom=null,!1):(this._centerAltitude=n,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let x=0,b=0;for(let E=0;E<h.length;E++){const I=new a.pointGeometry(h[E][0]*this.width,_+h[E][1]*(this.height-_)),z=n.pointCoordinate(I);if(!z)continue;const L=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);x+=z[3]*L,b+=L}return b===0?NaN:x/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const n=this._cameraZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,x=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),E=Math.max(x-_,b);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let _;_=n.z<this._camera.position[2]?[h.x,h.y,h.z]:[n.x,n.y,n.z];const x=a.length(a.sub([],this._camera.position,_));return a.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let h=!1;if(n.orientation&&!a.exactEquals(n.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(n.orientation)),n.position){const _=[n.position.x,n.position.y,n.position.z];a.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,h=new Fd;return h.position=new a.MercatorCoordinate(n[0],n[1],n[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(n){if(!a.length$1(n))return!1;a.normalize$1(n,n);const h=a.transformQuat([],[0,0,-1],n),_=a.transformQuat([],[0,-1,0],n);if(_[2]<0)return!1;const x=xh(h,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(n){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;n[2]=a.clamp(n[2],x/_,x/h),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,h,_){this._unmodified=!1,this._edgeInsets.interpolate(n,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const h=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(n){const h=[new a.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const _=this.pointCoordinate(new a.pointGeometry(0,0)),x=this.pointCoordinate(new a.pointGeometry(this.width,0)),b=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new a.pointGeometry(0,this.height)),I=Math.floor(Math.min(_.x,x.x,b.x,E.x)),z=Math.floor(Math.max(_.x,x.x,b.x,E.x)),L=1;for(let O=I-L;O<=z+L;O++)O!==0&&h.push(new a.UnwrappedTileID(O,n))}return h}coveringTiles(n){let h=this.coveringZoomLevel(n);const _=h,x=this.elevation&&!n.isTerrainDEM,b=this.projection.name==="mercator";if(n.minzoom!==void 0&&h<n.minzoom)return[];n.maxzoom!==void 0&&h>n.maxzoom&&(h=n.maxzoom);const E=this.locationCoordinate(this.center),I=1<<h,z=[I*E.x,I*E.y,0],L=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,this.projection.name!=="globe"),O=this.pointCoordinate(this.getCameraPoint()),N=I*a.mercatorZfromAltitude(1,this.center.lat),$=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),Q=[I*O.x,I*O.y,$],H=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),J=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,he=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Y=n.isTerrainDEM?-he:this._elevation?this._elevation.getMinElevationBelowMSL():0,oe=this.projection.isReprojectedInTileSpace?Oc(this):1,ae=De=>{const Ge=new a.MercatorCoordinate(De.x+25e-6,De.y,De.z),kt=new a.MercatorCoordinate(De.x,De.y+25e-6,De.z),Ot=De.toLngLat(),Ht=Ge.toLngLat(),ut=kt.toLngLat(),zt=this.locationCoordinate(Ot),Vt=this.locationCoordinate(Ht),wi=this.locationCoordinate(ut),Pi=Math.hypot(Vt.x-zt.x,Vt.y-zt.y),jt=Math.hypot(wi.x-zt.x,wi.y-zt.y);return Math.sqrt(Pi*jt)*oe/25e-6},ne=De=>{const Ke=he,Ge=Y;return{aabb:a.tileAABB(this,I,0,0,0,De,Ge,Ke,this.projection),zoom:0,x:0,y:0,minZ:Ge,maxZ:Ke,wrap:De,fullyVisible:!1}},se=[];let de=[];const Me=h,Fe=n.reparseOverscaled?_:h,ht=De=>De*De,et=ht(($-this._centerAltitude)*N),Ye=De=>{if(!this._elevation||!De.tileID||!b)return;const Ke=this._elevation.getMinMaxForTile(De.tileID),Ge=De.aabb;Ke?(Ge.min[2]=Ke.min,Ge.max[2]=Ke.max,Ge.center[2]=(Ge.min[2]+Ge.max[2])/2):(De.shouldSplit=Ue(De),De.shouldSplit||(Ge.min[2]=Ge.max[2]=Ge.center[2]=this._centerAltitude))},Ue=De=>{if(De.zoom<J)return!0;if(De.zoom===Me)return!1;if(De.shouldSplit!=null)return De.shouldSplit;const Ke=De.aabb.distanceX(Q),Ge=De.aabb.distanceY(Q);let kt=et;x&&(kt=ht(De.aabb.distanceZ(Q)*N));let Ot=1;if(this.projection.isReprojectedInTileSpace&&_<=5){const ut=Math.pow(2,De.zoom),zt=ae(new a.MercatorCoordinate((De.x+.5)/ut,(De.y+.5)/ut));Ot=zt>.85?1:zt}const Ht=Ke*Ke+Ge*Ge+kt;return Ht<ht((1<<Me-De.zoom)*H*Ot*((ut,zt)=>{if(zt*ht(.707)<ut)return 1;const Vt=Math.sqrt(zt/ut);return Vt/(1.4144271570014144+(Math.pow(1.1,Vt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(kt,et),Ht))};if(this.renderWorldCopies)for(let De=1;De<=3;De++)se.push(ne(-De)),se.push(ne(De));for(se.push(ne(0));se.length>0;){const De=se.pop(),Ke=De.x,Ge=De.y;let kt=De.fullyVisible;if(!kt){const Ot=De.aabb.intersects(L);if(Ot===0)continue;kt=Ot===2}if(De.zoom!==Me&&Ue(De))for(let Ot=0;Ot<4;Ot++){const Ht=(Ke<<1)+Ot%2,ut=(Ge<<1)+(Ot>>1),zt={aabb:b?De.aabb.quadrant(Ot):a.tileAABB(this,I,De.zoom+1,Ht,ut,De.wrap,De.minZ,De.maxZ,this.projection),zoom:De.zoom+1,x:Ht,y:ut,wrap:De.wrap,fullyVisible:kt,tileID:void 0,shouldSplit:void 0,minZ:De.minZ,maxZ:De.maxZ};x&&(zt.tileID=new a.OverscaledTileID(De.zoom+1===Me?Fe:De.zoom+1,De.wrap,De.zoom+1,Ht,ut),Ye(zt)),se.push(zt)}else{const Ot=De.zoom===Me?Fe:De.zoom;if(n.minzoom&&n.minzoom>Ot)continue;const Ht=z[0]-(.5+Ke+(De.wrap<<De.zoom))*(1<<h-De.zoom),ut=z[1]-.5-Ge,zt=De.tileID?De.tileID:new a.OverscaledTileID(Ot,De.wrap,De.zoom,Ke,Ge);de.push({tileID:zt,distanceSq:Ht*Ht+ut*ut})}}if(this.fogCullDistSq){const De=this.fogCullDistSq,Ke=this.horizonLineFromTop();de=de.filter(Ge=>{const kt=[0,0,0,1],Ot=[a.EXTENT,a.EXTENT,0,1],Ht=this.calculateFogTileMatrix(Ge.tileID.toUnwrapped());a.transformMat4$1(kt,kt,Ht),a.transformMat4$1(Ot,Ot,Ht);const ut=a.getAABBPointSquareDist(kt,Ot);if(ut===0)return!0;let zt=!1;const Vt=this._elevation;if(Vt&&ut>De&&Ke!==0){const wi=this.calculateProjMatrix(Ge.tileID.toUnwrapped());let Pi;n.isTerrainDEM||(Pi=Vt.getMinMaxForTile(Ge.tileID)),Pi||(Pi={min:Y,max:he});const jt=a.furthestTileCorner(this.rotation),Jt=[jt[0]*a.EXTENT,jt[1]*a.EXTENT,Pi.max];a.transformMat4(Jt,Jt,wi),zt=(1-Jt[1])*this.height*.5<Ke}return ut<De||zt})}return de.sort((De,Ke)=>De.distanceSq-Ke.distanceSq).map(De=>De.tileID)}resize(n,h){this.width=n,this.height=h,this.pixelsToGLUnits=[2/n,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const h=a.clamp(n.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),_=this.projection.project(n.lng,h);return new a.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,h){const _=this.pointCoordinate(h),x=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(n);this.setLocation(new a.MercatorCoordinate(b.x-(_.x-x.x),b.y-(_.y-x.y)))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this._coordinatePoint(this.locationCoordinate(n),!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,h){const _=h?a.mercatorZfromAltitude(h,n.lat):void 0,x=this.projection.project(n.lng,n.lat);return new a.MercatorCoordinate(x.x,x.y,_)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,h){const _=h!=null?h:this._centerAltitude,x=[n.x,n.y,0,1],b=[n.x,n.y,1,1];a.transformMat4$1(x,x,this.pixelMatrixInverse),a.transformMat4$1(b,b,this.pixelMatrixInverse);const E=b[3];a.scale$1(x,x,1/x[3]),a.scale$1(b,b,1/E);const I=x[2],z=b[2];return{p0:x,p1:b,t:I===z?0:(_-I)/(z-I)}}screenPointToMercatorRay(n){const h=[n.x,n.y,0,1],_=[n.x,n.y,1,1];return a.transformMat4$1(h,h,this.pixelMatrixInverse),a.transformMat4$1(_,_,this.pixelMatrixInverse),a.scale$1(h,h,1/h[3]),a.scale$1(_,_,1/_[3]),h[2]=a.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=a.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,a.scale$1(h,h,1/this.worldSize),a.scale$1(_,_,1/this.worldSize),new a.Ray([h[0],h[1],h[2]],a.normalize([],a.sub([],_,h)))}rayIntersectionCoordinate(n){const{p0:h,p1:_,t:x}=n,b=a.mercatorZfromAltitude(h[2],this._center.lat),E=a.mercatorZfromAltitude(_[2],this._center.lat);return new a.MercatorCoordinate(a.number(h[0],_[0],x)/this.worldSize,a.number(h[1],_[1],x)/this.worldSize,a.number(b,E,x))}pointCoordinate(n,h=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(n.x,n.y,h)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);const h=this.elevation;let _=this.elevation.pointCoordinate(n);if(_)return new a.MercatorCoordinate(_[0],_[1],_[2]);let x=0,b=this.horizonLineFromTop();if(n.y>b)return this.pointCoordinate(n);const E=.02*b,I=n.clone();for(let z=0;z<10&&b-x>E;z++){I.y=a.number(x,b,.66);const L=h.pointCoordinate(I);L?(b=I.y,_=L):x=I.y}return _?new a.MercatorCoordinate(_[0],_[1],_[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){if(this.elevation)return!this.elevation.pointCoordinate(n);{const h=this.horizonLineFromTop();return n.y<h}}_coordinatePoint(n,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,x=[n.x*this.worldSize,n.y*this.worldSize,_+n.toAltitude(),1];return a.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new a.pointGeometry(x[0]/x[3],x[1]/x[3]):new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(n,h){const _=new a.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),x=new a.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new a.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new a.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let I=this.pointCoordinate(_,n),z=this.pointCoordinate(x,n);const L=this.pointCoordinate(b,h),O=this.pointCoordinate(E,h),N=($,Q)=>(Q.y-$.y)/(Q.x-$.x);return I.y>1&&z.y>=0?I=new a.MercatorCoordinate((1-O.y)/N(O,I)+O.x,1):I.y<0&&z.y<=1&&(I=new a.MercatorCoordinate(-O.y/N(O,I)+O.x,0)),z.y>1&&I.y>=0?z=new a.MercatorCoordinate((1-L.y)/N(L,z)+L.x,1):z.y<0&&I.y<=1&&(z=new a.MercatorCoordinate(-L.y/N(L,z)+L.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(I)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(L))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length)return this._getBounds(0,0);const h=n.visibleDemTiles.reduce((_,x)=>{if(x.dem){const b=x.dem.tree;_.min=Math.min(_.min,b.minimums[0]),_.max=Math.max(_.max,b.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*n.exaggeration(),h.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return n?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,h){return this.projection.createTileTransform(this,h).createTileMatrix(n)}calculateDistanceTileData(n){const h=n.key,_=this._distanceTileDataCache;if(_[h])return _[h];const x=n.canonical,b=1/this.height,E=this.cameraWorldSize/this.zoomScale(x.z),I=(x.x+Math.pow(2,x.z)*n.wrap)*E,z=x.y*E,L=this.point,O=this.angle,N=Math.sin(-O),$=-Math.cos(-O);return _[h]={bearing:[N,$],center:[(L.x-I)*b,(L.y-z)*b],scale:E/a.EXTENT*b},_[h]}calculateFogTileMatrix(n){const h=n.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const x=this.calculatePosMatrix(n,this.cameraWorldSize);return a.multiply$1(x,this.worldToFogMatrix,x),_[h]=new Float32Array(x),_[h]}calculateProjMatrix(n,h=!1){const _=n.key,x=h?this._alignedProjMatrixCache:this._projMatrixCache;if(x[_])return x[_];const b=this.calculatePosMatrix(n,this.worldSize);return a.multiply$1(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,b),x[_]=new Float32Array(b),x[_]}calculatePixelsToTileUnitsMatrix(n){const h=n.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const x=function(b,E){const{scale:I}=b.tileTransform,z=I*a.EXTENT/(b.tileSize*Math.pow(2,E.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return L=new Float32Array(4),$=(O=E.inverseAdjustmentMatrix)[1],Q=O[2],H=O[3],he=(N=[z,z])[1],L[0]=O[0]*(J=N[0]),L[1]=$*J,L[2]=Q*he,L[3]=H*he,L;var L,O,N,$,Q,H,J,he}(n,this);return _[h]=x,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const h=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),x=this._camera.forward(),b=a.mercatorZfromAltitude(1,this._center.lat);_[2]/=b,x[2]/=b,a.normalize(x,x);const E=n.raycast(_,x,n.exaggeration());if(E){const I=a.scaleAndAdd([],_,x,E),z=new a.MercatorCoordinate(I[0],I[1],a.mercatorZfromAltitude(I[2],a.latFromMercatorY(I[1]))),L=(z.z+a.length([z.x-_[0],z.y-_[1],z.z-_[2]*b]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(L),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const h=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),x=n.getAtPointOrZero(new a.MercatorCoordinate(..._)),b=this._minimumHeightOverTerrain()*Math.cos(a.degToRad(this._maxPitch)),E=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*x;if(E<b){const I=this.locationCoordinate(this._center,this._centerAltitude),z=[I.x-_[0],I.y-_[1],I.z-_[2]],L=a.length(z);z[2]-=(b-E)/this._projectionScaler;const O=a.length(z);if(O===0)return;a.scale$2(z,z,L/O*this._projectionScaler),this._camera.position=[I.x-z[0],I.y-z[1],I.z*this._projectionScaler-z[2]],this._camera.orientation=xh(z,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const N=this.center;return N.lat=a.clamp(N.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(N.lng=a.clamp(N.lng,this.minLng,this.maxLng)),this.center=N,void(this._constraining=!1)}const n=this._unmodified,{x:h,y:_}=this.point;let x=0,b=h,E=_;const I=this.width/2,z=this.height/2,L=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(_-z<L&&(E=L+z),_+z>O&&(E=O-z),O-L<this.height&&(x=Math.max(x,this.height/(O-L)),E=(O+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const N=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,Q=this.worldSize/2-(N+$)/2;b=(h+Q+this.worldSize)%this.worldSize-Q,b-I<N&&(b=N+I),b+I>$&&(b=$-I),$-N<this.width&&(x=Math.max(x,this.width/($-N)),b=($+N)/2)}b===h&&E===_||(this.center=this.unproject(new a.pointGeometry(b,E))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCameraAltitude(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this._fov/2,h=this.centerOffset,_=this.pixelsPerMeter;this._projectionScaler=_/(a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(n)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?_:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-h.x/this.width,b[9]=2*h.y/this.height;let E=a.mul([],b,x);if(this.projection.isReprojectedInTileSpace){const ne=this.locationCoordinate(this.center),se=a.identity([]);a.translate(se,se,[ne.x*this.worldSize,ne.y*this.worldSize,0]),a.multiply$1(se,se,Ld(this)),a.translate(se,se,[-ne.x*this.worldSize,-ne.y*this.worldSize,0]),a.multiply$1(E,E,se),this.inverseAdjustmentMatrix=function(de){const Me=Ld(de,!0);return k([],[Me[0],Me[1],Me[4],Me[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],E,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=E,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const I=new Float32Array(16);a.identity(I),a.scale(I,I,[1,-1,1]),a.rotateX(I,I,this._pitch),a.rotateZ(I,I,this.angle);const z=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),L=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-h.x/this.width,z[9]=2*(h.y+L)/this.height,this.skyboxMatrix=a.multiply$1(I,z,I);const O=this.point,N=O.x,$=O.y,Q=this.width%2/2,H=this.height%2/2,J=Math.cos(this.angle),he=Math.sin(this.angle),Y=N-Math.round(N)+J*Q+he*H,oe=$-Math.round($)+J*H+he*Q,ae=new Float64Array(E);if(a.translate(ae,ae,[Y>.5?Y-1:Y,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=ae,E=a.create(),a.scale(E,E,[this.width/2,-this.height/2,1]),a.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=a.create(),a.scale(E,E,[1,-1,1]),a.translate(E,E,[-1,-1,0]),a.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=a.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},E=a.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");this.pixelMatrixInverse=E,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,h=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height,b=[n,n,h];a.scale$2(b,b,x),a.scale$2(_,_,-1),a.multiply$2(_,_,b);const E=a.create();a.translate(E,E,_),a.scale(E,E,b),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,h,x)}_computeCameraPosition(n){const h=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,b=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*h-n/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*b,x.y/this.worldSize-_[1]*b,n/this.worldSize*this._centerAltitude-_[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=n[2];let x=1;_>0&&(x=Math.min((h-this._camera.position[2])/_,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,n,x),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),b=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),I=Math.max((n[2]-b)/Math.cos(_),E),z=this._zoomFromMercatorZ(I);a.scaleAndAdd(n,n,h,I),this._pitch=a.clamp(_,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(x,-Math.PI,Math.PI),this._setZoom(a.clamp(z,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new a.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(n,h){const _=Math.min(n.x,h.x),x=Math.max(n.x,h.x),b=Math.min(n.y,h.y),E=Math.max(n.y,h.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new a.pointGeometry(_,b),new a.pointGeometry(x,E),new a.pointGeometry(_,E),new a.pointGeometry(x,b)],z=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const O of I){const N=this.pointRayIntersection(O);if(N.t<0)return!0;const $=this.rayIntersectionCoordinate(N);if($.x<z||$.y<0||$.x>L||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.pointGeometry(0,0),new a.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,h){const _=a.length(a.sub([],this._camera.position,n)),x=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(x)}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,n))}}function lo(m,n){let h=!1,_=null;const x=()=>{_=null,h&&(m(),_=setTimeout(x,n),h=!1)};return()=>(h=!0,_||x(),_)}class Od{constructor(n){this._hashName=n&&encodeURIComponent(n),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=lo(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,a.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return a.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(n){const h=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,x),E=Math.round(h.lng*b)/b,I=Math.round(h.lat*b)/b,z=this._map.getBearing(),L=this._map.getPitch();let O="";if(O+=n?`/${E}/${I}/${_}`:`${_}/${I}/${E}`,(z||L)&&(O+="/"+Math.round(10*z)/10),L&&(O+=`/${Math.round(L)}`),this._hashName){const N=this._hashName;let $=!1;const Q=a.window.location.hash.slice(1).split("&").map(H=>{const J=H.split("=")[0];return J===N?($=!0,`${J}=${O}`):H}).filter(H=>H);return $||Q.push(`${N}=${O}`),`#${Q.join("&")}`}return`#${O}`}_getCurrentHash(){const n=a.window.location.hash.replace("#","");if(this._hashName){let h;return n.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._getCurrentHash();if(n.length>=3&&!n.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:h,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,n)}}const Fs={linearity:.3,easing:a.bezier(0,0,.3,1)},ha=a.extend({deceleration:2500,maxSpeed:1400},Fs),Bd=a.extend({deceleration:20,maxSpeed:1400},Fs),Th=a.extend({deceleration:1e3,maxSpeed:360},Fs),_i=a.extend({deceleration:1e3,maxSpeed:90},Fs);class Uc{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,h=a.exported.now();for(;n.length>0&&h-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){const b=Sl(h.pan.mag(),_,a.extend({},ha,n||{}));x.offset=h.pan.mult(b.amount/h.pan.mag()),x.center=this._map.transform.center,Nc(x,b)}if(h.zoom){const b=Sl(h.zoom,_,Bd);x.zoom=this._map.transform.zoom+b.amount,Nc(x,b)}if(h.bearing){const b=Sl(h.bearing,_,Th);x.bearing=this._map.transform.bearing+a.clamp(b.amount,-179,179),Nc(x,b)}if(h.pitch){const b=Sl(h.pitch,_,_i);x.pitch=this._map.transform.pitch+b.amount,Nc(x,b)}if(x.zoom||x.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),a.extend(x,{noMoveStart:!0})}}function Nc(m,n){(!m.duration||m.duration<n.duration)&&(m.duration=n.duration,m.easing=n.easing)}function Sl(m,n,h){const{maxSpeed:_,linearity:x,deceleration:b}=h,E=a.clamp(m*x/(n/1e3),-_,_),I=Math.abs(E)/(b*x);return{easing:h.easing,duration:1e3*I,amount:E*(I/2)}}class Ir extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,h,_,x={}){const b=R.mousePos(h.getCanvasContainer(),_),E=h.unproject(b);super(n,a.extend({point:b,lngLat:E,originalEvent:_},x)),this._defaultPrevented=!1,this.target=h}}class jc extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,h,_){const x=n==="touchend"?_.changedTouches:_.touches,b=R.touchPos(h.getCanvasContainer(),x),E=b.map(z=>h.unproject(z)),I=b.reduce((z,L,O,N)=>z.add(L.div(N.length)),new a.pointGeometry(0,0));super(n,{points:b,point:I,lngLats:E,lngLat:h.unproject(I),originalEvent:_}),this._defaultPrevented=!1}}class S_ extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,h,_){super(n,{originalEvent:_}),this._defaultPrevented=!1}}class Ud{constructor(n,h){this._map=n,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new S_(n.type,this._map,n))}mousedown(n,h){return this._mousedownPos=h,this._firePreventable(new Ir(n.type,this._map,n))}mouseup(n){this._map.fire(new Ir(n.type,this._map,n))}preclick(n){const h=a.extend({},n);h.type="preclick",this._map.fire(new Ir(h.type,this._map,h))}click(n,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Ir(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Ir(n.type,this._map,n))}mouseover(n){this._map.fire(new Ir(n.type,this._map,n))}mouseout(n){this._map.fire(new Ir(n.type,this._map,n))}touchstart(n){return this._firePreventable(new jc(n.type,this._map,n))}touchmove(n){this._map.fire(new jc(n.type,this._map,n))}touchend(n){this._map.fire(new jc(n.type,this._map,n))}touchcancel(n){this._map.fire(new jc(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class A_{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(n){this._map.fire(new Ir(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ir("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Ir(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eh{constructor(n,h){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,h){this.isEnabled()&&n.shiftKey&&n.button===0&&(R.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(n,h){if(!this._active)return;const _=h;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=_,this._box||(this._box=R.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const b=Math.min(x.x,_.x),E=Math.max(x.x,_.x),I=Math.min(x.y,_.y),z=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${I}px)`,this._box.style.width=E-b+"px",this._box.style.height=z-I+"px")})}mouseupWindow(n,h){if(!this._active||n.button!==0)return;const _=this._startPos,x=h;if(this.reset(),R.suppressClick(),_.x!==x.x||_.y!==x.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,h){return this._map.fire(new a.Event(n,{originalEvent:h}))}}function fa(m,n){const h={};for(let _=0;_<m.length;_++)h[m[_].identifier]=n[_];return h}class Al{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const b=new a.pointGeometry(0,0);for(const E of x)b._add(E);return b.div(x.length)}(h),this.touches=fa(_,h)))}touchmove(n,h,_){if(this.aborted||!this.centroid)return;const x=fa(_,h);for(const b in this.touches){const E=this.touches[b],I=x[b];(!I||I.dist(E)>30)&&(this.aborted=!0)}}touchend(n,h,_){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Cl{constructor(n){this.singleTap=new Al(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,h,_){this.singleTap.touchstart(n,h,_)}touchmove(n,h,_){this.singleTap.touchmove(n,h,_)}touchend(n,h,_){const x=this.singleTap.touchend(n,h,_);if(x){const b=n.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(x)<30;if(b&&E||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Sh{constructor(){this._zoomIn=new Cl({numTouches:1,numTaps:2}),this._zoomOut=new Cl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,h,_){this._zoomIn.touchstart(n,h,_),this._zoomOut.touchstart(n,h,_)}touchmove(n,h,_){this._zoomIn.touchmove(n,h,_),this._zoomOut.touchmove(n,h,_)}touchend(n,h,_){const x=this._zoomIn.touchend(n,h,_),b=this._zoomOut.touchend(n,h,_);return x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Nd={0:1,2:2};class da{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(n,h){return!1}_move(n,h){return{}}mousedown(n,h){if(this._lastPoint)return;const _=R.mouseButton(n);this._correctButton(n,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(n,h){const _=this._lastPoint;if(_){if(n.preventDefault(),function(x,b){const E=Nd[b];return x.buttons===void 0||(x.buttons&E)!==E}(n,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}}mouseupWindow(n){this._lastPoint&&R.mouseButton(n)===this._eventButton&&(this._moved&&R.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vc extends da{mousedown(n,h){super.mousedown(n,h),this._lastPoint&&(this._active=!0)}_correctButton(n,h){return h===0&&!n.ctrlKey}_move(n,h){return{around:h,panDelta:h.sub(n)}}}class Cn extends da{_correctButton(n,h){return h===0&&n.ctrlKey||h===2}_move(n,h){const _=.8*(h.x-n.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(n){n.preventDefault()}}class Ah extends da{_correctButton(n,h){return h===0&&n.ctrlKey||h===2}_move(n,h){const _=-.5*(h.y-n.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(n){n.preventDefault()}}class jd{constructor(n,h){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(n,h,_){return this._calculateTransform(n,h,_)}touchmove(n,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.preventDefault(),this._calculateTransform(n,h,_)}}touchend(n,h,_){this._calculateTransform(n,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,h,_){_.length>0&&(this._active=!0);const x=fa(_,h),b=new a.pointGeometry(0,0),E=new a.pointGeometry(0,0);let I=0;for(const L in x){const O=x[L],N=this._touches[L];N&&(b._add(O),E._add(O.sub(N)),I++,x[L]=O)}if(this._touches=x,I<this._minTouches||!E.mag())return;const z=E.div(I);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=R.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class $c{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(n){}_move(n,h,_){return{}}touchstart(n,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(n,h,_){if(!this._firstTwoTouches)return;n.preventDefault();const[x,b]=this._firstTwoTouches,E=Ls(_,h,x),I=Ls(_,h,b);if(!E||!I)return;const z=this._aroundCenter?null:E.add(I).div(2);return this._move([E,I],z,n)}touchend(n,h,_){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,E=Ls(_,h,x),I=Ls(_,h,b);E&&I||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ls(m,n,h){for(let _=0;_<m.length;_++)if(m[_].identifier===h)return n[_]}function Ch(m,n){return Math.log(m/n)/Math.LN2}class Gc extends $c{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,h){const _=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Ch(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ch(this._distance,_),pinchAround:h}}}function qc(m,n){return 180*m.angleWith(n)/Math.PI}class Zc extends $c{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,h){const _=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:qc(this._vector,_),pinchAround:h}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const h=25/(Math.PI*this._minDiameter)*360,_=qc(n,this._startVector);return Math.abs(_)<h}}function Wc(m){return Math.abs(m.y)>Math.abs(m.x)}class Vd extends $c{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(n){this._lastPoints=n,Wc(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,h,_){const x=n[0].sub(this._lastPoints[0]),b=n[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&_.touches.length<3)&&(this._valid=this.gestureBeginsVertically(x,b,_.timeStamp),this._valid))return this._lastPoints=n,this._active=!0,{pitchDelta:(x.y+b.y)/2*-.5}}gestureBeginsVertically(n,h,_){if(this._valid!==void 0)return this._valid;const x=n.mag()>=2,b=h.mag()>=2;if(!x&&!b)return;if(!x||!b)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const E=n.y>0==h.y>0;return Wc(n)&&Wc(h)&&E}}const pa={panStep:100,bearingStep:15,pitchStep:10};class C_{constructor(){const n=pa;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let h=0,_=0,x=0,b=0,E=0;switch(n.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:n.shiftKey?_=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?_=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?x=1:(n.preventDefault(),E=-1);break;case 40:n.shiftKey?x=-1:(n.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:I=>{const z=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:I_,zoom:h?Math.round(z)+h*(n.shiftKey?2:1):z,bearing:I.getBearing()+_*this._bearingStep,pitch:I.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:I.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function I_(m){return m*(2-m)}const Ih=4.000244140625;class Hc{constructor(n,h){this._map=n,this._el=n.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=n.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const _=a.exported.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,h!==0&&h%Ih==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),n.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=n,this._delta-=h,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=R.mousePos(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,h=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Ih?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&L!==0&&(L=1/L);const O=h(),N=Math.pow(2,O),$=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom($*L))),this._type==="wheel"&&(this._startZoom=h(),this._easing=this._smoothOutEasing(200)),this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:h(),x=this._startZoom,b=this._easing;let E,I=!1;if(this._type==="wheel"&&x&&b){const z=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),L=b(z);E=a.number(x,_,L),z<1?this._frameId||(this._frameId=!0):I=!0}else E=_,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:E-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let h=a.ease;if(this._prevEase){const _=this._prevEase,x=(a.exported.now()-_.start)/_.duration,b=_.easing(x+.01)-_.easing(x),E=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-E*E);h=a.bezier(E,I,.25,1)}return this._prevEase={start:a.exported.now(),duration:n,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=R.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!a.window.document.fullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Mh{constructor(n,h){this._clickZoom=n,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $d{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,h){return n.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(n.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gd{constructor(){this._tap=new Cl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(n,h,_){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(n,h,_))}touchmove(n,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=h[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,h,_)}touchend(n,h,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(n,h,_)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xc{constructor(n,h,_){this._el=n,this._mousePan=h,this._touchPan=_}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class kh{constructor(n,h,_){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class qd{constructor(n,h,_,x){this._el=n,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Il=m=>m.zoom||m.drag||m.pitch||m.rotate;class Zd extends a.Event{}class Wd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,h){const _=a.sub([],h,n);this.radius=a.length(_[2]<0?a.div([],_,this.constants):[_[0],_[1],0])}projectRay(n){a.div(n,n,this.constants),a.normalize(n,n),a.mul$1(n,n,this.constants);const h=a.scale$2([],n,this.radius);if(h[2]>0){const _=a.scale$2([],[0,0,1],a.dot(h,[0,0,1])),x=a.scale$2([],a.normalize([],[h[0],h[1],0]),this.radius),b=a.add([],h,a.scale$2([],a.sub([],a.add([],x,_),h),2));h[0]=b[0],h[1]=b[1]}return h}}function Ml(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class ma{constructor(n,h){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Uc(n),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),a.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[x,b,E]of this._listeners)x.addEventListener(b,x===a.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[n,h,_]of this._listeners)n.removeEventListener(h,n===a.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(n){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new Ud(h,n));const x=h.boxZoom=new Eh(h,n);this._add("boxZoom",x);const b=new Sh,E=new $d;h.doubleClickZoom=new Mh(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const I=new Gd;this._add("tapDragZoom",I);const z=h.touchPitch=new Vd(h);this._add("touchPitch",z);const L=new Cn(n),O=new Ah(n);h.dragRotate=new kh(n,L,O),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const N=new Vc(n),$=new jd(h,n);h.dragPan=new Xc(_,N,$),this._add("mousePan",N),this._add("touchPan",$,["touchZoom","touchRotate"]);const Q=new Zc,H=new Gc;h.touchZoomRotate=new qd(_,H,Q,I),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new A_(h));const J=h.scrollZoom=new Hc(h,this);this._add("scrollZoom",J,["mousePan"]);const he=h.keyboard=new C_;this._add("keyboard",he);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[Y]&&h[Y].enable(n[Y])}_add(n,h,_){this._handlers.push({handlerName:n,handler:h,allowed:_}),this._handlersById[n]=h}stop(n){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Il(this._eventsInProgress))||this.isZooming()}_blockedByActive(n,h,_){for(const x in n)if(x!==_&&(!h||h.indexOf(x)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const h=[];for(const _ of n)this._el.contains(_.target)&&h.push(_);return h}handleEvent(n,h){this._updatingCamera=!0;const _=n.type==="renderFrame",x=_?void 0:n,b={needsRenderFrame:!1},E={},I={},z=n.touches?this._getMapTouches(n.touches):void 0,L=z?R.touchPos(this._el,z):_?void 0:R.mousePos(this._el,n);for(const{handlerName:$,handler:Q,allowed:H}of this._handlers){if(!Q.isEnabled())continue;let J;this._blockedByActive(I,H,$)?Q.reset():Q[h||n.type]&&(J=Q[h||n.type](n,L,z),this.mergeHandlerResult(b,E,J,$,x),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||Q.isActive())&&(I[$]=Q)}const O={};for(const $ in this._previousActiveHandlers)I[$]||(O[$]=x);this._previousActiveHandlers=I,(Object.keys(O).length||Ml(b))&&(this._changes.push([b,E,O]),this._triggerRenderFrame()),(Object.keys(I).length||Ml(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=b;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(n,h,_,x,b){if(!_)return;a.extend(n,_);const E={handlerName:x,originalEvent:_.originalEvent||b};_.zoomDelta!==void 0&&(h.zoom=E),_.panDelta!==void 0&&(h.drag=E),_.pitchDelta!==void 0&&(h.pitch=E),_.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const n={},h={},_={};for(const[x,b,E]of this._changes)x.panDelta&&(n.panDelta=(n.panDelta||new a.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(n.around=x.around),x.aroundCoord!==void 0&&(n.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(n.pinchAround=x.pinchAround),x.noInertia&&(n.noInertia=x.noInertia),a.extend(h,b),a.extend(_,E);this._updateMapTransform(n,h,_),this._changes=[]}_updateMapTransform(n,h,_){const x=this._map,b=x.transform,E=oe=>[oe.x,oe.y,oe.z];if((oe=>{const ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!Ml(n)){const oe=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",oe!==b.zoom&&this._map._update(!0)}if(!Ml(n))return this._fireEvents(h,_,!0);let{panDelta:I,zoomDelta:z,bearingDelta:L,pitchDelta:O,around:N,aroundCoord:$,pinchAround:Q}=n;Q!==void 0&&(N=Q),(oe=>h.drag&&!this._eventsInProgress.drag)()&&N&&(this._dragOrigin=E(b.pointCoordinate3D(N)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),N=N||x.transform.centerPoint,L&&(b.bearing+=L),O&&(b.pitch+=O),b._updateCameraState();const H=[0,0,0];if(I){const oe=b.pointCoordinate(N),ae=b.pointCoordinate(N.sub(I));oe&&ae&&(H[0]=ae.x-oe.x,H[1]=ae.y-oe.y)}const J=b.zoom,he=[0,0,0];if(z){const oe=E($||b.pointCoordinate3D(N)),ae={dir:a.normalize([],a.sub([],oe,b._camera.position))};if(ae.dir[2]<0){const ne=b.zoomDeltaToMovement(oe,z);a.scale$2(he,ae.dir,ne)}}const Y=a.add(H,H,he);b._translateCameraConstrained(Y),z&&Math.abs(b.zoom-J)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(h,_,!0)}_fireEvents(n,h,_){const x=Il(this._eventsInProgress),b=Il(n),E={};for(const O in n){const{originalEvent:N}=n[O];this._eventsInProgress[O]||(E[`${O}start`]=N),this._eventsInProgress[O]=n[O]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const O in E)this._fireEvent(O,E[O]);b&&this._fireEvent("move",b.originalEvent);for(const O in n){const{originalEvent:N}=n[O];this._fireEvent(O,N)}const I={};let z;for(const O in this._eventsInProgress){const{handlerName:N,originalEvent:$}=this._eventsInProgress[O];this._handlersById[N].isActive()||(delete this._eventsInProgress[O],z=h[N]||$,I[`${O}end`]=z)}for(const O in I)this._fireEvent(O,I[O]);const L=Il(this._eventsInProgress);if(_&&(x||b)&&!L){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;O?(N(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:z})):(this._map.fire(new a.Event("moveend",{originalEvent:z})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,h){this._map.fire(new a.Event(n,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new Zd("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ph="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Hd extends a.Evented{constructor(n,h){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=h.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,h){return this.jumpTo({center:n},h)}panBy(n,h,_){return n=a.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,a.extend({offset:n},h),_)}panTo(n,h,_){return this.easeTo(a.extend({center:n},h),_)}getZoom(){return this.transform.zoom}setZoom(n,h){return this.jumpTo({zoom:n},h),this}zoomTo(n,h,_){return this.easeTo(a.extend({zoom:n},h),_)}zoomIn(n,h){return this.zoomTo(this.getZoom()+1,n,h),this}zoomOut(n,h){return this.zoomTo(this.getZoom()-1,n,h),this}getBearing(){return this.transform.bearing}setBearing(n,h){return this.jumpTo({bearing:n},h),this}getPadding(){return this.transform.padding}setPadding(n,h){return this.jumpTo({padding:n},h),this}rotateTo(n,h,_){return this.easeTo(a.extend({bearing:n},h),_)}resetNorth(n,h){return this.rotateTo(0,a.extend({duration:1e3},n),h),this}resetNorthPitch(n,h){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},n),h),this}snapToNorth(n,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,h):this}getPitch(){return this.transform.pitch}setPitch(n,h){return this.jumpTo({pitch:n},h),this}cameraForBounds(n,h){n=a.LngLatBounds.convert(n);const _=h&&h.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),_,h)}_extendCameraOptions(n){const h={top:0,bottom:0,right:0,left:0};if(typeof(n=a.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const _=n.padding;n.padding={top:_,bottom:_,right:_,left:_}}return n.padding=a.extend(h,n.padding),n}_cameraForBoxAndBearing(n,h,_,x){const b=this._extendCameraOptions(x),E=this.transform,I=E.padding,z=E.project(a.LngLat.convert(n)),L=E.project(a.LngLat.convert(h)),O=z.rotate(-a.degToRad(_)),N=L.rotate(-a.degToRad(_)),$=new a.pointGeometry(Math.max(O.x,N.x),Math.max(O.y,N.y)),Q=new a.pointGeometry(Math.min(O.x,N.x),Math.min(O.y,N.y)),H=$.sub(Q),J=(E.width-(I.left+I.right+b.padding.left+b.padding.right))/H.x,he=(E.height-(I.top+I.bottom+b.padding.top+b.padding.bottom))/H.y;if(he<0||J<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Y=Math.min(E.scaleZoom(E.scale*Math.min(J,he)),b.maxZoom),oe=typeof b.offset.x=="number"?new a.pointGeometry(b.offset.x,b.offset.y):a.pointGeometry.convert(b.offset),ae=new a.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(_*Math.PI/180),ne=oe.add(ae).mult(E.scale/E.zoomScale(Y));return{center:E.unproject(z.add(L).div(2).sub(ne)),zoom:Y,bearing:_}}_cameraForBox(n,h,_,x,b){const E=this._extendCameraOptions(b);_=_||0,x=x||0,n=a.LngLat.convert(n),h=a.LngLat.convert(h);const I=this.transform.clone();I.padding=E.padding;const z=this.getFreeCameraOptions(),L=new a.LngLat(.5*(n.lng+h.lng),.5*(n.lat+h.lat)),O=.5*(_+x);if(I._camera.position[2]<a.mercatorZfromAltitude(O,L.lat))return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");z.lookAtPoint(L),I.setFreeCameraOptions(z);const N=a.MercatorCoordinate.fromLngLat(n),$=a.MercatorCoordinate.fromLngLat(h),Q=I.pointRayIntersection(I.centerPoint,O),H=[(J=I.rayIntersectionCoordinate(Q)).x,J.y,J.z];var J;const he=I.screenPointToMercatorRay(I.centerPoint),Y=I.projection.name!=="globe";let oe,ae=0;do{const ne=Math.floor(I.zoom),se=1<<ne,de=Math.min(se*N.x,se*$.x),Me=Math.min(se*N.y,se*$.y),Fe=Math.max(se*N.x,se*$.x),ht=Math.max(se*N.y,se*$.y),et=new a.Aabb([de,Me,_],[Fe,ht,x]),Ye=a.Frustum.fromInvProjectionMatrix(I.invProjMatrix,I.worldSize,ne,Y);if(et.intersects(Ye)!==2){oe&&(I._camera.position=a.scaleAndAdd([],I._camera.position,he.dir,-oe),I._updateStateFromCamera());break}const Ue=a.sub([],I._camera.position,H);oe=.5*a.length(Ue),I._camera.position=a.scaleAndAdd([],I._camera.position,he.dir,oe);try{I._updateStateFromCamera()}catch{return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ae<10);return{center:I.center,zoom:I.zoom,bearing:I.bearing,pitch:I.pitch}}fitBounds(n,h,_){return this._fitInternal(this.cameraForBounds(n,h),h,_)}_raycastElevationBox(n,h){const _=this.transform.elevation;if(!_)return;const x=new a.pointGeometry(n.x,h.y),b=new a.pointGeometry(h.x,n.y),E=_.pointCoordinate(n);if(!E)return;const I=_.pointCoordinate(h);if(!I)return;const z=_.pointCoordinate(x);if(!z)return;const L=_.pointCoordinate(b);if(!L)return;const O=new a.MercatorCoordinate(E[0],E[1]).toLngLat(),N=new a.MercatorCoordinate(I[0],I[1]).toLngLat(),$=new a.MercatorCoordinate(z[0],z[1]).toLngLat(),Q=new a.MercatorCoordinate(L[0],L[1]).toLngLat(),H=Math.min(O.lng,Math.min(N.lng,Math.min($.lng,Q.lng))),J=Math.min(O.lat,Math.min(N.lat,Math.min($.lat,Q.lat))),he=Math.max(O.lng,Math.max(N.lng,Math.max($.lng,Q.lng))),Y=Math.max(O.lat,Math.max(N.lat,Math.max($.lat,Q.lat))),oe=Math.min(E[3],Math.min(I[3],Math.min(z[3],L[3]))),ae=Math.max(E[3],Math.max(I[3],Math.max(z[3],L[3])));return{minLngLat:new a.LngLat(H,J),maxLngLat:new a.LngLat(he,Y),minAltitude:oe,maxAltitude:ae}}fitScreenCoordinates(n,h,_,x,b){let E,I,z,L;const O=a.pointGeometry.convert(n),N=a.pointGeometry.convert(h),$=this._raycastElevationBox(O,N);if($)E=$.minLngLat,I=$.maxLngLat,z=$.minAltitude,L=$.maxAltitude;else{if(this.transform.anyCornerOffEdge(O,N))return this;E=this.transform.pointLocation(O),I=this.transform.pointLocation(N)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(n)),this.transform.pointLocation(a.pointGeometry.convert(h)),_,x):this._cameraForBox(E,I,z,L,x),x,b)}_fitInternal(n,h,_){return n?(delete(h=a.extend(n,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(n,h){this.stop();const _=n.preloadOnly?this.transform.clone():this.transform;let x=!1,b=!1,E=!1;return"zoom"in n&&_.zoom!==+n.zoom&&(x=!0,_.zoom=+n.zoom),n.center!==void 0&&(_.center=a.LngLat.convert(n.center)),"bearing"in n&&_.bearing!==+n.bearing&&(b=!0,_.bearing=+n.bearing),"pitch"in n&&_.pitch!==+n.pitch&&(E=!0,_.pitch=+n.pitch),n.padding==null||_.isPaddingEqual(n.padding)||(_.padding=n.padding),n.preloadOnly?(this._preloadTiles(_),this):(this.fire(new a.Event("movestart",h)).fire(new a.Event("move",h)),x&&this.fire(new a.Event("zoomstart",h)).fire(new a.Event("zoom",h)).fire(new a.Event("zoomend",h)),b&&this.fire(new a.Event("rotatestart",h)).fire(new a.Event("rotate",h)).fire(new a.Event("rotateend",h)),E&&this.fire(new a.Event("pitchstart",h)).fire(new a.Event("pitch",h)).fire(new a.Event("pitchend",h)),this.fire(new a.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(Ph),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return void a.warnOnce(Ph);this.stop();const x=_.zoom,b=_.pitch,E=_.bearing;_.setFreeCameraOptions(n);const I=x!==_.zoom,z=b!==_.pitch,L=E!==_.bearing;return this.fire(new a.Event("movestart",h)).fire(new a.Event("move",h)),I&&this.fire(new a.Event("zoomstart",h)).fire(new a.Event("zoom",h)).fire(new a.Event("zoomend",h)),L&&this.fire(new a.Event("rotatestart",h)).fire(new a.Event("rotate",h)).fire(new a.Event("rotateend",h)),z&&this.fire(new a.Event("pitchstart",h)).fire(new a.Event("pitch",h)).fire(new a.Event("pitchend",h)),this.fire(new a.Event("moveend",h)),this}easeTo(n,h){this._stop(!1,n.easeId),((n=a.extend({offset:[0,0],duration:500,easing:a.ease},n)).animate===!1||!n.essential&&a.exported.prefersReducedMotion)&&(n.duration=0);const _=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),I=this.getPadding(),z="zoom"in n?+n.zoom:x,L="bearing"in n?this._normalizeBearing(n.bearing,b):b,O="pitch"in n?+n.pitch:E,N="padding"in n?n.padding:_.padding,$=a.pointGeometry.convert(n.offset);let Q=_.centerPoint.add($);const H=_.projection.name==="globe"?_.pointCoordinate(Q).toLngLat():_.pointLocation(Q),J=a.LngLat.convert(n.center||H);this._normalizeCenter(J);const he=_.project(H),Y=_.project(J).sub(he),oe=_.zoomScale(z-x);let ae,ne;n.around&&(ae=a.LngLat.convert(n.around),ne=_.locationPoint(ae));const se=this._zooming||z!==x,de=this._rotating||b!==L,Me=this._pitching||O!==E,Fe=!_.isPaddingEqual(N),ht=Ye=>Ue=>{if(se&&(Ye.zoom=a.number(x,z,Ue)),de&&(Ye.bearing=a.number(b,L,Ue)),Me&&(Ye.pitch=a.number(E,O,Ue)),Fe&&(Ye.interpolatePadding(I,N,Ue),Q=Ye.centerPoint.add($)),ae)Ye.setLocationAtPoint(ae,ne);else{const De=Ye.zoomScale(Ye.zoom-x),Ke=z>x?Math.min(2,oe):Math.max(.5,oe),Ge=Math.pow(Ke,1-Ue),kt=Ye.unproject(he.add(Y.mult(Ue*Ge)).mult(De));Ye.setLocationAtPoint(Ye.renderWorldCopies?kt.wrap():kt,Q)}return n.preloadOnly||this._fireMoveEvents(h),Ye};if(n.preloadOnly){const Ye=this._emulate(ht,n.duration,_);return this._preloadTiles(Ye),this}const et={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=se,this._rotating=de,this._pitching=Me,this._padding=Fe,this._easeId=n.easeId,this._prepareEase(h,n.noMoveStart,et),this._ease(ht(_),Ye=>{_.recenterOnTerrain(),this._afterEase(h,Ye)},n),this}_prepareEase(n,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new a.Event("movestart",n)),this._zooming&&!_.zooming&&this.fire(new a.Event("zoomstart",n)),this._rotating&&!_.rotating&&this.fire(new a.Event("rotatestart",n)),this._pitching&&!_.pitching&&this.fire(new a.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new a.Event("move",n)),this._zooming&&this.fire(new a.Event("zoom",n)),this._rotating&&this.fire(new a.Event("rotate",n)),this._pitching&&this.fire(new a.Event("pitch",n))}_afterEase(n,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId,this.transform.cameraElevationReference="ground";const _=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new a.Event("zoomend",n)),x&&this.fire(new a.Event("rotateend",n)),b&&this.fire(new a.Event("pitchend",n)),this.fire(new a.Event("moveend",n))}flyTo(n,h){if(!n.essential&&a.exported.prefersReducedMotion){const ut=a.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ut,h)}this.stop(),n=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},n);const _=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),I=this.getPadding(),z="zoom"in n?a.clamp(+n.zoom,_.minZoom,_.maxZoom):x,L="bearing"in n?this._normalizeBearing(n.bearing,b):b,O="pitch"in n?+n.pitch:E,N="padding"in n?n.padding:_.padding,$=_.zoomScale(z-x),Q=a.pointGeometry.convert(n.offset);let H=_.centerPoint.add(Q);const J=_.pointLocation(H),he=a.LngLat.convert(n.center||J);this._normalizeCenter(he);const Y=_.project(J),oe=_.project(he).sub(Y);let ae=n.curve;const ne=Math.max(_.width,_.height),se=ne/$,de=oe.mag();if("minZoom"in n){const ut=a.clamp(Math.min(n.minZoom,x,z),_.minZoom,_.maxZoom),zt=ne/_.zoomScale(ut-x);ae=Math.sqrt(zt/de*2)}const Me=ae*ae;function Fe(ut){const zt=(se*se-ne*ne+(ut?-1:1)*Me*Me*de*de)/(2*(ut?se:ne)*Me*de);return Math.log(Math.sqrt(zt*zt+1)-zt)}function ht(ut){return(Math.exp(ut)-Math.exp(-ut))/2}function et(ut){return(Math.exp(ut)+Math.exp(-ut))/2}const Ye=Fe(0);let Ue=function(ut){return et(Ye)/et(Ye+ae*ut)},De=function(ut){return ne*((et(Ye)*(ht(zt=Ye+ae*ut)/et(zt))-ht(Ye))/Me)/de;var zt},Ke=(Fe(1)-Ye)/ae;if(Math.abs(de)<1e-6||!isFinite(Ke)){if(Math.abs(ne-se)<1e-6)return this.easeTo(n,h);const ut=se<ne?-1:1;Ke=Math.abs(Math.log(se/ne))/ae,De=function(){return 0},Ue=function(zt){return Math.exp(ut*ae*zt)}}n.duration="duration"in n?+n.duration:1e3*Ke/("screenSpeed"in n?+n.screenSpeed/ae:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Ge=b!==L,kt=O!==E,Ot=!_.isPaddingEqual(N),Ht=ut=>zt=>{const Vt=zt*Ke,wi=1/Ue(Vt);ut.zoom=zt===1?z:x+ut.scaleZoom(wi),Ge&&(ut.bearing=a.number(b,L,zt)),kt&&(ut.pitch=a.number(E,O,zt)),Ot&&(ut.interpolatePadding(I,N,zt),H=ut.centerPoint.add(Q));const Pi=zt===1?he:ut.unproject(Y.add(oe.mult(De(Vt))).mult(wi));return ut.setLocationAtPoint(ut.renderWorldCopies?Pi.wrap():Pi,H),ut._updateCenterElevation(),n.preloadOnly||this._fireMoveEvents(h),ut};if(n.preloadOnly){const ut=this._emulate(Ht,n.duration,_);return this._preloadTiles(ut),this}return this._zooming=!0,this._rotating=Ge,this._pitching=kt,this._padding=Ot,this._prepareEase(h,!1),this._ease(Ht(_),()=>this._afterEase(h),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,h)}if(!n){const _=this.handlers;_&&_.stop(!1)}return this}_ease(n,h,_){_.animate===!1||_.duration===0?(n(1),h()):(this._easeStart=a.exported.now(),this._easeOptions=_,this._onEaseFrame=n,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,h){n=a.wrap(n,-180,180);const _=Math.abs(n-h);return Math.abs(n-360-h)<_&&(n-=360),Math.abs(n+360-h)<_&&(n+=360),n}_normalizeCenter(n){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=n.lng-h.center.lng;n.lng+=_>180?-360:_<-180?360:0}_emulate(n,h,_){const x=Math.ceil(15*h/1e3),b=[],E=n(_.clone());for(let I=0;I<=x;I++){const z=E(I/x);b.push(z.clone())}return b}}class Dh{constructor(n={}){this.options=n,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const h=this.options&&this.options.compact;return this._map=n,this._container=R.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=R.create("button","mapboxgl-ctrl-attrib-button",this._container),R.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,h){const _=this._map._getUIString(`AttributionControl.${h}`);n.setAttribute("aria-label",_),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(n){const _=h.reduce((x,b,E)=>(b.value&&(x+=`${b.key}=${b.value}${E<h.length-1?"&":""}`),x),"?");n.href=`${a.config.FEEDBACK_URL}/${_}${this._map._hash?this._map._hash.getHashString(!0):""}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const h=this._map.style._sourceCaches;for(const x in h){const b=h[x];if(b.used){const E=b.getSource();E.attribution&&n.indexOf(E.attribution)<0&&n.push(E.attribution)}}n.sort((x,b)=>x.length-b.length),n=n.filter((x,b)=>{for(let E=b+1;E<n.length;E++)if(n[E].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const _=n.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,n.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class zh{constructor(){a.bindAll(["_updateLogo"],this),a.bindAll(["_updateCompact"],this)}onAdd(n){this._map=n,this._container=R.create("div","mapboxgl-ctrl");const h=R.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const h in n){const _=n[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const h=n[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Rh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const h=++this._id;return this._queue.push({callback:n,id:h,cancelled:!1}),h}remove(n){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const x of _)if(x.id===n)return void(x.cancelled=!0)}run(n=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Fh(m,n,h){if(m=new a.LngLat(m.lng,m.lat),n){const _=new a.LngLat(m.lng-360,m.lat),x=new a.LngLat(m.lng+360,m.lat),b=360*Math.ceil(Math.abs(m.lng-h.center.lng)/360),E=h.locationPoint(m).distSqr(n),I=n.x<0||n.y<0||n.x>h.width||n.y>h.height;h.locationPoint(_).distSqr(n)<E&&(I||Math.abs(_.lng-h.center.lng)<b)?m=_:h.locationPoint(x).distSqr(n)<E&&(I||Math.abs(x.lng-h.center.lng)<b)&&(m=x)}for(;Math.abs(m.lng-h.center.lng)>180;){const _=h.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const xr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Lh extends a.Evented{constructor(n,h){if(super(),(n instanceof a.window.HTMLElement||h)&&(n=a.extend({element:n},h)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),n&&n.element)this._element=n.element,this._offset=a.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div");const x=41,b=27,E=R.createSVG("svg",{display:"block",height:x*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${x}`},this._element),I=R.createSVG("radialGradient",{id:"shadowGradient"},R.createSVG("defs",{},E));R.createSVG("stop",{offset:"10%","stop-opacity":.4},I),R.createSVG("stop",{offset:"100%","stop-opacity":.05},I),R.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),R.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),R.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),R.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=a.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const _=this._element.classList;for(const x in xr)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=a.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const h=n.code,_=n.charCode||n.keyCode;h!=="Space"&&h!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(n){const h=n.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const n=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(n))return void this._clearFadeTimer();const h=this._map.unproject(n);let _=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const b=this._map.getFreeCameraOptions();if(b.position){const E=b.position.toLngLat();_=E.distanceTo(h)<.9*E.distanceTo(this._lngLat)}}const x=(1-this._map._queryFogOpacity(h))*(_?.2:1);this._element.style.opacity=`${x}`,this._popup&&this._popup._setOpacity(`${x}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(n){const h=this._map.transform;return!!n&&n.x>=0&&n.x<h.width&&n.y>=0&&n.y<h.height}_updateDOM(){const n=this._pos||new a.pointGeometry(0,0),h=this._calculatePitch(),_=this._calculateRotation();this._element.style.transform=`${xr[this._anchor]} translate(${n.x}px, ${n.y}px) rotateX(${h}deg) rotateZ(${_}deg)`}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(n){a.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Fh(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),n===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const n=this._map.transform,h=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&h._rotate(n.angle),this._pitchAlignment==="map"&&(h.y*=Math.cos(n._pitch)),h}getOffset(){return this._offset}setOffset(n){return this._offset=a.pointGeometry.convert(n),this._update(),this}_onMove(n){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(n){this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Os{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const h=a.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,h,_){this._start=this.getValue(h),this._end=n,this._startTime=h,this._endTime=h+_}}const Xd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Wn,HTMLElement:_a,ImageBitmap:ga}=a.window,M_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Oh(m){m.parentNode&&m.parentNode.removeChild(m)}const k_={showCompass:!0,showZoom:!0,visualizePitch:!1};class Kd{constructor(n,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Cn({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,_&&(this.mousePitch=new Ah({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(n,h){this.mouseRotate.mousedown(n,h),this.mousePitch&&this.mousePitch.mousedown(n,h),R.disableDrag()}move(n,h){const _=this.map,x=this.mouseRotate.mousemoveWindow(n,h);if(x&&x.bearingDelta&&_.setBearing(_.getBearing()+x.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(n,h);b&&b.pitchDelta&&_.setPitch(_.getPitch()+b.pitchDelta)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(a.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),R.mousePos(this.element,n)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,R.mousePos(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const kl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let qr,Pl=0,ya=!1;const Dl={maxWidth:100,unit:"metric"};function Et(m,n,h){const _=h&&h.maxWidth||100,x=m._containerHeight/2,b=m.unproject([0,x]),E=m.unproject([_,x]),I=b.distanceTo(E);if(h&&h.unit==="imperial"){const z=3.2808*I;z>5280?xa(n,_,z/5280,m._getUIString("ScaleControl.Miles"),m):xa(n,_,z,m._getUIString("ScaleControl.Feet"),m)}else h&&h.unit==="nautical"?xa(n,_,I/1852,m._getUIString("ScaleControl.NauticalMiles"),m):I>=1e3?xa(n,_,I/1e3,m._getUIString("ScaleControl.Kilometers"),m):xa(n,_,I,m._getUIString("ScaleControl.Meters"),m)}function xa(m,n,h,_,x){const b=function(I){const z=Math.pow(10,`${Math.floor(I)}`.length-1);let L=I/z;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(O){const N=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*N)/N}(L),z*L}(h),E=b/h;x._requestDomTask(()=>{m.style.width=n*E+"px",m.innerHTML=`${b}&nbsp;${_}`})}const Yd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),co={version:a.version,supported:w,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Hd{constructor(m){if((m=a.extend({},M_,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new El(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._renderTaskQueue=new Rh,this._domRenderTaskQueue=new Rh,this._controls=[],this._markers=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Xd,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Os(0),this._requestManager=new a.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,typeof m.container=="string"){if(this._container=a.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof _a))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new ma(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new Od(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,a.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Dh({customAttribution:m.customAttribution})),this._logoControl=new zh,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new a.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new a.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(m,n){if(n===void 0&&(n=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const _=this._controlPositions[n];return n.indexOf("bottom")!==-1?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(m);return n>-1&&this._controls.splice(n,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new a.Event("movestart",m)).fire(new a.Event("move",m)),this.fire(new a.Event("resize",m)),n&&this.fire(new a.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(a.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m==null?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m==null?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m==null?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m==null?85:m)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}getProjection(){return this.transform.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),typeof m=="string"&&(m={name:m}),this._runtimeProjection=m,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(m){return this.transform.locationPoint3D(a.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(a.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(m,n,h){if(m==="mouseenter"||m==="mouseover"){let _=!1;const x=E=>{const I=n.filter(L=>this.getLayer(L)),z=I.length?this.queryRenderedFeatures(E.point,{layers:I}):[];z.length?_||(_=!0,h.call(this,new Ir(m,this,E.originalEvent,{features:z}))):_=!1},b=()=>{_=!1};return{layers:new Set(n),listener:h,delegates:{mousemove:x,mouseout:b}}}if(m==="mouseleave"||m==="mouseout"){let _=!1;const x=E=>{const I=n.filter(z=>this.getLayer(z));(I.length?this.queryRenderedFeatures(E.point,{layers:I}):[]).length?_=!0:_&&(_=!1,h.call(this,new Ir(m,this,E.originalEvent)))},b=E=>{_&&(_=!1,h.call(this,new Ir(m,this,E.originalEvent)))};return{layers:new Set(n),listener:h,delegates:{mousemove:x,mouseout:b}}}{const _=x=>{const b=n.filter(I=>this.getLayer(I)),E=b.length?this.queryRenderedFeatures(x.point,{layers:b}):[];E.length&&(x.features=E,h.call(this,x),delete x.features)};return{layers:new Set(n),listener:h,delegates:{[m]:_}}}}on(m,n,h){if(h===void 0)return super.on(m,n);Array.isArray(n)||(n=[n]);const _=this._createDelegatedListener(m,n,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(m,n,h){if(h===void 0)return super.once(m,n);Array.isArray(n)||(n=[n]);const _=this._createDelegatedListener(m,n,h);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(m,n,h){if(h===void 0)return super.off(m,n);n=new Set(Array.isArray(n)?n:[n]);const _=(b,E)=>{if(b.size!==E.size)return!1;for(const I of b)if(!E.has(I))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[m]:void 0;return x&&(b=>{for(let E=0;E<b.length;E++){const I=b[E];if(I.listener===h&&_(I.layers,n)){for(const z in I.delegates)this.off(z,I.delegates[z]);return b.splice(E,1),this}}})(x),this}queryRenderedFeatures(m,n){return this.style?(n!==void 0||m===void 0||m instanceof a.pointGeometry||Array.isArray(m)||(n=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(m,n){return this.style.querySourceFeatures(m,n)}queryTerrainElevation(m,n){const h=this.transform.elevation;return h?(n=a.extend({},{exaggerated:!0},n),h.getAtPoint(a.MercatorCoordinate.fromLngLat(m),null,n.exaggerated)):null}setStyle(m,n){return(n=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(m,n))}_getUIString(m){const n=this._locale[m];if(n==null)throw new Error(`Missing UI string '${m}'`);return n}_updateStyle(m,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),m&&(this.style=new en(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new en(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,n){if(typeof m=="string"){const h=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(h,a.ResourceType.Style);a.getJSON(_,(x,b)=>{x?this.fire(new a.ErrorEvent(x)):b&&this._updateDiff(b,n)})}else typeof m=="object"&&this._updateDiff(m,n)}_updateDiff(m,n){try{this.style.setState(m)&&this._update(!0)}catch(h){a.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(m,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(m,n){return this._lazyInitEmptyStyle(),this.style.addSource(m,n),this._update(!0)}isSourceLoaded(m){const n=this.style&&this.style._getSourceCaches(m);if(n.length!==0)return n.every(h=>h.loaded());this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const n in m){const h=m[n]._tiles;for(const _ in h){const x=h[_];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(m,n,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,n,h)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,n,{pixelRatio:h=1,sdf:_=!1,stretchX:x,stretchY:b,content:E}={}){if(this._lazyInitEmptyStyle(),n instanceof Wn||ga&&n instanceof ga){const{width:I,height:z,data:L}=a.exported.getImageData(n);this.style.addImage(m,{data:new a.RGBAImage({width:I,height:z},L),pixelRatio:h,stretchX:x,stretchY:b,content:E,sdf:_,version:0})}else{if(n.width===void 0||n.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:z,data:L}=n,O=n;this.style.addImage(m,{data:new a.RGBAImage({width:I,height:z},new Uint8Array(L)),pixelRatio:h,stretchX:x,stretchY:b,content:E,sdf:_,version:0,userImage:O}),O.onAdd&&O.onAdd(this,m)}}}updateImage(m,n){const h=this.style.getImage(m);if(!h)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=n instanceof Wn||ga&&n instanceof ga?a.exported.getImageData(n):n,{width:x,height:b,data:E}=_;return x===void 0||b===void 0?this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):x!==h.data.width||b!==h.data.height?this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(h.data.replace(E,!(n instanceof Wn||ga&&n instanceof ga)),void this.style.updateImage(m,h))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,n){a.getImage(this._requestManager.transformRequest(m,a.ResourceType.Image),(h,_)=>{n(h,_ instanceof Wn?a.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,n){return this._lazyInitEmptyStyle(),this.style.addLayer(m,n),this._update(!0)}moveLayer(m,n){return this.style.moveLayer(m,n),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,n,h){return this.style.setLayerZoomRange(m,n,h),this._update(!0)}setFilter(m,n,h={}){return this.style.setFilter(m,n,h),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,n,h,_={}){return this.style.setPaintProperty(m,n,h,_),this._update(!0)}getPaintProperty(m,n){return this.style.getPaintProperty(m,n)}setLayoutProperty(m,n,h,_={}){return this.style.setLayoutProperty(m,n,h,_),this._update(!0)}getLayoutProperty(m,n){return this.style.getLayoutProperty(m,n)}setLight(m,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){this.transform.projection.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(m),this.transform):0}setFeatureState(m,n){return this.style.setFeatureState(m,n),this._update()}removeFeatureState(m,n){return this.style.removeFeatureState(m,n),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let h,_=this._container;for(;_&&!h;){const x=a.window.getComputedStyle(_).transform;x&&x!=="none"&&(h=x.match(/matrix.*\((.+)\)/)[1].split(", ")),_=_.parentElement}h?(this._containerWidth=h[0]&&h[0]!=="0"?Math.abs(m/h[0]):m,this._containerHeight=h[3]&&h[3]!=="0"?Math.abs(n/h[3]):n):(this._containerWidth=m,this._containerHeight=n)}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=R.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=R.create("div","mapboxgl-canvas-container",m);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=R.create("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=R.create("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=R.create("div",`mapboxgl-ctrl-${x}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,n){const h=a.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(m),this._canvas.height=h*Math.ceil(n),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${n}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const n=this._markers.indexOf(m);n!==-1&&this._markers.splice(n,1)}_setupPainter(){const m=a.extend({},w.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);n?(a.storeAuthState(n,!0),this.painter=new zd(n,this.transform),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(n)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let n;const h=this.painter.context.extTimerQuery,_=a.exported.now();this.listens("gpu-timing-frame")&&(n=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,n));let x=this._updateAverageElevation(_);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjection();let b=!1;const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,L=this.transform.pitch,O=a.exported.now();this.style.zoomHistory.update(z,O);const N=new a.EvaluationParameters(z,{now:O,fadeDuration:E,pitch:L,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),$=N.crossFadingFactor();$===1&&$===this._crossFadingFactor||(b=!0,this._crossFadingFactor=$),this.style.update(N)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const z=a.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,n),setTimeout(()=>{const L=h.getQueryObjectEXT(n,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(n),this.fire(new a.Event("gpu-timing-frame",{cpuTime:z,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(z);this.fire(new a.Event("gpu-timing-layer",{layerTimes:L}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(I||this._repaint)this.triggerRepaint();else{const z=!this.isMoving()&&this.loaded();if(z&&(x=this._updateAverageElevation(_,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const m of this._markers)m._update()}_updateAverageElevation(m,n=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);if((n||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();isNaN(x)?x=0:this._averageElevationLastSampledAt=m;const b=Math.abs(_-x);if(b>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,m,300)}else if(b>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(m)&&h(this._averageElevation.getValue(m))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===a.AUTH_ERR_MSG||m.status===401)){const n=this.painter.context.gl;a.storeAuthState(n,!1),this._logoControl instanceof zh&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function x(b){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,b,0);const E=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,E),E}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(x(m),n.canvasCopies.map(x),n.timeStamps)}_canvasPixelComparison(m,n,h){let _=h[1]-h[0];const x=m.length/4;for(let b=0;b<n.length;b++){const E=n[b];let I=0;for(let z=0;z<E.length;z+=4)E[z]===m[z]&&E[z+1]===m[z+1]&&E[z+2]===m[z+2]&&E[z+3]===m[z+3]&&(I+=1);_+=(h[b+2]-h[b+1])*(1-I/x)}return _}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),Oh(this._canvasContainer),Oh(this._controlContainer),Oh(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=a.exported.frame(n=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(n)}))}_preloadTiles(m){const n=this.style&&Object.values(this.style._sourceCaches)||[];return a.asyncAll(n,(h,_)=>h._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,n){a.setCacheLimits(m,n)}get version(){return a.version}},NavigationControl:class{constructor(m){this.options=a.extend({},k_,m),this._container=R.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),R.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),R.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=R.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const m=this._map.getZoom(),n=m===this._map.getMaxZoom(),h=m===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=m)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Kd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,n){const h=R.create("button",m,this._container);return h.type="button",h.addEventListener("click",n),h}_setButtonTitle(m,n){const h=this._map._getUIString(`NavigationControl.${n}`);m.setAttribute("aria-label",h),m.firstElementChild&&m.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends a.Evented{constructor(m){super(),this.options=a.extend({},kl,m),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=lo(this._updateMarkerRotation,20)}onAdd(m){var n;return this._map=m,this._container=R.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,qr!==void 0?n(qr):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(h=>{qr=h.state!=="denied",n(qr)}):(qr=!!a.window.navigator.geolocation,n(qr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Pl=0,ya=!1}_isOutOfMapMaxBounds(m){const n=this._map.getMaxBounds(),h=m.coords;return n&&(h.longitude<n.getWest()||h.longitude>n.getEast()||h.latitude<n.getSouth()||h.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",m)),this._finish()}}_updateCamera(m){const n=new a.LngLat(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,_=this._map.getBearing(),x=a.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(h),x,{geolocateSource:!0})}_updateMarker(m){if(m){const n=new a.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._containerHeight/2,n=this._map.unproject([0,m]),h=this._map.unproject([100,m]),_=n.distanceTo(h)/100,x=Math.ceil(2*this._accuracy/_);this._circleElement.style.width=`${x}px`,this._circleElement.style.height=`${x}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&ya)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=R.create("button","mapboxgl-ctrl-geolocate",this._container),R.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",m===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","mapboxgl-user-location"),this._dotElement.appendChild(R.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(R.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Lh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=R.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Lh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Pl--,ya=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Pl++,Pl>1?(m={maximumAge:6e5,timeout:0},ya=!0):(m=this.options.positionOptions,ya=!1),this._geolocationWatchID=a.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else a.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&m()}).catch(console.error):m()}_clearWatch(){a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Dh,ScaleControl:class{constructor(m){this.options=a.extend({},Dl,m),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Et(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=R.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,Et(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof a.window.HTMLElement?this._container=m.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=R.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);R.create("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden",!0),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(m){super(),this.options=a.extend(Object.create(Yd),m),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=a.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(a.window.document.createTextNode(m))}setHTML(m){const n=a.window.document.createDocumentFragment(),h=a.window.document.createElement("body");let _;for(h.innerHTML=m;_=h.firstChild,_;)n.appendChild(_);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._container&&this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._container&&this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let n;return this._classList.delete(m)?n=!1:(this._classList.add(m),n=!0),this._container&&this._updateClassList(),n}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const n=this._pos,h=this._container.offsetWidth,_=this._container.offsetHeight;let x;return x=n.y+m.bottom.y<_?["top"]:n.y>this._map.transform.height-_?["bottom"]:[],n.x<h/2?x.push("left"):n.x>this._map.transform.width-h/2&&x.push("right"),x.length===0?"bottom":x.join("-")}_updateClassList(){const m=[...this._classList];m.push("mapboxgl-popup"),this._anchor&&m.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&m.push("mapboxgl-popup-track-pointer"),this._container.className=m.join(" ")}_update(m){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=R.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=R.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fh(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||m){const n=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat),h=function(b){if(b||(b=new a.pointGeometry(0,0)),typeof b=="number"){const E=Math.round(Math.sqrt(.5*Math.pow(b,2)));return{center:new a.pointGeometry(0,0),top:new a.pointGeometry(0,b),"top-left":new a.pointGeometry(E,E),"top-right":new a.pointGeometry(-E,E),bottom:new a.pointGeometry(0,-b),"bottom-left":new a.pointGeometry(E,-E),"bottom-right":new a.pointGeometry(-E,-E),left:new a.pointGeometry(b,0),right:new a.pointGeometry(-b,0)}}if(b instanceof a.pointGeometry||Array.isArray(b)){const E=a.pointGeometry.convert(b);return{center:E,top:E,"top-left":E,"top-right":E,bottom:E,"bottom-left":E,"bottom-right":E,left:E,right:E}}return{center:a.pointGeometry.convert(b.center||[0,0]),top:a.pointGeometry.convert(b.top||[0,0]),"top-left":a.pointGeometry.convert(b["top-left"]||[0,0]),"top-right":a.pointGeometry.convert(b["top-right"]||[0,0]),bottom:a.pointGeometry.convert(b.bottom||[0,0]),"bottom-left":a.pointGeometry.convert(b["bottom-left"]||[0,0]),"bottom-right":a.pointGeometry.convert(b["bottom-right"]||[0,0]),left:a.pointGeometry.convert(b.left||[0,0]),right:a.pointGeometry.convert(b.right||[0,0])}}(this.options.offset),_=this._anchor=this._getAnchor(h),x=n.add(h[_]).round();this._map._requestDomTask(()=>{this._container&&_&&(this._container.style.transform=`${xr[_]} translate(${x.x}px,${x.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(zl);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._content&&(this._content.style.opacity=m),this._tip&&(this._tip.style.opacity=m)}},Marker:Lh,Style:en,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Fd,Evented:a.Evented,config:a.config,prewarm:function(){ye().acquire(_e)},clearPrewarmedResources:function(){const m=Ce;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(_e),Ce=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(m){a.config.ACCESS_TOKEN=m},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(m){a.config.API_URL=m},get workerCount(){return Ae.workerCount},set workerCount(m){Ae.workerCount=m},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){a.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){a.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return co});var g=u;return g})})(uA);var M6=uA.exports;const CB="1.30.0",fA={"X-Client-Info":`supabase-js/${CB}`},IB="supabase.auth.token";function MB(t){return t.replace(/\/$/,"")}const kB=()=>typeof window!="undefined";var Ry={exports:{}};(function(t,i){var o=typeof self!="undefined"?self:cA,l=function(){function d(){this.fetch=!1,this.DOMException=o.DOMException}return d.prototype=o,new d}();(function(d){(function(g){var a={searchParams:"URLSearchParams"in d,iterable:"Symbol"in d&&"iterator"in Symbol,blob:"FileReader"in d&&"Blob"in d&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in d,arrayBuffer:"ArrayBuffer"in d};function w(be){return be&&DataView.prototype.isPrototypeOf(be)}if(a.arrayBuffer)var S=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],C=ArrayBuffer.isView||function(be){return be&&S.indexOf(Object.prototype.toString.call(be))>-1};function k(be){if(typeof be!="string"&&(be=String(be)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(be))throw new TypeError("Invalid character in header field name");return be.toLowerCase()}function F(be){return typeof be!="string"&&(be=String(be)),be}function R(be){var Ze={next:function(){var Qe=be.shift();return{done:Qe===void 0,value:Qe}}};return a.iterable&&(Ze[Symbol.iterator]=function(){return Ze}),Ze}function W(be){this.map={},be instanceof W?be.forEach(function(Ze,Qe){this.append(Qe,Ze)},this):Array.isArray(be)?be.forEach(function(Ze){this.append(Ze[0],Ze[1])},this):be&&Object.getOwnPropertyNames(be).forEach(function(Ze){this.append(Ze,be[Ze])},this)}W.prototype.append=function(be,Ze){be=k(be),Ze=F(Ze);var Qe=this.map[be];this.map[be]=Qe?Qe+", "+Ze:Ze},W.prototype.delete=function(be){delete this.map[k(be)]},W.prototype.get=function(be){return be=k(be),this.has(be)?this.map[be]:null},W.prototype.has=function(be){return this.map.hasOwnProperty(k(be))},W.prototype.set=function(be,Ze){this.map[k(be)]=F(Ze)},W.prototype.forEach=function(be,Ze){for(var Qe in this.map)this.map.hasOwnProperty(Qe)&&be.call(Ze,this.map[Qe],Qe,this)},W.prototype.keys=function(){var be=[];return this.forEach(function(Ze,Qe){be.push(Qe)}),R(be)},W.prototype.values=function(){var be=[];return this.forEach(function(Ze){be.push(Ze)}),R(be)},W.prototype.entries=function(){var be=[];return this.forEach(function(Ze,Qe){be.push([Qe,Ze])}),R(be)},a.iterable&&(W.prototype[Symbol.iterator]=W.prototype.entries);function Z(be){if(be.bodyUsed)return Promise.reject(new TypeError("Already read"));be.bodyUsed=!0}function X(be){return new Promise(function(Ze,Qe){be.onload=function(){Ze(be.result)},be.onerror=function(){Qe(be.error)}})}function q(be){var Ze=new FileReader,Qe=X(Ze);return Ze.readAsArrayBuffer(be),Qe}function ue(be){var Ze=new FileReader,Qe=X(Ze);return Ze.readAsText(be),Qe}function pe(be){for(var Ze=new Uint8Array(be),Qe=new Array(Ze.length),gt=0;gt<Ze.length;gt++)Qe[gt]=String.fromCharCode(Ze[gt]);return Qe.join("")}function xe(be){if(be.slice)return be.slice(0);var Ze=new Uint8Array(be.byteLength);return Ze.set(new Uint8Array(be)),Ze.buffer}function fe(){return this.bodyUsed=!1,this._initBody=function(be){this._bodyInit=be,be?typeof be=="string"?this._bodyText=be:a.blob&&Blob.prototype.isPrototypeOf(be)?this._bodyBlob=be:a.formData&&FormData.prototype.isPrototypeOf(be)?this._bodyFormData=be:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(be)?this._bodyText=be.toString():a.arrayBuffer&&a.blob&&w(be)?(this._bodyArrayBuffer=xe(be.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(be)||C(be))?this._bodyArrayBuffer=xe(be):this._bodyText=be=Object.prototype.toString.call(be):this._bodyText="",this.headers.get("content-type")||(typeof be=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(be)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var be=Z(this);if(be)return be;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?Z(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(q)}),this.text=function(){var be=Z(this);if(be)return be;if(this._bodyBlob)return ue(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(pe(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(Pe)}),this.json=function(){return this.text().then(JSON.parse)},this}var Te=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Ie(be){var Ze=be.toUpperCase();return Te.indexOf(Ze)>-1?Ze:be}function Le(be,Ze){Ze=Ze||{};var Qe=Ze.body;if(be instanceof Le){if(be.bodyUsed)throw new TypeError("Already read");this.url=be.url,this.credentials=be.credentials,Ze.headers||(this.headers=new W(be.headers)),this.method=be.method,this.mode=be.mode,this.signal=be.signal,!Qe&&be._bodyInit!=null&&(Qe=be._bodyInit,be.bodyUsed=!0)}else this.url=String(be);if(this.credentials=Ze.credentials||this.credentials||"same-origin",(Ze.headers||!this.headers)&&(this.headers=new W(Ze.headers)),this.method=Ie(Ze.method||this.method||"GET"),this.mode=Ze.mode||this.mode||null,this.signal=Ze.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Qe)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Qe)}Le.prototype.clone=function(){return new Le(this,{body:this._bodyInit})};function Pe(be){var Ze=new FormData;return be.trim().split("&").forEach(function(Qe){if(Qe){var gt=Qe.split("="),St=gt.shift().replace(/\+/g," "),bt=gt.join("=").replace(/\+/g," ");Ze.append(decodeURIComponent(St),decodeURIComponent(bt))}}),Ze}function qe(be){var Ze=new W,Qe=be.replace(/\r?\n[\t ]+/g," ");return Qe.split(/\r?\n/).forEach(function(gt){var St=gt.split(":"),bt=St.shift().trim();if(bt){var Ti=St.join(":").trim();Ze.append(bt,Ti)}}),Ze}fe.call(Le.prototype);function ze(be,Ze){Ze||(Ze={}),this.type="default",this.status=Ze.status===void 0?200:Ze.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in Ze?Ze.statusText:"OK",this.headers=new W(Ze.headers),this.url=Ze.url||"",this._initBody(be)}fe.call(ze.prototype),ze.prototype.clone=function(){return new ze(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new W(this.headers),url:this.url})},ze.error=function(){var be=new ze(null,{status:0,statusText:""});return be.type="error",be};var lt=[301,302,303,307,308];ze.redirect=function(be,Ze){if(lt.indexOf(Ze)===-1)throw new RangeError("Invalid status code");return new ze(null,{status:Ze,headers:{location:be}})},g.DOMException=d.DOMException;try{new g.DOMException}catch{g.DOMException=function(Ze,Qe){this.message=Ze,this.name=Qe;var gt=Error(Ze);this.stack=gt.stack},g.DOMException.prototype=Object.create(Error.prototype),g.DOMException.prototype.constructor=g.DOMException}function ct(be,Ze){return new Promise(function(Qe,gt){var St=new Le(be,Ze);if(St.signal&&St.signal.aborted)return gt(new g.DOMException("Aborted","AbortError"));var bt=new XMLHttpRequest;function Ti(){bt.abort()}bt.onload=function(){var Pt={status:bt.status,statusText:bt.statusText,headers:qe(bt.getAllResponseHeaders()||"")};Pt.url="responseURL"in bt?bt.responseURL:Pt.headers.get("X-Request-URL");var Bi="response"in bt?bt.response:bt.responseText;Qe(new ze(Bi,Pt))},bt.onerror=function(){gt(new TypeError("Network request failed"))},bt.ontimeout=function(){gt(new TypeError("Network request failed"))},bt.onabort=function(){gt(new g.DOMException("Aborted","AbortError"))},bt.open(St.method,St.url,!0),St.credentials==="include"?bt.withCredentials=!0:St.credentials==="omit"&&(bt.withCredentials=!1),"responseType"in bt&&a.blob&&(bt.responseType="blob"),St.headers.forEach(function(Pt,Bi){bt.setRequestHeader(Bi,Pt)}),St.signal&&(St.signal.addEventListener("abort",Ti),bt.onreadystatechange=function(){bt.readyState===4&&St.signal.removeEventListener("abort",Ti)}),bt.send(typeof St._bodyInit=="undefined"?null:St._bodyInit)})}return ct.polyfill=!0,d.fetch||(d.fetch=ct,d.Headers=W,d.Request=Le,d.Response=ze),g.Headers=W,g.Request=Le,g.Response=ze,g.fetch=ct,Object.defineProperty(g,"__esModule",{value:!0}),g})({})})(l),l.fetch.ponyfill=!0,delete l.fetch.polyfill;var u=l;i=u.fetch,i.default=u.fetch,i.fetch=u.fetch,i.Headers=u.Headers,i.Request=u.Request,i.Response=u.Response,t.exports=i})(Ry,Ry.exports);var p_=AB(Ry.exports),hd=globalThis&&globalThis.__awaiter||function(t,i,o,l){function u(d){return d instanceof o?d:new o(function(g){g(d)})}return new(o||(o=Promise))(function(d,g){function a(C){try{S(l.next(C))}catch(k){g(k)}}function w(C){try{S(l.throw(C))}catch(k){g(k)}}function S(C){C.done?d(C.value):u(C.value).then(a,w)}S((l=l.apply(t,i||[])).next())})};const PB=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),DB=(t,i)=>{if(typeof t.json!="function")return i(t);t.json().then(o=>i({message:PB(o),status:(t==null?void 0:t.status)||500}))},zB=(t,i,o)=>{const l={method:t,headers:(i==null?void 0:i.headers)||{}};return t==="GET"||(l.headers=Object.assign({"Content-Type":"text/plain;charset=UTF-8"},i==null?void 0:i.headers),l.body=JSON.stringify(o)),l};function m_(t=p_,i,o,l,u){return hd(this,void 0,void 0,function*(){return new Promise((d,g)=>{t(o,zB(i,l,u)).then(a=>{if(!a.ok)throw a;return(l==null?void 0:l.noResolveJson)?d:a.json()}).then(a=>d(a)).catch(a=>DB(a,g))})})}function y0(t,i,o){return hd(this,void 0,void 0,function*(){return m_(t,"GET",i,o)})}function zn(t,i,o,l){return hd(this,void 0,void 0,function*(){return m_(t,"POST",i,l,o)})}function C2(t,i,o,l){return hd(this,void 0,void 0,function*(){return m_(t,"PUT",i,l,o)})}function RB(t,i,o,l){return hd(this,void 0,void 0,function*(){return m_(t,"DELETE",i,l,o)})}const FB="1.22.1",LB="http://localhost:9999",OB={"X-Client-Info":`gotrue-js/${FB}`},df="supabase.auth.token",BB={name:"sb",lifetime:60*60*8,domain:"",path:"/",sameSite:"lax"};function UB(t,i,o){const l=o||{},u=encodeURIComponent,d=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;if(typeof u!="function")throw new TypeError("option encode is invalid");if(!d.test(t))throw new TypeError("argument name is invalid");const g=u(i);if(g&&!d.test(g))throw new TypeError("argument val is invalid");let a=t+"="+g;if(l.maxAge!=null){const w=l.maxAge-0;if(isNaN(w)||!isFinite(w))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(w)}if(l.domain){if(!d.test(l.domain))throw new TypeError("option domain is invalid");a+="; Domain="+l.domain}if(l.path){if(!d.test(l.path))throw new TypeError("option path is invalid");a+="; Path="+l.path}if(l.expires){if(typeof l.expires.toUTCString!="function")throw new TypeError("option expires is invalid");a+="; Expires="+l.expires.toUTCString()}if(l.httpOnly&&(a+="; HttpOnly"),l.secure&&(a+="; Secure"),l.sameSite)switch(typeof l.sameSite=="string"?l.sameSite.toLowerCase():l.sameSite){case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a}function NB(t){if(!t||!t.headers||!t.headers.host)throw new Error('The "host" request header is not available');const i=t.headers.host.indexOf(":")>-1&&t.headers.host.split(":")[0]||t.headers.host;return!(["localhost","127.0.0.1"].indexOf(i)>-1||i.endsWith(".local"))}function jB(t,i){var o,l,u;return UB(t.name,t.value,{maxAge:t.maxAge,expires:new Date(Date.now()+t.maxAge*1e3),httpOnly:!0,secure:i,path:(o=t.path)!==null&&o!==void 0?o:"/",domain:(l=t.domain)!==null&&l!==void 0?l:"",sameSite:(u=t.sameSite)!==null&&u!==void 0?u:"lax"})}function Fy(t,i,o){const l=o.map(d=>jB(d,NB(t))),u=i.getHeader("Set-Cookie");return u&&(u instanceof Array?Array.prototype.push.apply(l,u):typeof u=="string"&&l.push(u)),l}function Wp(t,i,o){i.setHeader("Set-Cookie",Fy(t,i,o))}function xu(t){return Math.round(Date.now()/1e3)+t}function VB(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const i=Math.random()*16|0;return(t=="x"?i:i&3|8).toString(16)})}const Ra=()=>typeof window!="undefined";function Fa(t,i){var o;i||(i=((o=window==null?void 0:window.location)===null||o===void 0?void 0:o.href)||""),t=t.replace(/[\[\]]/g,"\\$&");const l=new RegExp("[?&#]"+t+"(=([^&#]*)|&|#|$)"),u=l.exec(i);return u?u[2]?decodeURIComponent(u[2].replace(/\+/g," ")):"":null}var pr=globalThis&&globalThis.__awaiter||function(t,i,o,l){function u(d){return d instanceof o?d:new o(function(g){g(d)})}return new(o||(o=Promise))(function(d,g){function a(C){try{S(l.next(C))}catch(k){g(k)}}function w(C){try{S(l.throw(C))}catch(k){g(k)}}function S(C){C.done?d(C.value):u(C.value).then(a,w)}S((l=l.apply(t,i||[])).next())})};class $B{constructor({url:i="",headers:o={},cookieOptions:l,fetch:u}){this.url=i,this.headers=o,this.cookieOptions=Object.assign(Object.assign({},BB),l),this.fetch=u}_createRequestHeaders(i){const o=Object.assign({},this.headers);return o.Authorization=`Bearer ${i}`,o}cookieName(){var i;return(i=this.cookieOptions.name)!==null&&i!==void 0?i:""}getUrlForProvider(i,o){const l=[`provider=${encodeURIComponent(i)}`];return(o==null?void 0:o.redirectTo)&&l.push(`redirect_to=${encodeURIComponent(o.redirectTo)}`),(o==null?void 0:o.scopes)&&l.push(`scopes=${encodeURIComponent(o.scopes)}`),`${this.url}/authorize?${l.join("&")}`}signUpWithEmail(i,o,l={}){return pr(this,void 0,void 0,function*(){try{const u=Object.assign({},this.headers);let d="";l.redirectTo&&(d="?redirect_to="+encodeURIComponent(l.redirectTo));const g=yield zn(this.fetch,`${this.url}/signup${d}`,{email:i,password:o,data:l.data,gotrue_meta_security:{hcaptcha_token:l.captchaToken}},{headers:u}),a=Object.assign({},g);return a.expires_in&&(a.expires_at=xu(g.expires_in)),{data:a,error:null}}catch(u){return{data:null,error:u}}})}signInWithEmail(i,o,l={}){return pr(this,void 0,void 0,function*(){try{const u=Object.assign({},this.headers);let d="?grant_type=password";l.redirectTo&&(d+="&redirect_to="+encodeURIComponent(l.redirectTo));const g=yield zn(this.fetch,`${this.url}/token${d}`,{email:i,password:o},{headers:u}),a=Object.assign({},g);return a.expires_in&&(a.expires_at=xu(g.expires_in)),{data:a,error:null}}catch(u){return{data:null,error:u}}})}signUpWithPhone(i,o,l={}){return pr(this,void 0,void 0,function*(){try{const u=Object.assign({},this.headers),d=yield zn(this.fetch,`${this.url}/signup`,{phone:i,password:o,data:l.data,gotrue_meta_security:{hcaptcha_token:l.captchaToken}},{headers:u}),g=Object.assign({},d);return g.expires_in&&(g.expires_at=xu(d.expires_in)),{data:g,error:null}}catch(u){return{data:null,error:u}}})}signInWithPhone(i,o){return pr(this,void 0,void 0,function*(){try{const l=Object.assign({},this.headers),u="?grant_type=password",d=yield zn(this.fetch,`${this.url}/token${u}`,{phone:i,password:o},{headers:l}),g=Object.assign({},d);return g.expires_in&&(g.expires_at=xu(d.expires_in)),{data:g,error:null}}catch(l){return{data:null,error:l}}})}signInWithOpenIDConnect({id_token:i,nonce:o,client_id:l,issuer:u,provider:d}){return pr(this,void 0,void 0,function*(){try{const g=Object.assign({},this.headers),a="?grant_type=id_token",w=yield zn(this.fetch,`${this.url}/token${a}`,{id_token:i,nonce:o,client_id:l,issuer:u,provider:d},{headers:g}),S=Object.assign({},w);return S.expires_in&&(S.expires_at=xu(w.expires_in)),{data:S,error:null}}catch(g){return{data:null,error:g}}})}sendMagicLinkEmail(i,o={}){return pr(this,void 0,void 0,function*(){try{const l=Object.assign({},this.headers);let u="";return o.redirectTo&&(u+="?redirect_to="+encodeURIComponent(o.redirectTo)),{data:yield zn(this.fetch,`${this.url}/magiclink${u}`,{email:i,gotrue_meta_security:{hcaptcha_token:o.captchaToken}},{headers:l}),error:null}}catch(l){return{data:null,error:l}}})}sendMobileOTP(i,o={}){return pr(this,void 0,void 0,function*(){try{let l=Object.assign({},this.headers);return{data:yield zn(this.fetch,`${this.url}/otp`,{phone:i,gotrue_meta_security:{hcaptcha_token:o.captchaToken}},{headers:l}),error:null}}catch(l){return{data:null,error:l}}})}signOut(i){return pr(this,void 0,void 0,function*(){try{return yield zn(this.fetch,`${this.url}/logout`,{},{headers:this._createRequestHeaders(i),noResolveJson:!0}),{error:null}}catch(o){return{error:o}}})}verifyMobileOTP(i,o,l={}){return pr(this,void 0,void 0,function*(){try{const u=Object.assign({},this.headers);return{data:yield zn(this.fetch,`${this.url}/verify`,{phone:i,token:o,type:"sms",redirect_to:l.redirectTo},{headers:u}),error:null}}catch(u){return{data:null,error:u}}})}inviteUserByEmail(i,o={}){return pr(this,void 0,void 0,function*(){try{const l=Object.assign({},this.headers);let u="";return o.redirectTo&&(u+="?redirect_to="+encodeURIComponent(o.redirectTo)),{data:yield zn(this.fetch,`${this.url}/invite${u}`,{email:i,data:o.data},{headers:l}),error:null}}catch(l){return{data:null,error:l}}})}resetPasswordForEmail(i,o={}){return pr(this,void 0,void 0,function*(){try{const l=Object.assign({},this.headers);let u="";return o.redirectTo&&(u+="?redirect_to="+encodeURIComponent(o.redirectTo)),{data:yield zn(this.fetch,`${this.url}/recover${u}`,{email:i,gotrue_meta_security:{hcaptcha_token:o.captchaToken}},{headers:l}),error:null}}catch(l){return{data:null,error:l}}})}refreshAccessToken(i){return pr(this,void 0,void 0,function*(){try{const o=yield zn(this.fetch,`${this.url}/token?grant_type=refresh_token`,{refresh_token:i},{headers:this.headers}),l=Object.assign({},o);return l.expires_in&&(l.expires_at=xu(o.expires_in)),{data:l,error:null}}catch(o){return{data:null,error:o}}})}setAuthCookie(i,o){i.method!=="POST"&&(o.setHeader("Allow","POST"),o.status(405).end("Method Not Allowed"));const{event:l,session:u}=i.body;if(!l)throw new Error("Auth event missing!");if(l==="SIGNED_IN"){if(!u)throw new Error("Auth session missing!");Wp(i,o,[{key:"access-token",value:u.access_token},{key:"refresh-token",value:u.refresh_token}].map(d=>{var g;return{name:`${this.cookieName()}-${d.key}`,value:d.value,domain:this.cookieOptions.domain,maxAge:(g=this.cookieOptions.lifetime)!==null&&g!==void 0?g:0,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite}}))}l==="SIGNED_OUT"&&Wp(i,o,["access-token","refresh-token"].map(d=>({name:`${this.cookieName()}-${d}`,value:"",maxAge:-1}))),o.status(200).json({})}deleteAuthCookie(i,o,{redirectTo:l="/"}){return Wp(i,o,["access-token","refresh-token"].map(u=>({name:`${this.cookieName()}-${u}`,value:"",maxAge:-1}))),o.redirect(307,l)}getAuthCookieString(i,o){i.method!=="POST"&&(o.setHeader("Allow","POST"),o.status(405).end("Method Not Allowed"));const{event:l,session:u}=i.body;if(!l)throw new Error("Auth event missing!");if(l==="SIGNED_IN"){if(!u)throw new Error("Auth session missing!");return Fy(i,o,[{key:"access-token",value:u.access_token},{key:"refresh-token",value:u.refresh_token}].map(d=>{var g;return{name:`${this.cookieName()}-${d.key}`,value:d.value,domain:this.cookieOptions.domain,maxAge:(g=this.cookieOptions.lifetime)!==null&&g!==void 0?g:0,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite}}))}return l==="SIGNED_OUT"?Fy(i,o,["access-token","refresh-token"].map(d=>({name:`${this.cookieName()}-${d}`,value:"",maxAge:-1}))):o.getHeader("Set-Cookie")}generateLink(i,o,l={}){return pr(this,void 0,void 0,function*(){try{return{data:yield zn(this.fetch,`${this.url}/admin/generate_link`,{type:i,email:o,password:l.password,data:l.data,redirect_to:l.redirectTo},{headers:this.headers}),error:null}}catch(u){return{data:null,error:u}}})}createUser(i){return pr(this,void 0,void 0,function*(){try{const o=yield zn(this.fetch,`${this.url}/admin/users`,i,{headers:this.headers});return{user:o,data:o,error:null}}catch(o){return{user:null,data:null,error:o}}})}listUsers(){return pr(this,void 0,void 0,function*(){try{return{data:(yield y0(this.fetch,`${this.url}/admin/users`,{headers:this.headers})).users,error:null}}catch(i){return{data:null,error:i}}})}getUserById(i){return pr(this,void 0,void 0,function*(){try{return{data:yield y0(this.fetch,`${this.url}/admin/users/${i}`,{headers:this.headers}),error:null}}catch(o){return{data:null,error:o}}})}getUserByCookie(i,o){return pr(this,void 0,void 0,function*(){try{if(!i.cookies)throw new Error("Not able to parse cookies! When using Express make sure the cookie-parser middleware is in use!");const l=i.cookies[`${this.cookieName()}-access-token`],u=i.cookies[`${this.cookieName()}-refresh-token`];if(!l)throw new Error("No cookie found!");const{user:d,error:g}=yield this.getUser(l);if(g){if(!u)throw new Error("No refresh_token cookie found!");if(!o)throw new Error("You need to pass the res object to automatically refresh the session!");const{data:a,error:w}=yield this.refreshAccessToken(u);if(w)throw w;if(a)return Wp(i,o,[{key:"access-token",value:a.access_token},{key:"refresh-token",value:a.refresh_token}].map(S=>{var C;return{name:`${this.cookieName()}-${S.key}`,value:S.value,domain:this.cookieOptions.domain,maxAge:(C=this.cookieOptions.lifetime)!==null&&C!==void 0?C:0,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite}})),{token:a.access_token,user:a.user,data:a.user,error:null}}return{token:l,user:d,data:d,error:null}}catch(l){return{token:null,user:null,data:null,error:l}}})}updateUserById(i,o){return pr(this,void 0,void 0,function*(){try{const l=yield C2(this.fetch,`${this.url}/admin/users/${i}`,o,{headers:this.headers});return{user:l,data:l,error:null}}catch(l){return{user:null,data:null,error:l}}})}deleteUser(i){return pr(this,void 0,void 0,function*(){try{const o=yield RB(this.fetch,`${this.url}/admin/users/${i}`,{},{headers:this.headers});return{user:o,data:o,error:null}}catch(o){return{user:null,data:null,error:o}}})}getUser(i){return pr(this,void 0,void 0,function*(){try{const o=yield y0(this.fetch,`${this.url}/user`,{headers:this._createRequestHeaders(i)});return{user:o,data:o,error:null}}catch(o){return{user:null,data:null,error:o}}})}updateUser(i,o){return pr(this,void 0,void 0,function*(){try{const l=yield C2(this.fetch,`${this.url}/user`,o,{headers:this._createRequestHeaders(i)});return{user:l,data:l,error:null}}catch(l){return{user:null,data:null,error:l}}})}}function GB(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self!="undefined"&&(self.globalThis=self)}}var Rn=globalThis&&globalThis.__awaiter||function(t,i,o,l){function u(d){return d instanceof o?d:new o(function(g){g(d)})}return new(o||(o=Promise))(function(d,g){function a(C){try{S(l.next(C))}catch(k){g(k)}}function w(C){try{S(l.throw(C))}catch(k){g(k)}}function S(C){C.done?d(C.value):u(C.value).then(a,w)}S((l=l.apply(t,i||[])).next())})};GB();const qB={url:LB,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:OB};class ZB{constructor(i){this.stateChangeEmitters=new Map;const o=Object.assign(Object.assign({},qB),i);this.currentUser=null,this.currentSession=null,this.autoRefreshToken=o.autoRefreshToken,this.persistSession=o.persistSession,this.multiTab=o.multiTab,this.localStorage=o.localStorage||globalThis.localStorage,this.api=new $B({url:o.url,headers:o.headers,cookieOptions:o.cookieOptions,fetch:o.fetch}),this._recoverSession(),this._recoverAndRefresh(),this._listenForMultiTabEvents(),o.detectSessionInUrl&&Ra()&&!!Fa("access_token")&&this.getSessionFromUrl({storeSession:!0}).then(({error:l})=>{l&&console.error("Error getting session from URL.",l)})}signUp({email:i,password:o,phone:l},u={}){return Rn(this,void 0,void 0,function*(){try{this._removeSession();const{data:d,error:g}=l&&o?yield this.api.signUpWithPhone(l,o,{data:u.data,captchaToken:u.captchaToken}):yield this.api.signUpWithEmail(i,o,{redirectTo:u.redirectTo,data:u.data,captchaToken:u.captchaToken});if(g)throw g;if(!d)throw"An error occurred on sign up.";let a=null,w=null;return d.access_token&&(a=d,w=a.user,this._saveSession(a),this._notifyAllSubscribers("SIGNED_IN")),d.id&&(w=d),{user:w,session:a,error:null}}catch(d){return{user:null,session:null,error:d}}})}signIn({email:i,phone:o,password:l,refreshToken:u,provider:d,oidc:g},a={}){return Rn(this,void 0,void 0,function*(){try{if(this._removeSession(),i&&!l){const{error:w}=yield this.api.sendMagicLinkEmail(i,{redirectTo:a.redirectTo,captchaToken:a.captchaToken});return{user:null,session:null,error:w}}if(i&&l)return this._handleEmailSignIn(i,l,{redirectTo:a.redirectTo});if(o&&!l){const{error:w}=yield this.api.sendMobileOTP(o,{captchaToken:a.captchaToken});return{user:null,session:null,error:w}}if(o&&l)return this._handlePhoneSignIn(o,l);if(u){const{error:w}=yield this._callRefreshToken(u);if(w)throw w;return{user:this.currentUser,session:this.currentSession,error:null}}if(d)return this._handleProviderSignIn(d,{redirectTo:a.redirectTo,scopes:a.scopes});if(g)return this._handleOpenIDConnectSignIn(g);throw new Error("You must provide either an email, phone number, a third-party provider or OpenID Connect.")}catch(w){return{user:null,session:null,error:w}}})}verifyOTP({phone:i,token:o},l={}){return Rn(this,void 0,void 0,function*(){try{this._removeSession();const{data:u,error:d}=yield this.api.verifyMobileOTP(i,o,l);if(d)throw d;if(!u)throw"An error occurred on token verification.";let g=null,a=null;return u.access_token&&(g=u,a=g.user,this._saveSession(g),this._notifyAllSubscribers("SIGNED_IN")),u.id&&(a=u),{user:a,session:g,error:null}}catch(u){return{user:null,session:null,error:u}}})}user(){return this.currentUser}session(){return this.currentSession}refreshSession(){var i;return Rn(this,void 0,void 0,function*(){try{if(!((i=this.currentSession)===null||i===void 0?void 0:i.access_token))throw new Error("Not logged in.");const{error:o}=yield this._callRefreshToken();if(o)throw o;return{data:this.currentSession,user:this.currentUser,error:null}}catch(o){return{data:null,user:null,error:o}}})}update(i){var o;return Rn(this,void 0,void 0,function*(){try{if(!((o=this.currentSession)===null||o===void 0?void 0:o.access_token))throw new Error("Not logged in.");const{user:l,error:u}=yield this.api.updateUser(this.currentSession.access_token,i);if(u)throw u;if(!l)throw Error("Invalid user data.");const d=Object.assign(Object.assign({},this.currentSession),{user:l});return this._saveSession(d),this._notifyAllSubscribers("USER_UPDATED"),{data:l,user:l,error:null}}catch(l){return{data:null,user:null,error:l}}})}setSession(i){return Rn(this,void 0,void 0,function*(){try{if(!i)throw new Error("No current session.");const{data:o,error:l}=yield this.api.refreshAccessToken(i);return l?{session:null,error:l}:(this._saveSession(o),this._notifyAllSubscribers("SIGNED_IN"),{session:o,error:null})}catch(o){return{error:o,session:null}}})}setAuth(i){return this.currentSession=Object.assign(Object.assign({},this.currentSession),{access_token:i,token_type:"bearer",user:null}),this.currentSession}getSessionFromUrl(i){return Rn(this,void 0,void 0,function*(){try{if(!Ra())throw new Error("No browser detected.");const o=Fa("error_description");if(o)throw new Error(o);const l=Fa("provider_token"),u=Fa("access_token");if(!u)throw new Error("No access_token detected.");const d=Fa("expires_in");if(!d)throw new Error("No expires_in detected.");const g=Fa("refresh_token");if(!g)throw new Error("No refresh_token detected.");const a=Fa("token_type");if(!a)throw new Error("No token_type detected.");const S=Math.round(Date.now()/1e3)+parseInt(d),{user:C,error:k}=yield this.api.getUser(u);if(k)throw k;const F={provider_token:l,access_token:u,expires_in:parseInt(d),expires_at:S,refresh_token:g,token_type:a,user:C};if(i==null?void 0:i.storeSession){this._saveSession(F);const R=Fa("type");this._notifyAllSubscribers("SIGNED_IN"),R==="recovery"&&this._notifyAllSubscribers("PASSWORD_RECOVERY")}return window.location.hash="",{data:F,error:null}}catch(o){return{data:null,error:o}}})}signOut(){var i;return Rn(this,void 0,void 0,function*(){const o=(i=this.currentSession)===null||i===void 0?void 0:i.access_token;if(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"),o){const{error:l}=yield this.api.signOut(o);if(l)return{error:l}}return{error:null}})}onAuthStateChange(i){try{const o=VB(),l={id:o,callback:i,unsubscribe:()=>{this.stateChangeEmitters.delete(o)}};return this.stateChangeEmitters.set(o,l),{data:l,error:null}}catch(o){return{data:null,error:o}}}_handleEmailSignIn(i,o,l={}){var u,d;return Rn(this,void 0,void 0,function*(){try{const{data:g,error:a}=yield this.api.signInWithEmail(i,o,{redirectTo:l.redirectTo});return a||!g?{data:null,user:null,session:null,error:a}:((((u=g==null?void 0:g.user)===null||u===void 0?void 0:u.confirmed_at)||((d=g==null?void 0:g.user)===null||d===void 0?void 0:d.email_confirmed_at))&&(this._saveSession(g),this._notifyAllSubscribers("SIGNED_IN")),{data:g,user:g.user,session:g,error:null})}catch(g){return{data:null,user:null,session:null,error:g}}})}_handlePhoneSignIn(i,o){var l;return Rn(this,void 0,void 0,function*(){try{const{data:u,error:d}=yield this.api.signInWithPhone(i,o);return d||!u?{data:null,user:null,session:null,error:d}:(((l=u==null?void 0:u.user)===null||l===void 0?void 0:l.phone_confirmed_at)&&(this._saveSession(u),this._notifyAllSubscribers("SIGNED_IN")),{data:u,user:u.user,session:u,error:null})}catch(u){return{data:null,user:null,session:null,error:u}}})}_handleProviderSignIn(i,o={}){const l=this.api.getUrlForProvider(i,{redirectTo:o.redirectTo,scopes:o.scopes});try{return Ra()&&(window.location.href=l),{provider:i,url:l,data:null,session:null,user:null,error:null}}catch(u){return l?{provider:i,url:l,data:null,session:null,user:null,error:null}:{data:null,user:null,session:null,error:u}}}_handleOpenIDConnectSignIn({id_token:i,nonce:o,client_id:l,issuer:u,provider:d}){return Rn(this,void 0,void 0,function*(){if(i&&o&&(l&&u||d))try{const{data:g,error:a}=yield this.api.signInWithOpenIDConnect({id_token:i,nonce:o,client_id:l,issuer:u,provider:d});return a||!g?{user:null,session:null,error:a}:(this._saveSession(g),this._notifyAllSubscribers("SIGNED_IN"),{user:g.user,session:g,error:null})}catch(g){return{user:null,session:null,error:g}}throw new Error("You must provide a OpenID Connect provider with your id token and nonce.")})}_recoverSession(){var i;try{const o=Ra()&&((i=this.localStorage)===null||i===void 0?void 0:i.getItem(df));if(!o||typeof o!="string")return null;const l=JSON.parse(o),{currentSession:u,expiresAt:d}=l,g=Math.round(Date.now()/1e3);d>=g&&(u==null?void 0:u.user)&&(this._saveSession(u),this._notifyAllSubscribers("SIGNED_IN"))}catch(o){console.log("error",o)}}_recoverAndRefresh(){return Rn(this,void 0,void 0,function*(){try{const i=Ra()&&(yield this.localStorage.getItem(df));if(!i)return null;const o=JSON.parse(i),{currentSession:l,expiresAt:u}=o,d=Math.round(Date.now()/1e3);if(u<d)if(this.autoRefreshToken&&l.refresh_token){const{error:g}=yield this._callRefreshToken(l.refresh_token);g&&(console.log(g.message),yield this._removeSession())}else this._removeSession();else!l||!l.user?(console.log("Current session is missing data."),this._removeSession()):(this._saveSession(l),this._notifyAllSubscribers("SIGNED_IN"))}catch(i){return console.error(i),null}})}_callRefreshToken(i){var o;return i===void 0&&(i=(o=this.currentSession)===null||o===void 0?void 0:o.refresh_token),Rn(this,void 0,void 0,function*(){try{if(!i)throw new Error("No current session.");const{data:l,error:u}=yield this.api.refreshAccessToken(i);if(u)throw u;if(!l)throw Error("Invalid session data.");return this._saveSession(l),this._notifyAllSubscribers("TOKEN_REFRESHED"),this._notifyAllSubscribers("SIGNED_IN"),{data:l,error:null}}catch(l){return{data:null,error:l}}})}_notifyAllSubscribers(i){this.stateChangeEmitters.forEach(o=>o.callback(i,this.currentSession))}_saveSession(i){this.currentSession=i,this.currentUser=i.user;const o=i.expires_at;if(o){const l=Math.round(Date.now()/1e3),u=o-l,d=u>60?60:.5;this._startAutoRefreshToken((u-d)*1e3)}this.persistSession&&i.expires_at&&this._persistSession(this.currentSession)}_persistSession(i){const o={currentSession:i,expiresAt:i.expires_at};Ra()&&this.localStorage.setItem(df,JSON.stringify(o))}_removeSession(){return Rn(this,void 0,void 0,function*(){this.currentSession=null,this.currentUser=null,this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),Ra()&&(yield this.localStorage.removeItem(df))})}_startAutoRefreshToken(i){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),!(i<=0||!this.autoRefreshToken)&&(this.refreshTokenTimer=setTimeout(()=>this._callRefreshToken(),i),typeof this.refreshTokenTimer.unref=="function"&&this.refreshTokenTimer.unref())}_listenForMultiTabEvents(){if(!this.multiTab||!Ra()||!(window==null?void 0:window.addEventListener))return!1;try{window==null||window.addEventListener("storage",i=>{var o;if(i.key===df){const l=JSON.parse(String(i.newValue));((o=l==null?void 0:l.currentSession)===null||o===void 0?void 0:o.access_token)?(this._recoverAndRefresh(),this._notifyAllSubscribers("SIGNED_IN")):(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"))}})}catch(i){console.error("_listenForMultiTabEvents",i)}}}class WB extends ZB{constructor(i){super(i)}}var HB=globalThis&&globalThis.__awaiter||function(t,i,o,l){function u(d){return d instanceof o?d:new o(function(g){g(d)})}return new(o||(o=Promise))(function(d,g){function a(C){try{S(l.next(C))}catch(k){g(k)}}function w(C){try{S(l.throw(C))}catch(k){g(k)}}function S(C){C.done?d(C.value):u(C.value).then(a,w)}S((l=l.apply(t,i||[])).next())})};class Hx{constructor(i){this.shouldThrowOnError=!1,Object.assign(this,i),this.fetch=i.fetch||p_}throwOnError(){return this.shouldThrowOnError=!0,this}then(i,o){typeof this.schema=="undefined"||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let l=this.fetch(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(u=>HB(this,void 0,void 0,function*(){var d,g,a;let w=null,S=null,C=null;if(u.ok){const F=(d=this.headers.Prefer)===null||d===void 0?void 0:d.split(",").includes("return=minimal");if(this.method!=="HEAD"&&!F){const Z=yield u.text();Z&&(this.headers.Accept==="text/csv"?S=Z:S=JSON.parse(Z))}const R=(g=this.headers.Prefer)===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),W=(a=u.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");R&&W&&W.length>1&&(C=parseInt(W[1]))}else{const F=yield u.text();try{w=JSON.parse(F)}catch{w={message:F}}if(w&&this.shouldThrowOnError)throw w}return{error:w,data:S,count:C,status:u.status,statusText:u.statusText,body:S}}));return this.shouldThrowOnError||(l=l.catch(u=>({error:{message:`FetchError: ${u.message}`,details:"",hint:"",code:u.code||""},data:null,body:null,count:null,status:400,statusText:"Bad Request"}))),l.then(i,o)}}class Xx extends Hx{select(i="*"){let o=!1;const l=i.split("").map(u=>/\s/.test(u)&&!o?"":(u==='"'&&(o=!o),u)).join("");return this.url.searchParams.set("select",l),this}order(i,{ascending:o=!0,nullsFirst:l=!1,foreignTable:u}={}){const d=typeof u=="undefined"?"order":`${u}.order`,g=this.url.searchParams.get(d);return this.url.searchParams.set(d,`${g?`${g},`:""}${i}.${o?"asc":"desc"}.${l?"nullsfirst":"nullslast"}`),this}limit(i,{foreignTable:o}={}){const l=typeof o=="undefined"?"limit":`${o}.limit`;return this.url.searchParams.set(l,`${i}`),this}range(i,o,{foreignTable:l}={}){const u=typeof l=="undefined"?"offset":`${l}.offset`,d=typeof l=="undefined"?"limit":`${l}.limit`;return this.url.searchParams.set(u,`${i}`),this.url.searchParams.set(d,`${o-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){this.headers.Accept="application/vnd.pgrst.object+json";const i=new Xx(this);return i.then=(o,l)=>this.then(u=>{var d,g;return((g=(d=u.error)===null||d===void 0?void 0:d.details)===null||g===void 0?void 0:g.includes("Results contain 0 rows"))?o({error:null,data:null,count:u.count,status:200,statusText:"OK",body:null}):o(u)},l),i}csv(){return this.headers.Accept="text/csv",this}}class Eu extends Xx{constructor(){super(...arguments);this.cs=this.contains,this.cd=this.containedBy,this.sl=this.rangeLt,this.sr=this.rangeGt,this.nxl=this.rangeGte,this.nxr=this.rangeLte,this.adj=this.rangeAdjacent,this.ov=this.overlaps}not(i,o,l){return this.url.searchParams.append(`${i}`,`not.${o}.${l}`),this}or(i,{foreignTable:o}={}){const l=typeof o=="undefined"?"or":`${o}.or`;return this.url.searchParams.append(l,`(${i})`),this}eq(i,o){return this.url.searchParams.append(`${i}`,`eq.${o}`),this}neq(i,o){return this.url.searchParams.append(`${i}`,`neq.${o}`),this}gt(i,o){return this.url.searchParams.append(`${i}`,`gt.${o}`),this}gte(i,o){return this.url.searchParams.append(`${i}`,`gte.${o}`),this}lt(i,o){return this.url.searchParams.append(`${i}`,`lt.${o}`),this}lte(i,o){return this.url.searchParams.append(`${i}`,`lte.${o}`),this}like(i,o){return this.url.searchParams.append(`${i}`,`like.${o}`),this}ilike(i,o){return this.url.searchParams.append(`${i}`,`ilike.${o}`),this}is(i,o){return this.url.searchParams.append(`${i}`,`is.${o}`),this}in(i,o){const l=o.map(u=>typeof u=="string"&&new RegExp("[,()]").test(u)?`"${u}"`:`${u}`).join(",");return this.url.searchParams.append(`${i}`,`in.(${l})`),this}contains(i,o){return typeof o=="string"?this.url.searchParams.append(`${i}`,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(`${i}`,`cs.{${o.join(",")}}`):this.url.searchParams.append(`${i}`,`cs.${JSON.stringify(o)}`),this}containedBy(i,o){return typeof o=="string"?this.url.searchParams.append(`${i}`,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(`${i}`,`cd.{${o.join(",")}}`):this.url.searchParams.append(`${i}`,`cd.${JSON.stringify(o)}`),this}rangeLt(i,o){return this.url.searchParams.append(`${i}`,`sl.${o}`),this}rangeGt(i,o){return this.url.searchParams.append(`${i}`,`sr.${o}`),this}rangeGte(i,o){return this.url.searchParams.append(`${i}`,`nxl.${o}`),this}rangeLte(i,o){return this.url.searchParams.append(`${i}`,`nxr.${o}`),this}rangeAdjacent(i,o){return this.url.searchParams.append(`${i}`,`adj.${o}`),this}overlaps(i,o){return typeof o=="string"?this.url.searchParams.append(`${i}`,`ov.${o}`):this.url.searchParams.append(`${i}`,`ov.{${o.join(",")}}`),this}textSearch(i,o,{config:l,type:u=null}={}){let d="";u==="plain"?d="pl":u==="phrase"?d="ph":u==="websearch"&&(d="w");const g=l===void 0?"":`(${l})`;return this.url.searchParams.append(`${i}`,`${d}fts${g}.${o}`),this}fts(i,o,{config:l}={}){const u=typeof l=="undefined"?"":`(${l})`;return this.url.searchParams.append(`${i}`,`fts${u}.${o}`),this}plfts(i,o,{config:l}={}){const u=typeof l=="undefined"?"":`(${l})`;return this.url.searchParams.append(`${i}`,`plfts${u}.${o}`),this}phfts(i,o,{config:l}={}){const u=typeof l=="undefined"?"":`(${l})`;return this.url.searchParams.append(`${i}`,`phfts${u}.${o}`),this}wfts(i,o,{config:l}={}){const u=typeof l=="undefined"?"":`(${l})`;return this.url.searchParams.append(`${i}`,`wfts${u}.${o}`),this}filter(i,o,l){return this.url.searchParams.append(`${i}`,`${o}.${l}`),this}match(i){return Object.keys(i).forEach(o=>{this.url.searchParams.append(`${o}`,`eq.${i[o]}`)}),this}}class dA extends Hx{constructor(i,{headers:o={},schema:l,fetch:u}={}){super({fetch:u});this.url=new URL(i),this.headers=Object.assign({},o),this.schema=l}select(i="*",{head:o=!1,count:l=null}={}){this.method="GET";let u=!1;const d=i.split("").map(g=>/\s/.test(g)&&!u?"":(g==='"'&&(u=!u),g)).join("");return this.url.searchParams.set("select",d),l&&(this.headers.Prefer=`count=${l}`),o&&(this.method="HEAD"),new Eu(this)}insert(i,{upsert:o=!1,onConflict:l,returning:u="representation",count:d=null}={}){this.method="POST";const g=[`return=${u}`];if(o&&g.push("resolution=merge-duplicates"),o&&l!==void 0&&this.url.searchParams.set("on_conflict",l),this.body=i,d&&g.push(`count=${d}`),this.headers.Prefer&&g.unshift(this.headers.Prefer),this.headers.Prefer=g.join(","),Array.isArray(i)){const a=i.reduce((w,S)=>w.concat(Object.keys(S)),[]);if(a.length>0){const w=[...new Set(a)].map(S=>`"${S}"`);this.url.searchParams.set("columns",w.join(","))}}return new Eu(this)}upsert(i,{onConflict:o,returning:l="representation",count:u=null,ignoreDuplicates:d=!1}={}){this.method="POST";const g=[`resolution=${d?"ignore":"merge"}-duplicates`,`return=${l}`];return o!==void 0&&this.url.searchParams.set("on_conflict",o),this.body=i,u&&g.push(`count=${u}`),this.headers.Prefer&&g.unshift(this.headers.Prefer),this.headers.Prefer=g.join(","),new Eu(this)}update(i,{returning:o="representation",count:l=null}={}){this.method="PATCH";const u=[`return=${o}`];return this.body=i,l&&u.push(`count=${l}`),this.headers.Prefer&&u.unshift(this.headers.Prefer),this.headers.Prefer=u.join(","),new Eu(this)}delete({returning:i="representation",count:o=null}={}){this.method="DELETE";const l=[`return=${i}`];return o&&l.push(`count=${o}`),this.headers.Prefer&&l.unshift(this.headers.Prefer),this.headers.Prefer=l.join(","),new Eu(this)}}class XB extends Hx{constructor(i,{headers:o={},schema:l,fetch:u}={}){super({fetch:u});this.url=new URL(i),this.headers=Object.assign({},o),this.schema=l}rpc(i,{head:o=!1,count:l=null}={}){return o?(this.method="HEAD",i&&Object.entries(i).forEach(([u,d])=>{this.url.searchParams.append(u,d)})):(this.method="POST",this.body=i),l&&(this.headers.Prefer!==void 0?this.headers.Prefer+=`,count=${l}`:this.headers.Prefer=`count=${l}`),new Eu(this)}}const KB="0.36.0",YB={"X-Client-Info":`postgrest-js/${KB}`};class QB{constructor(i,{headers:o={},schema:l,fetch:u}={}){this.url=i,this.headers=Object.assign(Object.assign({},YB),o),this.schema=l,this.fetch=u}auth(i){return this.headers.Authorization=`Bearer ${i}`,this}from(i){const o=`${this.url}/${i}`;return new dA(o,{headers:this.headers,schema:this.schema,fetch:this.fetch})}rpc(i,o,{head:l=!1,count:u=null}={}){const d=`${this.url}/rpc/${i}`;return new XB(d,{headers:this.headers,schema:this.schema,fetch:this.fetch}).rpc(o,{head:l,count:u})}}var Qi;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Qi||(Qi={}));const I2=(t,i,o={})=>{var l;const u=(l=o.skipTypes)!==null&&l!==void 0?l:[];return Object.keys(i).reduce((d,g)=>(d[g]=JB(g,t,i,u),d),{})},JB=(t,i,o,l)=>{const u=i.find(a=>a.name===t),d=u==null?void 0:u.type,g=o[t];return d&&!l.includes(d)?pA(d,g):Ly(g)},pA=(t,i)=>{if(t.charAt(0)==="_"){const o=t.slice(1,t.length);return r4(i,o)}switch(t){case Qi.bool:return e4(i);case Qi.float4:case Qi.float8:case Qi.int2:case Qi.int4:case Qi.int8:case Qi.numeric:case Qi.oid:return t4(i);case Qi.json:case Qi.jsonb:return i4(i);case Qi.timestamp:return n4(i);case Qi.abstime:case Qi.date:case Qi.daterange:case Qi.int4range:case Qi.int8range:case Qi.money:case Qi.reltime:case Qi.text:case Qi.time:case Qi.timestamptz:case Qi.timetz:case Qi.tsrange:case Qi.tstzrange:return Ly(i);default:return Ly(i)}},Ly=t=>t,e4=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},t4=t=>{if(typeof t=="string"){const i=parseFloat(t);if(!Number.isNaN(i))return i}return t},i4=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(i){return console.log(`JSON parse error: ${i}`),t}return t},r4=(t,i)=>{if(typeof t!="string")return t;const o=t.length-1,l=t[o];if(t[0]==="{"&&l==="}"){let d;const g=t.slice(1,o);try{d=JSON.parse("["+g+"]")}catch{d=g?g.split(","):[]}return d.map(a=>pA(i,a))}return t},n4=t=>typeof t=="string"?t.replace(" ","T"):t,s4="1.3.5",o4={"X-Client-Info":`realtime-js/${s4}`},a4="1.0.0",mA=1e4,l4=1e3;var Lf;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Lf||(Lf={}));var Fn;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Fn||(Fn={}));var Gs;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Gs||(Gs={}));var Oy;(function(t){t.websocket="websocket"})(Oy||(Oy={}));class _A{constructor(i,o){this.callback=i,this.timerCalc=o,this.timer=void 0,this.tries=0,this.callback=i,this.timerCalc=o}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class x0{constructor(i,o,l={},u=mA){this.channel=i,this.event=o,this.payload=l,this.timeout=u,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(i){this.timeout=i,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref}))}updatePayload(i){this.payload=Object.assign(Object.assign({},this.payload),i)}receive(i,o){var l;return this._hasReceived(i)&&o((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:i,callback:o}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(i,o){this.refEvent&&this.channel.trigger(this.refEvent,{status:i,response:o})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){!this.refEvent||this.channel.off(this.refEvent)}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:i,response:o}){this.recHooks.filter(l=>l.status===i).forEach(l=>l.callback(o))}_hasReceived(i){return this.receivedResp&&this.receivedResp.status===i}}class c4{constructor(i,o={},l){this.topic=i,this.params=o,this.socket=l,this.bindings=[],this.state=Fn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.timeout=this.socket.timeout,this.joinPush=new x0(this,Gs.join,this.params,this.timeout),this.rejoinTimer=new _A(()=>this.rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Fn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(u=>u.send()),this.pushBuffer=[]}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=Fn.closed,this.socket.remove(this)}),this.onError(u=>{this.isLeaving()||this.isClosed()||(this.socket.log("channel",`error ${this.topic}`,u),this.state=Fn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{!this.isJoining()||(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Fn.errored,this.rejoinTimer.scheduleTimeout())}),this.on(Gs.reply,(u,d)=>{this.trigger(this.replyEventName(d),u)})}rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}subscribe(i=this.timeout){if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(i),this.joinPush}onClose(i){this.on(Gs.close,i)}onError(i){this.on(Gs.error,o=>i(o))}on(i,o){this.bindings.push({event:i,callback:o})}off(i){this.bindings=this.bindings.filter(o=>o.event!==i)}canPush(){return this.socket.isConnected()&&this.isJoined()}push(i,o,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${i}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let u=new x0(this,i,o,l);return this.canPush()?u.send():(u.startTimeout(),this.pushBuffer.push(u)),u}updateJoinPayload(i){this.joinPush.updatePayload(i)}unsubscribe(i=this.timeout){this.state=Fn.leaving;let o=()=>{this.socket.log("channel",`leave ${this.topic}`),this.trigger(Gs.close,"leave",this.joinRef())};this.joinPush.destroy();let l=new x0(this,Gs.leave,{},i);return l.receive("ok",()=>o()).receive("timeout",()=>o()),l.send(),this.canPush()||l.trigger("ok",{}),l}onMessage(i,o,l){return o}isMember(i){return this.topic===i}joinRef(){return this.joinPush.ref}rejoin(i=this.timeout){this.isLeaving()||(this.socket.leaveOpenTopic(this.topic),this.state=Fn.joining,this.joinPush.resend(i))}trigger(i,o,l){let{close:u,error:d,leave:g,join:a}=Gs;if(l&&[u,d,g,a].indexOf(i)>=0&&l!==this.joinRef())return;let S=this.onMessage(i,o,l);if(o&&!S)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter(C=>C.event==="*"?i===(o==null?void 0:o.type):C.event===i).map(C=>C.callback(S,l))}replyEventName(i){return`chan_reply_${i}`}isClosed(){return this.state===Fn.closed}isErrored(){return this.state===Fn.errored}isJoined(){return this.state===Fn.joined}isJoining(){return this.state===Fn.joining}isLeaving(){return this.state===Fn.leaving}}const u4="websocket",h4="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",f4=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],d4="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",p4=["I\xF1aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],m4="1.0.34",_4={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},g4="https://github.com/theturtle32/WebSocket-Node",y4={node:">=4.0.0"},x4={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},v4={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},b4={verbose:!1},w4={test:"tape test/unit/*.js",gulp:"gulp"},T4="index",E4={lib:"./lib"},S4="lib/browser.js",A4="Apache-2.0";var C4={name:u4,description:h4,keywords:f4,author:d4,contributors:p4,version:m4,repository:_4,homepage:g4,engines:y4,dependencies:x4,devDependencies:v4,config:b4,scripts:w4,main:T4,directories:E4,browser:S4,license:A4},I4=C4.version,Jl;if(typeof globalThis=="object")Jl=globalThis;else try{Jl=require("es5-ext/global")}catch{}finally{if(!Jl&&typeof window!="undefined"&&(Jl=window),!Jl)throw new Error("Could not determine global this")}var ed=Jl.WebSocket||Jl.MozWebSocket,M4=I4;function gA(t,i){var o;return i?o=new ed(t,i):o=new ed(t),o}ed&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(t){Object.defineProperty(gA,t,{get:function(){return ed[t]}})});var k4={w3cwebsocket:ed?gA:null,version:M4};class P4{constructor(){this.HEADER_LENGTH=1}decode(i,o){return i.constructor===ArrayBuffer?o(this._binaryDecode(i)):o(typeof i=="string"?JSON.parse(i):{})}_binaryDecode(i){const o=new DataView(i),l=new TextDecoder;return this._decodeBroadcast(i,o,l)}_decodeBroadcast(i,o,l){const u=o.getUint8(1),d=o.getUint8(2);let g=this.HEADER_LENGTH+2;const a=l.decode(i.slice(g,g+u));g=g+u;const w=l.decode(i.slice(g,g+d));g=g+d;const S=JSON.parse(l.decode(i.slice(g,i.byteLength)));return{ref:null,topic:a,event:w,payload:S}}}var D4=globalThis&&globalThis.__awaiter||function(t,i,o,l){function u(d){return d instanceof o?d:new o(function(g){g(d)})}return new(o||(o=Promise))(function(d,g){function a(C){try{S(l.next(C))}catch(k){g(k)}}function w(C){try{S(l.throw(C))}catch(k){g(k)}}function S(C){C.done?d(C.value):u(C.value).then(a,w)}S((l=l.apply(t,i||[])).next())})};const z4=()=>{};class R4{constructor(i,o){this.accessToken=null,this.channels=[],this.endPoint="",this.headers=o4,this.params={},this.timeout=mA,this.transport=k4.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.longpollerTimeout=2e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=z4,this.conn=null,this.sendBuffer=[],this.serializer=new P4,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.endPoint=`${i}/${Oy.websocket}`,(o==null?void 0:o.params)&&(this.params=o.params),(o==null?void 0:o.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),o.headers)),(o==null?void 0:o.timeout)&&(this.timeout=o.timeout),(o==null?void 0:o.logger)&&(this.logger=o.logger),(o==null?void 0:o.transport)&&(this.transport=o.transport),(o==null?void 0:o.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=o.heartbeatIntervalMs),(o==null?void 0:o.longpollerTimeout)&&(this.longpollerTimeout=o.longpollerTimeout),this.reconnectAfterMs=(o==null?void 0:o.reconnectAfterMs)?o.reconnectAfterMs:l=>[1e3,2e3,5e3,1e4][l-1]||1e4,this.encode=(o==null?void 0:o.encode)?o.encode:(l,u)=>u(JSON.stringify(l)),this.decode=(o==null?void 0:o.decode)?o.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new _A(()=>D4(this,void 0,void 0,function*(){yield this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this.endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=i=>this._onConnError(i),this.conn.onmessage=i=>this.onConnMessage(i),this.conn.onclose=i=>this._onConnClose(i)))}disconnect(i,o){return new Promise((l,u)=>{try{this.conn&&(this.conn.onclose=function(){},i?this.conn.close(i,o||""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset()),l({error:null,data:!0})}catch(d){l({error:d,data:!1})}})}log(i,o,l){this.logger(i,o,l)}onOpen(i){this.stateChangeCallbacks.open.push(i)}onClose(i){this.stateChangeCallbacks.close.push(i)}onError(i){this.stateChangeCallbacks.error.push(i)}onMessage(i){this.stateChangeCallbacks.message.push(i)}connectionState(){switch(this.conn&&this.conn.readyState){case Lf.connecting:return"connecting";case Lf.open:return"open";case Lf.closing:return"closing";default:return"closed"}}isConnected(){return this.connectionState()==="open"}remove(i){this.channels=this.channels.filter(o=>o.joinRef()!==i.joinRef())}channel(i,o={}){let l=new c4(i,o,this);return this.channels.push(l),l}push(i){let{topic:o,event:l,payload:u,ref:d}=i,g=()=>{this.encode(i,a=>{var w;(w=this.conn)===null||w===void 0||w.send(a)})};this.log("push",`${o} ${l} (${d})`,u),this.isConnected()?g():this.sendBuffer.push(g)}onConnMessage(i){this.decode(i.data,o=>{let{topic:l,event:u,payload:d,ref:g}=o;g&&g===this.pendingHeartbeatRef?this.pendingHeartbeatRef=null:u===(d==null?void 0:d.type)&&this._resetHeartbeat(),this.log("receive",`${d.status||""} ${l} ${u} ${g&&"("+g+")"||""}`,d),this.channels.filter(a=>a.isMember(l)).forEach(a=>a.trigger(u,d,g)),this.stateChangeCallbacks.message.forEach(a=>a(o))})}endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:a4}))}makeRef(){let i=this.ref+1;return i===this.ref?this.ref=0:this.ref=i,this.ref.toString()}setAuth(i){this.accessToken=i;try{this.channels.forEach(o=>{i&&o.updateJoinPayload({user_token:i}),o.joinedOnce&&o.isJoined()&&o.push(Gs.access_token,{access_token:i})})}catch(o){console.log("setAuth error",o)}}leaveOpenTopic(i){let o=this.channels.find(l=>l.topic===i&&(l.isJoined()||l.isJoining()));o&&(this.log("transport",`leaving duplicate topic "${i}"`),o.unsubscribe())}_onConnOpen(){this.log("transport",`connected to ${this.endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this._resetHeartbeat(),this.stateChangeCallbacks.open.forEach(i=>i())}_onConnClose(i){this.log("transport","close",i),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(o=>o(i))}_onConnError(i){this.log("transport",i.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(o=>o(i))}_triggerChanError(){this.channels.forEach(i=>i.trigger(Gs.error))}_appendParams(i,o){if(Object.keys(o).length===0)return i;const l=i.match(/\?/)?"&":"?",u=new URLSearchParams(o);return`${i}${l}${u}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(i=>i()),this.sendBuffer=[])}_resetHeartbeat(){this.pendingHeartbeatRef=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs)}_sendHeartbeat(){var i;if(!!this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(i=this.conn)===null||i===void 0||i.close(l4,"hearbeat timeout");return}this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class F4{constructor(i,o,l,u){const d={},g=u==="*"?`realtime:${l}`:`realtime:${l}:${u}`,a=o.Authorization.split(" ")[1];a&&(d.user_token=a),this.subscription=i.channel(g,d)}getPayloadRecords(i){const o={new:{},old:{}};return(i.type==="INSERT"||i.type==="UPDATE")&&(o.new=I2(i.columns,i.record)),(i.type==="UPDATE"||i.type==="DELETE")&&(o.old=I2(i.columns,i.old_record)),o}on(i,o){return this.subscription.on(i,l=>{let u={schema:l.schema,table:l.table,commit_timestamp:l.commit_timestamp,eventType:l.type,new:{},old:{},errors:l.errors};u=Object.assign(Object.assign({},u),this.getPayloadRecords(l)),o(u)}),this}subscribe(i=()=>{}){return this.subscription.onError(o=>i("SUBSCRIPTION_ERROR",o)),this.subscription.onClose(()=>i("CLOSED")),this.subscription.subscribe().receive("ok",()=>i("SUBSCRIBED")).receive("error",o=>i("SUBSCRIPTION_ERROR",o)).receive("timeout",()=>i("RETRYING_AFTER_TIMEOUT")),this.subscription}}class L4 extends dA{constructor(i,{headers:o={},schema:l,realtime:u,table:d,fetch:g}){super(i,{headers:o,schema:l,fetch:g});this._subscription=null,this._realtime=u,this._headers=o,this._schema=l,this._table=d}on(i,o){return this._realtime.isConnected()||this._realtime.connect(),this._subscription||(this._subscription=new F4(this._realtime,this._headers,this._schema,this._table)),this._subscription.on(i,o)}}var fd=globalThis&&globalThis.__awaiter||function(t,i,o,l){function u(d){return d instanceof o?d:new o(function(g){g(d)})}return new(o||(o=Promise))(function(d,g){function a(C){try{S(l.next(C))}catch(k){g(k)}}function w(C){try{S(l.throw(C))}catch(k){g(k)}}function S(C){C.done?d(C.value):u(C.value).then(a,w)}S((l=l.apply(t,i||[])).next())})};const O4=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),B4=(t,i)=>{if(typeof t.json!="function")return i(t);t.json().then(o=>i({message:O4(o),status:(t==null?void 0:t.status)||500}))},U4=(t,i,o,l)=>{const u={method:t,headers:(i==null?void 0:i.headers)||{}};return t==="GET"?u:(u.headers=Object.assign({"Content-Type":"application/json"},i==null?void 0:i.headers),u.body=JSON.stringify(l),Object.assign(Object.assign({},u),o))};function __(t=p_,i,o,l,u,d){return fd(this,void 0,void 0,function*(){return new Promise((g,a)=>{t(o,U4(i,l,u,d)).then(w=>{if(!w.ok)throw w;return(l==null?void 0:l.noResolveJson)?g(w):w.json()}).then(w=>g(w)).catch(w=>B4(w,a))})})}function By(t,i,o,l){return fd(this,void 0,void 0,function*(){return __(t,"GET",i,o,l)})}function Of(t,i,o,l,u){return fd(this,void 0,void 0,function*(){return __(t,"POST",i,l,u,o)})}function N4(t,i,o,l,u){return fd(this,void 0,void 0,function*(){return __(t,"PUT",i,l,u,o)})}function yA(t,i,o,l,u){return fd(this,void 0,void 0,function*(){return __(t,"DELETE",i,l,u,o)})}const j4="0.0.0",V4={"X-Client-Info":`storage-js/${j4}`};var vu=globalThis&&globalThis.__awaiter||function(t,i,o,l){function u(d){return d instanceof o?d:new o(function(g){g(d)})}return new(o||(o=Promise))(function(d,g){function a(C){try{S(l.next(C))}catch(k){g(k)}}function w(C){try{S(l.throw(C))}catch(k){g(k)}}function S(C){C.done?d(C.value):u(C.value).then(a,w)}S((l=l.apply(t,i||[])).next())})};class $4{constructor(i,o={},l){this.url=i,this.headers=Object.assign(Object.assign({},V4),o),this.fetch=l}listBuckets(){return vu(this,void 0,void 0,function*(){try{return{data:yield By(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(i){return{data:null,error:i}}})}getBucket(i){return vu(this,void 0,void 0,function*(){try{return{data:yield By(this.fetch,`${this.url}/bucket/${i}`,{headers:this.headers}),error:null}}catch(o){return{data:null,error:o}}})}createBucket(i,o={public:!1}){return vu(this,void 0,void 0,function*(){try{return{data:(yield Of(this.fetch,`${this.url}/bucket`,{id:i,name:i,public:o.public},{headers:this.headers})).name,error:null}}catch(l){return{data:null,error:l}}})}updateBucket(i,o){return vu(this,void 0,void 0,function*(){try{return{data:yield N4(this.fetch,`${this.url}/bucket/${i}`,{id:i,name:i,public:o.public},{headers:this.headers}),error:null}}catch(l){return{data:null,error:l}}})}emptyBucket(i){return vu(this,void 0,void 0,function*(){try{return{data:yield Of(this.fetch,`${this.url}/bucket/${i}/empty`,{},{headers:this.headers}),error:null}}catch(o){return{data:null,error:o}}})}deleteBucket(i){return vu(this,void 0,void 0,function*(){try{return{data:yield yA(this.fetch,`${this.url}/bucket/${i}`,{},{headers:this.headers}),error:null}}catch(o){return{data:null,error:o}}})}}var La=globalThis&&globalThis.__awaiter||function(t,i,o,l){function u(d){return d instanceof o?d:new o(function(g){g(d)})}return new(o||(o=Promise))(function(d,g){function a(C){try{S(l.next(C))}catch(k){g(k)}}function w(C){try{S(l.throw(C))}catch(k){g(k)}}function S(C){C.done?d(C.value):u(C.value).then(a,w)}S((l=l.apply(t,i||[])).next())})};const G4={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},q4={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Z4{constructor(i,o={},l,u){this.url=i,this.headers=o,this.bucketId=l,this.fetch=u}uploadOrUpdate(i,o,l,u){return La(this,void 0,void 0,function*(){try{let d;const g=Object.assign(Object.assign({},q4),u),a=Object.assign(Object.assign({},this.headers),i==="POST"&&{"x-upsert":String(g.upsert)});typeof Blob!="undefined"&&l instanceof Blob?(d=new FormData,d.append("cacheControl",g.cacheControl),d.append("",l)):typeof FormData!="undefined"&&l instanceof FormData?(d=l,d.append("cacheControl",g.cacheControl)):(d=l,a["cache-control"]=`max-age=${g.cacheControl}`,a["content-type"]=g.contentType);const w=this._removeEmptyFolders(o),S=this._getFinalPath(w),C=yield p_(`${this.url}/object/${S}`,{method:i,body:d,headers:a});if(C.ok)return{data:{Key:S},error:null};{const k=yield C.json();return{data:null,error:k}}}catch(d){return{data:null,error:d}}})}upload(i,o,l){return La(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",i,o,l)})}update(i,o,l){return La(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",i,o,l)})}move(i,o){return La(this,void 0,void 0,function*(){try{return{data:yield Of(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:i,destinationKey:o},{headers:this.headers}),error:null}}catch(l){return{data:null,error:l}}})}createSignedUrl(i,o){return La(this,void 0,void 0,function*(){try{const l=this._getFinalPath(i);let u=yield Of(this.fetch,`${this.url}/object/sign/${l}`,{expiresIn:o},{headers:this.headers});const d=`${this.url}${u.signedURL}`;return u={signedURL:d},{data:u,error:null,signedURL:d}}catch(l){return{data:null,error:l,signedURL:null}}})}download(i){return La(this,void 0,void 0,function*(){try{const o=this._getFinalPath(i);return{data:yield(yield By(this.fetch,`${this.url}/object/${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){return{data:null,error:o}}})}getPublicUrl(i){try{const o=this._getFinalPath(i),l=`${this.url}/object/public/${o}`;return{data:{publicURL:l},error:null,publicURL:l}}catch(o){return{data:null,error:o,publicURL:null}}}remove(i){return La(this,void 0,void 0,function*(){try{return{data:yield yA(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:i},{headers:this.headers}),error:null}}catch(o){return{data:null,error:o}}})}list(i,o,l){return La(this,void 0,void 0,function*(){try{const u=Object.assign(Object.assign(Object.assign({},G4),o),{prefix:i||""});return{data:yield Of(this.fetch,`${this.url}/object/list/${this.bucketId}`,u,{headers:this.headers},l),error:null}}catch(u){return{data:null,error:u}}})}_getFinalPath(i){return`${this.bucketId}/${i}`}_removeEmptyFolders(i){return i.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}}class W4 extends $4{constructor(i,o={},l){super(i,o,l)}from(i){return new Z4(this.url,this.headers,i,this.fetch)}}var v0=globalThis&&globalThis.__awaiter||function(t,i,o,l){function u(d){return d instanceof o?d:new o(function(g){g(d)})}return new(o||(o=Promise))(function(d,g){function a(C){try{S(l.next(C))}catch(k){g(k)}}function w(C){try{S(l.throw(C))}catch(k){g(k)}}function S(C){C.done?d(C.value):u(C.value).then(a,w)}S((l=l.apply(t,i||[])).next())})};const H4={schema:"public",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,multiTab:!0,headers:fA};class X4{constructor(i,o,l){if(this.supabaseUrl=i,this.supabaseKey=o,!i)throw new Error("supabaseUrl is required.");if(!o)throw new Error("supabaseKey is required.");const u=MB(i),d=Object.assign(Object.assign({},H4),l);this.restUrl=`${u}/rest/v1`,this.realtimeUrl=`${u}/realtime/v1`.replace("http","ws"),this.authUrl=`${u}/auth/v1`,this.storageUrl=`${u}/storage/v1`,this.schema=d.schema,this.multiTab=d.multiTab,this.fetch=d.fetch,this.headers=Object.assign(Object.assign({},fA),l==null?void 0:l.headers),this.auth=this._initSupabaseAuthClient(d),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},d.realtime)),this._listenForAuthEvents(),this._listenForMultiTabEvents()}get storage(){return new W4(this.storageUrl,this._getAuthHeaders(),this.fetch)}from(i){const o=`${this.restUrl}/${i}`;return new L4(o,{headers:this._getAuthHeaders(),schema:this.schema,realtime:this.realtime,table:i,fetch:this.fetch})}rpc(i,o,{head:l=!1,count:u=null}={}){return this._initPostgRESTClient().rpc(i,o,{head:l,count:u})}removeAllSubscriptions(){return v0(this,void 0,void 0,function*(){const i=this.getSubscriptions().slice(),o=i.map(u=>this.removeSubscription(u));return(yield Promise.all(o)).map(({error:u},d)=>({data:{subscription:i[d]},error:u}))})}removeSubscription(i){return v0(this,void 0,void 0,function*(){const{error:o}=yield this._closeSubscription(i),l=this.getSubscriptions(),u=l.filter(d=>d.isJoined()).length;return l.length===0&&(yield this.realtime.disconnect()),{data:{openSubscriptions:u},error:o}})}_closeSubscription(i){return v0(this,void 0,void 0,function*(){let o=null;if(!i.isClosed()){const{error:l}=yield this._unsubscribeSubscription(i);o=l}return this.realtime.remove(i),{error:o}})}_unsubscribeSubscription(i){return new Promise(o=>{i.unsubscribe().receive("ok",()=>o({error:null})).receive("error",l=>o({error:l})).receive("timeout",()=>o({error:new Error("timed out")}))})}getSubscriptions(){return this.realtime.channels}_initSupabaseAuthClient({autoRefreshToken:i,persistSession:o,detectSessionInUrl:l,localStorage:u,headers:d,fetch:g}){const a={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new WB({url:this.authUrl,headers:Object.assign(Object.assign({},d),a),autoRefreshToken:i,persistSession:o,detectSessionInUrl:l,localStorage:u,fetch:g})}_initRealtimeClient(i){return new R4(this.realtimeUrl,Object.assign(Object.assign({},i),{params:Object.assign(Object.assign({},i==null?void 0:i.params),{apikey:this.supabaseKey})}))}_initPostgRESTClient(){return new QB(this.restUrl,{headers:this._getAuthHeaders(),schema:this.schema,fetch:this.fetch})}_getAuthHeaders(){var i,o;const l=this.headers,u=(o=(i=this.auth.session())===null||i===void 0?void 0:i.access_token)!==null&&o!==void 0?o:this.supabaseKey;return l.apikey=this.supabaseKey,l.Authorization=`Bearer ${u}`,l}_listenForMultiTabEvents(){if(!this.multiTab||!kB()||!(window==null?void 0:window.addEventListener))return null;try{return window==null?void 0:window.addEventListener("storage",i=>{var o,l,u;if(i.key===IB){const d=JSON.parse(String(i.newValue)),g=(l=(o=d==null?void 0:d.currentSession)===null||o===void 0?void 0:o.access_token)!==null&&l!==void 0?l:void 0,a=(u=this.auth.session())===null||u===void 0?void 0:u.access_token;g?!a&&g?this._handleTokenChanged("SIGNED_IN",g,"STORAGE"):a!==g&&this._handleTokenChanged("TOKEN_REFRESHED",g,"STORAGE"):this._handleTokenChanged("SIGNED_OUT",g,"STORAGE")}})}catch(i){return console.error("_listenForMultiTabEvents",i),null}}_listenForAuthEvents(){let{data:i}=this.auth.onAuthStateChange((o,l)=>{this._handleTokenChanged(o,l==null?void 0:l.access_token,"CLIENT")});return i}_handleTokenChanged(i,o,l){(i==="TOKEN_REFRESHED"||i==="SIGNED_IN")&&this.changedAccessToken!==o?(this.realtime.setAuth(o),l=="STORAGE"&&this.auth.setAuth(o),this.changedAccessToken=o):(i==="SIGNED_OUT"||i==="USER_DELETED")&&(this.realtime.setAuth(this.supabaseKey),l=="STORAGE"&&this.auth.signOut())}}const k6=(t,i,o)=>new X4(t,i,o);export{t6 as $,_6 as A,Pz as B,g6 as C,y6 as D,E6 as E,vn as F,lS as G,qi as H,v6 as I,_E as J,M6 as K,Ao as L,k6 as M,h6 as N,d6 as O,p6 as P,a6 as Q,RT as R,OT as S,C6 as T,o6 as U,u6 as V,Q4 as W,J4 as X,m6 as Y,f6 as Z,e6 as _,I6 as a,l6 as a0,S6 as a1,A6 as a2,ux as a3,r6 as a4,s_ as a5,x6 as b,c6 as c,e_ as d,Iz as e,w6 as f,b6 as g,DT as h,T6 as i,n6 as j,wB as k,tO as l,LT as m,qy as n,id as o,bn as p,i6 as q,Pr as r,Zy as s,Xa as t,_x as u,Y4 as v,Jr as w,pT as x,s6 as y,Uk as z};
