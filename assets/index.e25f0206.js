var Be=Object.defineProperty,Ve=Object.defineProperties;var ze=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;var be=(e,n,r)=>n in e?Be(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,U=(e,n)=>{for(var r in n||(n={}))Fe.call(n,r)&&be(e,r,n[r]);if(Se)for(var r of Se(n))He.call(n,r)&&be(e,r,n[r]);return e},Le=(e,n)=>Ve(e,ze(n));import{O as Ze,s as re,_ as K,u as se,r as Ge,d as Ye,e as Je,a as je}from"./app.05f80c03.js";import{P as We,h as S,j as b,m as g,d as D,t as M,v as c,s as $,R as J,r as R,p as Q,N as we,au as Te,av as ye,ai as De,ay as j,ag as Re,o as Xe,x as Z,n as he,y as A,al as Ue,ar as Qe,F as B,Y as V,a1 as qe,a2 as Ke,az as Ne,W as ve,w as et,q as tt}from"./vendor.204456b6.js";import{_ as ot,a as nt}from"./records.9755688b.js";function lt(){return We("tetris-records",async()=>(await re.from("tetris-records").select("*, user: user_id (user_name, avatar_url)").order("score",{ascending:!1}).limit(100)).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Ze,retry:!1})}const rt={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},at=g("path",{d:"M24.59 16.59L17 24.17V4h-2v20.17l-7.59-7.58L6 18l10 10l10-10l-1.41-1.41z",fill:"currentColor"},null,-1),it=[at];function st(e,n){return S(),b("svg",rt,it)}var ut={name:"carbon-arrow-down",render:st};const ct={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},ft=g("path",{d:"M16 4L6 14l1.41 1.41L15 7.83V28h2V7.83l7.59 7.58L26 14L16 4z",fill:"currentColor"},null,-1),dt=[ft];function vt(e,n){return S(),b("svg",ct,dt)}var _t={name:"carbon-arrow-up",render:vt};const ht={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},mt=g("path",{d:"M18 6l-1.43 1.393L24.15 15H4v2h20.15l-7.58 7.573L18 26l10-10L18 6z",fill:"currentColor"},null,-1),pt=[mt];function gt(e,n){return S(),b("svg",ht,pt)}var xe={name:"carbon-arrow-right",render:gt};const St={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},bt=g("path",{d:"M14 26l1.41-1.41L7.83 17H28v-2H7.83l7.58-7.59L14 6L4 16l10 10z",fill:"currentColor"},null,-1),Lt=[bt];function It(e,n){return S(),b("svg",St,Lt)}var Oe={name:"carbon-arrow-left",render:It};const wt={class:"h-0 opacity-0"},Tt={class:"grid gap-2"},yt=["aria-label"],Rt=["aria-label"],xt=["aria-label"],Ot=["aria-label"],kt=["aria-label"],Mt=D({setup(e){const{t:n}=se();return(r,v)=>{const d=Oe,p=xe,_=_t,m=ut;return S(),b("div",null,[g("h6",wt,M(c(n)("keyboard_guide")),1),g("ul",Tt,[g("li",null,[g("div",{"aria-label":c(n)("arrow_left_key")},[$(d)],8,yt),J(" : "+M(c(n)("move_block_left")),1)]),g("li",null,[g("div",{"aria-label":c(n)("arrow_right_key")},[$(p)],8,Rt),J(" : "+M(c(n)("move_block_right")),1)]),g("li",null,[g("div",{"aria-label":c(n)("arrow_up_key")},[$(_)],8,xt),J(" : "+M(c(n)("rotate_block")),1)]),g("li",null,[g("div",{"aria-label":c(n)("arrow_down_key")},[$(m)],8,Ot),J(" : "+M(c(n)("move_block_downwards")),1)]),g("li",null,[g("div",{"aria-label":c(n)("space_bar_key"),class:"px-1"},M(c(n)("space_bar")),9,kt),J(" : "+M(c(n)("drop_block")),1)])])])}}});var $t=K(Mt,[["__scopeId","data-v-475f4e67"]]);const ke=R("READY"),ue=R(!1),ce=R(0),me=R(0),pe=Q(()=>Math.floor(ce.value/10)+1);we(pe,()=>{ge.value=fe()});const ge=R(fe());function fe(){return Math.max(50,500-(pe.value-1)*(ue.value?50:30))}function Ct(){ce.value=0,ge.value=fe(),ue.value=!1,me.value=0,ke.value="READY"}function At(e){let n=0;ce.value+=e,e===1?n=40:e===2?n=100:e===3?n=300:n=1200,ue.value,me.value+=n}function N(){return{destroyedRawsCount:ce,setTimeoutMs:ge,gameStatus:ke,isCatHere:ue,level:pe,score:me,computeSetTimeoutMs:fe,resetGameInfo:Ct,increaseScore:At}}const{sm:Et,md:Pt}=Te(ye),Bt=Q(()=>Pt.value?32:Et.value?24:20);function Me(){return{nodeSize:Bt}}const Vt={class:"relative flex items-center"},zt=D({props:{position:null,left:null},setup(e){const n=e;De(u=>({"654d2619":y.value,"654d2618":T.value}));const r="111-1-1-11111111",{isCatHere:v,gameStatus:d,level:p}=N(),{nodeSize:_}=Me();j(["ArrowUp","ArrowDown"],I);let m="",h,L;Re(()=>{clearInterval(L),clearTimeout(h)}),we(d,()=>{d.value!=="PLAYING"&&(clearInterval(L),clearTimeout(h))});function I(u){if(u.preventDefault(),d.value==="READY"&&!v.value){if(clearTimeout(h),m+=u.key==="ArrowUp"?1:-1,m!==r)return h=setTimeout(()=>m="",1e3);v.value=!0,s()}}const w=R(!1),T=R("0rem"),y=R("0rem");Xe(()=>{T.value="0rem",y.value="0rem"});function o(){T.value=Math.floor((n.position.value[2][1]+1)*_.value+n.left)+"px",y.value=n.position.value[2][0]*_.value+"px"}function s(){L=setInterval(()=>{d.value==="PLAYING"&&(o(),w.value=!0,p.value>2&&setTimeout(o,2e3),p.value>4&&setTimeout(o,2500))},15e3)}return(u,l)=>(S(),b("div",Vt,[c(v)?(S(),b("img",{key:0,src:"https://ijivzwfsihdcvwrntdpe.supabase.co/storage/v1/object/public/tetris-images/paw.png",alt:"",class:Z(["absolute right-full z-10 opacity-0 filter brightness-75",{paw__active:w.value}]),style:he({width:`${c(_)*22}px`}),onAnimationend:l[0]||(l[0]=f=>w.value=!1)},null,38)):A("",!0)]))}});var Ft=K(zt,[["__scopeId","data-v-c7cb5d9a"]]);const Ht={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Zt=g("path",{d:"M28 30H16a2.002 2.002 0 0 1-2-2V16a2.002 2.002 0 0 1 2-2h12a2.002 2.002 0 0 1 2 2v12a2.002 2.002 0 0 1-2 2zM16 16v12h12.001L28 16z",fill:"currentColor"},null,-1),Gt=g("path",{d:"M15 2l-1.41 1.41L16.17 6H11a7.008 7.008 0 0 0-7 7v5h2v-5a5.006 5.006 0 0 1 5-5h5.17l-2.58 2.59L15 12l5-5z",fill:"currentColor"},null,-1),Yt=[Zt,Gt];function Jt(e,n){return S(),b("svg",Ht,Yt)}var jt={name:"carbon-rotate-clockwise",render:Jt};const Wt={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Dt=g("path",{d:"M23 6v10h5a1 1 0 0 1 .707 1.707l-12 12a1 1 0 0 1-1.414 0l-12-12A1 1 0 0 1 4 16h5V6a2.002 2.002 0 0 1 2-2h10a2.003 2.003 0 0 1 2 2zm-7 21.586L25.586 18H21V6H11v12H6.414z",fill:"currentColor"},null,-1),Xt=[Dt];function Ut(e,n){return S(),b("svg",Wt,Xt)}var Qt={name:"carbon-arrow-shift-down",render:Ut};const qt=["aria-label"],Kt=["aria-label"],Nt=["aria-label"],eo=["aria-label"],to=D({emits:["onTouchArrowRightBtn","onTouchArrowLeftBtn","onTouchArrowDownBtn","onTouchRotateBtn"],setup(e,{emit:n}){const{t:r}=se();return(v,d)=>{const p=Oe,_=xe,m=Qt,h=jt;return S(),b("div",null,[g("button",{class:"fixed bottom-5 left-5 horizontal-btn","aria-label":c(r)("move_block_left"),onClick:d[0]||(d[0]=L=>n("onTouchArrowLeftBtn",L))},[$(p)],8,qt),g("button",{class:"fixed bottom-5 right-5 horizontal-btn","aria-label":c(r)("move_block_right"),onClick:d[1]||(d[1]=L=>n("onTouchArrowRightBtn",L))},[$(_)],8,Kt),g("button",{class:"fixed bottom-5 left-1/2 transform -translate-x-1/2 horizontal-btn","aria-label":c(r)("move_block_downwards"),onClick:d[2]||(d[2]=L=>n("onTouchArrowDownBtn",L))},[$(m)],8,Nt),g("button",{class:"fixed bottom-25 right-5 horizontal-btn","aria-label":c(r)("rotate_block"),onClick:d[3]||(d[3]=L=>n("onTouchRotateBtn",L))},[$(h)],8,eo)])}}});var oo=K(to,[["__scopeId","data-v-9a6d88ee"]]),i=(e=>(e[e.WALL=0]="WALL",e[e.BIRTH=1]="BIRTH",e[e.VOID=2]="VOID",e[e.FOSSIL_I=3]="FOSSIL_I",e[e.FOSSIL_J=4]="FOSSIL_J",e[e.FOSSIL_L=5]="FOSSIL_L",e[e.FOSSIL_O=6]="FOSSIL_O",e[e.FOSSIL_S=7]="FOSSIL_S",e[e.FOSSIL_T=8]="FOSSIL_T",e[e.FOSSIL_Z=9]="FOSSIL_Z",e[e.I=10]="I",e[e.J=11]="J",e[e.L=12]="L",e[e.O=13]="O",e[e.S=14]="S",e[e.T=15]="T",e[e.Z=16]="Z",e))(i||{});const{increaseScore:no}=N(),ae=4,W=12,_e=28,x=R($e());function $e(){return Array.from({length:_e},(e,n)=>n===_e-1?Array.from({length:W},()=>i.WALL):Array.from({length:W},(r,v)=>v===0||v===W-1?i.WALL:n<=ae-1?i.BIRTH:i.VOID))}const ee=R(q()),ie=R(q());function q(){return Ge(1,[i.I,i.J,i.L,i.O,i.S,i.Z,i.T])[0]}function lo(){ee.value=ie.value,ie.value=q()}function ro(){ee.value=q(),ie.value=q(),x.value=$e()}function ao(e){for(let n=0;n<e.length;n++){const[r,v]=e[n];if(x.value[r][v]!==i.VOID&&x.value[r][v]!==i.BIRTH&&x.value[r][v]!==ee.value)return!0}return!1}function io([e,n]){switch(ee.value){case i.I:x.value[e][n]=i.FOSSIL_I;break;case i.J:x.value[e][n]=i.FOSSIL_J;break;case i.L:x.value[e][n]=i.FOSSIL_L;break;case i.O:x.value[e][n]=i.FOSSIL_O;break;case i.S:x.value[e][n]=i.FOSSIL_S;break;case i.T:x.value[e][n]=i.FOSSIL_T;break;case i.Z:x.value[e][n]=i.FOSSIL_Z;break}}function so(){const e=[];x.value.forEach((n,r)=>{n.every(v=>v===i.WALL)||n.every(v=>v===i.FOSSIL_I||v===i.FOSSIL_J||v===i.FOSSIL_L||v===i.FOSSIL_O||v===i.FOSSIL_S||v===i.FOSSIL_T||v===i.FOSSIL_Z||v===i.WALL)&&e.push(r)}),e.length!==0&&(no(e.length),x.value=x.value.filter((n,r)=>!e.includes(r)),x.value=[...x.value.slice(0,ae),...e.map(()=>Array.from({length:W},(n,r)=>r===0||r===W-1?i.WALL:i.VOID)),...x.value.slice(ae)])}function E(){return{TOP_RESERVE:ae,currNode:ee,nextNode:ie,X_SIZE:W,Y_SIZE:_e,nodes:x,resetUseNodes:ro,willCollide:ao,removeNodes:so,switchNode:lo,fossilize:io}}const uo={class:"relative w-20 md:w-28 h-20 md:h-28 flex items-center justify-center bg-gray-900 border border-gray-600 rounded-md"},co={key:0},fo={class:"absolute top-0 left-0 w-full h-full object-cover object-left",src:"https://ijivzwfsihdcvwrntdpe.supabase.co/storage/v1/object/public/tetris-images/cat-stare.webp",width:"80",height:"80",alt:""},vo={key:0,class:"grid gap-px"},_o={key:1,class:"grid gap-px grid-cols-2"},ho={key:2,class:"grid gap-px grid-cols-2"},mo={key:3,class:"grid gap-px grid-cols-2"},po={key:4,class:"grid gap-px grid-cols-3"},go={key:5,class:"grid gap-px grid-cols-3"},So={key:6,class:"grid gap-px grid-cols-3"},bo=D({setup(e){const{nextNode:n}=E(),{destroyedRawsCount:r,gameStatus:v,isCatHere:d}=N(),p=Q(()=>{if(!d.value)return!1;const _=r.value%10;return _===1||_===5});return(_,m)=>(S(),b("div",uo,[c(v)==="PLAYING"?(S(),b("div",co,[Ue(g("img",fo,null,512),[[Qe,c(p)]]),c(n)===c(i).I?(S(),b("div",vo,[(S(),b(B,null,V(4,h=>g("div",{key:h,class:"node-size tetromino-border border-color__tetromino__I"})),64))])):A("",!0),c(n)===c(i).J?(S(),b("div",_o,[(S(),b(B,null,V(6,h=>g("div",{key:h,class:Z(["node-size",{"border-color__tetromino__J tetromino-border":h===5||h%2===0}])},null,2)),64))])):A("",!0),c(n)===c(i).L?(S(),b("div",ho,[(S(),b(B,null,V(6,h=>g("div",{key:h,class:Z(["node-size",{"border-color__tetromino__L tetromino-border":h===6||h%2===1}])},null,2)),64))])):A("",!0),c(n)===c(i).O?(S(),b("div",mo,[(S(),b(B,null,V(4,h=>g("div",{key:h,class:"border-color__tetromino__O node-size tetromino-border"})),64))])):A("",!0),c(n)===c(i).S?(S(),b("div",po,[(S(),b(B,null,V(6,h=>g("div",{key:h,class:Z(["node-size",{"border-color__tetromino__S tetromino-border":[2,3,4,5].includes(h)}])},null,2)),64))])):A("",!0),c(n)===c(i).T?(S(),b("div",go,[(S(),b(B,null,V(6,h=>g("div",{key:h,class:Z(["node-size",{"border-color__tetromino__T tetromino-border":[2,4,5,6].includes(h)}])},null,2)),64))])):A("",!0),c(n)===c(i).Z?(S(),b("div",So,[(S(),b(B,null,V(6,h=>g("div",{key:h,class:Z(["node-size",{"border-color__tetromino__Z tetromino-border":[1,2,5,6].includes(h)}])},null,2)),64))])):A("",!0)])):A("",!0)]))}});var Lo=K(bo,[["__scopeId","data-v-43e46289"]]);const Io=D({props:{rowIdx:null,colIdx:null,node:null,isCatHere:{type:Boolean},isGuide:{type:Boolean}},setup(e){const{TOP_RESERVE:n}=E(),{nodeSize:r}=Me();return(v,d)=>(S(),b("div",{class:Z(["bg-gray-900",[e.node===c(i).VOID?e.isGuide&&!e.isCatHere?"border-color__guide":"":e.node===c(i).I||e.node===c(i).FOSSIL_I?"border-color__tetromino__I":e.node===c(i).J||e.node===c(i).FOSSIL_J?"border-color__tetromino__J":e.node===c(i).L||e.node===c(i).FOSSIL_L?"border-color__tetromino__L":e.node===c(i).O||e.node===c(i).FOSSIL_O?"border-color__tetromino__O":e.node===c(i).S||e.node===c(i).FOSSIL_S?"border-color__tetromino__S":e.node===c(i).T||e.node===c(i).FOSSIL_T?"border-color__tetromino__T":e.node===c(i).Z||e.node===c(i).FOSSIL_Z?"border-color__tetromino__Z":""]]),style:he(U(U({},e.node===c(i).WALL||e.rowIdx<c(n)?{display:"none"}:{width:`${c(r)}px`,height:`${c(r)}px`}),e.node===c(i).VOID?e.isGuide&&!e.isCatHere?{borderWidth:"1px"}:{}:{borderWidth:`${c(r)/2}px`}))},null,6))}});var wo=K(Io,[["__scopeId","data-v-f8ddccd4"]]);function Ie(e){return[[...e[0]],[...e[1]],[...e[2]],[...e[3]]]}function G(e,n){const{nodes:r,currNode:v,TOP_RESERVE:d,willCollide:p,fossilize:_}=E(),m=R(Ie(e)),h=Q(()=>m.value.map(([s,u])=>[s+1,u])),L=Q(I);function I(){let s=!1,u=0;for(;!s;){u++;for(let l=0;l<m.value.length;l++){const[f,a]=m.value[l];if(!(r.value[f+u][a]===i.BIRTH||r.value[f+u][a]===i.VOID||r.value[f+u][a]===v.value)){s=!0;break}}}return m.value.map(([l,f])=>[l+u-1,f])}function w(){n.value=0,m.value=Ie(e),m.value.forEach(([s,u])=>r.value[s][u]=v.value)}function T(){let s=!1;for(let u=0;u<h.value.length;u++){const[l,f]=h.value[u];if(!(r.value[l][f]===i.BIRTH||r.value[l][f]===i.VOID||r.value[l][f]===v.value)){s=!0;break}}return s?(m.value.forEach(_),!1):(m.value.forEach(([u,l])=>{r.value[u][l]=u<=d-1?i.BIRTH:i.VOID}),h.value.forEach(([u,l])=>{r.value[u][l]=v.value}),m.value=h.value,!0)}function y(){const s=m.value.map(([u,l])=>[u,l+1]);p(s)||(m.value.forEach(([u,l],f)=>{r.value[u][l]=u<=d-1?i.BIRTH:i.VOID,m.value[f]=[u,l+1]}),m.value.forEach(([u,l])=>{r.value[u][l]=v.value}))}function o(){const s=m.value.map(([u,l])=>[u,l-1]);p(s)||(m.value.forEach(([u,l],f)=>{r.value[u][l]=u<=d-1?i.BIRTH:i.VOID,m.value[f]=[u,l-1]}),m.value.forEach(([u,l])=>{r.value[u][l]=v.value}))}return{position:m,nextPosition:h,endPosition:L,prepare:w,fall:T,moveRight:y,moveLeft:o}}function To(){const e=R(0),{nodes:n,TOP_RESERVE:r,willCollide:v,X_SIZE:d}=E(),p=Object.freeze([[r-2,Math.floor(d/2)],[r-3,Math.floor(d/2)],[r-4,Math.floor(d/2)],[r-1,Math.floor(d/2)]]),{position:_,nextPosition:m,endPosition:h,prepare:L,fall:I,moveRight:w,moveLeft:T}=G(p,e);function y(){let o=0,s=[..._.value];for(;o===0||v(s);){e.value===0?s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0],t[0][1]-1+o]:a===2?[t[0][0],t[0][1]-2+o]:[t[0][0],t[0][1]+1+o]):e.value===1?s=s.map(([l,f],a,t)=>a===0?[t[1][0]-1,t[1][1]+o]:a===1?[l,f+o]:a===2?[t[1][0]+1,t[1][1]+o]:[t[1][0]-2,t[1][1]+o]):e.value===2?s=s.map(([l,f],a,t)=>a===0?[t[1][0],t[1][1]+1+o]:a===1?[l,f+o]:a===2?[t[1][0],t[1][1]-1+o]:[t[1][0],t[1][1]+2+o]):s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0]-1,t[0][1]+o]:a===2?[t[0][0]-2,t[0][1]+o]:[t[0][0]+1,t[0][1]+o]);const u=o>0?1:-1;if(o=-(o+u),o>10)return}_.value.forEach(([u,l])=>{n.value[u][l]=u<=r-1?i.BIRTH:i.VOID}),_.value=[...s],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,_.value.forEach(([u,l])=>{n.value[u][l]=i.I})}return{defaultPosition:p,nextPosition:m,endPosition:h,position:_,shape:e,id:i.I,changeShape:y,moveRight:w,moveLeft:T,prepare:L,fall:I}}function yo(){const e=R(0),{nodes:n,TOP_RESERVE:r,willCollide:v,X_SIZE:d}=E(),p=Object.freeze([[r-3,Math.floor(d/2)],[r-2,Math.floor(d/2)],[r-1,Math.floor(d/2)],[r-1,Math.floor(d/2)-1]]),{position:_,nextPosition:m,endPosition:h,prepare:L,fall:I,moveLeft:w,moveRight:T}=G(p,e);function y(){let o=0,s=[..._.value];for(;o===0||v(s);){e.value===0?s=s.map(([l,f],a,t)=>a===0?[t[1][0],t[1][1]+1+o]:a===1?[l,f+o]:a===2?[t[1][0],t[1][1]-1+o]:[t[1][0]-1,t[1][1]-1+o]):e.value===1?s=s.map(([l,f],a,t)=>a===0?[t[1][0]+1,t[1][1]+o]:a===1?[l,f+o]:a===2?[t[1][0]-1,t[1][1]+o]:[t[1][0]-1,t[1][1]+1+o]):e.value===2?s=s.map(([l,f],a,t)=>a===0?[t[1][0],t[1][1]-1+o]:a===1?[l,f+o]:a===2?[t[1][0],t[1][1]+1+o]:[t[1][0]+1,t[1][1]+1+o]):s=s.map(([l,f],a,t)=>a===0?[t[1][0]-1,t[1][1]+o]:a===1?[l,f+o]:a===2?[t[1][0]+1,t[1][1]+o]:[t[1][0]+1,t[1][1]-1+o]);const u=o>0?1:-1;if(o=-(o+u),o>10)return}_.value.forEach(([u,l])=>{n.value[u][l]=u<=r-1?i.BIRTH:i.VOID}),_.value=[...s],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,_.value.forEach(([u,l])=>{n.value[u][l]=i.J})}return{defaultPosition:p,nextPosition:m,endPosition:h,position:_,shape:e,id:i.J,changeShape:y,moveRight:T,moveLeft:w,prepare:L,fall:I}}function Ro(){const e=R(0),{nodes:n,TOP_RESERVE:r,willCollide:v,X_SIZE:d}=E(),p=Object.freeze([[r-3,Math.floor(d/2)],[r-2,Math.floor(d/2)],[r-1,Math.floor(d/2)],[r-1,Math.floor(d/2)+1]]),{position:_,nextPosition:m,endPosition:h,prepare:L,fall:I,moveLeft:w,moveRight:T}=G(p,e);function y(){let o=0,s=[..._.value];for(;o===0||v(s);){e.value===0?s=s.map(([l,f],a,t)=>a===0?[t[1][0],t[1][1]-1+o]:a===1?[l,f+o]:a===2?[t[1][0],t[1][1]+1+o]:[t[1][0]-1,t[1][1]+1+o]):e.value===1?s=s.map(([l,f],a,t)=>a===0?[t[1][0]+1,t[1][1]+o]:a===1?[l,f+o]:a===2?[t[1][0]-1,t[1][1]+o]:[t[1][0]-1,t[1][1]-1+o]):e.value===2?s=s.map(([l,f],a,t)=>a===0?[t[1][0],t[1][1]+1+o]:a===1?[l,f+o]:a===2?[t[1][0],t[1][1]-1+o]:[t[1][0]+1,t[1][1]-1+o]):s=s.map(([l,f],a,t)=>a===0?[t[1][0]-1,t[1][1]+o]:a===1?[l,f+o]:a===2?[t[1][0]+1,t[1][1]+o]:[t[1][0]+1,t[1][1]+1+o]);const u=o>0?1:-1;if(o=-(o+u),o>10)return}_.value.forEach(([u,l])=>{n.value[u][l]=u<=r-1?i.BIRTH:i.VOID}),_.value=[...s],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,_.value.forEach(([u,l])=>{n.value[u][l]=i.L})}return{defaultPosition:p,nextPosition:m,endPosition:h,position:_,shape:e,id:i.L,changeShape:y,moveRight:T,moveLeft:w,prepare:L,fall:I}}function xo(){const e=R(0),{X_SIZE:n,TOP_RESERVE:r}=E(),v=Object.freeze([[r-2,Math.floor(n/2)-1],[r-2,Math.floor(n/2)],[r-1,Math.floor(n/2)-1],[r-1,Math.floor(n/2)]]),{position:d,nextPosition:p,endPosition:_,prepare:m,fall:h,moveLeft:L,moveRight:I}=G(v,e);return{defaultPosition:v,nextPosition:p,endPosition:_,position:d,shape:e,id:i.O,changeShape:()=>{},moveRight:I,moveLeft:L,prepare:m,fall:h}}function Oo(){const e=R(0),{nodes:n,TOP_RESERVE:r,willCollide:v,X_SIZE:d}=E(),p=Object.freeze([[r-1,Math.floor(d/2)-1],[r-2,Math.floor(d/2)-1],[r-2,Math.floor(d/2)],[r-1,Math.floor(d/2)-2]]),{position:_,nextPosition:m,endPosition:h,prepare:L,fall:I,moveRight:w,moveLeft:T}=G(p,e);function y(){let o=0,s=[..._.value];for(;o===0||v(s);){e.value===0?s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0],t[0][1]+1+o]:a===2?[t[0][0]+1,t[0][1]+1+o]:[t[0][0]-1,t[0][1]+o]):e.value===1?s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0]+1,t[0][1]+o]:a===2?[t[0][0]+1,t[0][1]-1+o]:[t[0][0],t[0][1]+1+o]):e.value===2?s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0],t[0][1]-1+o]:a===2?[t[0][0]-1,t[0][1]-1+o]:[t[0][0]+1,t[0][1]+o]):s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0]-1,t[0][1]+o]:a===2?[t[0][0]-1,t[0][1]+1+o]:[t[0][0],t[0][1]-1+o]);const u=o>0?1:-1;if(o=-(o+u),o>10)return}_.value.forEach(([u,l])=>{n.value[u][l]=u<=r-1?i.BIRTH:i.VOID}),_.value=[...s],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,_.value.forEach(([u,l])=>{n.value[u][l]=i.S})}return{defaultPosition:p,nextPosition:m,endPosition:h,position:_,shape:e,id:i.S,changeShape:y,moveRight:w,moveLeft:T,prepare:L,fall:I}}function ko(){const e=R(0),{nodes:n,TOP_RESERVE:r,willCollide:v,X_SIZE:d}=E(),p=Object.freeze([[r-1,Math.floor(d/2)],[r-2,Math.floor(d/2)],[r-1,Math.floor(d/2)-1],[r-1,Math.floor(d/2)+1]]),{position:_,nextPosition:m,endPosition:h,prepare:L,fall:I,moveRight:w,moveLeft:T}=G(p,e);function y(){let o=0,s=[..._.value];for(;o===0||v(s);){e.value===0?s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0],t[0][1]+1+o]:a===2?[t[0][0]-1,t[0][1]+o]:[t[0][0]+1,t[0][1]+o]):e.value===1?s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0]+1,t[0][1]+o]:a===2?[t[0][0],t[0][1]+1+o]:[t[0][0],t[0][1]-1+o]):e.value===2?s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0],t[0][1]-1+o]:a===2?[t[0][0]+1,t[0][1]+o]:[t[0][0]-1,t[0][1]+o]):s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0]-1,t[0][1]+o]:a===2?[t[0][0],t[0][1]-1+o]:[t[0][0],t[0][1]+1+o]);const u=o>0?1:-1;if(o=-(o+u),o>10)return}_.value.forEach(([u,l])=>{n.value[u][l]=u<=r-1?i.BIRTH:i.VOID}),_.value=[...s],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,_.value.forEach(([u,l])=>{n.value[u][l]=i.T})}return{defaultPosition:p,nextPosition:m,endPosition:h,position:_,shape:e,id:i.T,changeShape:y,moveRight:w,moveLeft:T,prepare:L,fall:I}}function Mo(){const e=R(0),{nodes:n,TOP_RESERVE:r,willCollide:v,X_SIZE:d}=E(),p=Object.freeze([[r-1,Math.floor(d/2)],[r-2,Math.floor(d/2)],[r-2,Math.floor(d/2)-1],[r-1,Math.floor(d/2)+1]]),{position:_,nextPosition:m,endPosition:h,prepare:L,fall:I,moveRight:w,moveLeft:T}=G(p,e);function y(){let o=0,s=[..._.value];for(;o===0||v(s);){e.value===0?s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0],t[0][1]+1+o]:a===2?[t[0][0]-1,t[0][1]+1+o]:[t[0][0]+1,t[0][1]+o]):e.value===1?s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0]+1,t[0][1]+o]:a===2?[t[0][0]+1,t[0][1]+1+o]:[t[0][0],t[0][1]-1+o]):e.value===2?s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0],t[0][1]-1+o]:a===2?[t[0][0]+1,t[0][1]-1+o]:[t[0][0]-1,t[0][1]+o]):s=s.map(([l,f],a,t)=>a===0?[l,f+o]:a===1?[t[0][0]-1,t[0][1]+o]:a===2?[t[0][0]-1,t[0][1]-1+o]:[t[0][0],t[0][1]+1+o]);const u=o>0?1:-1;if(o=-(o+u),o>10)return}_.value.forEach(([u,l])=>{n.value[u][l]=u<=r-1?i.BIRTH:i.VOID}),_.value=[...s],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,_.value.forEach(([u,l])=>{n.value[u][l]=i.Z})}return{defaultPosition:p,nextPosition:m,endPosition:h,position:_,shape:e,id:i.Z,changeShape:y,moveRight:w,moveLeft:T,prepare:L,fall:I}}function $o(){const e=Ke(),{data:n}=Ye();return qe(async({score:r})=>{if(!n.value)return null;const{data:v}=await re.from("tetris-records").select("*").eq("user_id",n.value.id).order("score",{ascending:!0});if(!v)return null;switch(v.length<=10){case!0:return(await re.from("tetris-records").insert({score:r,user_id:n.value.id}).single()).data;case!1:{const d=v[v.length-1];return d.score<r?null:(await re.from("tetris-records").update({id:d.id,score:r}).single()).data}}},{onSuccess:r=>{if(!n.value)return;const{user_name:v=n.value.email,avatar_url:d=""}=n.value.user_metadata;if(!r)return;const p=e.getQueryData("tetris-records");!p||e.setQueryData("tetris-records",()=>[...p,Le(U({},r),{user:{user_name:v,avatar_url:d}})].sort((_,m)=>_.score-m.score))}})}function Co(){const{t:e}=se(),n=$o(),{openIssueModal:r}=Je(),{TOP_RESERVE:v,currNode:d,nodes:p,removeNodes:_,switchNode:m,fossilize:h,resetUseNodes:L}=E(),{gameStatus:I,setTimeoutMs:w,score:T,computeSetTimeoutMs:y,resetGameInfo:o}=N(),s=To(),u=yo(),l=Ro(),f=xo(),a=Oo(),t=Mo(),te=ko();let H;Re(()=>{clearTimeout(H),ne()});function k(){const O=[s,u,l,f,a,t,te].find(({id:C})=>C===d.value);if(!O)throw Error("Tetromino not found");return O}function Y(){k().prepare(),P(),I.value="PLAYING"}function oe(){n.mutate({score:T.value},{onSettled:()=>{window.alert("Game Over!"),I.value="END"},onError:()=>{r({title:e("record_mutation_failed.title"),content:e("record_mutation_failed.content")})}})}function ne(){L(),o()}function P(){clearTimeout(H),H=setTimeout(()=>{if(!k().fall()){if(clearTimeout(H),_(),!z())return oe();m(),k().prepare()}P()},w.value)}function z(){const O=k().position.value;for(let C=0;C<O.length;C++){const[F]=O[C];if(F<v)return!1}return!0}function de(O){I.value==="PLAYING"&&(O.preventDefault(),k().changeShape())}function X(O){I.value==="PLAYING"&&(O.preventDefault(),k().moveRight())}function Ce(O){I.value==="PLAYING"&&(O.preventDefault(),k().moveLeft())}function Ae(O){I.value==="PLAYING"&&(O.preventDefault(),w.value=0,P(),w.value=y())}function Ee(O){if(I.value==="PLAYING"){if(O.preventDefault(),clearTimeout(H),k().position.value.forEach(([C,F])=>{p.value[C][F]=i.VOID}),k().endPosition.value.forEach(([C,F],le)=>{h([C,F]),k().position.value[le][0]=C,k().position.value[le][1]=F}),_(),!z())return oe();m(),k().prepare(),P()}}function Pe(O,C){return I.value!=="PLAYING"?!1:!!k().endPosition.value.find(([F,le])=>F===O&&le===C)}return{moveTetrominoToRight:X,moveTetrominoToLeft:Ce,moveTetrominoDown:Ae,rotateTetromino:de,dropTetromino:Ee,resetGame:ne,startGame:Y,tetromino:k,validate:z,isGuide:Pe,fall:P}}const Ao={class:"my-20 text-3xl md:text-5xl text-center"},Eo={class:"flex px-10 sm:pl-32 md:pl-50 xl:pl-64 gap-3 lg:gap-20"},Po={class:"flex flex-col gap-10"},Bo={key:0},Vo={class:"mt-auto"},Go=D({setup(e){const{lg:n}=Te(ye),{t:r}=se(),{isLoading:v,data:d}=lt(),{nodes:p,TOP_RESERVE:_,X_SIZE:m}=E(),{moveTetrominoToRight:h,moveTetrominoToLeft:L,moveTetrominoDown:I,rotateTetromino:w,dropTetromino:T,resetGame:y,startGame:o,tetromino:s,isGuide:u}=Co(),{gameStatus:l,isCatHere:f,score:a,level:t}=N();j("ArrowRight",h),j("ArrowLeft",L),j("ArrowDown",I),j("ArrowUp",w),j(" ",T);const te=R(null),{left:H}=Ne(te);return(k,Y)=>{const oe=je,ne=tt("client-only");return S(),b(B,null,[g("h1",Ao,M(c(r)("tetris")),1),$(Ft,{position:c(s)().position,left:c(H)},null,8,["position","left"]),g("div",Eo,[g("div",{ref_key:"tetrisContainerEl",ref:te,class:"grid gap-px shadow-lg bg-gray-700"},[(S(!0),b(B,null,V(c(p),(P,z)=>(S(),b("div",{key:z,style:he(U({},z<c(_)?{display:"none"}:{display:"grid",gap:"1px",gridTemplateColumns:`repeat(${c(m)-2}, 1fr)`}))},[(S(!0),b(B,null,V(P,(de,X)=>(S(),ve(wo,{key:X,rowIdx:z,colIdx:X,"is-guide":c(u)(z,X),node:de,"is-cat-here":c(f)},null,8,["rowIdx","colIdx","is-guide","node","is-cat-here"]))),128))],4))),128))],512),g("div",Po,[$(Lo),g("div",null,M(c(r)("level"))+": "+M(c(t)),1),g("div",null,M(c(r)("score"))+": "+M(c(a)),1),c(l)==="READY"?(S(),b("button",{key:0,class:"py-2 px-3 border border-red-600 rounded",onClick:Y[0]||(Y[0]=(...P)=>c(o)&&c(o)(...P))},[J(M(c(r)("start"))+" ",1),c(f)?(S(),b("span",Bo,"\u{1F408}")):A("",!0)])):A("",!0),c(l)==="END"?(S(),b("button",{key:1,class:"py-2 px-3 border border-red-600 rounded",onClick:Y[1]||(Y[1]=(...P)=>c(y)&&c(y)(...P))},M(c(r)("reset")),1)):A("",!0),g("div",Vo,[c(n)?(S(),ve($t,{key:0})):(S(),ve(oo,{key:1,onOnTouchArrowRightBtn:c(h),onOnTouchArrowLeftBtn:c(L),onOnTouchArrowDownBtn:c(T),onOnTouchRotateBtn:c(w)},null,8,["onOnTouchArrowRightBtn","onOnTouchArrowLeftBtn","onOnTouchArrowDownBtn","onOnTouchRotateBtn"]))])])]),$(nt,{class:"mt-10 text-center"}),$(ot,{"is-loading":c(v),data:c(d)},null,8,["is-loading","data"]),$(ne,null,{default:et(()=>[$(oe,{class:"opacity-50"})]),_:1})],64)}}});export{Go as default};
