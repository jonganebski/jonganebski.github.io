import{R as Ae,ap as Ee,T as le,o as g,c as S,a as b,d as U,s as re,y as C,h as u,x as $,A as D,_ as W,r as k,f as X,G as be,Y as Se,Z as Le,ao as Me,aq as J,j as Ie,$ as Pe,p as Z,n as ve,i as E,w as Be,v as Ve,F as B,z as V,ar as Fe,as as ze,at as He,au as Ze,b as Ge,k as je,g as de,l as De,C as Je}from"./app-e8c50df9.js";import{R as Ye,A as Ue}from"./records-2554630b.js";import{r as We}from"./random-7bb4a1e6.js";function qe(){return Ae(["tetris-records"],async()=>(await le.from("tetris-records").select("*, user: user_id (user_name, avatar_url)").order("score",{ascending:!1}).limit(100)).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Ee,retry:!1})}const Xe={viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"},Qe=b("path",{fill:"currentColor",d:"M24.59 16.59L17 24.17V4h-2v20.17l-7.59-7.58L6 18l10 10l10-10l-1.41-1.41z"},null,-1),Ke=[Qe];function Ne(e,i){return g(),S("svg",Xe,Ke)}const et={name:"carbon-arrow-down",render:Ne},tt={viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"},ot=b("path",{fill:"currentColor",d:"M16 4L6 14l1.41 1.41L15 7.83V28h2V7.83l7.59 7.58L26 14L16 4z"},null,-1),nt=[ot];function lt(e,i){return g(),S("svg",tt,nt)}const it={name:"carbon-arrow-up",render:lt},st={viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"},rt=b("path",{fill:"currentColor",d:"m18 6l-1.43 1.393L24.15 15H4v2h20.15l-7.58 7.573L18 26l10-10L18 6z"},null,-1),at=[rt];function ut(e,i){return g(),S("svg",st,at)}const ye={name:"carbon-arrow-right",render:ut},ct={viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"},ft=b("path",{fill:"currentColor",d:"m14 26l1.41-1.41L7.83 17H28v-2H7.83l7.58-7.59L14 6L4 16l10 10z"},null,-1),dt=[ft];function _t(e,i){return g(),S("svg",ct,dt)}const Te={name:"carbon-arrow-left",render:_t},vt={class:"h-0 opacity-0"},mt={class:"grid gap-2"},ht=["aria-label"],pt=["aria-label"],gt=["aria-label"],bt=["aria-label"],St=["aria-label"],Lt=U({__name:"keyboard-guide",setup(e){const{t:i}=re();return(r,_)=>{const d=Te,p=ye,v=it,h=et;return g(),S("div",null,[b("h6",vt,C(u(i)("keyboard_guide")),1),b("ul",mt,[b("li",null,[b("div",{"aria-label":u(i)("arrow_left_key")},[$(d)],8,ht),D(" : "+C(u(i)("move_block_left")),1)]),b("li",null,[b("div",{"aria-label":u(i)("arrow_right_key")},[$(p)],8,pt),D(" : "+C(u(i)("move_block_right")),1)]),b("li",null,[b("div",{"aria-label":u(i)("arrow_up_key")},[$(v)],8,gt),D(" : "+C(u(i)("rotate_block")),1)]),b("li",null,[b("div",{"aria-label":u(i)("arrow_down_key")},[$(h)],8,bt),D(" : "+C(u(i)("move_block_downwards")),1)]),b("li",null,[b("div",{"aria-label":u(i)("space_bar_key"),class:"px-1"},C(u(i)("space_bar")),9,St),D(" : "+C(u(i)("drop_block")),1)])])])}}});const It=W(Lt,[["__scopeId","data-v-c095fe0d"],["__file","/Users/jinseok.bang/Documents/github.me/jonganebski.github.io/src/pages/games/tetris/components/keyboard-guide.vue"]]),we=k("READY"),ae=k(!1),ue=k(0),me=k(0),he=X(()=>Math.floor(ue.value/10)+1);be(he,()=>{pe.value=ce()});const pe=k(ce());function ce(){return Math.max(50,500-(he.value-1)*(ae.value?50:30))}function yt(){ue.value=0,pe.value=ce(),ae.value=!1,me.value=0,we.value="READY"}function Tt(e){let i=0;ue.value+=e,e===1?i=40:e===2?i=100:e===3?i=300:i=1200,ae.value,me.value+=i}function K(){return{destroyedRawsCount:ue,setTimeoutMs:pe,gameStatus:we,isCatHere:ae,level:he,score:me,computeSetTimeoutMs:ce,resetGameInfo:yt,increaseScore:Tt}}const{sm:wt,md:kt}=Se(Le),Rt=X(()=>kt.value?32:wt.value?24:20);function ke(){return{nodeSize:Rt}}const xt={class:"relative flex items-center"},Ot="111-1-1-11111111",Ct=U({__name:"mean-cat",props:{position:{type:null,required:!0},left:{type:Number,required:!0}},setup(e){const i=e;Me(a=>({"773409b4-y":u(T),"773409b4-x":u(y)}));const{isCatHere:r,gameStatus:_,level:d}=K(),{nodeSize:p}=ke();J(["ArrowUp","ArrowDown"],L);let v="",h,m;Ie(()=>{clearInterval(m),clearTimeout(h)}),be(_,()=>{_.value!=="PLAYING"&&(clearInterval(m),clearTimeout(h))});function L(a){if(a.preventDefault(),_.value==="READY"&&!r.value){if(clearTimeout(h),v+=a.key==="ArrowUp"?1:-1,v!==Ot)return h=setTimeout(()=>v="",1e3);r.value=!0,o()}}const I=k(!1),y=k("0rem"),T=k("0rem");Pe(()=>{y.value="0rem",T.value="0rem"});function w(){y.value=Math.floor((i.position.value[2][1]+1)*p.value+i.left)+"px",T.value=i.position.value[2][0]*p.value+"px"}function o(){m=setInterval(()=>{_.value==="PLAYING"&&(w(),I.value=!0,d.value>2&&setTimeout(w,2e3),d.value>4&&setTimeout(w,2500))},15e3)}return(a,c)=>(g(),S("div",xt,[u(r)?(g(),S("img",{key:0,src:"https://ijivzwfsihdcvwrntdpe.supabase.co/storage/v1/object/public/tetris-images/paw.png",alt:"",class:Z(["absolute right-full z-10 opacity-0 filter brightness-75",{paw__active:u(I)}]),style:ve({width:`${u(p)*22}px`}),onAnimationend:c[0]||(c[0]=n=>I.value=!1)},null,38)):E("v-if",!0)]))}});const $t=W(Ct,[["__scopeId","data-v-773409b4"],["__file","/Users/jinseok.bang/Documents/github.me/jonganebski.github.io/src/pages/games/tetris/components/mean-cat.vue"]]),At={viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"},Et=b("path",{fill:"currentColor",d:"M28 30H16a2.002 2.002 0 0 1-2-2V16a2.002 2.002 0 0 1 2-2h12a2.002 2.002 0 0 1 2 2v12a2.002 2.002 0 0 1-2 2zM16 16v12h12.001L28 16zM15 2l-1.41 1.41L16.17 6H11a7.008 7.008 0 0 0-7 7v5h2v-5a5.006 5.006 0 0 1 5-5h5.17l-2.58 2.59L15 12l5-5z"},null,-1),Mt=[Et];function Pt(e,i){return g(),S("svg",At,Mt)}const Bt={name:"carbon-rotate-clockwise",render:Pt},Vt={viewBox:"0 0 32 32",width:"1.2em",height:"1.2em"},Ft=b("path",{fill:"currentColor",d:"M23 6v10h5a1 1 0 0 1 .707 1.707l-12 12a1 1 0 0 1-1.414 0l-12-12A1 1 0 0 1 4 16h5V6a2.002 2.002 0 0 1 2-2h10a2.003 2.003 0 0 1 2 2Zm-7 21.586L25.586 18H21V6H11v12H6.414Z"},null,-1),zt=[Ft];function Ht(e,i){return g(),S("svg",Vt,zt)}const Zt={name:"carbon-arrow-shift-down",render:Ht},Gt=["aria-label"],jt=["aria-label"],Dt=["aria-label"],Jt=["aria-label"],Yt=U({__name:"mobile-controller",emits:["onTouchArrowRightBtn","onTouchArrowLeftBtn","onTouchArrowDownBtn","onTouchRotateBtn"],setup(e,{emit:i}){const{t:r}=re();return(_,d)=>{const p=Te,v=ye,h=Zt,m=Bt;return g(),S("div",null,[b("button",{class:"fixed bottom-5 left-5 horizontal-btn","aria-label":u(r)("move_block_left"),onClick:d[0]||(d[0]=L=>i("onTouchArrowLeftBtn",L))},[$(p)],8,Gt),b("button",{class:"fixed bottom-5 right-5 horizontal-btn","aria-label":u(r)("move_block_right"),onClick:d[1]||(d[1]=L=>i("onTouchArrowRightBtn",L))},[$(v)],8,jt),b("button",{class:"fixed bottom-5 left-1/2 transform -translate-x-1/2 horizontal-btn","aria-label":u(r)("move_block_downwards"),onClick:d[2]||(d[2]=L=>i("onTouchArrowDownBtn",L))},[$(h)],8,Dt),b("button",{class:"fixed bottom-25 right-5 horizontal-btn","aria-label":u(r)("rotate_block"),onClick:d[3]||(d[3]=L=>i("onTouchRotateBtn",L))},[$(m)],8,Jt)])}}});const Ut=W(Yt,[["__scopeId","data-v-0738db0e"],["__file","/Users/jinseok.bang/Documents/github.me/jonganebski.github.io/src/pages/games/tetris/components/mobile-controller.vue"]]);var s=(e=>(e[e.WALL=0]="WALL",e[e.BIRTH=1]="BIRTH",e[e.VOID=2]="VOID",e[e.FOSSIL_I=3]="FOSSIL_I",e[e.FOSSIL_J=4]="FOSSIL_J",e[e.FOSSIL_L=5]="FOSSIL_L",e[e.FOSSIL_O=6]="FOSSIL_O",e[e.FOSSIL_S=7]="FOSSIL_S",e[e.FOSSIL_T=8]="FOSSIL_T",e[e.FOSSIL_Z=9]="FOSSIL_Z",e[e.I=10]="I",e[e.J=11]="J",e[e.L=12]="L",e[e.O=13]="O",e[e.S=14]="S",e[e.T=15]="T",e[e.Z=16]="Z",e))(s||{});const{increaseScore:Wt}=K(),ie=4,Y=12,_e=28,R=k(Re());function Re(){return Array.from({length:_e},(e,i)=>i===_e-1?Array.from({length:Y},()=>s.WALL):Array.from({length:Y},(r,_)=>_===0||_===Y-1?s.WALL:i<=ie-1?s.BIRTH:s.VOID))}const N=k(Q()),se=k(Q());function Q(){return We(1,[s.I,s.J,s.L,s.O,s.S,s.Z,s.T])[0]}function qt(){N.value=se.value,se.value=Q()}function Xt(){N.value=Q(),se.value=Q(),R.value=Re()}function Qt(e){for(let i=0;i<e.length;i++){const[r,_]=e[i];if(R.value[r][_]!==s.VOID&&R.value[r][_]!==s.BIRTH&&R.value[r][_]!==N.value)return!0}return!1}function Kt([e,i]){switch(N.value){case s.I:R.value[e][i]=s.FOSSIL_I;break;case s.J:R.value[e][i]=s.FOSSIL_J;break;case s.L:R.value[e][i]=s.FOSSIL_L;break;case s.O:R.value[e][i]=s.FOSSIL_O;break;case s.S:R.value[e][i]=s.FOSSIL_S;break;case s.T:R.value[e][i]=s.FOSSIL_T;break;case s.Z:R.value[e][i]=s.FOSSIL_Z;break}}function Nt(){const e=[];R.value.forEach((i,r)=>{i.every(_=>_===s.WALL)||i.every(_=>_===s.FOSSIL_I||_===s.FOSSIL_J||_===s.FOSSIL_L||_===s.FOSSIL_O||_===s.FOSSIL_S||_===s.FOSSIL_T||_===s.FOSSIL_Z||_===s.WALL)&&e.push(r)}),e.length!==0&&(Wt(e.length),R.value=R.value.filter((i,r)=>!e.includes(r)),R.value=[...R.value.slice(0,ie),...e.map(()=>Array.from({length:Y},(i,r)=>r===0||r===Y-1?s.WALL:s.VOID)),...R.value.slice(ie)])}function M(){return{TOP_RESERVE:ie,currNode:N,nextNode:se,X_SIZE:Y,Y_SIZE:_e,nodes:R,resetUseNodes:Xt,willCollide:Qt,removeNodes:Nt,switchNode:qt,fossilize:Kt}}const eo={class:"relative w-20 md:w-28 h-20 md:h-28 flex items-center justify-center bg-gray-900 border border-gray-600 rounded-md"},to={key:0},oo={class:"absolute top-0 left-0 w-full h-full object-cover object-left",src:"https://ijivzwfsihdcvwrntdpe.supabase.co/storage/v1/object/public/tetris-images/cat-stare.webp",width:"80",height:"80",alt:""},no={key:0,class:"grid gap-px"},lo={key:1,class:"grid gap-px grid-cols-2"},io={key:2,class:"grid gap-px grid-cols-2"},so={key:3,class:"grid gap-px grid-cols-2"},ro={key:4,class:"grid gap-px grid-cols-3"},ao={key:5,class:"grid gap-px grid-cols-3"},uo={key:6,class:"grid gap-px grid-cols-3"},co=U({__name:"next-tetromino",setup(e){const{nextNode:i}=M(),{destroyedRawsCount:r,gameStatus:_,isCatHere:d}=K(),p=X(()=>{if(!d.value)return!1;const v=r.value%10;return v===1||v===5});return(v,h)=>(g(),S("div",eo,[u(_)==="PLAYING"?(g(),S("div",to,[Be(b("img",oo,null,512),[[Ve,u(p)]]),u(i)===u(s).I?(g(),S("div",no,[(g(),S(B,null,V(4,m=>b("div",{key:m,class:"node-size tetromino-border border-color__tetromino__I"})),64))])):E("v-if",!0),u(i)===u(s).J?(g(),S("div",lo,[(g(),S(B,null,V(6,m=>b("div",{key:m,class:Z(["node-size",{"border-color__tetromino__J tetromino-border":m===5||m%2===0}])},null,2)),64))])):E("v-if",!0),u(i)===u(s).L?(g(),S("div",io,[(g(),S(B,null,V(6,m=>b("div",{key:m,class:Z(["node-size",{"border-color__tetromino__L tetromino-border":m===6||m%2===1}])},null,2)),64))])):E("v-if",!0),u(i)===u(s).O?(g(),S("div",so,[(g(),S(B,null,V(4,m=>b("div",{key:m,class:"border-color__tetromino__O node-size tetromino-border"})),64))])):E("v-if",!0),u(i)===u(s).S?(g(),S("div",ro,[(g(),S(B,null,V(6,m=>b("div",{key:m,class:Z(["node-size",{"border-color__tetromino__S tetromino-border":[2,3,4,5].includes(m)}])},null,2)),64))])):E("v-if",!0),u(i)===u(s).T?(g(),S("div",ao,[(g(),S(B,null,V(6,m=>b("div",{key:m,class:Z(["node-size",{"border-color__tetromino__T tetromino-border":[2,4,5,6].includes(m)}])},null,2)),64))])):E("v-if",!0),u(i)===u(s).Z?(g(),S("div",uo,[(g(),S(B,null,V(6,m=>b("div",{key:m,class:Z(["node-size",{"border-color__tetromino__Z tetromino-border":[1,2,5,6].includes(m)}])},null,2)),64))])):E("v-if",!0)])):E("v-if",!0)]))}});const fo=W(co,[["__scopeId","data-v-30680c55"],["__file","/Users/jinseok.bang/Documents/github.me/jonganebski.github.io/src/pages/games/tetris/components/next-tetromino.vue"]]),_o=U({__name:"node",props:{rowIdx:{type:Number,required:!0},colIdx:{type:Number,required:!0},node:{type:null,required:!0},isCatHere:{type:Boolean,required:!0},isGuide:{type:Boolean,required:!0}},setup(e){const{TOP_RESERVE:i}=M(),{nodeSize:r}=ke();return(_,d)=>(g(),S("div",{class:Z(["bg-gray-900",[e.node===u(s).VOID?e.isGuide&&!e.isCatHere?"border-color__guide":"":e.node===u(s).I||e.node===u(s).FOSSIL_I?"border-color__tetromino__I":e.node===u(s).J||e.node===u(s).FOSSIL_J?"border-color__tetromino__J":e.node===u(s).L||e.node===u(s).FOSSIL_L?"border-color__tetromino__L":e.node===u(s).O||e.node===u(s).FOSSIL_O?"border-color__tetromino__O":e.node===u(s).S||e.node===u(s).FOSSIL_S?"border-color__tetromino__S":e.node===u(s).T||e.node===u(s).FOSSIL_T?"border-color__tetromino__T":e.node===u(s).Z||e.node===u(s).FOSSIL_Z?"border-color__tetromino__Z":""]]),style:ve({...e.node===u(s).WALL||e.rowIdx<u(i)?{display:"none"}:{width:`${u(r)}px`,height:`${u(r)}px`},...e.node===u(s).VOID?e.isGuide&&!e.isCatHere?{borderWidth:"1px"}:{}:{borderWidth:`${u(r)/2}px`}})},null,6))}});const vo=W(_o,[["__scopeId","data-v-005aef5a"],["__file","/Users/jinseok.bang/Documents/github.me/jonganebski.github.io/src/pages/games/tetris/components/node.vue"]]);function ge(e){return[[...e[0]],[...e[1]],[...e[2]],[...e[3]]]}function G(e,i){const{nodes:r,currNode:_,TOP_RESERVE:d,willCollide:p,fossilize:v}=M(),h=k(ge(e)),m=X(()=>h.value.map(([a,c])=>[a+1,c])),L=X(I);function I(){let a=!1,c=0;for(;!a;){c++;for(let n=0;n<h.value.length;n++){const[f,l]=h.value[n];if(!(r.value[f+c][l]===s.BIRTH||r.value[f+c][l]===s.VOID||r.value[f+c][l]===_.value)){a=!0;break}}}return h.value.map(([n,f])=>[n+c-1,f])}function y(){i.value=0,h.value=ge(e),h.value.forEach(([a,c])=>r.value[a][c]=_.value)}function T(){let a=!1;for(let c=0;c<m.value.length;c++){const[n,f]=m.value[c];if(!(r.value[n][f]===s.BIRTH||r.value[n][f]===s.VOID||r.value[n][f]===_.value)){a=!0;break}}return a?(h.value.forEach(v),!1):(h.value.forEach(([c,n])=>{r.value[c][n]=c<=d-1?s.BIRTH:s.VOID}),m.value.forEach(([c,n])=>{r.value[c][n]=_.value}),h.value=m.value,!0)}function w(){const a=h.value.map(([c,n])=>[c,n+1]);p(a)||(h.value.forEach(([c,n],f)=>{r.value[c][n]=c<=d-1?s.BIRTH:s.VOID,h.value[f]=[c,n+1]}),h.value.forEach(([c,n])=>{r.value[c][n]=_.value}))}function o(){const a=h.value.map(([c,n])=>[c,n-1]);p(a)||(h.value.forEach(([c,n],f)=>{r.value[c][n]=c<=d-1?s.BIRTH:s.VOID,h.value[f]=[c,n-1]}),h.value.forEach(([c,n])=>{r.value[c][n]=_.value}))}return{position:h,nextPosition:m,endPosition:L,prepare:y,fall:T,moveRight:w,moveLeft:o}}function mo(){const e=k(0),{nodes:i,TOP_RESERVE:r,willCollide:_,X_SIZE:d}=M(),p=Object.freeze([[r-2,Math.floor(d/2)],[r-3,Math.floor(d/2)],[r-4,Math.floor(d/2)],[r-1,Math.floor(d/2)]]),{position:v,nextPosition:h,endPosition:m,prepare:L,fall:I,moveRight:y,moveLeft:T}=G(p,e);function w(){let o=0,a=[...v.value];for(;o===0||_(a);){e.value===0?a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0],t[0][1]-1+o]:l===2?[t[0][0],t[0][1]-2+o]:[t[0][0],t[0][1]+1+o]):e.value===1?a=a.map(([n,f],l,t)=>l===0?[t[1][0]-1,t[1][1]+o]:l===1?[n,f+o]:l===2?[t[1][0]+1,t[1][1]+o]:[t[1][0]-2,t[1][1]+o]):e.value===2?a=a.map(([n,f],l,t)=>l===0?[t[1][0],t[1][1]+1+o]:l===1?[n,f+o]:l===2?[t[1][0],t[1][1]-1+o]:[t[1][0],t[1][1]+2+o]):a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0]-1,t[0][1]+o]:l===2?[t[0][0]-2,t[0][1]+o]:[t[0][0]+1,t[0][1]+o]);const c=o>0?1:-1;if(o=-(o+c),o>10)return}v.value.forEach(([c,n])=>{i.value[c][n]=c<=r-1?s.BIRTH:s.VOID}),v.value=[...a],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,v.value.forEach(([c,n])=>{i.value[c][n]=s.I})}return{defaultPosition:p,nextPosition:h,endPosition:m,position:v,shape:e,id:s.I,changeShape:w,moveRight:y,moveLeft:T,prepare:L,fall:I}}function ho(){const e=k(0),{nodes:i,TOP_RESERVE:r,willCollide:_,X_SIZE:d}=M(),p=Object.freeze([[r-3,Math.floor(d/2)],[r-2,Math.floor(d/2)],[r-1,Math.floor(d/2)],[r-1,Math.floor(d/2)-1]]),{position:v,nextPosition:h,endPosition:m,prepare:L,fall:I,moveLeft:y,moveRight:T}=G(p,e);function w(){let o=0,a=[...v.value];for(;o===0||_(a);){e.value===0?a=a.map(([n,f],l,t)=>l===0?[t[1][0],t[1][1]+1+o]:l===1?[n,f+o]:l===2?[t[1][0],t[1][1]-1+o]:[t[1][0]-1,t[1][1]-1+o]):e.value===1?a=a.map(([n,f],l,t)=>l===0?[t[1][0]+1,t[1][1]+o]:l===1?[n,f+o]:l===2?[t[1][0]-1,t[1][1]+o]:[t[1][0]-1,t[1][1]+1+o]):e.value===2?a=a.map(([n,f],l,t)=>l===0?[t[1][0],t[1][1]-1+o]:l===1?[n,f+o]:l===2?[t[1][0],t[1][1]+1+o]:[t[1][0]+1,t[1][1]+1+o]):a=a.map(([n,f],l,t)=>l===0?[t[1][0]-1,t[1][1]+o]:l===1?[n,f+o]:l===2?[t[1][0]+1,t[1][1]+o]:[t[1][0]+1,t[1][1]-1+o]);const c=o>0?1:-1;if(o=-(o+c),o>10)return}v.value.forEach(([c,n])=>{i.value[c][n]=c<=r-1?s.BIRTH:s.VOID}),v.value=[...a],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,v.value.forEach(([c,n])=>{i.value[c][n]=s.J})}return{defaultPosition:p,nextPosition:h,endPosition:m,position:v,shape:e,id:s.J,changeShape:w,moveRight:T,moveLeft:y,prepare:L,fall:I}}function po(){const e=k(0),{nodes:i,TOP_RESERVE:r,willCollide:_,X_SIZE:d}=M(),p=Object.freeze([[r-3,Math.floor(d/2)],[r-2,Math.floor(d/2)],[r-1,Math.floor(d/2)],[r-1,Math.floor(d/2)+1]]),{position:v,nextPosition:h,endPosition:m,prepare:L,fall:I,moveLeft:y,moveRight:T}=G(p,e);function w(){let o=0,a=[...v.value];for(;o===0||_(a);){e.value===0?a=a.map(([n,f],l,t)=>l===0?[t[1][0],t[1][1]-1+o]:l===1?[n,f+o]:l===2?[t[1][0],t[1][1]+1+o]:[t[1][0]-1,t[1][1]+1+o]):e.value===1?a=a.map(([n,f],l,t)=>l===0?[t[1][0]+1,t[1][1]+o]:l===1?[n,f+o]:l===2?[t[1][0]-1,t[1][1]+o]:[t[1][0]-1,t[1][1]-1+o]):e.value===2?a=a.map(([n,f],l,t)=>l===0?[t[1][0],t[1][1]+1+o]:l===1?[n,f+o]:l===2?[t[1][0],t[1][1]-1+o]:[t[1][0]+1,t[1][1]-1+o]):a=a.map(([n,f],l,t)=>l===0?[t[1][0]-1,t[1][1]+o]:l===1?[n,f+o]:l===2?[t[1][0]+1,t[1][1]+o]:[t[1][0]+1,t[1][1]+1+o]);const c=o>0?1:-1;if(o=-(o+c),o>10)return}v.value.forEach(([c,n])=>{i.value[c][n]=c<=r-1?s.BIRTH:s.VOID}),v.value=[...a],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,v.value.forEach(([c,n])=>{i.value[c][n]=s.L})}return{defaultPosition:p,nextPosition:h,endPosition:m,position:v,shape:e,id:s.L,changeShape:w,moveRight:T,moveLeft:y,prepare:L,fall:I}}function go(){const e=k(0),{X_SIZE:i,TOP_RESERVE:r}=M(),_=Object.freeze([[r-2,Math.floor(i/2)-1],[r-2,Math.floor(i/2)],[r-1,Math.floor(i/2)-1],[r-1,Math.floor(i/2)]]),{position:d,nextPosition:p,endPosition:v,prepare:h,fall:m,moveLeft:L,moveRight:I}=G(_,e);return{defaultPosition:_,nextPosition:p,endPosition:v,position:d,shape:e,id:s.O,changeShape:()=>{},moveRight:I,moveLeft:L,prepare:h,fall:m}}function bo(){const e=k(0),{nodes:i,TOP_RESERVE:r,willCollide:_,X_SIZE:d}=M(),p=Object.freeze([[r-1,Math.floor(d/2)-1],[r-2,Math.floor(d/2)-1],[r-2,Math.floor(d/2)],[r-1,Math.floor(d/2)-2]]),{position:v,nextPosition:h,endPosition:m,prepare:L,fall:I,moveRight:y,moveLeft:T}=G(p,e);function w(){let o=0,a=[...v.value];for(;o===0||_(a);){e.value===0?a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0],t[0][1]+1+o]:l===2?[t[0][0]+1,t[0][1]+1+o]:[t[0][0]-1,t[0][1]+o]):e.value===1?a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0]+1,t[0][1]+o]:l===2?[t[0][0]+1,t[0][1]-1+o]:[t[0][0],t[0][1]+1+o]):e.value===2?a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0],t[0][1]-1+o]:l===2?[t[0][0]-1,t[0][1]-1+o]:[t[0][0]+1,t[0][1]+o]):a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0]-1,t[0][1]+o]:l===2?[t[0][0]-1,t[0][1]+1+o]:[t[0][0],t[0][1]-1+o]);const c=o>0?1:-1;if(o=-(o+c),o>10)return}v.value.forEach(([c,n])=>{i.value[c][n]=c<=r-1?s.BIRTH:s.VOID}),v.value=[...a],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,v.value.forEach(([c,n])=>{i.value[c][n]=s.S})}return{defaultPosition:p,nextPosition:h,endPosition:m,position:v,shape:e,id:s.S,changeShape:w,moveRight:y,moveLeft:T,prepare:L,fall:I}}function So(){const e=k(0),{nodes:i,TOP_RESERVE:r,willCollide:_,X_SIZE:d}=M(),p=Object.freeze([[r-1,Math.floor(d/2)],[r-2,Math.floor(d/2)],[r-1,Math.floor(d/2)-1],[r-1,Math.floor(d/2)+1]]),{position:v,nextPosition:h,endPosition:m,prepare:L,fall:I,moveRight:y,moveLeft:T}=G(p,e);function w(){let o=0,a=[...v.value];for(;o===0||_(a);){e.value===0?a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0],t[0][1]+1+o]:l===2?[t[0][0]-1,t[0][1]+o]:[t[0][0]+1,t[0][1]+o]):e.value===1?a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0]+1,t[0][1]+o]:l===2?[t[0][0],t[0][1]+1+o]:[t[0][0],t[0][1]-1+o]):e.value===2?a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0],t[0][1]-1+o]:l===2?[t[0][0]+1,t[0][1]+o]:[t[0][0]-1,t[0][1]+o]):a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0]-1,t[0][1]+o]:l===2?[t[0][0],t[0][1]-1+o]:[t[0][0],t[0][1]+1+o]);const c=o>0?1:-1;if(o=-(o+c),o>10)return}v.value.forEach(([c,n])=>{i.value[c][n]=c<=r-1?s.BIRTH:s.VOID}),v.value=[...a],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,v.value.forEach(([c,n])=>{i.value[c][n]=s.T})}return{defaultPosition:p,nextPosition:h,endPosition:m,position:v,shape:e,id:s.T,changeShape:w,moveRight:y,moveLeft:T,prepare:L,fall:I}}function Lo(){const e=k(0),{nodes:i,TOP_RESERVE:r,willCollide:_,X_SIZE:d}=M(),p=Object.freeze([[r-1,Math.floor(d/2)],[r-2,Math.floor(d/2)],[r-2,Math.floor(d/2)-1],[r-1,Math.floor(d/2)+1]]),{position:v,nextPosition:h,endPosition:m,prepare:L,fall:I,moveRight:y,moveLeft:T}=G(p,e);function w(){let o=0,a=[...v.value];for(;o===0||_(a);){e.value===0?a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0],t[0][1]+1+o]:l===2?[t[0][0]-1,t[0][1]+1+o]:[t[0][0]+1,t[0][1]+o]):e.value===1?a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0]+1,t[0][1]+o]:l===2?[t[0][0]+1,t[0][1]+1+o]:[t[0][0],t[0][1]-1+o]):e.value===2?a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0],t[0][1]-1+o]:l===2?[t[0][0]+1,t[0][1]-1+o]:[t[0][0]-1,t[0][1]+o]):a=a.map(([n,f],l,t)=>l===0?[n,f+o]:l===1?[t[0][0]-1,t[0][1]+o]:l===2?[t[0][0]-1,t[0][1]-1+o]:[t[0][0],t[0][1]+1+o]);const c=o>0?1:-1;if(o=-(o+c),o>10)return}v.value.forEach(([c,n])=>{i.value[c][n]=c<=r-1?s.BIRTH:s.VOID}),v.value=[...a],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,v.value.forEach(([c,n])=>{i.value[c][n]=s.Z})}return{defaultPosition:p,nextPosition:h,endPosition:m,position:v,shape:e,id:s.Z,changeShape:w,moveRight:y,moveLeft:T,prepare:L,fall:I}}function Io(){const e=Fe(),{data:i}=ze();return He(async({score:r})=>{if(!i.value)return null;const{data:_}=await le.from("tetris-records").select("*").eq("user_id",i.value.id).order("score",{ascending:!1});if(!_)return null;switch(_.length<=10){case!0:return(await le.from("tetris-records").insert({score:r,user_id:i.value.id}).single()).data;case!1:{const d=_[_.length-1];return d.score>r?null:(await le.from("tetris-records").update({id:d.id,score:r}).single()).data}}},{onSuccess:r=>{if(!i.value)return;const{user_name:_=i.value.email,avatar_url:d=""}=i.value.user_metadata;if(!r)return;const p=e.getQueryData(["tetris-records"]);p&&e.setQueryData(["tetris-records"],()=>[...p,{...r,user:{user_name:_,avatar_url:d}}].sort((v,h)=>h.score-v.score))}})}function yo(){const{t:e}=re(),i=Io(),{openIssueModal:r}=Ze(),{TOP_RESERVE:_,currNode:d,nodes:p,removeNodes:v,switchNode:h,fossilize:m,resetUseNodes:L}=M(),{gameStatus:I,setTimeoutMs:y,score:T,computeSetTimeoutMs:w,resetGameInfo:o}=K(),a=mo(),c=ho(),n=po(),f=go(),l=bo(),t=Lo(),ee=So();let H;Ie(()=>{clearTimeout(H),oe()});function O(){const x=[a,c,n,f,l,t,ee].find(({id:A})=>A===d.value);if(!x)throw Error("Tetromino not found");return x}function j(){O().prepare(),P(),I.value="PLAYING"}function te(){i.mutate({score:T.value},{onSettled:()=>{window.alert("Game Over!"),I.value="END"},onError:()=>{r({title:e("record_mutation_failed.title"),content:e("record_mutation_failed.content")})}})}function oe(){L(),o()}function P(){clearTimeout(H),H=setTimeout(()=>{if(!O().fall()){if(clearTimeout(H),v(),!F())return te();h(),O().prepare()}P()},y.value)}function F(){const x=O().position.value;for(let A=0;A<x.length;A++){const[z]=x[A];if(z<_)return!1}return!0}function fe(x){I.value==="PLAYING"&&(x.preventDefault(),O().changeShape())}function q(x){I.value==="PLAYING"&&(x.preventDefault(),O().moveRight())}function xe(x){I.value==="PLAYING"&&(x.preventDefault(),O().moveLeft())}function Oe(x){I.value==="PLAYING"&&(x.preventDefault(),y.value=0,P(),y.value=w())}function Ce(x){if(I.value==="PLAYING"){if(x.preventDefault(),clearTimeout(H),O().position.value.forEach(([A,z])=>{p.value[A][z]=s.VOID}),O().endPosition.value.forEach(([A,z],ne)=>{m([A,z]),O().position.value[ne][0]=A,O().position.value[ne][1]=z}),v(),!F())return te();h(),O().prepare(),P()}}function $e(x,A){return I.value!=="PLAYING"?!1:!!O().endPosition.value.find(([z,ne])=>z===x&&ne===A)}return{moveTetrominoToRight:q,moveTetrominoToLeft:xe,moveTetrominoDown:Oe,rotateTetromino:fe,dropTetromino:Ce,resetGame:oe,startGame:j,tetromino:O,validate:F,isGuide:$e,fall:P}}const To={class:"my-20 text-3xl md:text-5xl text-center"},wo={class:"flex px-10 sm:pl-32 md:pl-50 xl:pl-64 gap-3 lg:gap-20"},ko={class:"flex flex-col gap-10"},Ro={key:0},xo={class:"mt-auto"},Oo=U({__name:"index",setup(e){const{lg:i}=Se(Le),{t:r}=re(),{isLoading:_,data:d}=qe(),{nodes:p,TOP_RESERVE:v,X_SIZE:h}=M(),{moveTetrominoToRight:m,moveTetrominoToLeft:L,moveTetrominoDown:I,rotateTetromino:y,dropTetromino:T,resetGame:w,startGame:o,tetromino:a,isGuide:c}=yo(),{gameStatus:n,isCatHere:f,score:l,level:t}=K();J("ArrowRight",m),J("ArrowLeft",L),J("ArrowDown",I),J("ArrowUp",y),J(" ",T);const ee=k(null),{left:H}=Ge(ee);return(O,j)=>{const te=Je,oe=je("client-only");return g(),S(B,null,[b("h1",To,C(u(r)("tetris")),1),$($t,{position:u(a)().position,left:u(H)},null,8,["position","left"]),b("div",wo,[b("div",{ref_key:"tetrisContainerEl",ref:ee,class:"grid gap-px shadow-lg bg-gray-700"},[(g(!0),S(B,null,V(u(p),(P,F)=>(g(),S("div",{key:F,style:ve({...F<u(v)?{display:"none"}:{display:"grid",gap:"1px",gridTemplateColumns:`repeat(${u(h)-2}, 1fr)`}})},[(g(!0),S(B,null,V(P,(fe,q)=>(g(),de(vo,{key:q,rowIdx:F,colIdx:q,"is-guide":u(c)(F,q),node:fe,"is-cat-here":u(f)},null,8,["rowIdx","colIdx","is-guide","node","is-cat-here"]))),128))],4))),128))],512),b("div",ko,[$(fo),b("div",null,C(u(r)("level"))+": "+C(u(t)),1),b("div",null,C(u(r)("score"))+": "+C(u(l)),1),u(n)==="READY"?(g(),S("button",{key:0,class:"py-2 px-3 border border-red-600 rounded",onClick:j[0]||(j[0]=(...P)=>u(o)&&u(o)(...P))},[D(C(u(r)("start"))+" ",1),u(f)?(g(),S("span",Ro,"🐈")):E("v-if",!0)])):E("v-if",!0),u(n)==="END"?(g(),S("button",{key:1,class:"py-2 px-3 border border-red-600 rounded",onClick:j[1]||(j[1]=(...P)=>u(w)&&u(w)(...P))},C(u(r)("reset")),1)):E("v-if",!0),b("div",xo,[u(i)?(g(),de(It,{key:0})):(g(),de(Ut,{key:1,onOnTouchArrowRightBtn:u(m),onOnTouchArrowLeftBtn:u(L),onOnTouchArrowDownBtn:u(T),onOnTouchRotateBtn:u(y)},null,8,["onOnTouchArrowRightBtn","onOnTouchArrowLeftBtn","onOnTouchArrowDownBtn","onOnTouchRotateBtn"]))])])]),$(Ue,{class:"mt-10 text-center"}),$(Ye,{"is-loading":u(_),data:u(d)},null,8,["is-loading","data"]),$(oe,null,{default:De(()=>[$(te,{class:"opacity-50"})]),_:1})],64)}}});const Eo=W(Oo,[["__file","/Users/jinseok.bang/Documents/github.me/jonganebski.github.io/src/pages/games/tetris/index.vue"]]);export{Eo as default};
