var ve=Object.defineProperty,pe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var ne=(t,a,n)=>a in t?ve(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,oe=(t,a)=>{for(var n in a||(a={}))we.call(a,n)&&ne(t,n,a[n]);if(ae)for(var n of ae(a))xe.call(a,n)&&ne(t,n,a[n]);return t},re=(t,a)=>pe(t,ge(a));import{s as W,d as me,e as Ne,u as se,_ as Ce,a as ye}from"./app.41ec1720.js";import{h,j as g,m as c,P as he,ac as ue,$ as Me,a0 as be,r as V,ad as ke,p as te,N as le,ae as fe,Q as _e,A as ce,d as Se,s as G,w as K,v as i,H as Fe,t as b,F as U,af as Oe,q as Qe,W as Z,T as ee,ag as Y,n as Re,x as de,y as E}from"./vendor.c8137ce3.js";import{_ as Ee,a as Ve,b as Ae}from"./records.7c119c85.js";const $e={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},qe=c("path",{d:"M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2zm0 26a12 12 0 1 1 12-12a12 12 0 0 1-12 12z",fill:"currentColor"},null,-1),He=c("circle",{cx:"16",cy:"23.5",r:"1.5",fill:"currentColor"},null,-1),ze=c("path",{d:"M17 8h-1.5a4.49 4.49 0 0 0-4.5 4.5v.5h2v-.5a2.5 2.5 0 0 1 2.5-2.5H17a2.5 2.5 0 0 1 0 5h-2v4.5h2V17a4.5 4.5 0 0 0 0-9z",fill:"currentColor"},null,-1),De=[qe,He,ze];function Le(t,a){return h(),g("svg",$e,De)}var Te={name:"carbon-help",render:Le};const je={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Be=c("path",{d:"M6 30H4V2h24l-5.8 9l5.8 9H6zm0-12h18.33l-4.53-7l4.53-7H6z",fill:"currentColor"},null,-1),Ge=[Be];function We(t,a){return h(),g("svg",je,Ge)}var Ie={name:"carbon-flag",render:We};const Ue=1e3*60*60;function Ye(t){return he(ue(["mine-sweeper-records",t]),async()=>t.value?(await W.from("mine-sweeper-records").select("*, user: user_id (user_name, avatar_url)").eq("mode_id",t.value).order("score",{ascending:!0}).limit(100)).data:null,ue({enabled:!!t,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Ue,retry:!1}))}function Pe(){const t=be(),{data:a}=me();return Me(async({modeId:n,score:u})=>{if(!a.value)return null;const{data:d}=await W.from("mine-sweeper-records").select("*").eq("user_id",a.value.id).eq("mode_id",n).order("score",{ascending:!0});if(!d)return null;switch(d.length<=10){case!0:return(await W.from("mine-sweeper-records").insert({mode_id:n,score:u,user_id:a.value.id}).single()).data;case!1:{const v=d[d.length-1];return v.score<u?null:(await W.from("mine-sweeper-records").update({id:v.id,score:u}).single()).data}}},{onSuccess:n=>{if(!a.value)return;const{user_name:u=a.value.email,avatar_url:d=""}=a.value.user_metadata;if(!n)return;const v=t.getQueryData(["mine-sweeper-records",n.mode_id]);!v||t.setQueryData(["mine-sweeper-records",n.mode_id],()=>[...v,re(oe({},n),{user:{user_name:u,avatar_url:d}})].sort((f,s)=>f.score-s.score))}})}function Xe(t){class a{constructor(e){this.isExploded=!1,this.isQuestion=!1,this.isFlagged=!1,this.isVeiled=!0,this.isMine=!1,this.hint=0,this.rowNum=e.rowNum,this.colNum=e.colNum}increaseHint(){this.hint+=1}around(e){var o,w,S,_,F,r,O,$,q,H,z,D,L,T,j,B;(w=(o=s.value[this.rowNum-1])==null?void 0:o[this.colNum])==null||w[e](),(_=(S=s.value[this.rowNum-1])==null?void 0:S[this.colNum+1])==null||_[e](),(r=(F=s.value[this.rowNum])==null?void 0:F[this.colNum+1])==null||r[e](),($=(O=s.value[this.rowNum+1])==null?void 0:O[this.colNum+1])==null||$[e](),(H=(q=s.value[this.rowNum+1])==null?void 0:q[this.colNum])==null||H[e](),(D=(z=s.value[this.rowNum+1])==null?void 0:z[this.colNum-1])==null||D[e](),(T=(L=s.value[this.rowNum])==null?void 0:L[this.colNum-1])==null||T[e](),(B=(j=s.value[this.rowNum-1])==null?void 0:j[this.colNum-1])==null||B[e]()}countAround(e){var w,S,_,F,r,O,$,q,H,z,D,L,T,j,B,ie;let o=0;return((S=(w=s.value[this.rowNum-1])==null?void 0:w[this.colNum])==null?void 0:S[e])&&o++,((F=(_=s.value[this.rowNum-1])==null?void 0:_[this.colNum+1])==null?void 0:F[e])&&o++,((O=(r=s.value[this.rowNum])==null?void 0:r[this.colNum+1])==null?void 0:O[e])&&o++,((q=($=s.value[this.rowNum+1])==null?void 0:$[this.colNum+1])==null?void 0:q[e])&&o++,((z=(H=s.value[this.rowNum+1])==null?void 0:H[this.colNum])==null?void 0:z[e])&&o++,((L=(D=s.value[this.rowNum+1])==null?void 0:D[this.colNum-1])==null?void 0:L[e])&&o++,((j=(T=s.value[this.rowNum])==null?void 0:T[this.colNum-1])==null?void 0:j[e])&&o++,((ie=(B=s.value[this.rowNum-1])==null?void 0:B[this.colNum-1])==null?void 0:ie[e])&&o++,o}unveil(){if(!!this.isVeiled&&!this.isFlagged){if(this.isMine){A({isSuccess:!1});return}this.isVeiled=!1,this.hint===0&&this.around("unveil")}}onLeftClick(){this.isFlagged||this.isQuestion||this.unveil()}onDoubleClick(){this.isVeiled||this.countAround("isFlagged")!==this.hint||this.around("unveil")}onRightClick(){if(!!this.isVeiled){if(this.isFlagged){m.value-=1,this.isFlagged=!1,this.isQuestion=!0;return}if(this.isQuestion){m.value-=1,this.isFlagged=!1,this.isQuestion=!1;return}m.value+=1,this.isFlagged=!0,this.isQuestion=!1}}}const n=1e3*999,u={surfaceLight:"#c6c6c6",surfaceDark:"#C0C0C0",shadow:"#808080"},d=Pe(),{openIssueModal:v}=Ne(),{t:f}=se(),s=V([]),m=V(0),N=V(!1),Q=V(!1),k=V(null),{timestamp:I,pause:C,resume:P}=ke({immediate:!1,controls:!0}),y=te(()=>k.value?I.value-k.value:0);le(y,()=>{y.value<n||A({isSuccess:!1})});const x=te(()=>t.value===3?{totalMines:99,rows:16,cols:30}:t.value===2?{totalMines:40,rows:16,cols:16}:t.value===1?{totalMines:10,rows:9,cols:9}:{totalMines:0,rows:0,cols:0});le(()=>t.value,()=>M(),{immediate:!0});function M(){C(),k.value=null,N.value=!1,Q.value=!1,m.value=0,s.value=[];for(let e=0;e<x.value.rows;e++){const o=[];for(let w=0;w<x.value.cols;w++)o.push(new a({rowNum:e,colNum:w}));s.value.push(o)}let l=0;for(;l<x.value.totalMines;){const e=Math.round(Math.random()*(x.value.rows-1)),o=Math.round(Math.random()*(x.value.cols-1));s.value[e][o].isMine||(s.value[e][o].isMine=!0,s.value[e][o].around("increaseHint"),l++)}}function X(){k.value=new Date().getTime(),P()}function A(l){if(C(),N.value=!0,Q.value=l.isSuccess,!l.isSuccess)return R();!t.value||d.mutate({modeId:t.value,score:y.value},{onSuccess:()=>{const e=f("congratulations")+"!";window.alert(e)},onError:()=>v({title:f("record_mutation_failed.title"),content:f("record_mutation_failed.content")})})}function p(l){N.value||(k.value||X(),l(),x.value.totalMines===m.value&&J()&&A({isSuccess:!0}))}function R(){s.value.forEach(l=>{l.forEach(e=>{e.isFlagged||!e.isMine||(e.isExploded=!0)})})}function J(){for(let l=0;l<s.value.length;l++)for(let e=0;e<s.value[l].length;e++){const o=s.value[l][e];if(!(o.isMine&&o.isFlagged)&&!!o.isVeiled)return!1}return!0}return{withController:p,initialize:M,isGameOver:N,flagCount:m,isSuccess:Q,COLORS:u,game:s,meta:x,time:y}}const Je=1e3*60*60*24;function Ke(t){return he([t],async()=>(await W.from(t).select("id, mode")).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Je,retry:!1})}function Ze(){const{t}=se(),{data:a}=Ke("mine-sweeper-modes"),n=fe(),u=_e(),d=te(()=>{var f;return(f=a.value)==null?void 0:f.map(({id:s,mode:m})=>({id:s,mode:t(m==="expert"?"expert":m==="intermediate"?"intermediate":"beginner")}))}),v=V(u.query.mode?Number(u.query.mode):1);return ce(()=>{if(!d.value)return;const f=u.query.mode?Number(u.query.mode):1;if(!d.value.find(({id:m})=>m===f))return n.replace({path:u.path});v.value=f}),ce(()=>Array.isArray(u.query.mode)&&n.replace({path:u.path})),{selectedMode:v,modes:d}}const et={class:"mt-20 min-h-screen grid place-items-center text-dark-500 dark:text-light-500"},tt={class:"text-3xl md:text-5xl"},st={class:"mt-10 flex justify-center"},it={class:"p-2 grid grid-cols-3 intaglio"},at={class:"flex"},nt={class:"counter"},ot={class:"flex items-center justify-center"},rt=["data-isGameOver"],ut={class:"flex justify-end"},lt={class:"counter"},ct={class:"rows-container intaglio"},dt=["data-isExploded","onContextmenu","onDblclick","onClick"],mt={key:1},ht={key:0,class:"mt-2 w-96 text-rose-500 text-sm"},ft=Se({setup(t){Oe(p=>({"0d1ab81d":i(C).rows,b2d8dc4e:i(m).shadow,"0d13e537":i(C).cols,"3c7e2662":i(m).surfaceLight}));const a=fe(),n=_e(),{data:u}=me(),{selectedMode:d,modes:v}=Ze(),{data:f,isLoading:s}=Ye(d),{COLORS:m,isGameOver:N,isSuccess:Q,flagCount:k,initialize:I,meta:C,game:P,withController:y,time:x}=Xe(d),{t:M}=se();function X(p){return p===1?"text-blue-700":p===2?"text-green-700":p===3?"text-red-700":p===4?"text-purple-700":p===5?"text-fuchsia-700":p===6?"text-cyan-600":"text-black"}function A(p){a.push({path:n.path,query:{mode:p}})}return(p,R)=>{const J=Ae,l=Ve,e=Ie,o=Te,w=Qe("client-only"),S=ye;return h(),g(U,null,[G(i(Fe),null,{default:K(()=>[c("title",null,b(i(M)("minesweeper"))+" | "+b(i(M)("jon_ganebskis_blog")),1)]),_:1}),c("div",et,[c("h1",tt,b(i(M)("minesweeper")),1),c("div",st,[G(l,{"model-value":i(d),"option-label-key":"mode",label:i(M)("mode"),class:"w-72","onUpdate:modelValue":A},{default:K(()=>[(h(!0),g(U,null,Z(i(v),_=>(h(),ee(J,{key:_.id,value:_.id,label:_.mode},null,8,["value","label"]))),128))]),_:1},8,["model-value","label"])]),G(w,null,{default:K(()=>[0<i(C).rows&&0<i(C).cols?(h(),g("div",{key:0,class:"mt-20 flex flex-col items-center justify-center game",onContextmenu:R[1]||(R[1]=Y(()=>{},["prevent"]))},[c("div",{class:"p-2 relief",style:Re({backgroundColor:i(m).surfaceDark})},[c("div",it,[c("div",at,[c("span",nt,b((i(C).totalMines-i(k)).toString().padStart(3,"0")),1)]),c("div",ot,[c("button",{class:"node-btn relief player w-10 h-10","data-isGameOver":i(N),"aria-label":"Click to restart the game",onClick:R[0]||(R[0]=(..._)=>i(I)&&i(I)(..._))},b(i(N)&&i(Q)?"\u{1F60E}":i(N)&&!i(Q)?"\u{1F480}":""),9,rt)]),c("div",ut,[c("span",lt,b(Math.round(i(x)/1e3).toString().padStart(3,"0")),1)])]),c("div",ct,[(h(!0),g(U,null,Z(i(P),(_,F)=>(h(),g("div",{key:F,class:"row"},[(h(!0),g(U,null,Z(_,(r,O)=>(h(),g("button",{key:O,class:de(["node-btn",[r.isVeiled&&"relief"]]),"data-isExploded":r.isExploded,onContextmenu:Y(()=>i(y)(()=>r.onRightClick()),["prevent"]),onDblclick:Y(()=>i(y)(()=>r.onDoubleClick()),["prevent"]),onClick:Y(()=>i(y)(()=>r.onLeftClick()),["prevent"])},[r.isVeiled?E("",!0):(h(),g("span",{key:0,class:de(["font-extrabold",[X(r.hint)]])},b(r.hint===0?"":r.hint),3)),r.isExploded?(h(),g("span",mt,"\u{1F4A3}")):E("",!0),r.isFlagged?(h(),ee(e,{key:2})):E("",!0),r.isQuestion?(h(),ee(o,{key:3})):E("",!0)],42,dt))),128))]))),128))])],4),i(u)?E("",!0):(h(),g("div",ht,b(i(M)("games_auth_warning")),1))],32)):E("",!0)]),_:1}),G(Ee,{"is-loading":i(s),data:i(f)},null,8,["is-loading","data"]),G(S)])],64)}}});var wt=Ce(ft,[["__scopeId","data-v-3f8f43e4"]]);export{wt as default};
