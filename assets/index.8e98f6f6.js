var fe=Object.defineProperty,ve=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var te=(s,i,a)=>i in s?fe(s,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[i]=a,se=(s,i)=>{for(var a in i||(i={}))ge.call(i,a)&&te(s,a,i[a]);if(ee)for(var a of ee(i))we.call(i,a)&&te(s,a,i[a]);return s},oe=(s,i)=>ve(s,pe(i));import{d as le,s as U,e as xe,b as Ne,u as ce,_ as ye,a as Ce}from"./app.54392c9e.js";import{h as u,j as d,m as n,$ as be,a0 as Me,r as A,a5 as $e,p as X,L as ne,N as de,a6 as ie,d as _e,w as $,t as o,F as W,U as I,v as b,y as O,a7 as me,O as he,z as ae,a4 as ke,q as Fe,x as re,R as P,a8 as Y,s as ue,n as Se}from"./vendor.6bd645fd.js";import{_ as Oe,a as Re,b as Ve}from"./list-numbered.75736eed.js";const Ae={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Qe=n("path",{d:"M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2zm0 26a12 12 0 1 1 12-12a12 12 0 0 1-12 12z",fill:"currentColor"},null,-1),ze=n("circle",{cx:"16",cy:"23.5",r:"1.5",fill:"currentColor"},null,-1),Ee=n("path",{d:"M17 8h-1.5a4.49 4.49 0 0 0-4.5 4.5v.5h2v-.5a2.5 2.5 0 0 1 2.5-2.5H17a2.5 2.5 0 0 1 0 5h-2v4.5h2V17a4.5 4.5 0 0 0 0-9z",fill:"currentColor"},null,-1),Le=[Qe,ze,Ee];function qe(s,i){return u(),d("svg",Ae,Le)}var De={name:"carbon-help",render:qe};const He={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Be=n("path",{d:"M6 30H4V2h24l-5.8 9l5.8 9H6zm0-12h18.33l-4.53-7l4.53-7H6z",fill:"currentColor"},null,-1),Te=[Be];function Ge(s,i){return u(),d("svg",He,Te)}var je={name:"carbon-flag",render:Ge};function Ue(){const s=Me(),{data:i}=le();return be(async({modeId:a,time:c})=>{if(!i.value)return null;const{data:m}=await U.from("mine-sweeper-records").select("*").eq("user_id",i.value.id).eq("mode_id",a).order("time",{ascending:!0});if(!m)return null;switch(m.length<=10){case!0:return(await U.from("mine-sweeper-records").insert({mode_id:a,time:c,user_id:i.value.id}).single()).data;case!1:{const e=m[m.length-1];return e.time<c?null:(await U.from("mine-sweeper-records").update({id:e.id,time:c}).single()).data}}},{onSuccess:a=>{if(!i.value)return;const{user_name:c=i.value.email,avatar_url:m=""}=i.value.user_metadata;if(!a)return;const e=s.getQueryData(["mine-sweeper-records",a.mode_id]);!e||s.setQueryData(["mine-sweeper-records",a.mode_id],()=>(e.push(oe(se({},a),{user:{user_name:c,avatar_url:m}})),e.sort((l,f)=>l.time-f.time)))}})}function Ye(s){class i{constructor(t){this.isExploded=!1,this.isQuestion=!1,this.isFlagged=!1,this.isVeiled=!0,this.isMine=!1,this.hint=0,this.rowNum=t.rowNum,this.colNum=t.colNum}increaseHint(){this.hint+=1}around(t){var r,x,k,g,F,_,S,E,L,q,D,H,B,T,G,j;(x=(r=e.value[this.rowNum-1])==null?void 0:r[this.colNum])==null||x[t](),(g=(k=e.value[this.rowNum-1])==null?void 0:k[this.colNum+1])==null||g[t](),(_=(F=e.value[this.rowNum])==null?void 0:F[this.colNum+1])==null||_[t](),(E=(S=e.value[this.rowNum+1])==null?void 0:S[this.colNum+1])==null||E[t](),(q=(L=e.value[this.rowNum+1])==null?void 0:L[this.colNum])==null||q[t](),(H=(D=e.value[this.rowNum+1])==null?void 0:D[this.colNum-1])==null||H[t](),(T=(B=e.value[this.rowNum])==null?void 0:B[this.colNum-1])==null||T[t](),(j=(G=e.value[this.rowNum-1])==null?void 0:G[this.colNum-1])==null||j[t]()}countAround(t){var x,k,g,F,_,S,E,L,q,D,H,B,T,G,j,Z;let r=0;return((k=(x=e.value[this.rowNum-1])==null?void 0:x[this.colNum])==null?void 0:k[t])&&r++,((F=(g=e.value[this.rowNum-1])==null?void 0:g[this.colNum+1])==null?void 0:F[t])&&r++,((S=(_=e.value[this.rowNum])==null?void 0:_[this.colNum+1])==null?void 0:S[t])&&r++,((L=(E=e.value[this.rowNum+1])==null?void 0:E[this.colNum+1])==null?void 0:L[t])&&r++,((D=(q=e.value[this.rowNum+1])==null?void 0:q[this.colNum])==null?void 0:D[t])&&r++,((B=(H=e.value[this.rowNum+1])==null?void 0:H[this.colNum-1])==null?void 0:B[t])&&r++,((G=(T=e.value[this.rowNum])==null?void 0:T[this.colNum-1])==null?void 0:G[t])&&r++,((Z=(j=e.value[this.rowNum-1])==null?void 0:j[this.colNum-1])==null?void 0:Z[t])&&r++,r}unveil(){if(!!this.isVeiled&&!this.isFlagged){if(this.isMine){z({isSuccess:!1});return}this.isVeiled=!1,this.hint===0&&this.around("unveil")}}onLeftClick(){this.isFlagged||this.isQuestion||this.unveil()}onDoubleClick(){this.isVeiled||this.countAround("isFlagged")!==this.hint||this.around("unveil")}onRightClick(){if(!!this.isVeiled){if(this.isFlagged){l.value-=1,this.isFlagged=!1,this.isQuestion=!0;return}if(this.isQuestion){l.value-=1,this.isFlagged=!1,this.isQuestion=!1;return}l.value+=1,this.isFlagged=!0,this.isQuestion=!1}}}const a=1e3*999,c={surfaceLight:"#c6c6c6",surfaceDark:"#C0C0C0",shadow:"#808080"},m=Ue(),e=A([]),l=A(0),f=A(!1),p=A(!1),N=A(null),{timestamp:y,pause:v,resume:R}=$e({immediate:!1,controls:!0}),M=X(()=>N.value?y.value-N.value:0);ne(M,()=>{M.value<a||z({isSuccess:!1})});const C=X(()=>s.value===3?{totalMines:99,rows:16,cols:30}:s.value===2?{totalMines:40,rows:16,cols:16}:s.value===1?{totalMines:10,rows:9,cols:9}:{totalMines:0,rows:0,cols:0});ne(()=>s.value,()=>Q(),{immediate:!0});function Q(){v(),N.value=null,f.value=!1,p.value=!1,l.value=0,e.value=[];for(let t=0;t<C.value.rows;t++){const r=[];for(let x=0;x<C.value.cols;x++)r.push(new i({rowNum:t,colNum:x}));e.value.push(r)}let h=0;for(;h<C.value.totalMines;){const t=Math.round(Math.random()*(C.value.rows-1)),r=Math.round(Math.random()*(C.value.cols-1));e.value[t][r].isMine||(e.value[t][r].isMine=!0,e.value[t][r].around("increaseHint"),h++)}}function J(){N.value=new Date().getTime(),R()}function z(h){if(v(),f.value=!0,p.value=h.isSuccess,!h.isSuccess)return V();!s.value||m.mutate({modeId:s.value,time:M.value},{onSuccess:()=>{window.alert("New Record!")}})}function w(h){f.value||(N.value||J(),h(),C.value.totalMines===l.value&&K()&&z({isSuccess:!0}))}function V(){e.value.forEach(h=>{h.forEach(t=>{t.isFlagged||!t.isMine||(t.isExploded=!0)})})}function K(){for(let h=0;h<e.value.length;h++)for(let t=0;t<e.value[h].length;t++){const r=e.value[h][t];if(!(r.isMine&&r.isFlagged)&&!!r.isVeiled)return!1}return!0}return{withController:w,initialize:Q,isGameOver:f,flagCount:l,isSuccess:p,COLORS:c,game:e,meta:C,time:M}}const We={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Ie=n("path",{d:"M16 30a14 14 0 1 1 14-14a14 14 0 0 1-14 14zm0-26a12 12 0 1 0 12 12A12 12 0 0 0 16 4z",fill:"currentColor"},null,-1),Xe=n("path",{d:"M20.59 22L15 16.41V7h2v8.58l5 5.01L20.59 22z",fill:"currentColor"},null,-1),Je=[Ie,Xe];function Ke(s,i){return u(),d("svg",We,Je)}var Pe={name:"carbon-time",render:Ke};const Ze=1e3*60*60;function et(s){return de(ie(["mine-sweeper-records",s]),async()=>s.value?(await U.from("mine-sweeper-records").select("*, user: user_id (user_name, avatar_url)").eq("mode_id",s.value).order("time",{ascending:!0}).limit(100)).data:null,ie({enabled:!!s.value,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Ze,retry:!1}))}const tt={class:"mt-10 p-10 rounded shadow-lg"},st={class:"mx-auto text-sm"},ot={class:"pb-5 pr-10"},nt={class:"pb-5 px-10 w-48"},it={class:"pb-5 pl-10"},at={key:0},rt=n("td",{colspan:"3",class:"py-10 text-center"},"Loading...",-1),ut=[rt],lt={key:1},ct=n("td",{colspan:"3",class:"py-10 text-center"},"No Data",-1),dt=[ct],_t={class:"py-2 pr-10 text-center"},mt={class:"py-2"},ht={class:"flex items-center gap-3"},ft={class:"relative"},vt={key:0,class:"absolute top-0 right-0 text-xl"},pt={class:"w-48 truncate"},gt={class:"py-2 text-right"},wt=_e({props:{selectedMode:null},setup(s){const i=s,{data:a,isLoading:c}=et(X(()=>i.selectedMode));return(m,e)=>{const l=Oe,f=xe,p=Pe,N=Ne;return u(),d("div",tt,[n("table",st,[n("thead",null,[n("tr",null,[n("th",ot,[$(l,{class:"mx-auto"})]),n("th",nt,[$(f,{class:"mx-auto"})]),n("th",it,[$(p,{class:"mx-auto"})])])]),n("tbody",null,[o(c)?(u(),d("tr",at,ut)):!o(a)||o(a).length===0?(u(),d("tr",lt,dt)):(u(!0),d(W,{key:2},I(o(a),(y,v)=>{var R;return u(),d("tr",{key:y.id},[n("td",_t,b(v+1),1),n("td",mt,[n("div",ht,[n("div",ft,[$(N,{src:(R=y.user.avatar_url)!=null?R:"",width:40,height:40,class:"rounded-full"},null,8,["src"]),v+1<=3?(u(),d("span",vt,b(v+1===1?"\u{1F947}":v+1===2?"\u{1F948}":v+1===3?"\u{1F949}":""),1)):O("",!0)]),n("span",pt,b(y.user.user_name),1)])]),n("td",gt,b((y.time/1e3).toFixed(2))+"`s",1)])}),128))])])])}}}),xt=1e3*60*60*24;function Nt(s){return de([s],async()=>(await U.from(s).select("id, mode")).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:xt,retry:!1})}function yt(){const{t:s}=ce(),{data:i}=Nt("mine-sweeper-modes"),a=me(),c=he(),m=X(()=>{var l;return(l=i.value)==null?void 0:l.map(({id:f,mode:p})=>({id:f,mode:s(p==="expert"?"expert":p==="intermediate"?"intermediate":"beginner")}))}),e=A(c.query.mode?Number(c.query.mode):1);return ae(()=>{if(!m.value)return;const l=c.query.mode?Number(c.query.mode):1;if(!m.value.find(({id:p})=>p===l))return a.replace({path:c.path});e.value=l}),ae(()=>Array.isArray(c.query.mode)&&a.replace({path:c.path})),{selectedMode:e,modes:m}}const Ct={class:"min-h-screen grid place-items-center"},bt={class:"mt-10 flex justify-center"},Mt={class:"p-2 grid grid-cols-3 intaglio"},$t={class:"flex"},kt={class:"counter"},Ft={class:"flex items-center justify-center"},St=["data-isGameOver"],Ot={class:"flex justify-end"},Rt={class:"counter"},Vt={class:"rows-container intaglio"},At=["data-isExploded","onContextmenu","onDblclick","onClick"],Qt={key:1},zt={key:0,class:"mt-2 w-96 text-rose-500 text-sm"},Et=_e({setup(s){ke(w=>({"18a7a0d2":o(v).rows,"4939cfe4":o(l).shadow,"18a0cdec":o(v).cols,"5e891e52":o(l).surfaceLight}));const i=me(),a=he(),{data:c}=le(),{selectedMode:m,modes:e}=yt(),{COLORS:l,isGameOver:f,isSuccess:p,flagCount:N,initialize:y,meta:v,game:R,withController:M,time:C}=Ye(m),{t:Q}=ce();function J(w){return w===1?"text-blue-700":w===2?"text-green-700":w===3?"text-red-700":w===4?"text-purple-700":w===5?"text-fuchsia-700":w===6?"text-cyan-600":"text-black"}function z(w){i.push({path:a.path,query:{mode:w}})}return(w,V)=>{const K=Ve,h=Re,t=je,r=De,x=Fe("client-only"),k=Ce;return u(),d("div",Ct,[n("div",bt,[$(h,{"model-value":o(m),"option-label-key":"mode",label:o(Q)("mode"),"onUpdate:modelValue":z},{default:re(()=>[(u(!0),d(W,null,I(o(e),g=>(u(),P(K,{key:g.id,value:g.id,label:g.mode},null,8,["value","label"]))),128))]),_:1},8,["model-value","label"])]),$(x,null,{default:re(()=>[0<o(v).rows&&0<o(v).cols?(u(),d("div",{key:0,class:"mt-20 flex flex-col items-center justify-center game",onContextmenu:V[1]||(V[1]=Y(()=>{},["prevent"]))},[n("div",{class:"p-2 relief",style:Se({backgroundColor:o(l).surfaceDark})},[n("div",Mt,[n("div",$t,[n("span",kt,b((o(v).totalMines-o(N)).toString().padStart(3,"0")),1)]),n("div",Ft,[n("button",{class:"node-btn relief player w-10 h-10","data-isGameOver":o(f),"aria-label":"Click to restart the game",onClick:V[0]||(V[0]=(...g)=>o(y)&&o(y)(...g))},b(o(f)&&o(p)?"\u{1F60E}":o(f)&&!o(p)?"\u{1F480}":""),9,St)]),n("div",Ot,[n("span",Rt,b(Math.round(o(C)/1e3).toString().padStart(3,"0")),1)])]),n("div",Vt,[(u(!0),d(W,null,I(o(R),(g,F)=>(u(),d("div",{key:F,class:"row"},[(u(!0),d(W,null,I(g,(_,S)=>(u(),d("button",{key:S,class:ue(["node-btn",[_.isVeiled&&"relief"]]),"data-isExploded":_.isExploded,onContextmenu:Y(()=>o(M)(()=>_.onRightClick()),["prevent"]),onDblclick:Y(()=>o(M)(()=>_.onDoubleClick()),["prevent"]),onClick:Y(()=>o(M)(()=>_.onLeftClick()),["prevent"])},[_.isVeiled?O("",!0):(u(),d("span",{key:0,class:ue(["font-extrabold",[J(_.hint)]])},b(_.hint===0?"":_.hint),3)),_.isExploded?(u(),d("span",Qt,"\u{1F4A3}")):O("",!0),_.isFlagged?(u(),P(t,{key:2})):O("",!0),_.isQuestion?(u(),P(r,{key:3})):O("",!0)],42,At))),128))]))),128))])],4),o(c)?O("",!0):(u(),d("div",zt,b(o(Q)("games_auth_warning")),1))],32)):O("",!0)]),_:1}),$(wt,{"selected-mode":o(m)},null,8,["selected-mode"]),$(k)])}}});var Bt=ye(Et,[["__scopeId","data-v-5660b5e1"]]);export{Bt as default};
