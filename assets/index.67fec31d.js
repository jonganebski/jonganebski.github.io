var fe=Object.defineProperty,ve=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var se=(s,i,a)=>i in s?fe(s,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[i]=a,ne=(s,i)=>{for(var a in i||(i={}))ge.call(i,a)&&se(s,a,i[a]);if(te)for(var a of te(i))we.call(i,a)&&se(s,a,i[a]);return s},oe=(s,i)=>ve(s,pe(i));import{s as Y,d as xe,b as Ne,e as ue,u as ce,_ as ye,a as be}from"./app.5f2f8cef.js";import{h as l,j as d,m as o,P as de,a5 as ie,d as _e,p as P,s as M,v as n,F as W,W as I,t as x,y as R,$ as Ce,a0 as Me,r as V,a6 as ke,N as ae,a7 as me,Q as he,A as re,w as K,H as $e,a4 as Fe,q as Se,S as Z,a8 as U,n as Oe,x as le}from"./vendor.05982d12.js";import{_ as Re,a as Ae,b as Qe}from"./list-numbered.87fc7265.js";const Ve={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Ee=o("path",{d:"M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2zm0 26a12 12 0 1 1 12-12a12 12 0 0 1-12 12z",fill:"currentColor"},null,-1),ze=o("circle",{cx:"16",cy:"23.5",r:"1.5",fill:"currentColor"},null,-1),qe=o("path",{d:"M17 8h-1.5a4.49 4.49 0 0 0-4.5 4.5v.5h2v-.5a2.5 2.5 0 0 1 2.5-2.5H17a2.5 2.5 0 0 1 0 5h-2v4.5h2V17a4.5 4.5 0 0 0 0-9z",fill:"currentColor"},null,-1),Le=[Ee,ze,qe];function De(s,i){return l(),d("svg",Ve,Le)}var He={name:"carbon-help",render:De};const Be={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Te=o("path",{d:"M6 30H4V2h24l-5.8 9l5.8 9H6zm0-12h18.33l-4.53-7l4.53-7H6z",fill:"currentColor"},null,-1),je=[Te];function Ge(s,i){return l(),d("svg",Be,je)}var We={name:"carbon-flag",render:Ge};const Ye={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Ue=o("path",{d:"M16 30a14 14 0 1 1 14-14a14 14 0 0 1-14 14zm0-26a12 12 0 1 0 12 12A12 12 0 0 0 16 4z",fill:"currentColor"},null,-1),Ie=o("path",{d:"M20.59 22L15 16.41V7h2v8.58l5 5.01L20.59 22z",fill:"currentColor"},null,-1),Pe=[Ue,Ie];function Xe(s,i){return l(),d("svg",Ye,Pe)}var Je={name:"carbon-time",render:Xe};const Ke=1e3*60*60;function Ze(s){return de(ie(["mine-sweeper-records",s]),async()=>s.value?(await Y.from("mine-sweeper-records").select("*, user: user_id (user_name, avatar_url)").eq("mode_id",s.value).order("time",{ascending:!0}).limit(100)).data:null,ie({enabled:!!s.value,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Ke,retry:!1}))}const et={class:"mt-10 p-10 rounded shadow-lg"},tt={class:"mx-auto text-sm"},st={class:"pb-5 pr-10"},nt={class:"pb-5 px-10 w-48"},ot={class:"pb-5 pl-10"},it={key:0},at=o("td",{colspan:"3",class:"py-10 text-center"},"Loading...",-1),rt=[at],lt={key:1},ut=o("td",{colspan:"3",class:"py-10 text-center"},"No Data",-1),ct=[ut],dt={class:"py-2 pr-10 text-center"},_t={class:"py-2"},mt={class:"flex items-center gap-3"},ht={class:"relative"},ft={key:0,class:"absolute top-0 right-0 text-xl"},vt={class:"w-48 truncate"},pt={class:"py-2 text-right"},gt=_e({props:{selectedMode:null},setup(s){const i=s,{data:a,isLoading:c}=Ze(P(()=>i.selectedMode));return(m,e)=>{const u=Re,f=xe,p=Je,y=Ne;return l(),d("div",et,[o("table",tt,[o("thead",null,[o("tr",null,[o("th",st,[M(u,{class:"mx-auto"})]),o("th",nt,[M(f,{class:"mx-auto"})]),o("th",ot,[M(p,{class:"mx-auto"})])])]),o("tbody",null,[n(c)?(l(),d("tr",it,rt)):!n(a)||n(a).length===0?(l(),d("tr",lt,ct)):(l(!0),d(W,{key:2},I(n(a),(b,v)=>{var A;return l(),d("tr",{key:b.id},[o("td",dt,x(v+1),1),o("td",_t,[o("div",mt,[o("div",ht,[M(y,{src:(A=b.user.avatar_url)!=null?A:"",width:40,height:40,class:"rounded-full"},null,8,["src"]),v+1<=3?(l(),d("span",ft,x(v+1===1?"\u{1F947}":v+1===2?"\u{1F948}":v+1===3?"\u{1F949}":""),1)):R("",!0)]),o("span",vt,x(b.user.user_name),1)])]),o("td",pt,x((b.time/1e3).toFixed(2))+"`s",1)])}),128))])])])}}});function wt(){const s=Me(),{data:i}=ue();return Ce(async({modeId:a,time:c})=>{if(!i.value)return null;const{data:m}=await Y.from("mine-sweeper-records").select("*").eq("user_id",i.value.id).eq("mode_id",a).order("time",{ascending:!0});if(!m)return null;switch(m.length<=10){case!0:return(await Y.from("mine-sweeper-records").insert({mode_id:a,time:c,user_id:i.value.id}).single()).data;case!1:{const e=m[m.length-1];return e.time<c?null:(await Y.from("mine-sweeper-records").update({id:e.id,time:c}).single()).data}}},{onSuccess:a=>{if(!i.value)return;const{user_name:c=i.value.email,avatar_url:m=""}=i.value.user_metadata;if(!a)return;const e=s.getQueryData(["mine-sweeper-records",a.mode_id]);!e||s.setQueryData(["mine-sweeper-records",a.mode_id],()=>(e.push(oe(ne({},a),{user:{user_name:c,avatar_url:m}})),e.sort((u,f)=>u.time-f.time)))}})}function xt(s){class i{constructor(t){this.isExploded=!1,this.isQuestion=!1,this.isFlagged=!1,this.isVeiled=!0,this.isMine=!1,this.hint=0,this.rowNum=t.rowNum,this.colNum=t.colNum}increaseHint(){this.hint+=1}around(t){var r,N,F,g,S,_,O,z,q,L,D,H,B,T,j,G;(N=(r=e.value[this.rowNum-1])==null?void 0:r[this.colNum])==null||N[t](),(g=(F=e.value[this.rowNum-1])==null?void 0:F[this.colNum+1])==null||g[t](),(_=(S=e.value[this.rowNum])==null?void 0:S[this.colNum+1])==null||_[t](),(z=(O=e.value[this.rowNum+1])==null?void 0:O[this.colNum+1])==null||z[t](),(L=(q=e.value[this.rowNum+1])==null?void 0:q[this.colNum])==null||L[t](),(H=(D=e.value[this.rowNum+1])==null?void 0:D[this.colNum-1])==null||H[t](),(T=(B=e.value[this.rowNum])==null?void 0:B[this.colNum-1])==null||T[t](),(G=(j=e.value[this.rowNum-1])==null?void 0:j[this.colNum-1])==null||G[t]()}countAround(t){var N,F,g,S,_,O,z,q,L,D,H,B,T,j,G,ee;let r=0;return((F=(N=e.value[this.rowNum-1])==null?void 0:N[this.colNum])==null?void 0:F[t])&&r++,((S=(g=e.value[this.rowNum-1])==null?void 0:g[this.colNum+1])==null?void 0:S[t])&&r++,((O=(_=e.value[this.rowNum])==null?void 0:_[this.colNum+1])==null?void 0:O[t])&&r++,((q=(z=e.value[this.rowNum+1])==null?void 0:z[this.colNum+1])==null?void 0:q[t])&&r++,((D=(L=e.value[this.rowNum+1])==null?void 0:L[this.colNum])==null?void 0:D[t])&&r++,((B=(H=e.value[this.rowNum+1])==null?void 0:H[this.colNum-1])==null?void 0:B[t])&&r++,((j=(T=e.value[this.rowNum])==null?void 0:T[this.colNum-1])==null?void 0:j[t])&&r++,((ee=(G=e.value[this.rowNum-1])==null?void 0:G[this.colNum-1])==null?void 0:ee[t])&&r++,r}unveil(){if(!!this.isVeiled&&!this.isFlagged){if(this.isMine){E({isSuccess:!1});return}this.isVeiled=!1,this.hint===0&&this.around("unveil")}}onLeftClick(){this.isFlagged||this.isQuestion||this.unveil()}onDoubleClick(){this.isVeiled||this.countAround("isFlagged")!==this.hint||this.around("unveil")}onRightClick(){if(!!this.isVeiled){if(this.isFlagged){u.value-=1,this.isFlagged=!1,this.isQuestion=!0;return}if(this.isQuestion){u.value-=1,this.isFlagged=!1,this.isQuestion=!1;return}u.value+=1,this.isFlagged=!0,this.isQuestion=!1}}}const a=1e3*999,c={surfaceLight:"#c6c6c6",surfaceDark:"#C0C0C0",shadow:"#808080"},m=wt(),e=V([]),u=V(0),f=V(!1),p=V(!1),y=V(null),{timestamp:b,pause:v,resume:A}=ke({immediate:!1,controls:!0}),k=P(()=>y.value?b.value-y.value:0);ae(k,()=>{k.value<a||E({isSuccess:!1})});const C=P(()=>s.value===3?{totalMines:99,rows:16,cols:30}:s.value===2?{totalMines:40,rows:16,cols:16}:s.value===1?{totalMines:10,rows:9,cols:9}:{totalMines:0,rows:0,cols:0});ae(()=>s.value,()=>$(),{immediate:!0});function $(){v(),y.value=null,f.value=!1,p.value=!1,u.value=0,e.value=[];for(let t=0;t<C.value.rows;t++){const r=[];for(let N=0;N<C.value.cols;N++)r.push(new i({rowNum:t,colNum:N}));e.value.push(r)}let h=0;for(;h<C.value.totalMines;){const t=Math.round(Math.random()*(C.value.rows-1)),r=Math.round(Math.random()*(C.value.cols-1));e.value[t][r].isMine||(e.value[t][r].isMine=!0,e.value[t][r].around("increaseHint"),h++)}}function X(){y.value=new Date().getTime(),A()}function E(h){if(v(),f.value=!0,p.value=h.isSuccess,!h.isSuccess)return Q();!s.value||m.mutate({modeId:s.value,time:k.value},{onSuccess:()=>{window.alert("New Record!")}})}function w(h){f.value||(y.value||X(),h(),C.value.totalMines===u.value&&J()&&E({isSuccess:!0}))}function Q(){e.value.forEach(h=>{h.forEach(t=>{t.isFlagged||!t.isMine||(t.isExploded=!0)})})}function J(){for(let h=0;h<e.value.length;h++)for(let t=0;t<e.value[h].length;t++){const r=e.value[h][t];if(!(r.isMine&&r.isFlagged)&&!!r.isVeiled)return!1}return!0}return{withController:w,initialize:$,isGameOver:f,flagCount:u,isSuccess:p,COLORS:c,game:e,meta:C,time:k}}const Nt=1e3*60*60*24;function yt(s){return de([s],async()=>(await Y.from(s).select("id, mode")).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Nt,retry:!1})}function bt(){const{t:s}=ce(),{data:i}=yt("mine-sweeper-modes"),a=me(),c=he(),m=P(()=>{var u;return(u=i.value)==null?void 0:u.map(({id:f,mode:p})=>({id:f,mode:s(p==="expert"?"expert":p==="intermediate"?"intermediate":"beginner")}))}),e=V(c.query.mode?Number(c.query.mode):1);return re(()=>{if(!m.value)return;const u=c.query.mode?Number(c.query.mode):1;if(!m.value.find(({id:p})=>p===u))return a.replace({path:c.path});e.value=u}),re(()=>Array.isArray(c.query.mode)&&a.replace({path:c.path})),{selectedMode:e,modes:m}}const Ct={class:"mt-20 min-h-screen grid place-items-center text-dark-500 dark:text-light-500"},Mt={class:"text-3xl md:text-5xl"},kt={class:"mt-10 flex justify-center"},$t={class:"p-2 grid grid-cols-3 intaglio"},Ft={class:"flex"},St={class:"counter"},Ot={class:"flex items-center justify-center"},Rt=["data-isGameOver"],At={class:"flex justify-end"},Qt={class:"counter"},Vt={class:"rows-container intaglio"},Et=["data-isExploded","onContextmenu","onDblclick","onClick"],zt={key:1},qt={key:0,class:"mt-2 w-96 text-rose-500 text-sm"},Lt=_e({setup(s){Fe(w=>({"34fe2935":n(v).rows,"5ea8b6f1":n(u).shadow,"34f7564f":n(v).cols,"0cf9197a":n(u).surfaceLight}));const i=me(),a=he(),{data:c}=ue(),{selectedMode:m,modes:e}=bt(),{COLORS:u,isGameOver:f,isSuccess:p,flagCount:y,initialize:b,meta:v,game:A,withController:k,time:C}=xt(m),{t:$}=ce();function X(w){return w===1?"text-blue-700":w===2?"text-green-700":w===3?"text-red-700":w===4?"text-purple-700":w===5?"text-fuchsia-700":w===6?"text-cyan-600":"text-black"}function E(w){i.push({path:a.path,query:{mode:w}})}return(w,Q)=>{const J=Qe,h=Ae,t=We,r=He,N=Se("client-only"),F=be;return l(),d(W,null,[M(n($e),null,{default:K(()=>[o("title",null,x(n($)("minesweeper"))+" | "+x(n($)("jon_ganebskis_blog")),1)]),_:1}),o("div",Ct,[o("h1",Mt,x(n($)("minesweeper")),1),o("div",kt,[M(h,{"model-value":n(m),"option-label-key":"mode",label:n($)("mode"),class:"w-72","onUpdate:modelValue":E},{default:K(()=>[(l(!0),d(W,null,I(n(e),g=>(l(),Z(J,{key:g.id,value:g.id,label:g.mode},null,8,["value","label"]))),128))]),_:1},8,["model-value","label"])]),M(N,null,{default:K(()=>[0<n(v).rows&&0<n(v).cols?(l(),d("div",{key:0,class:"mt-20 flex flex-col items-center justify-center game",onContextmenu:Q[1]||(Q[1]=U(()=>{},["prevent"]))},[o("div",{class:"p-2 relief",style:Oe({backgroundColor:n(u).surfaceDark})},[o("div",$t,[o("div",Ft,[o("span",St,x((n(v).totalMines-n(y)).toString().padStart(3,"0")),1)]),o("div",Ot,[o("button",{class:"node-btn relief player w-10 h-10","data-isGameOver":n(f),"aria-label":"Click to restart the game",onClick:Q[0]||(Q[0]=(...g)=>n(b)&&n(b)(...g))},x(n(f)&&n(p)?"\u{1F60E}":n(f)&&!n(p)?"\u{1F480}":""),9,Rt)]),o("div",At,[o("span",Qt,x(Math.round(n(C)/1e3).toString().padStart(3,"0")),1)])]),o("div",Vt,[(l(!0),d(W,null,I(n(A),(g,S)=>(l(),d("div",{key:S,class:"row"},[(l(!0),d(W,null,I(g,(_,O)=>(l(),d("button",{key:O,class:le(["node-btn",[_.isVeiled&&"relief"]]),"data-isExploded":_.isExploded,onContextmenu:U(()=>n(k)(()=>_.onRightClick()),["prevent"]),onDblclick:U(()=>n(k)(()=>_.onDoubleClick()),["prevent"]),onClick:U(()=>n(k)(()=>_.onLeftClick()),["prevent"])},[_.isVeiled?R("",!0):(l(),d("span",{key:0,class:le(["font-extrabold",[X(_.hint)]])},x(_.hint===0?"":_.hint),3)),_.isExploded?(l(),d("span",zt,"\u{1F4A3}")):R("",!0),_.isFlagged?(l(),Z(t,{key:2})):R("",!0),_.isQuestion?(l(),Z(r,{key:3})):R("",!0)],42,Et))),128))]))),128))])],4),n(c)?R("",!0):(l(),d("div",qt,x(n($)("games_auth_warning")),1))],32)):R("",!0)]),_:1}),M(gt,{"selected-mode":n(m)},null,8,["selected-mode"]),M(F)])],64)}}});var jt=ye(Lt,[["__scopeId","data-v-6e132ab9"]]);export{jt as default};
