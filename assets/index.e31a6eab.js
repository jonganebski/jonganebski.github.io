var fe=Object.defineProperty,_e=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var se=(s,a,n)=>a in s?fe(s,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[a]=n,ie=(s,a)=>{for(var n in a||(a={}))pe.call(a,n)&&se(s,n,a[n]);if(te)for(var n of te(a))ge.call(a,n)&&se(s,n,a[n]);return s},ae=(s,a)=>_e(s,ve(a));import{s as T,d as le,u as ce,_ as we,a as xe}from"./app.b7c39b87.js";import{h,j as p,m as c,P as de,a5 as ne,$ as Ne,a0 as Ce,r as V,a6 as ye,p as Z,N as oe,a7 as me,Q as he,A as re,d as Me,s as L,w as X,v as i,H as be,t as M,F as W,a4 as ke,q as Se,W as J,S as K,a8 as U,n as Fe,x as ue,y as Q}from"./vendor.b0b37e84.js";import{_ as Oe,a as Re,b as Qe}from"./records.96ad039e.js";const Ve={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Ae=c("path",{d:"M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2zm0 26a12 12 0 1 1 12-12a12 12 0 0 1-12 12z",fill:"currentColor"},null,-1),Ee=c("circle",{cx:"16",cy:"23.5",r:"1.5",fill:"currentColor"},null,-1),$e=c("path",{d:"M17 8h-1.5a4.49 4.49 0 0 0-4.5 4.5v.5h2v-.5a2.5 2.5 0 0 1 2.5-2.5H17a2.5 2.5 0 0 1 0 5h-2v4.5h2V17a4.5 4.5 0 0 0 0-9z",fill:"currentColor"},null,-1),qe=[Ae,Ee,$e];function He(s,a){return h(),p("svg",Ve,qe)}var ze={name:"carbon-help",render:He};const De={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Le=c("path",{d:"M6 30H4V2h24l-5.8 9l5.8 9H6zm0-12h18.33l-4.53-7l4.53-7H6z",fill:"currentColor"},null,-1),Te=[Le];function je(s,a){return h(),p("svg",De,Te)}var Be={name:"carbon-flag",render:je};const Ge=1e3*60*60;function We(s){return de(ne(["mine-sweeper-records",s]),async()=>s.value?(await T.from("mine-sweeper-records").select("*, user: user_id (user_name, avatar_url)").eq("mode_id",s.value).order("score",{ascending:!0}).limit(100)).data:null,ne({enabled:!!s,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Ge,retry:!1}))}function Ue(){const s=Ce(),{data:a}=le();return Ne(async({modeId:n,score:l})=>{if(!a.value)return null;const{data:d}=await T.from("mine-sweeper-records").select("*").eq("user_id",a.value.id).eq("mode_id",n).order("score",{ascending:!0});if(!d)return null;switch(d.length<=10){case!0:return(await T.from("mine-sweeper-records").insert({mode_id:n,score:l,user_id:a.value.id}).single()).data;case!1:{const t=d[d.length-1];return t.score<l?null:(await T.from("mine-sweeper-records").update({id:t.id,score:l}).single()).data}}},{onSuccess:n=>{if(!a.value)return;const{user_name:l=a.value.email,avatar_url:d=""}=a.value.user_metadata;if(!n)return;const t=s.getQueryData(["mine-sweeper-records",n.mode_id]);!t||s.setQueryData(["mine-sweeper-records",n.mode_id],()=>[...t,ae(ie({},n),{user:{user_name:l,avatar_url:d}})].sort((m,g)=>m.score-g.score))}})}function Ye(s){class a{constructor(e){this.isExploded=!1,this.isQuestion=!1,this.isFlagged=!1,this.isVeiled=!0,this.isMine=!1,this.hint=0,this.rowNum=e.rowNum,this.colNum=e.colNum}increaseHint(){this.hint+=1}around(e){var o,w,b,k,S,f,F,u,O,A,E,$,q,H,z,D;(w=(o=t.value[this.rowNum-1])==null?void 0:o[this.colNum])==null||w[e](),(k=(b=t.value[this.rowNum-1])==null?void 0:b[this.colNum+1])==null||k[e](),(f=(S=t.value[this.rowNum])==null?void 0:S[this.colNum+1])==null||f[e](),(u=(F=t.value[this.rowNum+1])==null?void 0:F[this.colNum+1])==null||u[e](),(A=(O=t.value[this.rowNum+1])==null?void 0:O[this.colNum])==null||A[e](),($=(E=t.value[this.rowNum+1])==null?void 0:E[this.colNum-1])==null||$[e](),(H=(q=t.value[this.rowNum])==null?void 0:q[this.colNum-1])==null||H[e](),(D=(z=t.value[this.rowNum-1])==null?void 0:z[this.colNum-1])==null||D[e]()}countAround(e){var w,b,k,S,f,F,u,O,A,E,$,q,H,z,D,ee;let o=0;return((b=(w=t.value[this.rowNum-1])==null?void 0:w[this.colNum])==null?void 0:b[e])&&o++,((S=(k=t.value[this.rowNum-1])==null?void 0:k[this.colNum+1])==null?void 0:S[e])&&o++,((F=(f=t.value[this.rowNum])==null?void 0:f[this.colNum+1])==null?void 0:F[e])&&o++,((O=(u=t.value[this.rowNum+1])==null?void 0:u[this.colNum+1])==null?void 0:O[e])&&o++,((E=(A=t.value[this.rowNum+1])==null?void 0:A[this.colNum])==null?void 0:E[e])&&o++,((q=($=t.value[this.rowNum+1])==null?void 0:$[this.colNum-1])==null?void 0:q[e])&&o++,((z=(H=t.value[this.rowNum])==null?void 0:H[this.colNum-1])==null?void 0:z[e])&&o++,((ee=(D=t.value[this.rowNum-1])==null?void 0:D[this.colNum-1])==null?void 0:ee[e])&&o++,o}unveil(){if(!!this.isVeiled&&!this.isFlagged){if(this.isMine){y({isSuccess:!1});return}this.isVeiled=!1,this.hint===0&&this.around("unveil")}}onLeftClick(){this.isFlagged||this.isQuestion||this.unveil()}onDoubleClick(){this.isVeiled||this.countAround("isFlagged")!==this.hint||this.around("unveil")}onRightClick(){if(!!this.isVeiled){if(this.isFlagged){m.value-=1,this.isFlagged=!1,this.isQuestion=!0;return}if(this.isQuestion){m.value-=1,this.isFlagged=!1,this.isQuestion=!1;return}m.value+=1,this.isFlagged=!0,this.isQuestion=!1}}}const n=1e3*999,l={surfaceLight:"#c6c6c6",surfaceDark:"#C0C0C0",shadow:"#808080"},d=Ue(),t=V([]),m=V(0),g=V(!1),_=V(!1),N=V(null),{timestamp:j,pause:B,resume:G}=ye({immediate:!1,controls:!0}),x=Z(()=>N.value?j.value-N.value:0);oe(x,()=>{x.value<n||y({isSuccess:!1})});const C=Z(()=>s.value===3?{totalMines:99,rows:16,cols:30}:s.value===2?{totalMines:40,rows:16,cols:16}:s.value===1?{totalMines:10,rows:9,cols:9}:{totalMines:0,rows:0,cols:0});oe(()=>s.value,()=>R(),{immediate:!0});function R(){B(),N.value=null,g.value=!1,_.value=!1,m.value=0,t.value=[];for(let e=0;e<C.value.rows;e++){const o=[];for(let w=0;w<C.value.cols;w++)o.push(new a({rowNum:e,colNum:w}));t.value.push(o)}let r=0;for(;r<C.value.totalMines;){const e=Math.round(Math.random()*(C.value.rows-1)),o=Math.round(Math.random()*(C.value.cols-1));t.value[e][o].isMine||(t.value[e][o].isMine=!0,t.value[e][o].around("increaseHint"),r++)}}function Y(){N.value=new Date().getTime(),G()}function y(r){if(B(),g.value=!0,_.value=r.isSuccess,!r.isSuccess)return P();!s.value||d.mutate({modeId:s.value,score:x.value},{onSuccess:()=>{window.alert("New Record!")}})}function I(r){g.value||(N.value||Y(),r(),C.value.totalMines===m.value&&v()&&y({isSuccess:!0}))}function P(){t.value.forEach(r=>{r.forEach(e=>{e.isFlagged||!e.isMine||(e.isExploded=!0)})})}function v(){for(let r=0;r<t.value.length;r++)for(let e=0;e<t.value[r].length;e++){const o=t.value[r][e];if(!(o.isMine&&o.isFlagged)&&!!o.isVeiled)return!1}return!0}return{withController:I,initialize:R,isGameOver:g,flagCount:m,isSuccess:_,COLORS:l,game:t,meta:C,time:x}}const Ie=1e3*60*60*24;function Pe(s){return de([s],async()=>(await T.from(s).select("id, mode")).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Ie,retry:!1})}function Xe(){const{t:s}=ce(),{data:a}=Pe("mine-sweeper-modes"),n=me(),l=he(),d=Z(()=>{var m;return(m=a.value)==null?void 0:m.map(({id:g,mode:_})=>({id:g,mode:s(_==="expert"?"expert":_==="intermediate"?"intermediate":"beginner")}))}),t=V(l.query.mode?Number(l.query.mode):1);return re(()=>{if(!d.value)return;const m=l.query.mode?Number(l.query.mode):1;if(!d.value.find(({id:_})=>_===m))return n.replace({path:l.path});t.value=m}),re(()=>Array.isArray(l.query.mode)&&n.replace({path:l.path})),{selectedMode:t,modes:d}}const Je={class:"mt-20 min-h-screen grid place-items-center text-dark-500 dark:text-light-500"},Ke={class:"text-3xl md:text-5xl"},Ze={class:"mt-10 flex justify-center"},et={class:"p-2 grid grid-cols-3 intaglio"},tt={class:"flex"},st={class:"counter"},it={class:"flex items-center justify-center"},at=["data-isGameOver"],nt={class:"flex justify-end"},ot={class:"counter"},rt={class:"rows-container intaglio"},ut=["data-isExploded","onContextmenu","onDblclick","onClick"],lt={key:1},ct={key:0,class:"mt-2 w-96 text-rose-500 text-sm"},dt=Me({setup(s){ke(v=>({"0d1ab81d":i(x).rows,b2d8dc4e:i(_).shadow,"0d13e537":i(x).cols,"3c7e2662":i(_).surfaceLight}));const a=me(),n=he(),{data:l}=le(),{selectedMode:d,modes:t}=Xe(),{data:m,isLoading:g}=We(d),{COLORS:_,isGameOver:N,isSuccess:j,flagCount:B,initialize:G,meta:x,game:C,withController:R,time:Y}=Ye(d),{t:y}=ce();function I(v){return v===1?"text-blue-700":v===2?"text-green-700":v===3?"text-red-700":v===4?"text-purple-700":v===5?"text-fuchsia-700":v===6?"text-cyan-600":"text-black"}function P(v){a.push({path:n.path,query:{mode:v}})}return(v,r)=>{const e=Qe,o=Re,w=Be,b=ze,k=Se("client-only"),S=xe;return h(),p(W,null,[L(i(be),null,{default:X(()=>[c("title",null,M(i(y)("minesweeper"))+" | "+M(i(y)("jon_ganebskis_blog")),1)]),_:1}),c("div",Je,[c("h1",Ke,M(i(y)("minesweeper")),1),c("div",Ze,[L(o,{"model-value":i(d),"option-label-key":"mode",label:i(y)("mode"),class:"w-72","onUpdate:modelValue":P},{default:X(()=>[(h(!0),p(W,null,J(i(t),f=>(h(),K(e,{key:f.id,value:f.id,label:f.mode},null,8,["value","label"]))),128))]),_:1},8,["model-value","label"])]),L(k,null,{default:X(()=>[0<i(x).rows&&0<i(x).cols?(h(),p("div",{key:0,class:"mt-20 flex flex-col items-center justify-center game",onContextmenu:r[1]||(r[1]=U(()=>{},["prevent"]))},[c("div",{class:"p-2 relief",style:Fe({backgroundColor:i(_).surfaceDark})},[c("div",et,[c("div",tt,[c("span",st,M((i(x).totalMines-i(B)).toString().padStart(3,"0")),1)]),c("div",it,[c("button",{class:"node-btn relief player w-10 h-10","data-isGameOver":i(N),"aria-label":"Click to restart the game",onClick:r[0]||(r[0]=(...f)=>i(G)&&i(G)(...f))},M(i(N)&&i(j)?"\u{1F60E}":i(N)&&!i(j)?"\u{1F480}":""),9,at)]),c("div",nt,[c("span",ot,M(Math.round(i(Y)/1e3).toString().padStart(3,"0")),1)])]),c("div",rt,[(h(!0),p(W,null,J(i(C),(f,F)=>(h(),p("div",{key:F,class:"row"},[(h(!0),p(W,null,J(f,(u,O)=>(h(),p("button",{key:O,class:ue(["node-btn",[u.isVeiled&&"relief"]]),"data-isExploded":u.isExploded,onContextmenu:U(()=>i(R)(()=>u.onRightClick()),["prevent"]),onDblclick:U(()=>i(R)(()=>u.onDoubleClick()),["prevent"]),onClick:U(()=>i(R)(()=>u.onLeftClick()),["prevent"])},[u.isVeiled?Q("",!0):(h(),p("span",{key:0,class:ue(["font-extrabold",[I(u.hint)]])},M(u.hint===0?"":u.hint),3)),u.isExploded?(h(),p("span",lt,"\u{1F4A3}")):Q("",!0),u.isFlagged?(h(),K(w,{key:2})):Q("",!0),u.isQuestion?(h(),K(b,{key:3})):Q("",!0)],42,ut))),128))]))),128))])],4),i(l)?Q("",!0):(h(),p("div",ct,M(i(y)("games_auth_warning")),1))],32)):Q("",!0)]),_:1}),L(Oe,{"is-loading":i(g),data:i(m)},null,8,["is-loading","data"]),L(S)])],64)}}});var vt=we(dt,[["__scopeId","data-v-3f8f43e4"]]);export{vt as default};
