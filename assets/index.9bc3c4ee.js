import{h as a,j as l,m as s,$ as de,r as R,a4 as he,p as J,L as te,N as ie,a5 as se,d as ae,w as G,t as n,F as I,U as X,v as M,y,a6 as re,O as le,z as oe,a7 as _e,x as me,a8 as U,n as fe,R as W,s as ne}from"./vendor.bea6da78.js";import{_ as ve,a as pe}from"./option.6f23ee7e.js";import{s as j,u as ue,c as ge,d as we,e as ce,_ as xe}from"./app.c8b6e23b.js";const Ne={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Me=s("path",{d:"M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2zm0 26a12 12 0 1 1 12-12a12 12 0 0 1-12 12z",fill:"currentColor"},null,-1),ye=s("circle",{cx:"16",cy:"23.5",r:"1.5",fill:"currentColor"},null,-1),Ce=s("path",{d:"M17 8h-1.5a4.49 4.49 0 0 0-4.5 4.5v.5h2v-.5a2.5 2.5 0 0 1 2.5-2.5H17a2.5 2.5 0 0 1 0 5h-2v4.5h2V17a4.5 4.5 0 0 0 0-9z",fill:"currentColor"},null,-1),$e=[Me,ye,Ce];function be(i,_){return a(),l("svg",Ne,$e)}var ke={name:"carbon-help",render:be};const Fe={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Re=s("path",{d:"M6 30H4V2h24l-5.8 9l5.8 9H6zm0-12h18.33l-4.53-7l4.53-7H6z",fill:"currentColor"},null,-1),Se=[Re];function ze(i,_){return a(),l("svg",Fe,Se)}var Oe={name:"carbon-flag",render:ze};function He(){return de(async({modeId:i,userId:_,time:m})=>{const{data:h}=await j.from("mine-sweeper-records").select("*").eq("user_id",_).eq("mode_id",i).order("time",{ascending:!0});if(!h)return null;switch(h.length<=10){case!0:{const{data:c}=await j.from("mine-sweeper-records").insert({mode_id:i,time:m,user_id:_});return console.log(c),c}case!1:{const c=h[h.length-1];if(c.time<m)return null;const{data:N}=await j.from("mine-sweeper-records").update({id:c.id,time:m});return N}}},{onSuccess:()=>{}})}function Ve(i){class _{constructor(e){this.isExploded=!1,this.isQuestion=!1,this.isFlagged=!1,this.isVeiled=!0,this.isMine=!1,this.hint=0,this.rowNum=e.rowNum,this.colNum=e.colNum}increaseHint(){this.hint+=1}around(e){var o,x,u,b,z,O,H,V,A,E,D,L,Q,B,q,T;(x=(o=t.value[this.rowNum-1])==null?void 0:o[this.colNum])==null||x[e](),(b=(u=t.value[this.rowNum-1])==null?void 0:u[this.colNum+1])==null||b[e](),(O=(z=t.value[this.rowNum])==null?void 0:z[this.colNum+1])==null||O[e](),(V=(H=t.value[this.rowNum+1])==null?void 0:H[this.colNum+1])==null||V[e](),(E=(A=t.value[this.rowNum+1])==null?void 0:A[this.colNum])==null||E[e](),(L=(D=t.value[this.rowNum+1])==null?void 0:D[this.colNum-1])==null||L[e](),(B=(Q=t.value[this.rowNum])==null?void 0:Q[this.colNum-1])==null||B[e](),(T=(q=t.value[this.rowNum-1])==null?void 0:q[this.colNum-1])==null||T[e]()}countAround(e){var x,u,b,z,O,H,V,A,E,D,L,Q,B,q,T,ee;let o=0;return((u=(x=t.value[this.rowNum-1])==null?void 0:x[this.colNum])==null?void 0:u[e])&&o++,((z=(b=t.value[this.rowNum-1])==null?void 0:b[this.colNum+1])==null?void 0:z[e])&&o++,((H=(O=t.value[this.rowNum])==null?void 0:O[this.colNum+1])==null?void 0:H[e])&&o++,((A=(V=t.value[this.rowNum+1])==null?void 0:V[this.colNum+1])==null?void 0:A[e])&&o++,((D=(E=t.value[this.rowNum+1])==null?void 0:E[this.colNum])==null?void 0:D[e])&&o++,((Q=(L=t.value[this.rowNum+1])==null?void 0:L[this.colNum-1])==null?void 0:Q[e])&&o++,((q=(B=t.value[this.rowNum])==null?void 0:B[this.colNum-1])==null?void 0:q[e])&&o++,((ee=(T=t.value[this.rowNum-1])==null?void 0:T[this.colNum-1])==null?void 0:ee[e])&&o++,o}unveil(){if(!!this.isVeiled&&!this.isFlagged){if(this.isMine){v({isSuccess:!1});return}this.isVeiled=!1,this.hint===0&&this.around("unveil")}}onLeftClick(){this.isFlagged||this.isQuestion||this.unveil()}onDoubleClick(){this.isVeiled||this.countAround("isFlagged")!==this.hint||this.around("unveil")}onRightClick(){if(!!this.isVeiled){if(this.isFlagged){d.value-=1,this.isFlagged=!1,this.isQuestion=!0;return}if(this.isQuestion){d.value-=1,this.isFlagged=!1,this.isQuestion=!1;return}d.value+=1,this.isFlagged=!0,this.isQuestion=!1}}}const m=1e3*999,h={surfaceLight:"#c6c6c6",surfaceDark:"#C0C0C0",shadow:"#808080"},c=He(),{data:N}=ue(),t=R([]),d=R(0),f=R(!1),C=R(!1),p=R(null),{timestamp:g,pause:$,resume:S}=he({immediate:!1,controls:!0}),k=J(()=>p.value?g.value-p.value:0);te(k,()=>{k.value<m||v({isSuccess:!1})});const w=J(()=>{var r,e,o;return((r=i.value)==null?void 0:r.id)===3?{totalMines:99,rows:16,cols:30}:((e=i.value)==null?void 0:e.id)===2?{totalMines:40,rows:16,cols:16}:((o=i.value)==null?void 0:o.id)===1?{totalMines:10,rows:9,cols:9}:{totalMines:0,rows:0,cols:0}});te(()=>w.value,()=>Y(),{immediate:!0});function Y(){$(),p.value=null,f.value=!1,C.value=!1,d.value=0,t.value=[];for(let e=0;e<w.value.rows;e++){const o=[];for(let x=0;x<w.value.cols;x++)o.push(new _({rowNum:e,colNum:x}));t.value.push(o)}let r=0;for(;r<w.value.totalMines;){const e=Math.round(Math.random()*(w.value.rows-1)),o=Math.round(Math.random()*(w.value.cols-1));t.value[e][o].isMine||(t.value[e][o].isMine=!0,t.value[e][o].around("increaseHint"),r++)}}function K(){p.value=new Date().getTime(),S()}function v(r){if($(),f.value=!0,C.value=r.isSuccess,!r.isSuccess)return P();!N.value||!i.value||c.mutate({modeId:i.value.id,userId:N.value.id,time:k.value},{onSuccess:()=>{window.alert("New Record!")}})}function F(r){f.value||(p.value||K(),r(),w.value.totalMines===d.value&&Z()&&v({isSuccess:!0}))}function P(){t.value.forEach(r=>{r.forEach(e=>{e.isFlagged||!e.isMine||(e.isExploded=!0)})})}function Z(){for(let r=0;r<t.value.length;r++)for(let e=0;e<t.value[r].length;e++){const o=t.value[r][e];if(!(o.isMine&&o.isFlagged)&&!!o.isVeiled)return!1}return!0}return{withController:F,initialize:Y,isGameOver:f,flagCount:d,isSuccess:C,COLORS:h,game:t,meta:w,time:k}}const Ae={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Ee=s("path",{d:"M16 30a14 14 0 1 1 14-14a14 14 0 0 1-14 14zm0-26a12 12 0 1 0 12 12A12 12 0 0 0 16 4z",fill:"currentColor"},null,-1),De=s("path",{d:"M20.59 22L15 16.41V7h2v8.58l5 5.01L20.59 22z",fill:"currentColor"},null,-1),Le=[Ee,De];function Qe(i,_){return a(),l("svg",Ae,Le)}var Be={name:"carbon-time",render:Qe};const qe={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Te=s("path",{d:"M16 22h14v2H16z",fill:"currentColor"},null,-1),Ge=s("path",{d:"M16 8h14v2H16z",fill:"currentColor"},null,-1),je=s("path",{d:"M8 12V4H6v1H4v2h2v5H4v2h6v-2H8z",fill:"currentColor"},null,-1),Ye=s("path",{d:"M10 28H4v-4a2 2 0 0 1 2-2h2v-2H4v-2h4a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2H6v2h4z",fill:"currentColor"},null,-1),Ue=[Te,Ge,je,Ye];function We(i,_){return a(),l("svg",qe,Ue)}var Ie={name:"carbon-list-numbered",render:We};const Xe=1e3*60*60;function Je(i){return ie(se(["mine-sweeper-records",i]),async()=>i.value?(await j.from("mine-sweeper-records").select("*, user: user_id (user_name, avatar_url)").eq("mode_id",i.value).order("time",{ascending:!0}).limit(100)).data:null,se({enabled:!!i.value,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Xe,retry:!1}))}const Ke={class:"mt-10 p-10 rounded shadow-lg"},Pe={class:"mx-auto text-sm"},Ze={class:"pb-5 pr-10"},et={class:"pb-5 px-10 w-48"},tt={class:"pb-5 pl-10"},st={key:0},ot=s("td",{colspan:"3",class:"py-10 text-center"},"Loading...",-1),nt=[ot],it={key:1},at=s("td",{colspan:"3",class:"py-10 text-center"},"No Data",-1),rt=[at],lt={class:"py-2 pr-10 text-center"},ut={class:"py-2"},ct={class:"flex items-center gap-3"},dt={class:"relative"},ht={key:0,class:"absolute top-0 right-0 text-xl"},_t={class:"w-48 truncate"},mt={class:"py-2 text-right"},ft=ae({props:{selectedMode:null},setup(i){const _=i,{data:m,isLoading:h}=Je(J(()=>_.selectedMode.id));return(c,N)=>{const t=Ie,d=ge,f=Be,C=we;return a(),l("div",Ke,[s("table",Pe,[s("thead",null,[s("tr",null,[s("th",Ze,[G(t,{class:"mx-auto"})]),s("th",et,[G(d,{class:"mx-auto"})]),s("th",tt,[G(f,{class:"mx-auto"})])])]),s("tbody",null,[n(h)?(a(),l("tr",st,nt)):!n(m)||n(m).length===0?(a(),l("tr",it,rt)):(a(!0),l(I,{key:2},X(n(m),(p,g)=>{var $;return a(),l("tr",{key:p.id},[s("td",lt,M(g+1),1),s("td",ut,[s("div",ct,[s("div",dt,[G(C,{src:($=p.user.avatar_url)!=null?$:"",width:40,height:40,class:"rounded-full"},null,8,["src"]),g+1<=3?(a(),l("span",ht,M(g+1===1?"\u{1F947}":g+1===2?"\u{1F948}":g+1===3?"\u{1F949}":""),1)):y("",!0)]),s("span",_t,M(p.user.user_name),1)])]),s("td",mt,M((p.time/1e3).toFixed(2))+"`s",1)])}),128))])])])}}}),vt=1e3*60*60*24;function pt(i){return ie([i],async()=>(await j.from(i).select("id, mode")).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:vt,retry:!1})}function gt(){const{t:i}=ce(),{data:_}=pt("mine-sweeper-modes"),m=re(),h=le(),c=J(()=>{var t;return(t=_.value)==null?void 0:t.map(({id:d,mode:f})=>({id:d,mode:i(f==="expert"?"expert":f==="intermediate"?"intermediate":"beginner")}))}),N=R();return oe(()=>{if(!c.value)return;const t=h.query.mode?Number(h.query.mode):1,d=c.value.find(({id:f})=>f===t);if(!d)return m.replace({path:h.path});N.value=d}),oe(()=>Array.isArray(h.query.mode)&&m.replace({path:h.path})),{selectedMode:N,modes:c}}const wt={class:"min-h-screen grid place-items-center"},xt={class:"mt-10 flex justify-center"},Nt={class:"p-2 grid grid-cols-3 intaglio"},Mt={class:"flex"},yt={class:"counter"},Ct={class:"flex items-center justify-center"},$t=["data-isGameOver"],bt={class:"flex justify-end"},kt={class:"counter"},Ft={class:"rows-container intaglio"},Rt=["data-isExploded","onContextmenu","onDblclick","onClick"],St={key:1},zt={key:0,class:"mt-2 w-96 text-rose-300 text-sm"},Ot=ae({setup(i){_e(v=>({"7ae99f7e":n(g).rows,"39ede0ba":n(t).shadow,"7ae2cc98":n(g).cols,"08c00883":n(t).surfaceLight}));const _=re(),m=le(),{data:h}=ue(),{selectedMode:c,modes:N}=gt(),{COLORS:t,isGameOver:d,isSuccess:f,flagCount:C,initialize:p,meta:g,game:$,withController:S,time:k}=Ve(c),{t:w}=ce();function Y(v){return v===1?"text-blue-700":v===2?"text-green-700":v===3?"text-red-700":v===4?"text-purple-700":v===5?"text-fuchsia-700":v===6?"text-cyan-600":"text-black"}function K(v){_.push({path:m.path,query:{mode:v.id}})}return(v,F)=>{const P=pe,Z=ve,r=Oe,e=ke;return a(),l("div",wt,[s("div",xt,[G(Z,{"model-value":n(c),"option-label-key":"mode",label:n(w)("mode"),"onUpdate:modelValue":K},{default:me(()=>[(a(!0),l(I,null,X(n(N),o=>(a(),W(P,{key:o.id,value:o,"label-key":"mode"},null,8,["value"]))),128))]),_:1},8,["model-value","label"])]),0<n(g).rows&&0<n(g).cols?(a(),l("div",{key:0,class:"mt-20 flex flex-col items-center justify-center game",onContextmenu:F[1]||(F[1]=U(()=>{},["prevent"]))},[s("div",{class:"p-2 relief",style:fe({backgroundColor:n(t).surfaceDark})},[s("div",Nt,[s("div",Mt,[s("span",yt,M((n(g).totalMines-n(C)).toString().padStart(3,"0")),1)]),s("div",Ct,[s("button",{class:"node-btn relief player w-10 h-10","data-isGameOver":n(d),"aria-label":"Click to restart the game",onClick:F[0]||(F[0]=(...o)=>n(p)&&n(p)(...o))},M(n(d)&&n(f)?"\u{1F60E}":n(d)&&!n(f)?"\u{1F480}":""),9,$t)]),s("div",bt,[s("span",kt,M(Math.round(n(k)/1e3).toString().padStart(3,"0")),1)])]),s("div",Ft,[(a(!0),l(I,null,X(n($),(o,x)=>(a(),l("div",{key:x,class:"row"},[(a(!0),l(I,null,X(o,(u,b)=>(a(),l("button",{key:b,class:ne(["node-btn",[u.isVeiled&&"relief"]]),"data-isExploded":u.isExploded,onContextmenu:U(()=>n(S)(()=>u.onRightClick()),["prevent"]),onDblclick:U(()=>n(S)(()=>u.onDoubleClick()),["prevent"]),onClick:U(()=>n(S)(()=>u.onLeftClick()),["prevent"])},[u.isVeiled?y("",!0):(a(),l("span",{key:0,class:ne(["font-extrabold",[Y(u.hint)]])},M(u.hint===0?"":u.hint),3)),u.isExploded?(a(),l("span",St,"\u{1F4A3}")):y("",!0),u.isFlagged?(a(),W(r,{key:2})):y("",!0),u.isQuestion?(a(),W(e,{key:3})):y("",!0)],42,Rt))),128))]))),128))])],4),n(h)?y("",!0):(a(),l("div",zt,M(n(w)("games_auth_warning")),1))],32)):y("",!0),n(c)?(a(),W(ft,{key:1,"selected-mode":n(c)},null,8,["selected-mode"])):y("",!0)])}}});var Et=xe(Ot,[["__scopeId","data-v-508c8d84"]]);export{Et as default};
