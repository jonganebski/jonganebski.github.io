var oe=Object.defineProperty,re=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var I=(o,t,n)=>t in o?oe(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,ee=(o,t)=>{for(var n in t||(t={}))ie.call(t,n)&&I(o,n,t[n]);if(J)for(var n of J(t))ce.call(t,n)&&I(o,n,t[n]);return o},te=(o,t)=>re(o,ue(t));import{s as Y,_ as se,u as O,g as ae,d as ne,r as de,a as me}from"./app.21eb23d5.js";import{P as pe,d as P,h as d,j as f,m as k,t as g,x as B,y as U,v as e,T as K,p as F,R as _e,S as G,w as A,W as H,F as Z,r as T,$ as ge,a0 as ve,am as fe,o as he,ad as ye,an as $e,N as ke,s as j,H as be,ao as Ce,q as ze,n as V}from"./vendor.b0b37e84.js";import{b as Se,a as xe,_ as we}from"./records.9d40f870.js";const Ee=1e3*60*60;function Ne(){return pe("sliding-puzzle-records",async()=>(await Y.from("sliding-puzzle-records").select("*, user: user_id (user_name, avatar_url)").order("score",{ascending:!0}).limit(100)).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Ee,retry:!1})}const Ue={class:"mt-4 px-2 text-center"},Te={key:0,class:"text-sm text-gray-700 dark:text-gray-300"},Re=K(" Photo by "),je=["href"],Le={key:1,class:"text-sm text-gray-700 dark:text-gray-300"},Ve=K(" on "),Be=["href"],Fe={class:"text-xs text-gray-500"},Ze=P({props:{selectedImage:null},setup(o){const t=o,{t:n}=O();return(l,p)=>{var h,y,v,b,c,m,$,w,S,r;return d(),f("div",Ue,[((h=t.selectedImage)==null?void 0:h.creator)?(d(),f("span",Te,[Re,k("a",{class:B([((y=t.selectedImage)==null?void 0:y.creator.url)?"link__active":"link__inactive"]),href:(v=t.selectedImage)==null?void 0:v.creator.url,target:"_blank",rel:"noopener"},g((c=(b=t.selectedImage)==null?void 0:b.creator)==null?void 0:c.name),11,je)])):U("",!0),((m=t.selectedImage)==null?void 0:m.provider)?(d(),f("span",Le,[Ve,k("a",{class:B([(($=t.selectedImage)==null?void 0:$.provider.url)?"link__active":"link__inactive"]),href:(w=t.selectedImage)==null?void 0:w.provider.url,target:"_blank",rel:"noopener"},g((r=(S=t.selectedImage)==null?void 0:S.provider)==null?void 0:r.name),11,Be)])):U("",!0),k("p",Fe,g(e(n)("all_rights_of_the_image_belong_to_the_creator")),1)])}}});var Oe=se(Ze,[["__scopeId","data-v-176f9680"]]);const Pe={class:"text-sm"},De={key:0,class:""},Me={key:0},Ye={key:1},Ae={key:2},He={key:1},Xe=P({props:{clicksCount:null,shuffleCount:null,score:null,time:null},setup(o){const t=o,{t:n}=O(),l=F(()=>{if(!t.time)return null;const p=Math.floor(t.time/(1e3*60)),h=Math.floor((t.time-p*1e3*60)/1e3),y=t.time-p*1e3*60-h*1e3;return{minutes:p,seconds:h,milliseconds:y}});return(p,h)=>(d(),f("div",Pe,[k("span",null,[K(g(e(n)("move",2))+": ",1),k("span",{class:B([t.clicksCount<=t.shuffleCount?"text-green-500":t.clicksCount<t.shuffleCount*2?"text-yellow-500":"text-red-500"])},g(t.clicksCount),3)]),e(l)?(d(),f("p",De,[k("span",null,g(e(n)("time"))+": ",1),e(l).minutes?(d(),f("span",Me,g(e(l).minutes)+" "+g(e(n)("minutes").toLowerCase())+" "+g(" "),1)):U("",!0),e(l).seconds?(d(),f("span",Ye,g(e(l).seconds)+" "+g(e(n)("seconds").toLowerCase())+" "+g(" "),1)):U("",!0),e(l).milliseconds?(d(),f("span",Ae,g(e(l).milliseconds)+" "+g(e(n)("milliseconds").toLowerCase()),1)):U("",!0)])):U("",!0),o.score?(d(),f("p",He,g(e(n)("score"))+": "+g(o.score),1)):U("",!0)]))}}),Qe={class:"mt-2 text-sm"},qe={class:"pl-2 font-bold"},Ge={display:"mt-1 grid"},Ke=P({props:{categoryName:null},setup(o){const t=o;return(n,l)=>(d(),f("div",Qe,[k("span",qe,g(t.categoryName),1),k("div",Ge,[_e(n.$slots,"default")])]))}}),We=P({props:{modelValue:null,images:null},emits:["update:modelValue"],setup(o,{emit:t}){const n=o,{t:l}=O();return(p,h)=>{const y=Se,v=Ke,b=xe;return d(),G(b,{"model-value":n.modelValue,label:e(l)("image"),class:"w-72","onUpdate:modelValue":h[0]||(h[0]=c=>t("update:modelValue",c.toString()))},{default:A(()=>[(d(!0),f(Z,null,H(n.images,({categoryName:c,options:m})=>(d(),G(v,{key:c,"category-name":c,class:"text-dark-500"},{default:A(()=>[(d(!0),f(Z,null,H(m,$=>(d(),G(y,{key:$.url,value:$.url,label:$.label},null,8,["value","label"]))),128))]),_:2},1032,["category-name"]))),128))]),_:1},8,["model-value","label"])}}}),E="https://ijivzwfsihdcvwrntdpe.supabase.co/storage/v1/object/public/sliding-puzzle-images",N="utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText";function Je(){const{t:o}=O(),t=T(!1),n=T(0),l=F(()=>t.value?[{categoryName:o("fate_series"),options:[{label:o("jean_alter"),url:`${E}/jean-alter.jpg`},{label:o("rider_5th"),url:`${E}/rider-5th.jpg`}]},{categoryName:o("eighty_six"),options:[{label:o("vladilena_milize"),url:`${E}/vladilena-milize.jpg`}]},{categoryName:o("attack_on_titan"),options:[{label:o("eren_yeager"),url:`${E}/eren-yeager.jpg`}]}]:[{categoryName:o("nature"),options:[{label:"Kamran Ch",url:`${E}/mountain.jpg`,provider:{name:"Unsplash",url:`https://unsplash.com/t/act-for-nature?${N}`},creator:{name:"Kamran Ch",url:`https://unsplash.com/@kamranch?${N}`}},{label:"David Scanlon",url:`${E}/gorilla.jpg`,provider:{name:"Unsplash",url:`https://unsplash.com/t/nature?${N}`},creator:{name:"David Scanlon",url:`https://unsplash.com/@dsartwork?${N}`}}]},{categoryName:o("cat",2),options:[{label:"Pacto Visual",url:`${E}/cat_pacto-visual.jpg`,provider:{name:"Unsplash",url:`https://unsplash.com/s/photos/cat?${N}`},creator:{name:"Pacto Visual",url:`https://unsplash.com/@pactovisual?${N}`}},{label:"Georgi Benev",url:`${E}/cat_georgi-benev.jpg`,provider:{name:"Unsplash",url:`https://unsplash.com/s/photos/cat-box?${N}`},creator:{name:"georgi benev",url:`https://unsplash.com/@georgibenev97?${N}`}}]}]),p=T(h());function h(){const c=ae(0,l.value.length-1),m=ae(0,l.value[c].options.length-1);return l.value[c].options[m].url}let y;function v(){n.value+=1,clearTimeout(y),y=setTimeout(()=>n.value=0,200),n.value===10&&(t.value=!t.value,p.value=h())}function b(c){for(let m=0;m<l.value.length;m++)for(let $=0;$<l.value[m].options.length;$++)if(l.value[m].options[$].url===c)return l.value[m].options[$]}return{selectedImageUrl:p,images:l,findImageByUrl:b,worship:v}}function Ie(){const o=ve(),{data:t}=ne();return ge(async({score:n})=>{if(!t.value)return null;const{data:l}=await Y.from("sliding-puzzle-records").select("*").eq("user_id",t.value.id).order("score",{ascending:!0});if(!l)return null;switch(l.length<=10){case!0:return(await Y.from("sliding-puzzle-records").insert({score:n,user_id:t.value.id}).single()).data;case!1:{const p=l[l.length-1];return p.score<n?null:(await Y.from("sliding-puzzle-records").update({id:p.id,score:n}).single()).data}}},{onSuccess:n=>{if(!t.value)return;const{user_name:l=t.value.email,avatar_url:p=""}=t.value.user_metadata;if(!n)return;const h=o.getQueryData("sliding-puzzle-records");!h||o.setQueryData("sliding-puzzle-records",()=>[...h,te(ee({},n),{user:{user_name:l,avatar_url:p}})].sort((y,v)=>y.score-v.score))}})}function et(){const l=T("shuffle"),p=fe($e),h=p.greater("sm"),y=p.greater("lg"),v=F(()=>y.value?140:h.value?100:60),b=Ie(),c=T(0),m=T(null),$=T(null),w=F(()=>!m.value||!$.value?null:$.value-m.value),S=F(()=>w.value?c.value+Math.floor(w.value/1e3):null),r=T([[0,0,0,0,0,0,0],[0,1,2,3,4,5,0],[0,6,7,8,9,10,0],[0,11,12,13,14,15,0],[0,16,17,18,19,20,0],[0,21,22,23,24,25,0],[0,0,0,0,0,-1,0],[0,0,0,0,0,0,0]]);he(async()=>D());function X(u,a,s){let i=[];const _=r.value[u-1][a],C=r.value[u+1][a],z=r.value[u][a+1],q=r.value[u][a-1];return 0<_&&_!==s&&i.push(_),0<C&&C!==s&&i.push(C),0<z&&z!==s&&i.push(z),0<q&&q!==s&&i.push(q),s&&(i=i.filter(le=>le!==25)),de(1,i)[0]}async function D(){m.value=null,$.value=null,r.value=[[0,0,0,0,0,0,0],[0,1,2,3,4,5,0],[0,6,7,8,9,10,0],[0,11,12,13,14,15,0],[0,16,17,18,19,20,0],[0,21,22,23,24,25,0],[0,0,0,0,0,-1,0],[0,0,0,0,0,0,0]],await ye(),c.value=0,l.value="shuffle";let u;for(let a=0;a<50;a++){const s=document.getElementById("void");if(!s)return;const i=Number(s.dataset.rowidx),_=Number(s.dataset.colidx),C=X(i,_,u),z=document.getElementById(C.toString());if(!z)return;await M(z,Number(z.dataset.rowidx),Number(z.dataset.colidx),!1),u=C}l.value="ready"}function x(){let a=0;for(let s=0;s<r.value.length;s++)for(let i=0;i<r.value[s].length;i++){const _=r.value[s][i];if(_!==0){if(a===25&&_===-1)return!0;if(a+1!==_)return!1;a++}}return!0}async function M(u,a,s,i=!0){const _=Q(a,s);return i&&(u.style.transition="transform linear 0.1s"),_==="top"&&(i&&(u.style.transform=`translateY(-${v.value}px)`,await R(100)),[r.value[a][s],r.value[a-1][s]]=[r.value[a-1][s],r.value[a][s]]),_==="bottom"&&(i&&(u.style.transform=`translateY(${v.value}px)`,await R(100)),[r.value[a][s],r.value[a+1][s]]=[r.value[a+1][s],r.value[a][s]]),_==="right"&&(i&&(u.style.transform=`translateX(${v.value}px)`,await R(100)),[r.value[a][s],r.value[a][s+1]]=[r.value[a][s+1],r.value[a][s]]),_==="left"&&(i&&(u.style.transform=`translateX(-${v.value}px)`,await R(100)),[r.value[a][s],r.value[a][s-1]]=[r.value[a][s-1],r.value[a][s]]),i&&(u.style.transition=""),!!_}async function R(u){await new Promise(a=>setTimeout(()=>a(!0),u))}function Q(u,a){return r.value[u-1][a]===-1?"top":r.value[u+1][a]===-1?"bottom":r.value[u][a+1]===-1?"right":r.value[u][a-1]===-1?"left":null}async function W(u,a,s){if(l.value==="shuffle"||l.value==="done")return;const i=u.currentTarget;!i||!await M(i,a,s)||(m.value||(m.value=new Date().getTime()),c.value+=1,l.value==="ready"&&(l.value="playing"),!!x()&&(l.value="done",$.value=new Date().getTime(),!!S.value&&(console.log(S.value),b.mutate({score:S.value}))))}function L(u){const a=(u-1)%5*v.value*-1,s=Math.floor((u-1)/5)*v.value*-1;return`${a}px ${s}px`}return{SHUFFLE_COUNT:50,nodeSize:v,SIZE_X:5,SIZE_Y:5,clicksCount:c,status:l,nodes:r,score:S,time:w,computeBgPosition:L,onClickNode:W,initialize:D}}const tt={class:"mt-20 grid gap-12 place-items-center text-dark-500 dark:text-light-500"},at={key:0,class:"w-0 h-0"},st=["data-rowIdx","data-colIdx"],nt=["id","data-rowIdx","data-colIdx","onClick"],lt={class:"absolute inset-0 bg-black bg-opacity-50 grid place-items-center"},ot={key:0,class:"mt-2 text-center text-rose-500 text-sm"},rt=P({setup(o){const{data:t}=ne(),{data:n,isLoading:l}=Ne(),{t:p}=O(),{SHUFFLE_COUNT:h,SIZE_X:y,SIZE_Y:v,clicksCount:b,nodeSize:c,status:m,nodes:$,score:w,time:S,computeBgPosition:r,onClickNode:X,initialize:D}=et(),{selectedImageUrl:x,findImageByUrl:M,worship:R,images:Q}=Je();return ke(()=>x.value,()=>D()),(W,L)=>{const u=ze("client-only"),a=me;return d(),f(Z,null,[j(e(be),null,{default:A(()=>[k("title",null,g(e(p)("sliding_puzzle"))+" | "+g(e(p)("jon_ganebskis_blog")),1)]),_:1}),k("div",tt,[k("h1",{class:"text-3xl md:text-5xl",onClick:L[0]||(L[0]=(...s)=>e(R)&&e(R)(...s))},g(e(p)("sliding_puzzle")),1),j(We,{modelValue:e(x),"onUpdate:modelValue":L[1]||(L[1]=s=>Ce(x)?x.value=s:null),images:e(Q)},null,8,["modelValue","images"]),j(Xe,{class:"min-h-20","shuffle-count":e(h),"clicks-count":e(b),time:e(S),score:e(w)},null,8,["shuffle-count","clicks-count","time","score"])]),j(u,null,{default:A(()=>[k("div",{class:"relative grid gap-px transition-all duration-1000 ease-linear",style:V({gridTemplateRows:`auto repeat(${e(v)}, ${e(c)}px) auto`})},[k("div",{class:B(["absolute top-0 left-1/2 transform -translate-x-1/2 z-1 pointer-events-none",[e(m)==="done"?"shadow-2xl":"shadow"]]),style:V({width:`${e(y)*e(c)+e(y)}px`,height:`${e(v)*e(c)+e(v)}px`})},[k("div",{class:B(["absolute top-0 left-0 z-1 w-full h-full bg-white opacity-0",{"done__anim-mask":e(m)==="done"}])},null,2),k("div",{class:B(["w-full h-full bg-cover",[e(m)==="done"?"done__anim-image opacity-100":"opacity-0"]]),style:V({backgroundImage:`url(${e(x)})`})},null,6)],6),(d(!0),f(Z,null,H(e($),(s,i)=>(d(),f("div",{key:i,class:"grid gap-px transition-all duration-1000 ease-linear",style:V({gridTemplateColumns:`auto repeat(${e(y)}, ${e(c)}px) auto`})},[(d(!0),f(Z,null,H(s,(_,C)=>(d(),f("div",{key:_},[_===0?(d(),f("div",at)):_===-1?(d(),f("div",{key:1,id:"void","data-rowIdx":i,"data-colIdx":C,style:V({width:`${e(c)}px`,height:`${e(c)}px`})},null,12,st)):(d(),f("button",{key:2,id:_.toString(),"data-rowIdx":i,"data-colIdx":C,class:"text-white",style:V({width:`${e(c)}px`,height:`${e(c)}px`,backgroundImage:`url(${e(x)})`,backgroundSize:`${e(c)*e(y)}px ${e(c)*e(v)}px`,backgroundPosition:e(r)(_),transform:"translate(0px)"}),onClick:z=>e(X)(z,i,C)},[k("div",lt,g(e(m)==="done"?"":_),1)],12,nt))]))),128))],4))),128))],4)]),_:1}),e(t)?U("",!0):(d(),f("div",ot,g(e(p)("games_auth_warning")),1)),j(Oe,{"selected-image":e(M)(e(x))},null,8,["selected-image"]),j(we,{"is-loading":e(l),data:e(n)},null,8,["is-loading","data"]),j(a)],64)}}});var mt=se(rt,[["__scopeId","data-v-4b6954b4"]]);export{mt as default};
