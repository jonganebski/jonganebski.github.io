var he=Object.defineProperty,fe=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var te=(s,i,a)=>i in s?he(s,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[i]=a,se=(s,i)=>{for(var a in i||(i={}))pe.call(i,a)&&te(s,a,i[a]);if(ee)for(var a of ee(i))ge.call(i,a)&&te(s,a,i[a]);return s},oe=(s,i)=>fe(s,ve(i));import{u as ue,s as U,c as we,d as xe,e as le,_ as Ne,a as ye}from"./app.54880ce4.js";import{h as u,j as d,m as n,$ as Ce,a0 as Me,r as V,a4 as be,p as X,L as ne,N as ce,a5 as ie,d as de,w as S,t as o,F as W,U as I,v as M,y as F,a6 as me,O as _e,z as ae,a7 as $e,x as ke,a8 as Y,n as Fe,R as P,s as re}from"./vendor.d9c22db7.js";import{_ as Se,a as Oe,b as Re}from"./list-numbered.62f0329b.js";const Ve={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Ae=n("path",{d:"M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2zm0 26a12 12 0 1 1 12-12a12 12 0 0 1-12 12z",fill:"currentColor"},null,-1),Qe=n("circle",{cx:"16",cy:"23.5",r:"1.5",fill:"currentColor"},null,-1),ze=n("path",{d:"M17 8h-1.5a4.49 4.49 0 0 0-4.5 4.5v.5h2v-.5a2.5 2.5 0 0 1 2.5-2.5H17a2.5 2.5 0 0 1 0 5h-2v4.5h2V17a4.5 4.5 0 0 0 0-9z",fill:"currentColor"},null,-1),Ee=[Ae,Qe,ze];function Le(s,i){return u(),d("svg",Ve,Ee)}var qe={name:"carbon-help",render:Le};const De={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},He=n("path",{d:"M6 30H4V2h24l-5.8 9l5.8 9H6zm0-12h18.33l-4.53-7l4.53-7H6z",fill:"currentColor"},null,-1),Be=[He];function Te(s,i){return u(),d("svg",De,Be)}var Ge={name:"carbon-flag",render:Te};function je(){const s=Me(),{data:i}=ue();return Ce(async({modeId:a,time:c})=>{if(!i.value)return null;const{data:_}=await U.from("mine-sweeper-records").select("*").eq("user_id",i.value.id).eq("mode_id",a).order("time",{ascending:!0});if(!_)return null;switch(_.length<=10){case!0:return(await U.from("mine-sweeper-records").insert({mode_id:a,time:c,user_id:i.value.id}).single()).data;case!1:{const e=_[_.length-1];return e.time<c?null:(await U.from("mine-sweeper-records").update({id:e.id,time:c}).single()).data}}},{onSuccess:a=>{if(!i.value)return;const{user_name:c=i.value.email,avatar_url:_=""}=i.value.user_metadata;if(!a)return;const e=s.getQueryData(["mine-sweeper-records",a.mode_id]);!e||s.setQueryData(["mine-sweeper-records",a.mode_id],()=>(e.push(oe(se({},a),{user:{user_name:c,avatar_url:_}})),e.sort((l,f)=>l.time-f.time)))}})}function Ue(s){class i{constructor(t){this.isExploded=!1,this.isQuestion=!1,this.isFlagged=!1,this.isVeiled=!0,this.isMine=!1,this.hint=0,this.rowNum=t.rowNum,this.colNum=t.colNum}increaseHint(){this.hint+=1}around(t){var r,x,g,$,m,k,z,E,L,q,D,H,B,T,G,j;(x=(r=e.value[this.rowNum-1])==null?void 0:r[this.colNum])==null||x[t](),($=(g=e.value[this.rowNum-1])==null?void 0:g[this.colNum+1])==null||$[t](),(k=(m=e.value[this.rowNum])==null?void 0:m[this.colNum+1])==null||k[t](),(E=(z=e.value[this.rowNum+1])==null?void 0:z[this.colNum+1])==null||E[t](),(q=(L=e.value[this.rowNum+1])==null?void 0:L[this.colNum])==null||q[t](),(H=(D=e.value[this.rowNum+1])==null?void 0:D[this.colNum-1])==null||H[t](),(T=(B=e.value[this.rowNum])==null?void 0:B[this.colNum-1])==null||T[t](),(j=(G=e.value[this.rowNum-1])==null?void 0:G[this.colNum-1])==null||j[t]()}countAround(t){var x,g,$,m,k,z,E,L,q,D,H,B,T,G,j,Z;let r=0;return((g=(x=e.value[this.rowNum-1])==null?void 0:x[this.colNum])==null?void 0:g[t])&&r++,((m=($=e.value[this.rowNum-1])==null?void 0:$[this.colNum+1])==null?void 0:m[t])&&r++,((z=(k=e.value[this.rowNum])==null?void 0:k[this.colNum+1])==null?void 0:z[t])&&r++,((L=(E=e.value[this.rowNum+1])==null?void 0:E[this.colNum+1])==null?void 0:L[t])&&r++,((D=(q=e.value[this.rowNum+1])==null?void 0:q[this.colNum])==null?void 0:D[t])&&r++,((B=(H=e.value[this.rowNum+1])==null?void 0:H[this.colNum-1])==null?void 0:B[t])&&r++,((G=(T=e.value[this.rowNum])==null?void 0:T[this.colNum-1])==null?void 0:G[t])&&r++,((Z=(j=e.value[this.rowNum-1])==null?void 0:j[this.colNum-1])==null?void 0:Z[t])&&r++,r}unveil(){if(!!this.isVeiled&&!this.isFlagged){if(this.isMine){Q({isSuccess:!1});return}this.isVeiled=!1,this.hint===0&&this.around("unveil")}}onLeftClick(){this.isFlagged||this.isQuestion||this.unveil()}onDoubleClick(){this.isVeiled||this.countAround("isFlagged")!==this.hint||this.around("unveil")}onRightClick(){if(!!this.isVeiled){if(this.isFlagged){l.value-=1,this.isFlagged=!1,this.isQuestion=!0;return}if(this.isQuestion){l.value-=1,this.isFlagged=!1,this.isQuestion=!1;return}l.value+=1,this.isFlagged=!0,this.isQuestion=!1}}}const a=1e3*999,c={surfaceLight:"#c6c6c6",surfaceDark:"#C0C0C0",shadow:"#808080"},_=je(),e=V([]),l=V(0),f=V(!1),p=V(!1),N=V(null),{timestamp:y,pause:v,resume:O}=be({immediate:!1,controls:!0}),b=X(()=>N.value?y.value-N.value:0);ne(b,()=>{b.value<a||Q({isSuccess:!1})});const C=X(()=>s.value===3?{totalMines:99,rows:16,cols:30}:s.value===2?{totalMines:40,rows:16,cols:16}:s.value===1?{totalMines:10,rows:9,cols:9}:{totalMines:0,rows:0,cols:0});ne(()=>s.value,()=>A(),{immediate:!0});function A(){v(),N.value=null,f.value=!1,p.value=!1,l.value=0,e.value=[];for(let t=0;t<C.value.rows;t++){const r=[];for(let x=0;x<C.value.cols;x++)r.push(new i({rowNum:t,colNum:x}));e.value.push(r)}let h=0;for(;h<C.value.totalMines;){const t=Math.round(Math.random()*(C.value.rows-1)),r=Math.round(Math.random()*(C.value.cols-1));e.value[t][r].isMine||(e.value[t][r].isMine=!0,e.value[t][r].around("increaseHint"),h++)}}function J(){N.value=new Date().getTime(),O()}function Q(h){if(v(),f.value=!0,p.value=h.isSuccess,!h.isSuccess)return R();!s.value||_.mutate({modeId:s.value,time:b.value},{onSuccess:()=>{window.alert("New Record!")}})}function w(h){f.value||(N.value||J(),h(),C.value.totalMines===l.value&&K()&&Q({isSuccess:!0}))}function R(){e.value.forEach(h=>{h.forEach(t=>{t.isFlagged||!t.isMine||(t.isExploded=!0)})})}function K(){for(let h=0;h<e.value.length;h++)for(let t=0;t<e.value[h].length;t++){const r=e.value[h][t];if(!(r.isMine&&r.isFlagged)&&!!r.isVeiled)return!1}return!0}return{withController:w,initialize:A,isGameOver:f,flagCount:l,isSuccess:p,COLORS:c,game:e,meta:C,time:b}}const Ye={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},We=n("path",{d:"M16 30a14 14 0 1 1 14-14a14 14 0 0 1-14 14zm0-26a12 12 0 1 0 12 12A12 12 0 0 0 16 4z",fill:"currentColor"},null,-1),Ie=n("path",{d:"M20.59 22L15 16.41V7h2v8.58l5 5.01L20.59 22z",fill:"currentColor"},null,-1),Xe=[We,Ie];function Je(s,i){return u(),d("svg",Ye,Xe)}var Ke={name:"carbon-time",render:Je};const Pe=1e3*60*60;function Ze(s){return ce(ie(["mine-sweeper-records",s]),async()=>s.value?(await U.from("mine-sweeper-records").select("*, user: user_id (user_name, avatar_url)").eq("mode_id",s.value).order("time",{ascending:!0}).limit(100)).data:null,ie({enabled:!!s.value,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Pe,retry:!1}))}const et={class:"mt-10 p-10 rounded shadow-lg"},tt={class:"mx-auto text-sm"},st={class:"pb-5 pr-10"},ot={class:"pb-5 px-10 w-48"},nt={class:"pb-5 pl-10"},it={key:0},at=n("td",{colspan:"3",class:"py-10 text-center"},"Loading...",-1),rt=[at],ut={key:1},lt=n("td",{colspan:"3",class:"py-10 text-center"},"No Data",-1),ct=[lt],dt={class:"py-2 pr-10 text-center"},mt={class:"py-2"},_t={class:"flex items-center gap-3"},ht={class:"relative"},ft={key:0,class:"absolute top-0 right-0 text-xl"},vt={class:"w-48 truncate"},pt={class:"py-2 text-right"},gt=de({props:{selectedMode:null},setup(s){const i=s,{data:a,isLoading:c}=Ze(X(()=>i.selectedMode));return(_,e)=>{const l=Se,f=we,p=Ke,N=xe;return u(),d("div",et,[n("table",tt,[n("thead",null,[n("tr",null,[n("th",st,[S(l,{class:"mx-auto"})]),n("th",ot,[S(f,{class:"mx-auto"})]),n("th",nt,[S(p,{class:"mx-auto"})])])]),n("tbody",null,[o(c)?(u(),d("tr",it,rt)):!o(a)||o(a).length===0?(u(),d("tr",ut,ct)):(u(!0),d(W,{key:2},I(o(a),(y,v)=>{var O;return u(),d("tr",{key:y.id},[n("td",dt,M(v+1),1),n("td",mt,[n("div",_t,[n("div",ht,[S(N,{src:(O=y.user.avatar_url)!=null?O:"",width:40,height:40,class:"rounded-full"},null,8,["src"]),v+1<=3?(u(),d("span",ft,M(v+1===1?"\u{1F947}":v+1===2?"\u{1F948}":v+1===3?"\u{1F949}":""),1)):F("",!0)]),n("span",vt,M(y.user.user_name),1)])]),n("td",pt,M((y.time/1e3).toFixed(2))+"`s",1)])}),128))])])])}}}),wt=1e3*60*60*24;function xt(s){return ce([s],async()=>(await U.from(s).select("id, mode")).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:wt,retry:!1})}function Nt(){const{t:s}=le(),{data:i}=xt("mine-sweeper-modes"),a=me(),c=_e(),_=X(()=>{var l;return(l=i.value)==null?void 0:l.map(({id:f,mode:p})=>({id:f,mode:s(p==="expert"?"expert":p==="intermediate"?"intermediate":"beginner")}))}),e=V(c.query.mode?Number(c.query.mode):1);return ae(()=>{if(!_.value)return;const l=c.query.mode?Number(c.query.mode):1;if(!_.value.find(({id:p})=>p===l))return a.replace({path:c.path});e.value=l}),ae(()=>Array.isArray(c.query.mode)&&a.replace({path:c.path})),{selectedMode:e,modes:_}}const yt={class:"min-h-screen grid place-items-center"},Ct={class:"mt-10 flex justify-center"},Mt={class:"p-2 grid grid-cols-3 intaglio"},bt={class:"flex"},$t={class:"counter"},kt={class:"flex items-center justify-center"},Ft=["data-isGameOver"],St={class:"flex justify-end"},Ot={class:"counter"},Rt={class:"rows-container intaglio"},Vt=["data-isExploded","onContextmenu","onDblclick","onClick"],At={key:1},Qt={key:0,class:"mt-2 w-96 text-rose-500 text-sm"},zt=de({setup(s){$e(w=>({"34a0904a":o(v).rows,"29068297":o(l).shadow,"34ae3616":o(v).cols,"8845dec0":o(l).surfaceLight}));const i=me(),a=_e(),{data:c}=ue(),{selectedMode:_,modes:e}=Nt(),{COLORS:l,isGameOver:f,isSuccess:p,flagCount:N,initialize:y,meta:v,game:O,withController:b,time:C}=Ue(_),{t:A}=le();function J(w){return w===1?"text-blue-700":w===2?"text-green-700":w===3?"text-red-700":w===4?"text-purple-700":w===5?"text-fuchsia-700":w===6?"text-cyan-600":"text-black"}function Q(w){i.push({path:a.path,query:{mode:w}})}return(w,R)=>{const K=Re,h=Oe,t=Ge,r=qe,x=ye;return u(),d("div",yt,[n("div",Ct,[S(h,{"model-value":o(_),"option-label-key":"mode",label:o(A)("mode"),"onUpdate:modelValue":Q},{default:ke(()=>[(u(!0),d(W,null,I(o(e),g=>(u(),P(K,{key:g.id,value:g.id,label:g.mode},null,8,["value","label"]))),128))]),_:1},8,["model-value","label"])]),0<o(v).rows&&0<o(v).cols?(u(),d("div",{key:0,class:"mt-20 flex flex-col items-center justify-center game",onContextmenu:R[1]||(R[1]=Y(()=>{},["prevent"]))},[n("div",{class:"p-2 relief",style:Fe({backgroundColor:o(l).surfaceDark})},[n("div",Mt,[n("div",bt,[n("span",$t,M((o(v).totalMines-o(N)).toString().padStart(3,"0")),1)]),n("div",kt,[n("button",{class:"node-btn relief player w-10 h-10","data-isGameOver":o(f),"aria-label":"Click to restart the game",onClick:R[0]||(R[0]=(...g)=>o(y)&&o(y)(...g))},M(o(f)&&o(p)?"\u{1F60E}":o(f)&&!o(p)?"\u{1F480}":""),9,Ft)]),n("div",St,[n("span",Ot,M(Math.round(o(C)/1e3).toString().padStart(3,"0")),1)])]),n("div",Rt,[(u(!0),d(W,null,I(o(O),(g,$)=>(u(),d("div",{key:$,class:"row"},[(u(!0),d(W,null,I(g,(m,k)=>(u(),d("button",{key:k,class:re(["node-btn",[m.isVeiled&&"relief"]]),"data-isExploded":m.isExploded,onContextmenu:Y(()=>o(b)(()=>m.onRightClick()),["prevent"]),onDblclick:Y(()=>o(b)(()=>m.onDoubleClick()),["prevent"]),onClick:Y(()=>o(b)(()=>m.onLeftClick()),["prevent"])},[m.isVeiled?F("",!0):(u(),d("span",{key:0,class:re(["font-extrabold",[J(m.hint)]])},M(m.hint===0?"":m.hint),3)),m.isExploded?(u(),d("span",At,"\u{1F4A3}")):F("",!0),m.isFlagged?(u(),P(t,{key:2})):F("",!0),m.isQuestion?(u(),P(r,{key:3})):F("",!0)],42,Vt))),128))]))),128))])],4),o(c)?F("",!0):(u(),d("div",Qt,M(o(A)("games_auth_warning")),1))],32)):F("",!0),S(gt,{"selected-mode":o(_)},null,8,["selected-mode"]),S(x)])}}});var Ht=Ne(zt,[["__scopeId","data-v-f99ea278"]]);export{Ht as default};
