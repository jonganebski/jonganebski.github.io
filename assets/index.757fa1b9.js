var me=Object.defineProperty,fe=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var te=(s,i,a)=>i in s?me(s,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[i]=a,se=(s,i)=>{for(var a in i||(i={}))pe.call(i,a)&&te(s,a,i[a]);if(ee)for(var a of ee(i))ge.call(i,a)&&te(s,a,i[a]);return s},oe=(s,i)=>fe(s,ve(i));import{h as l,j as c,m as o,$ as we,a0 as xe,r as S,a4 as Ne,p as J,L as ne,N as le,a5 as ie,d as ue,w as j,t as n,F as I,U as X,v as M,y as b,a6 as ce,O as de,z as ae,a7 as ye,x as Me,a8 as U,n as Ce,R as W,s as re}from"./vendor.bea6da78.js";import{_ as be,a as $e}from"./option.959a9e71.js";import{u as he,s as Y,c as ke,d as Fe,e as _e,_ as Re}from"./app.dbd89cd9.js";const Se={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},ze=o("path",{d:"M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2zm0 26a12 12 0 1 1 12-12a12 12 0 0 1-12 12z",fill:"currentColor"},null,-1),Oe=o("circle",{cx:"16",cy:"23.5",r:"1.5",fill:"currentColor"},null,-1),He=o("path",{d:"M17 8h-1.5a4.49 4.49 0 0 0-4.5 4.5v.5h2v-.5a2.5 2.5 0 0 1 2.5-2.5H17a2.5 2.5 0 0 1 0 5h-2v4.5h2V17a4.5 4.5 0 0 0 0-9z",fill:"currentColor"},null,-1),Ve=[ze,Oe,He];function Ae(s,i){return l(),c("svg",Se,Ve)}var Qe={name:"carbon-help",render:Ae};const Ee={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Le=o("path",{d:"M6 30H4V2h24l-5.8 9l5.8 9H6zm0-12h18.33l-4.53-7l4.53-7H6z",fill:"currentColor"},null,-1),De=[Le];function qe(s,i){return l(),c("svg",Ee,De)}var Be={name:"carbon-flag",render:qe};function Te(){const s=xe(),{data:i}=he();return we(async({modeId:a,time:m})=>{if(!i.value)return null;const{data:h}=await Y.from("mine-sweeper-records").select("*").eq("user_id",i.value.id).eq("mode_id",a).order("time",{ascending:!0});if(!h)return null;switch(h.length<=10){case!0:return(await Y.from("mine-sweeper-records").insert({mode_id:a,time:m,user_id:i.value.id}).single()).data;case!1:{const t=h[h.length-1];return t.time<m?null:(await Y.from("mine-sweeper-records").update({id:t.id,time:m}).single()).data}}},{onSuccess:a=>{if(!i.value)return;const{user_name:m=i.value.email,avatar_url:h=""}=i.value.user_metadata;if(!a)return;const t=s.getQueryData(["mine-sweeper-records",a.mode_id]);!t||s.setQueryData(["mine-sweeper-records",a.mode_id],()=>(t.push(oe(se({},a),{user:{user_name:m,avatar_url:h}})),t.sort((d,f)=>d.time-f.time)))}})}function Ge(s){class i{constructor(e){this.isExploded=!1,this.isQuestion=!1,this.isFlagged=!1,this.isVeiled=!0,this.isMine=!1,this.hint=0,this.rowNum=e.rowNum,this.colNum=e.colNum}increaseHint(){this.hint+=1}around(e){var r,v,$,_,k,H,V,A,Q,E,L,D,q,B,T,G;(v=(r=t.value[this.rowNum-1])==null?void 0:r[this.colNum])==null||v[e](),(_=($=t.value[this.rowNum-1])==null?void 0:$[this.colNum+1])==null||_[e](),(H=(k=t.value[this.rowNum])==null?void 0:k[this.colNum+1])==null||H[e](),(A=(V=t.value[this.rowNum+1])==null?void 0:V[this.colNum+1])==null||A[e](),(E=(Q=t.value[this.rowNum+1])==null?void 0:Q[this.colNum])==null||E[e](),(D=(L=t.value[this.rowNum+1])==null?void 0:L[this.colNum-1])==null||D[e](),(B=(q=t.value[this.rowNum])==null?void 0:q[this.colNum-1])==null||B[e](),(G=(T=t.value[this.rowNum-1])==null?void 0:T[this.colNum-1])==null||G[e]()}countAround(e){var v,$,_,k,H,V,A,Q,E,L,D,q,B,T,G,Z;let r=0;return(($=(v=t.value[this.rowNum-1])==null?void 0:v[this.colNum])==null?void 0:$[e])&&r++,((k=(_=t.value[this.rowNum-1])==null?void 0:_[this.colNum+1])==null?void 0:k[e])&&r++,((V=(H=t.value[this.rowNum])==null?void 0:H[this.colNum+1])==null?void 0:V[e])&&r++,((Q=(A=t.value[this.rowNum+1])==null?void 0:A[this.colNum+1])==null?void 0:Q[e])&&r++,((L=(E=t.value[this.rowNum+1])==null?void 0:E[this.colNum])==null?void 0:L[e])&&r++,((q=(D=t.value[this.rowNum+1])==null?void 0:D[this.colNum-1])==null?void 0:q[e])&&r++,((T=(B=t.value[this.rowNum])==null?void 0:B[this.colNum-1])==null?void 0:T[e])&&r++,((Z=(G=t.value[this.rowNum-1])==null?void 0:G[this.colNum-1])==null?void 0:Z[e])&&r++,r}unveil(){if(!!this.isVeiled&&!this.isFlagged){if(this.isMine){O({isSuccess:!1});return}this.isVeiled=!1,this.hint===0&&this.around("unveil")}}onLeftClick(){this.isFlagged||this.isQuestion||this.unveil()}onDoubleClick(){this.isVeiled||this.countAround("isFlagged")!==this.hint||this.around("unveil")}onRightClick(){if(!!this.isVeiled){if(this.isFlagged){d.value-=1,this.isFlagged=!1,this.isQuestion=!0;return}if(this.isQuestion){d.value-=1,this.isFlagged=!1,this.isQuestion=!1;return}d.value+=1,this.isFlagged=!0,this.isQuestion=!1}}}const a=1e3*999,m={surfaceLight:"#c6c6c6",surfaceDark:"#C0C0C0",shadow:"#808080"},h=Te(),t=S([]),d=S(0),f=S(!1),g=S(!1),N=S(null),{timestamp:y,pause:p,resume:F}=Ne({immediate:!1,controls:!0}),C=J(()=>N.value?y.value-N.value:0);ne(C,()=>{C.value<a||O({isSuccess:!1})});const x=J(()=>{var u,e,r;return((u=s.value)==null?void 0:u.id)===3?{totalMines:99,rows:16,cols:30}:((e=s.value)==null?void 0:e.id)===2?{totalMines:40,rows:16,cols:16}:((r=s.value)==null?void 0:r.id)===1?{totalMines:10,rows:9,cols:9}:{totalMines:0,rows:0,cols:0}});ne(()=>x.value,()=>z(),{immediate:!0});function z(){p(),N.value=null,f.value=!1,g.value=!1,d.value=0,t.value=[];for(let e=0;e<x.value.rows;e++){const r=[];for(let v=0;v<x.value.cols;v++)r.push(new i({rowNum:e,colNum:v}));t.value.push(r)}let u=0;for(;u<x.value.totalMines;){const e=Math.round(Math.random()*(x.value.rows-1)),r=Math.round(Math.random()*(x.value.cols-1));t.value[e][r].isMine||(t.value[e][r].isMine=!0,t.value[e][r].around("increaseHint"),u++)}}function K(){N.value=new Date().getTime(),F()}function O(u){if(p(),f.value=!0,g.value=u.isSuccess,!u.isSuccess)return R();!s.value||h.mutate({modeId:s.value.id,time:C.value},{onSuccess:()=>{window.alert("New Record!")}})}function w(u){f.value||(N.value||K(),u(),x.value.totalMines===d.value&&P()&&O({isSuccess:!0}))}function R(){t.value.forEach(u=>{u.forEach(e=>{e.isFlagged||!e.isMine||(e.isExploded=!0)})})}function P(){for(let u=0;u<t.value.length;u++)for(let e=0;e<t.value[u].length;e++){const r=t.value[u][e];if(!(r.isMine&&r.isFlagged)&&!!r.isVeiled)return!1}return!0}return{withController:w,initialize:z,isGameOver:f,flagCount:d,isSuccess:g,COLORS:m,game:t,meta:x,time:C}}const je={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Ye=o("path",{d:"M16 30a14 14 0 1 1 14-14a14 14 0 0 1-14 14zm0-26a12 12 0 1 0 12 12A12 12 0 0 0 16 4z",fill:"currentColor"},null,-1),Ue=o("path",{d:"M20.59 22L15 16.41V7h2v8.58l5 5.01L20.59 22z",fill:"currentColor"},null,-1),We=[Ye,Ue];function Ie(s,i){return l(),c("svg",je,We)}var Xe={name:"carbon-time",render:Ie};const Je={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Ke=o("path",{d:"M16 22h14v2H16z",fill:"currentColor"},null,-1),Pe=o("path",{d:"M16 8h14v2H16z",fill:"currentColor"},null,-1),Ze=o("path",{d:"M8 12V4H6v1H4v2h2v5H4v2h6v-2H8z",fill:"currentColor"},null,-1),et=o("path",{d:"M10 28H4v-4a2 2 0 0 1 2-2h2v-2H4v-2h4a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2H6v2h4z",fill:"currentColor"},null,-1),tt=[Ke,Pe,Ze,et];function st(s,i){return l(),c("svg",Je,tt)}var ot={name:"carbon-list-numbered",render:st};const nt=1e3*60*60;function it(s){return le(ie(["mine-sweeper-records",s]),async()=>s.value?(await Y.from("mine-sweeper-records").select("*, user: user_id (user_name, avatar_url)").eq("mode_id",s.value).order("time",{ascending:!0}).limit(100)).data:null,ie({enabled:!!s.value,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:nt,retry:!1}))}const at={class:"mt-10 p-10 rounded shadow-lg"},rt={class:"mx-auto text-sm"},lt={class:"pb-5 pr-10"},ut={class:"pb-5 px-10 w-48"},ct={class:"pb-5 pl-10"},dt={key:0},ht=o("td",{colspan:"3",class:"py-10 text-center"},"Loading...",-1),_t=[ht],mt={key:1},ft=o("td",{colspan:"3",class:"py-10 text-center"},"No Data",-1),vt=[ft],pt={class:"py-2 pr-10 text-center"},gt={class:"py-2"},wt={class:"flex items-center gap-3"},xt={class:"relative"},Nt={key:0,class:"absolute top-0 right-0 text-xl"},yt={class:"w-48 truncate"},Mt={class:"py-2 text-right"},Ct=ue({props:{selectedMode:null},setup(s){const i=s,{data:a,isLoading:m}=it(J(()=>i.selectedMode.id));return(h,t)=>{const d=ot,f=ke,g=Xe,N=Fe;return l(),c("div",at,[o("table",rt,[o("thead",null,[o("tr",null,[o("th",lt,[j(d,{class:"mx-auto"})]),o("th",ut,[j(f,{class:"mx-auto"})]),o("th",ct,[j(g,{class:"mx-auto"})])])]),o("tbody",null,[n(m)?(l(),c("tr",dt,_t)):!n(a)||n(a).length===0?(l(),c("tr",mt,vt)):(l(!0),c(I,{key:2},X(n(a),(y,p)=>{var F;return l(),c("tr",{key:y.id},[o("td",pt,M(p+1),1),o("td",gt,[o("div",wt,[o("div",xt,[j(N,{src:(F=y.user.avatar_url)!=null?F:"",width:40,height:40,class:"rounded-full"},null,8,["src"]),p+1<=3?(l(),c("span",Nt,M(p+1===1?"\u{1F947}":p+1===2?"\u{1F948}":p+1===3?"\u{1F949}":""),1)):b("",!0)]),o("span",yt,M(y.user.user_name),1)])]),o("td",Mt,M((y.time/1e3).toFixed(2))+"`s",1)])}),128))])])])}}}),bt=1e3*60*60*24;function $t(s){return le([s],async()=>(await Y.from(s).select("id, mode")).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:bt,retry:!1})}function kt(){const{t:s}=_e(),{data:i}=$t("mine-sweeper-modes"),a=ce(),m=de(),h=J(()=>{var d;return(d=i.value)==null?void 0:d.map(({id:f,mode:g})=>({id:f,mode:s(g==="expert"?"expert":g==="intermediate"?"intermediate":"beginner")}))}),t=S();return ae(()=>{if(!h.value)return;const d=m.query.mode?Number(m.query.mode):1,f=h.value.find(({id:g})=>g===d);if(!f)return a.replace({path:m.path});t.value=f}),ae(()=>Array.isArray(m.query.mode)&&a.replace({path:m.path})),{selectedMode:t,modes:h}}const Ft={class:"min-h-screen grid place-items-center"},Rt={class:"mt-10 flex justify-center"},St={class:"p-2 grid grid-cols-3 intaglio"},zt={class:"flex"},Ot={class:"counter"},Ht={class:"flex items-center justify-center"},Vt=["data-isGameOver"],At={class:"flex justify-end"},Qt={class:"counter"},Et={class:"rows-container intaglio"},Lt=["data-isExploded","onContextmenu","onDblclick","onClick"],Dt={key:1},qt={key:0,class:"mt-2 w-96 text-rose-500 text-sm"},Bt=ue({setup(s){ye(w=>({"0f9070a9":n(p).rows,e1bbb736:n(d).shadow,"0f899dc3":n(p).cols,"3e3f9fee":n(d).surfaceLight}));const i=ce(),a=de(),{data:m}=he(),{selectedMode:h,modes:t}=kt(),{COLORS:d,isGameOver:f,isSuccess:g,flagCount:N,initialize:y,meta:p,game:F,withController:C,time:x}=Ge(h),{t:z}=_e();function K(w){return w===1?"text-blue-700":w===2?"text-green-700":w===3?"text-red-700":w===4?"text-purple-700":w===5?"text-fuchsia-700":w===6?"text-cyan-600":"text-black"}function O(w){i.push({path:a.path,query:{mode:w.id}})}return(w,R)=>{const P=$e,u=be,e=Be,r=Qe;return l(),c("div",Ft,[o("div",Rt,[j(u,{"model-value":n(h),"option-label-key":"mode",label:n(z)("mode"),"onUpdate:modelValue":O},{default:Me(()=>[(l(!0),c(I,null,X(n(t),v=>(l(),W(P,{key:v.id,value:v,"label-key":"mode"},null,8,["value"]))),128))]),_:1},8,["model-value","label"])]),0<n(p).rows&&0<n(p).cols?(l(),c("div",{key:0,class:"mt-20 flex flex-col items-center justify-center game",onContextmenu:R[1]||(R[1]=U(()=>{},["prevent"]))},[o("div",{class:"p-2 relief",style:Ce({backgroundColor:n(d).surfaceDark})},[o("div",St,[o("div",zt,[o("span",Ot,M((n(p).totalMines-n(N)).toString().padStart(3,"0")),1)]),o("div",Ht,[o("button",{class:"node-btn relief player w-10 h-10","data-isGameOver":n(f),"aria-label":"Click to restart the game",onClick:R[0]||(R[0]=(...v)=>n(y)&&n(y)(...v))},M(n(f)&&n(g)?"\u{1F60E}":n(f)&&!n(g)?"\u{1F480}":""),9,Vt)]),o("div",At,[o("span",Qt,M(Math.round(n(x)/1e3).toString().padStart(3,"0")),1)])]),o("div",Et,[(l(!0),c(I,null,X(n(F),(v,$)=>(l(),c("div",{key:$,class:"row"},[(l(!0),c(I,null,X(v,(_,k)=>(l(),c("button",{key:k,class:re(["node-btn",[_.isVeiled&&"relief"]]),"data-isExploded":_.isExploded,onContextmenu:U(()=>n(C)(()=>_.onRightClick()),["prevent"]),onDblclick:U(()=>n(C)(()=>_.onDoubleClick()),["prevent"]),onClick:U(()=>n(C)(()=>_.onLeftClick()),["prevent"])},[_.isVeiled?b("",!0):(l(),c("span",{key:0,class:re(["font-extrabold",[K(_.hint)]])},M(_.hint===0?"":_.hint),3)),_.isExploded?(l(),c("span",Dt,"\u{1F4A3}")):b("",!0),_.isFlagged?(l(),W(e,{key:2})):b("",!0),_.isQuestion?(l(),W(r,{key:3})):b("",!0)],42,Lt))),128))]))),128))])],4),n(m)?b("",!0):(l(),c("div",qt,M(n(z)("games_auth_warning")),1))],32)):b("",!0),n(h)?(l(),W(Ct,{key:1,"selected-mode":n(h)},null,8,["selected-mode"])):b("",!0)])}}});var Ut=Re(Bt,[["__scopeId","data-v-4f95f308"]]);export{Ut as default};
