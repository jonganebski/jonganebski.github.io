var pe=Object.defineProperty,ge=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var Z=(t,a,n)=>a in t?pe(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,re=(t,a)=>{for(var n in a||(a={}))xe.call(a,n)&&Z(t,n,a[n]);if(oe)for(var n of oe(a))Ne.call(a,n)&&Z(t,n,a[n]);return t},ue=(t,a)=>ge(t,we(a));var N=(t,a,n)=>(Z(t,typeof a!="symbol"?a+"":a,n),n);import{s as I,d as he,e as Ce,u as ae,_ as ye,a as Me}from"./app.98b3c972.js";import{h,j as g,m as c,P as fe,af as le,$ as be,a0 as ke,r as A,ag as Fe,p as ie,N as ce,ad as _e,Q as ve,A as de,d as Se,s as W,w as ee,v as i,H as Oe,t as k,F as Y,ae as Qe,q as Ee,W as te,T as se,ah as P,n as Re,x as me,y as V}from"./vendor.91685901.js";import{_ as Ve,a as Ae,b as $e}from"./records.922fe3fe.js";const qe={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},He=c("path",{d:"M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2zm0 26a12 12 0 1 1 12-12a12 12 0 0 1-12 12z",fill:"currentColor"},null,-1),ze=c("circle",{cx:"16",cy:"23.5",r:"1.5",fill:"currentColor"},null,-1),De=c("path",{d:"M17 8h-1.5a4.49 4.49 0 0 0-4.5 4.5v.5h2v-.5a2.5 2.5 0 0 1 2.5-2.5H17a2.5 2.5 0 0 1 0 5h-2v4.5h2V17a4.5 4.5 0 0 0 0-9z",fill:"currentColor"},null,-1),Le=[He,ze,De];function Te(t,a){return h(),g("svg",qe,Le)}var je={name:"carbon-help",render:Te};const Be={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Ge=c("path",{d:"M6 30H4V2h24l-5.8 9l5.8 9H6zm0-12h18.33l-4.53-7l4.53-7H6z",fill:"currentColor"},null,-1),We=[Ge];function Ie(t,a){return h(),g("svg",Be,We)}var Ue={name:"carbon-flag",render:Ie};const Ye=1e3*60*60;function Pe(t){return fe(le(["mine-sweeper-records",t]),async()=>t.value?(await I.from("mine-sweeper-records").select("*, user: user_id (user_name, avatar_url)").eq("mode_id",t.value).order("score",{ascending:!0}).limit(100)).data:null,le({enabled:!!t,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Ye,retry:!1}))}function Xe(){const t=ke(),{data:a}=he();return be(async({modeId:n,score:u})=>{if(!a.value)return null;const{data:d}=await I.from("mine-sweeper-records").select("*").eq("user_id",a.value.id).eq("mode_id",n).order("score",{ascending:!0});if(!d)return null;switch(d.length<=10){case!0:return(await I.from("mine-sweeper-records").insert({mode_id:n,score:u,user_id:a.value.id}).single()).data;case!1:{const v=d[d.length-1];return v.score<u?null:(await I.from("mine-sweeper-records").update({id:v.id,score:u}).single()).data}}},{onSuccess:n=>{if(!a.value)return;const{user_name:u=a.value.email,avatar_url:d=""}=a.value.user_metadata;if(!n)return;const v=t.getQueryData(["mine-sweeper-records",n.mode_id]);!v||t.setQueryData(["mine-sweeper-records",n.mode_id],()=>[...v,ue(re({},n),{user:{user_name:u,avatar_url:d}})].sort((f,s)=>f.score-s.score))}})}function Je(t){class a{constructor(e){N(this,"isExploded");N(this,"isQuestion");N(this,"isFlagged");N(this,"isVeiled");N(this,"isMine");N(this,"hint");N(this,"rowNum");N(this,"colNum");this.isExploded=!1,this.isQuestion=!1,this.isFlagged=!1,this.isVeiled=!0,this.isMine=!1,this.hint=0,this.rowNum=e.rowNum,this.colNum=e.colNum}increaseHint(){this.hint+=1}around(e){var o,w,S,_,O,r,Q,q,H,z,D,L,T,j,B,G;(w=(o=s.value[this.rowNum-1])==null?void 0:o[this.colNum])==null||w[e](),(_=(S=s.value[this.rowNum-1])==null?void 0:S[this.colNum+1])==null||_[e](),(r=(O=s.value[this.rowNum])==null?void 0:O[this.colNum+1])==null||r[e](),(q=(Q=s.value[this.rowNum+1])==null?void 0:Q[this.colNum+1])==null||q[e](),(z=(H=s.value[this.rowNum+1])==null?void 0:H[this.colNum])==null||z[e](),(L=(D=s.value[this.rowNum+1])==null?void 0:D[this.colNum-1])==null||L[e](),(j=(T=s.value[this.rowNum])==null?void 0:T[this.colNum-1])==null||j[e](),(G=(B=s.value[this.rowNum-1])==null?void 0:B[this.colNum-1])==null||G[e]()}countAround(e){var w,S,_,O,r,Q,q,H,z,D,L,T,j,B,G,ne;let o=0;return((S=(w=s.value[this.rowNum-1])==null?void 0:w[this.colNum])==null?void 0:S[e])&&o++,((O=(_=s.value[this.rowNum-1])==null?void 0:_[this.colNum+1])==null?void 0:O[e])&&o++,((Q=(r=s.value[this.rowNum])==null?void 0:r[this.colNum+1])==null?void 0:Q[e])&&o++,((H=(q=s.value[this.rowNum+1])==null?void 0:q[this.colNum+1])==null?void 0:H[e])&&o++,((D=(z=s.value[this.rowNum+1])==null?void 0:z[this.colNum])==null?void 0:D[e])&&o++,((T=(L=s.value[this.rowNum+1])==null?void 0:L[this.colNum-1])==null?void 0:T[e])&&o++,((B=(j=s.value[this.rowNum])==null?void 0:j[this.colNum-1])==null?void 0:B[e])&&o++,((ne=(G=s.value[this.rowNum-1])==null?void 0:G[this.colNum-1])==null?void 0:ne[e])&&o++,o}unveil(){if(!!this.isVeiled&&!this.isFlagged){if(this.isMine){$({isSuccess:!1});return}this.isVeiled=!1,this.hint===0&&this.around("unveil")}}onLeftClick(){this.isFlagged||this.isQuestion||this.unveil()}onDoubleClick(){this.isVeiled||this.countAround("isFlagged")!==this.hint||this.around("unveil")}onRightClick(){if(!!this.isVeiled){if(this.isFlagged){m.value-=1,this.isFlagged=!1,this.isQuestion=!0;return}if(this.isQuestion){m.value-=1,this.isFlagged=!1,this.isQuestion=!1;return}m.value+=1,this.isFlagged=!0,this.isQuestion=!1}}}const n=1e3*999,u={surfaceLight:"#c6c6c6",surfaceDark:"#C0C0C0",shadow:"#808080"},d=Xe(),{openIssueModal:v}=Ce(),{t:f}=ae(),s=A([]),m=A(0),C=A(!1),E=A(!1),F=A(null),{timestamp:U,pause:y,resume:X}=Fe({immediate:!1,controls:!0}),M=ie(()=>F.value?U.value-F.value:0);ce(M,()=>{M.value<n||$({isSuccess:!1})});const x=ie(()=>t.value===3?{totalMines:99,rows:16,cols:30}:t.value===2?{totalMines:40,rows:16,cols:16}:t.value===1?{totalMines:10,rows:9,cols:9}:{totalMines:0,rows:0,cols:0});ce(()=>t.value,()=>b(),{immediate:!0});function b(){y(),F.value=null,C.value=!1,E.value=!1,m.value=0,s.value=[];for(let e=0;e<x.value.rows;e++){const o=[];for(let w=0;w<x.value.cols;w++)o.push(new a({rowNum:e,colNum:w}));s.value.push(o)}let l=0;for(;l<x.value.totalMines;){const e=Math.round(Math.random()*(x.value.rows-1)),o=Math.round(Math.random()*(x.value.cols-1));s.value[e][o].isMine||(s.value[e][o].isMine=!0,s.value[e][o].around("increaseHint"),l++)}}function J(){F.value=new Date().getTime(),X()}function $(l){if(y(),C.value=!0,E.value=l.isSuccess,!l.isSuccess)return R();!t.value||d.mutate({modeId:t.value,score:M.value},{onSuccess:()=>{const e=f("congratulations")+"!";window.alert(e)},onError:()=>v({title:f("record_mutation_failed.title"),content:f("record_mutation_failed.content")})})}function p(l){C.value||(F.value||J(),l(),x.value.totalMines===m.value&&K()&&$({isSuccess:!0}))}function R(){s.value.forEach(l=>{l.forEach(e=>{e.isFlagged||!e.isMine||(e.isExploded=!0)})})}function K(){for(let l=0;l<s.value.length;l++)for(let e=0;e<s.value[l].length;e++){const o=s.value[l][e];if(!(o.isMine&&o.isFlagged)&&!!o.isVeiled)return!1}return!0}return{withController:p,initialize:b,isGameOver:C,flagCount:m,isSuccess:E,COLORS:u,game:s,meta:x,time:M}}const Ke=1e3*60*60*24;function Ze(t){return fe([t],async()=>(await I.from(t).select("id, mode")).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Ke,retry:!1})}function et(){const{t}=ae(),{data:a}=Ze("mine-sweeper-modes"),n=_e(),u=ve(),d=ie(()=>{var f;return(f=a.value)==null?void 0:f.map(({id:s,mode:m})=>({id:s,mode:t(m==="expert"?"expert":m==="intermediate"?"intermediate":"beginner")}))}),v=A(u.query.mode?Number(u.query.mode):1);return de(()=>{if(!d.value)return;const f=u.query.mode?Number(u.query.mode):1;if(!d.value.find(({id:m})=>m===f))return n.replace({path:u.path});v.value=f}),de(()=>Array.isArray(u.query.mode)&&n.replace({path:u.path})),{selectedMode:v,modes:d}}const tt={class:"mt-20 min-h-screen grid place-items-center text-dark-500 dark:text-light-500"},st={class:"text-3xl md:text-5xl"},it={class:"mt-10 flex justify-center"},at={class:"p-2 grid grid-cols-3 intaglio"},nt={class:"flex"},ot={class:"counter"},rt={class:"flex items-center justify-center"},ut=["data-isGameOver"],lt={class:"flex justify-end"},ct={class:"counter"},dt={class:"rows-container intaglio"},mt=["data-isExploded","onContextmenu","onDblclick","onClick"],ht={key:1},ft={key:0,class:"mt-2 w-96 text-rose-500 text-sm"},_t=Se({setup(t){Qe(p=>({"0d1ab81d":i(y).rows,b2d8dc4e:i(m).shadow,"0d13e537":i(y).cols,"3c7e2662":i(m).surfaceLight}));const a=_e(),n=ve(),{data:u}=he(),{selectedMode:d,modes:v}=et(),{data:f,isLoading:s}=Pe(d),{COLORS:m,isGameOver:C,isSuccess:E,flagCount:F,initialize:U,meta:y,game:X,withController:M,time:x}=Je(d),{t:b}=ae();function J(p){return p===1?"text-blue-700":p===2?"text-green-700":p===3?"text-red-700":p===4?"text-purple-700":p===5?"text-fuchsia-700":p===6?"text-cyan-600":"text-black"}function $(p){a.push({path:n.path,query:{mode:p}})}return(p,R)=>{const K=$e,l=Ae,e=Ue,o=je,w=Ee("client-only"),S=Me;return h(),g(Y,null,[W(i(Oe),null,{default:ee(()=>[c("title",null,k(i(b)("minesweeper"))+" | "+k(i(b)("jon_ganebskis_blog")),1)]),_:1}),c("div",tt,[c("h1",st,k(i(b)("minesweeper")),1),c("div",it,[W(l,{"model-value":i(d),"option-label-key":"mode",label:i(b)("mode"),class:"w-72","onUpdate:modelValue":$},{default:ee(()=>[(h(!0),g(Y,null,te(i(v),_=>(h(),se(K,{key:_.id,value:_.id,label:_.mode},null,8,["value","label"]))),128))]),_:1},8,["model-value","label"])]),W(w,null,{default:ee(()=>[0<i(y).rows&&0<i(y).cols?(h(),g("div",{key:0,class:"mt-20 flex flex-col items-center justify-center game",onContextmenu:R[1]||(R[1]=P(()=>{},["prevent"]))},[c("div",{class:"p-2 relief",style:Re({backgroundColor:i(m).surfaceDark})},[c("div",at,[c("div",nt,[c("span",ot,k((i(y).totalMines-i(F)).toString().padStart(3,"0")),1)]),c("div",rt,[c("button",{class:"node-btn relief player w-10 h-10","data-isGameOver":i(C),"aria-label":"Click to restart the game",onClick:R[0]||(R[0]=(..._)=>i(U)&&i(U)(..._))},k(i(C)&&i(E)?"\u{1F60E}":i(C)&&!i(E)?"\u{1F480}":""),9,ut)]),c("div",lt,[c("span",ct,k(Math.round(i(x)/1e3).toString().padStart(3,"0")),1)])]),c("div",dt,[(h(!0),g(Y,null,te(i(X),(_,O)=>(h(),g("div",{key:O,class:"row"},[(h(!0),g(Y,null,te(_,(r,Q)=>(h(),g("button",{key:Q,class:me(["node-btn",[r.isVeiled&&"relief"]]),"data-isExploded":r.isExploded,onContextmenu:P(()=>i(M)(()=>r.onRightClick()),["prevent"]),onDblclick:P(()=>i(M)(()=>r.onDoubleClick()),["prevent"]),onClick:P(()=>i(M)(()=>r.onLeftClick()),["prevent"])},[r.isVeiled?V("",!0):(h(),g("span",{key:0,class:me(["font-extrabold",[J(r.hint)]])},k(r.hint===0?"":r.hint),3)),r.isExploded?(h(),g("span",ht,"\u{1F4A3}")):V("",!0),r.isFlagged?(h(),se(e,{key:2})):V("",!0),r.isQuestion?(h(),se(o,{key:3})):V("",!0)],42,mt))),128))]))),128))])],4),i(u)?V("",!0):(h(),g("div",ft,k(i(b)("games_auth_warning")),1))],32)):V("",!0)]),_:1}),W(Ve,{"is-loading":i(s),data:i(f)},null,8,["is-loading","data"]),W(S)])],64)}}});var xt=ye(_t,[["__scopeId","data-v-3f8f43e4"]]);export{xt as default};
