var fe=Object.defineProperty,ve=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var se=(n,a,i)=>a in n?fe(n,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[a]=i,ne=(n,a)=>{for(var i in a||(a={}))ge.call(a,i)&&se(n,i,a[i]);if(te)for(var i of te(a))we.call(a,i)&&se(n,i,a[i]);return n},oe=(n,a)=>ve(n,pe(a));import{s as Y,d as xe,b as Ne,e as ue,u as ce,_ as ye,a as be}from"./app.887b33ea.js";import{h as u,j as _,m as o,P as de,a5 as ie,d as me,p as U,s as k,v as s,F as W,W as P,t as N,$ as Ce,a0 as Me,r as V,a6 as ke,N as ae,a7 as _e,Q as he,A as le,w as K,H as $e,a4 as Fe,q as Re,S as Z,a8 as I,n as Se,x as re,y as Q}from"./vendor.05982d12.js";import{_ as Oe,a as Ae,b as Qe}from"./list-numbered.8bdf8d48.js";const Ve={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Ee=o("path",{d:"M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2zm0 26a12 12 0 1 1 12-12a12 12 0 0 1-12 12z",fill:"currentColor"},null,-1),ze=o("circle",{cx:"16",cy:"23.5",r:"1.5",fill:"currentColor"},null,-1),qe=o("path",{d:"M17 8h-1.5a4.49 4.49 0 0 0-4.5 4.5v.5h2v-.5a2.5 2.5 0 0 1 2.5-2.5H17a2.5 2.5 0 0 1 0 5h-2v4.5h2V17a4.5 4.5 0 0 0 0-9z",fill:"currentColor"},null,-1),Le=[Ee,ze,qe];function De(n,a){return u(),_("svg",Ve,Le)}var He={name:"carbon-help",render:De};const Te={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Be=o("path",{d:"M6 30H4V2h24l-5.8 9l5.8 9H6zm0-12h18.33l-4.53-7l4.53-7H6z",fill:"currentColor"},null,-1),je=[Be];function Ge(n,a){return u(),_("svg",Te,je)}var We={name:"carbon-flag",render:Ge};const Ye={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Ue=o("path",{d:"M16 30a14 14 0 1 1 14-14a14 14 0 0 1-14 14zm0-26a12 12 0 1 0 12 12A12 12 0 0 0 16 4z",fill:"currentColor"},null,-1),Ie=o("path",{d:"M20.59 22L15 16.41V7h2v8.58l5 5.01L20.59 22z",fill:"currentColor"},null,-1),Pe=[Ue,Ie];function Xe(n,a){return u(),_("svg",Ye,Pe)}var Je={name:"carbon-time",render:Xe};const Ke=1e3*60*60;function Ze(n){return de(ie(["mine-sweeper-records",n]),async()=>n.value?(await Y.from("mine-sweeper-records").select("*, user: user_id (user_name, avatar_url)").eq("mode_id",n.value).order("time",{ascending:!0}).limit(100)).data:null,ie({enabled:!!n,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Ke,retry:!1}))}const et={class:"mt-10 p-10 rounded shadow-lg"},tt={class:"mx-auto text-sm"},st={class:"pb-5 pr-10"},nt={class:"pb-5 px-10 w-48"},ot={class:"pb-5 pl-10"},it={key:0},at=o("td",{colspan:"3",class:"py-10 text-center"},"Loading...",-1),lt=[at],rt={key:1},ut=o("td",{colspan:"3",class:"py-10 text-center"},"No Data",-1),ct=[ut],dt={class:"py-2 pr-10 text-center"},mt={class:"py-2"},_t={class:"flex items-center gap-3"},ht={class:"relative"},ft={class:"absolute top-0 right-0 text-xl"},vt={class:"w-48 truncate"},pt={class:"py-2 text-right"},gt=me({props:{selectedMode:null},setup(n){const a=n,{data:i,isLoading:d}=Ze(U(()=>a.selectedMode)),c=U(e);function e(){var h;const l=[];if(!i.value)return l;for(let f=0;f<((h=i.value)==null?void 0:h.length);f++){const{time:p}=i.value[f];if(l.length===0){l.push(p);continue}if(l[l.length-1]!==p&&(l.push(p),l.length===3))break}return l}return(l,h)=>{const f=Oe,p=xe,O=Je,C=Ne;return u(),_("div",et,[o("table",tt,[o("thead",null,[o("tr",null,[o("th",st,[k(f,{class:"mx-auto"})]),o("th",nt,[k(p,{class:"mx-auto"})]),o("th",ot,[k(O,{class:"mx-auto"})])])]),o("tbody",null,[s(d)?(u(),_("tr",it,lt)):!s(i)||s(i).length===0?(u(),_("tr",rt,ct)):(u(!0),_(W,{key:2},P(s(i),(y,M)=>{var w;return u(),_("tr",{key:y.id},[o("td",dt,N(M+1),1),o("td",mt,[o("div",_t,[o("div",ht,[k(C,{src:(w=y.user.avatar_url)!=null?w:"",width:40,height:40,class:"rounded-full"},null,8,["src"]),o("span",ft,N(s(c)[0]===y.time?"\u{1F947}":s(c)[1]===y.time?"\u{1F948}":s(c)[2]===y.time?"\u{1F949}":""),1)]),o("span",vt,N(y.user.user_name),1)])]),o("td",pt,N((y.time/1e3).toFixed(2))+"`s",1)])}),128))])])])}}});function wt(){const n=Me(),{data:a}=ue();return Ce(async({modeId:i,time:d})=>{if(!a.value)return null;const{data:c}=await Y.from("mine-sweeper-records").select("*").eq("user_id",a.value.id).eq("mode_id",i).order("time",{ascending:!0});if(!c)return null;switch(c.length<=10){case!0:return(await Y.from("mine-sweeper-records").insert({mode_id:i,time:d,user_id:a.value.id}).single()).data;case!1:{const e=c[c.length-1];return e.time<d?null:(await Y.from("mine-sweeper-records").update({id:e.id,time:d}).single()).data}}},{onSuccess:i=>{if(!a.value)return;const{user_name:d=a.value.email,avatar_url:c=""}=a.value.user_metadata;if(!i)return;const e=n.getQueryData(["mine-sweeper-records",i.mode_id]);!e||n.setQueryData(["mine-sweeper-records",i.mode_id],()=>[...e,oe(ne({},i),{user:{user_name:d,avatar_url:c}})].sort((l,h)=>l.time-h.time))}})}function xt(n){class a{constructor(t){this.isExploded=!1,this.isQuestion=!1,this.isFlagged=!1,this.isVeiled=!0,this.isMine=!1,this.hint=0,this.rowNum=t.rowNum,this.colNum=t.colNum}increaseHint(){this.hint+=1}around(t){var r,b,F,g,R,m,S,z,q,L,D,H,T,B,j,G;(b=(r=e.value[this.rowNum-1])==null?void 0:r[this.colNum])==null||b[t](),(g=(F=e.value[this.rowNum-1])==null?void 0:F[this.colNum+1])==null||g[t](),(m=(R=e.value[this.rowNum])==null?void 0:R[this.colNum+1])==null||m[t](),(z=(S=e.value[this.rowNum+1])==null?void 0:S[this.colNum+1])==null||z[t](),(L=(q=e.value[this.rowNum+1])==null?void 0:q[this.colNum])==null||L[t](),(H=(D=e.value[this.rowNum+1])==null?void 0:D[this.colNum-1])==null||H[t](),(B=(T=e.value[this.rowNum])==null?void 0:T[this.colNum-1])==null||B[t](),(G=(j=e.value[this.rowNum-1])==null?void 0:j[this.colNum-1])==null||G[t]()}countAround(t){var b,F,g,R,m,S,z,q,L,D,H,T,B,j,G,ee;let r=0;return((F=(b=e.value[this.rowNum-1])==null?void 0:b[this.colNum])==null?void 0:F[t])&&r++,((R=(g=e.value[this.rowNum-1])==null?void 0:g[this.colNum+1])==null?void 0:R[t])&&r++,((S=(m=e.value[this.rowNum])==null?void 0:m[this.colNum+1])==null?void 0:S[t])&&r++,((q=(z=e.value[this.rowNum+1])==null?void 0:z[this.colNum+1])==null?void 0:q[t])&&r++,((D=(L=e.value[this.rowNum+1])==null?void 0:L[this.colNum])==null?void 0:D[t])&&r++,((T=(H=e.value[this.rowNum+1])==null?void 0:H[this.colNum-1])==null?void 0:T[t])&&r++,((j=(B=e.value[this.rowNum])==null?void 0:B[this.colNum-1])==null?void 0:j[t])&&r++,((ee=(G=e.value[this.rowNum-1])==null?void 0:G[this.colNum-1])==null?void 0:ee[t])&&r++,r}unveil(){if(!!this.isVeiled&&!this.isFlagged){if(this.isMine){E({isSuccess:!1});return}this.isVeiled=!1,this.hint===0&&this.around("unveil")}}onLeftClick(){this.isFlagged||this.isQuestion||this.unveil()}onDoubleClick(){this.isVeiled||this.countAround("isFlagged")!==this.hint||this.around("unveil")}onRightClick(){if(!!this.isVeiled){if(this.isFlagged){l.value-=1,this.isFlagged=!1,this.isQuestion=!0;return}if(this.isQuestion){l.value-=1,this.isFlagged=!1,this.isQuestion=!1;return}l.value+=1,this.isFlagged=!0,this.isQuestion=!1}}}const i=1e3*999,d={surfaceLight:"#c6c6c6",surfaceDark:"#C0C0C0",shadow:"#808080"},c=wt(),e=V([]),l=V(0),h=V(!1),f=V(!1),p=V(null),{timestamp:O,pause:C,resume:y}=ke({immediate:!1,controls:!0}),M=U(()=>p.value?O.value-p.value:0);ae(M,()=>{M.value<i||E({isSuccess:!1})});const w=U(()=>n.value===3?{totalMines:99,rows:16,cols:30}:n.value===2?{totalMines:40,rows:16,cols:16}:n.value===1?{totalMines:10,rows:9,cols:9}:{totalMines:0,rows:0,cols:0});ae(()=>n.value,()=>$(),{immediate:!0});function $(){C(),p.value=null,h.value=!1,f.value=!1,l.value=0,e.value=[];for(let t=0;t<w.value.rows;t++){const r=[];for(let b=0;b<w.value.cols;b++)r.push(new a({rowNum:t,colNum:b}));e.value.push(r)}let v=0;for(;v<w.value.totalMines;){const t=Math.round(Math.random()*(w.value.rows-1)),r=Math.round(Math.random()*(w.value.cols-1));e.value[t][r].isMine||(e.value[t][r].isMine=!0,e.value[t][r].around("increaseHint"),v++)}}function X(){p.value=new Date().getTime(),y()}function E(v){if(C(),h.value=!0,f.value=v.isSuccess,!v.isSuccess)return A();!n.value||c.mutate({modeId:n.value,time:M.value},{onSuccess:()=>{window.alert("New Record!")}})}function x(v){h.value||(p.value||X(),v(),w.value.totalMines===l.value&&J()&&E({isSuccess:!0}))}function A(){e.value.forEach(v=>{v.forEach(t=>{t.isFlagged||!t.isMine||(t.isExploded=!0)})})}function J(){for(let v=0;v<e.value.length;v++)for(let t=0;t<e.value[v].length;t++){const r=e.value[v][t];if(!(r.isMine&&r.isFlagged)&&!!r.isVeiled)return!1}return!0}return{withController:x,initialize:$,isGameOver:h,flagCount:l,isSuccess:f,COLORS:d,game:e,meta:w,time:M}}const Nt=1e3*60*60*24;function yt(n){return de([n],async()=>(await Y.from(n).select("id, mode")).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Nt,retry:!1})}function bt(){const{t:n}=ce(),{data:a}=yt("mine-sweeper-modes"),i=_e(),d=he(),c=U(()=>{var l;return(l=a.value)==null?void 0:l.map(({id:h,mode:f})=>({id:h,mode:n(f==="expert"?"expert":f==="intermediate"?"intermediate":"beginner")}))}),e=V(d.query.mode?Number(d.query.mode):1);return le(()=>{if(!c.value)return;const l=d.query.mode?Number(d.query.mode):1;if(!c.value.find(({id:f})=>f===l))return i.replace({path:d.path});e.value=l}),le(()=>Array.isArray(d.query.mode)&&i.replace({path:d.path})),{selectedMode:e,modes:c}}const Ct={class:"mt-20 min-h-screen grid place-items-center text-dark-500 dark:text-light-500"},Mt={class:"text-3xl md:text-5xl"},kt={class:"mt-10 flex justify-center"},$t={class:"p-2 grid grid-cols-3 intaglio"},Ft={class:"flex"},Rt={class:"counter"},St={class:"flex items-center justify-center"},Ot=["data-isGameOver"],At={class:"flex justify-end"},Qt={class:"counter"},Vt={class:"rows-container intaglio"},Et=["data-isExploded","onContextmenu","onDblclick","onClick"],zt={key:1},qt={key:0,class:"mt-2 w-96 text-rose-500 text-sm"},Lt=me({setup(n){Fe(x=>({"34fe2935":s(C).rows,"5ea8b6f1":s(l).shadow,"34f7564f":s(C).cols,"0cf9197a":s(l).surfaceLight}));const a=_e(),i=he(),{data:d}=ue(),{selectedMode:c,modes:e}=bt(),{COLORS:l,isGameOver:h,isSuccess:f,flagCount:p,initialize:O,meta:C,game:y,withController:M,time:w}=xt(c),{t:$}=ce();function X(x){return x===1?"text-blue-700":x===2?"text-green-700":x===3?"text-red-700":x===4?"text-purple-700":x===5?"text-fuchsia-700":x===6?"text-cyan-600":"text-black"}function E(x){a.push({path:i.path,query:{mode:x}})}return(x,A)=>{const J=Qe,v=Ae,t=We,r=He,b=Re("client-only"),F=be;return u(),_(W,null,[k(s($e),null,{default:K(()=>[o("title",null,N(s($)("minesweeper"))+" | "+N(s($)("jon_ganebskis_blog")),1)]),_:1}),o("div",Ct,[o("h1",Mt,N(s($)("minesweeper")),1),o("div",kt,[k(v,{"model-value":s(c),"option-label-key":"mode",label:s($)("mode"),class:"w-72","onUpdate:modelValue":E},{default:K(()=>[(u(!0),_(W,null,P(s(e),g=>(u(),Z(J,{key:g.id,value:g.id,label:g.mode},null,8,["value","label"]))),128))]),_:1},8,["model-value","label"])]),k(b,null,{default:K(()=>[0<s(C).rows&&0<s(C).cols?(u(),_("div",{key:0,class:"mt-20 flex flex-col items-center justify-center game",onContextmenu:A[1]||(A[1]=I(()=>{},["prevent"]))},[o("div",{class:"p-2 relief",style:Se({backgroundColor:s(l).surfaceDark})},[o("div",$t,[o("div",Ft,[o("span",Rt,N((s(C).totalMines-s(p)).toString().padStart(3,"0")),1)]),o("div",St,[o("button",{class:"node-btn relief player w-10 h-10","data-isGameOver":s(h),"aria-label":"Click to restart the game",onClick:A[0]||(A[0]=(...g)=>s(O)&&s(O)(...g))},N(s(h)&&s(f)?"\u{1F60E}":s(h)&&!s(f)?"\u{1F480}":""),9,Ot)]),o("div",At,[o("span",Qt,N(Math.round(s(w)/1e3).toString().padStart(3,"0")),1)])]),o("div",Vt,[(u(!0),_(W,null,P(s(y),(g,R)=>(u(),_("div",{key:R,class:"row"},[(u(!0),_(W,null,P(g,(m,S)=>(u(),_("button",{key:S,class:re(["node-btn",[m.isVeiled&&"relief"]]),"data-isExploded":m.isExploded,onContextmenu:I(()=>s(M)(()=>m.onRightClick()),["prevent"]),onDblclick:I(()=>s(M)(()=>m.onDoubleClick()),["prevent"]),onClick:I(()=>s(M)(()=>m.onLeftClick()),["prevent"])},[m.isVeiled?Q("",!0):(u(),_("span",{key:0,class:re(["font-extrabold",[X(m.hint)]])},N(m.hint===0?"":m.hint),3)),m.isExploded?(u(),_("span",zt,"\u{1F4A3}")):Q("",!0),m.isFlagged?(u(),Z(t,{key:2})):Q("",!0),m.isQuestion?(u(),Z(r,{key:3})):Q("",!0)],42,Et))),128))]))),128))])],4),s(d)?Q("",!0):(u(),_("div",qt,N(s($)("games_auth_warning")),1))],32)):Q("",!0)]),_:1}),k(gt,{"selected-mode":s(c)},null,8,["selected-mode"]),k(F)])],64)}}});var jt=ye(Lt,[["__scopeId","data-v-6e132ab9"]]);export{jt as default};
