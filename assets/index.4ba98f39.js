var ve=Object.defineProperty,_e=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var ae=(s,a,n)=>a in s?ve(s,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[a]=n,ne=(s,a)=>{for(var n in a||(a={}))pe.call(a,n)&&ae(s,n,a[n]);if(ie)for(var n of ie(a))we.call(a,n)&&ae(s,n,a[n]);return s},oe=(s,a)=>_e(s,ge(a));import{y as de,z as re,A as $,O as me,B as Ne,C as xe,D as Ce,E as ye,u as te,r as O,G as be,p as ee,I as ue,g as fe,J as he,K as le,_ as ke,d as Me,c as w,b as S,w as Y,e as i,H as Fe,f as _,t as k,F as J,j as Se,k as Oe,h as p,i as Z,s as Ee,L as K,n as Qe,M as ce,N as I,l as Re}from"./app.cf751ca1.js";import{_ as Ve,a as Ae}from"./option.bbba4387.js";import{_ as qe,a as Le}from"./records.03b3f3c8.js";function De(s){return de(re(["mine-sweeper-records",s]),async()=>s.value?(await $.from("mine-sweeper-records").select("*, user: user_id (user_name, avatar_url)").eq("mode_id",s.value).order("score",{ascending:!0}).limit(100)).data:null,re({enabled:!!s,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:me,retry:!1}))}function Ge(){const s=xe(),{data:a}=Ce();return Ne(async({modeId:n,score:r})=>{if(!a.value)return null;const{data:d}=await $.from("mine-sweeper-records").select("*").eq("user_id",a.value.id).eq("mode_id",n).order("score",{ascending:!0});if(!d)return null;switch(d.length<=10){case!0:return(await $.from("mine-sweeper-records").insert({mode_id:n,score:r,user_id:a.value.id}).single()).data;case!1:{const g=d[d.length-1];return g.score<r?null:(await $.from("mine-sweeper-records").update({id:g.id,score:r}).single()).data}}},{onSuccess:n=>{if(!a.value)return;const{user_name:r=a.value.email,avatar_url:d=""}=a.value.user_metadata;if(!n)return;const g=s.getQueryData(["mine-sweeper-records",n.mode_id]);!g||s.setQueryData(["mine-sweeper-records",n.mode_id],()=>[...g,oe(ne({},n),{user:{user_name:r,avatar_url:d}})].sort((h,t)=>h.score-t.score))}})}function Te(s){class a{constructor(e){this.isExploded=!1,this.isQuestion=!1,this.isFlagged=!1,this.isVeiled=!0,this.isMine=!1,this.hint=0,this.rowNum=e.rowNum,this.colNum=e.colNum}increaseHint(){this.hint+=1}around(e){var o,c,y,u,b,V,A,q,L,D,G,T,j,H,z,B;(c=(o=t.value[this.rowNum-1])==null?void 0:o[this.colNum])==null||c[e](),(u=(y=t.value[this.rowNum-1])==null?void 0:y[this.colNum+1])==null||u[e](),(V=(b=t.value[this.rowNum])==null?void 0:b[this.colNum+1])==null||V[e](),(q=(A=t.value[this.rowNum+1])==null?void 0:A[this.colNum+1])==null||q[e](),(D=(L=t.value[this.rowNum+1])==null?void 0:L[this.colNum])==null||D[e](),(T=(G=t.value[this.rowNum+1])==null?void 0:G[this.colNum-1])==null||T[e](),(H=(j=t.value[this.rowNum])==null?void 0:j[this.colNum-1])==null||H[e](),(B=(z=t.value[this.rowNum-1])==null?void 0:z[this.colNum-1])==null||B[e]()}countAround(e){var c,y,u,b,V,A,q,L,D,G,T,j,H,z,B,se;let o=0;return(y=(c=t.value[this.rowNum-1])==null?void 0:c[this.colNum])!=null&&y[e]&&o++,(b=(u=t.value[this.rowNum-1])==null?void 0:u[this.colNum+1])!=null&&b[e]&&o++,(A=(V=t.value[this.rowNum])==null?void 0:V[this.colNum+1])!=null&&A[e]&&o++,(L=(q=t.value[this.rowNum+1])==null?void 0:q[this.colNum+1])!=null&&L[e]&&o++,(G=(D=t.value[this.rowNum+1])==null?void 0:D[this.colNum])!=null&&G[e]&&o++,(j=(T=t.value[this.rowNum+1])==null?void 0:T[this.colNum-1])!=null&&j[e]&&o++,(z=(H=t.value[this.rowNum])==null?void 0:H[this.colNum-1])!=null&&z[e]&&o++,(se=(B=t.value[this.rowNum-1])==null?void 0:B[this.colNum-1])!=null&&se[e]&&o++,o}unveil(){if(!!this.isVeiled&&!this.isFlagged){if(this.isMine){R({isSuccess:!1});return}this.isVeiled=!1,this.hint===0&&this.around("unveil")}}onLeftClick(){this.isFlagged||this.isQuestion||this.unveil()}onDoubleClick(){this.isVeiled||this.countAround("isFlagged")!==this.hint||this.around("unveil")}onRightClick(){if(!!this.isVeiled){if(this.isFlagged){m.value-=1,this.isFlagged=!1,this.isQuestion=!0;return}if(this.isQuestion){this.isFlagged=!1,this.isQuestion=!1;return}m.value+=1,this.isFlagged=!0,this.isQuestion=!1}}}const n=1e3*999,r={surfaceLight:"#c6c6c6",surfaceDark:"#C0C0C0",shadow:"#808080"},d=Ge(),{openIssueModal:g}=ye(),{t:h}=te(),t=O([]),m=O(0),x=O(!1),E=O(!1),N=O(null),{timestamp:C,pause:U,resume:Q}=be({immediate:!1,controls:!0}),M=ee(()=>N.value?C.value-N.value:0);ue(M,()=>{M.value<n||R({isSuccess:!1})});const v=ee(()=>s.value===3?{totalMines:99,rows:16,cols:30}:s.value===2?{totalMines:40,rows:16,cols:16}:s.value===1?{totalMines:10,rows:9,cols:9}:{totalMines:0,rows:0,cols:0});ue(()=>s.value,()=>W(),{immediate:!0});function W(){U(),N.value=null,x.value=!1,E.value=!1,m.value=0,t.value=[];for(let e=0;e<v.value.rows;e++){const o=[];for(let c=0;c<v.value.cols;c++)o.push(new a({rowNum:e,colNum:c}));t.value.push(o)}let l=0;for(;l<v.value.totalMines;){const e=Math.round(Math.random()*(v.value.rows-1)),o=Math.round(Math.random()*(v.value.cols-1));t.value[e][o].isMine||(t.value[e][o].isMine=!0,t.value[e][o].around("increaseHint"),l++)}}function X(){N.value=new Date().getTime(),Q()}function R(l){if(U(),x.value=!0,E.value=l.isSuccess,!l.isSuccess)return F();!s.value||d.mutate({modeId:s.value,score:M.value},{onSuccess:()=>{const e=h("congratulations")+"!";window.alert(e)},onError:()=>g({title:h("record_mutation_failed.title"),content:h("record_mutation_failed.content")})})}function f(l){x.value||(N.value||X(),l(),v.value.totalMines===m.value&&P()&&R({isSuccess:!0}))}function F(){t.value.forEach(l=>{l.forEach(e=>{e.isFlagged||!e.isMine||(e.isExploded=!0)})})}function P(){for(let l=0;l<t.value.length;l++)for(let e=0;e<t.value[l].length;e++){const o=t.value[l][e];if(!(o.isMine&&o.isFlagged)&&!!o.isVeiled)return!1}return!0}return{withController:f,initialize:W,isGameOver:x,flagCount:m,isSuccess:E,COLORS:r,game:t,meta:v,time:M}}function je(s){return de([s],async()=>(await $.from(s).select("id, mode")).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:me,retry:!1})}function He(){const{t:s}=te(),{data:a}=je("mine-sweeper-modes"),n=fe(),r=he(),d=ee(()=>{var h;return(h=a.value)==null?void 0:h.map(({id:t,mode:m})=>({id:t,mode:s(m==="expert"?"expert":m==="intermediate"?"intermediate":"beginner")}))}),g=O(r.query.mode?Number(r.query.mode):1);return le(()=>{if(!d.value)return;const h=r.query.mode?Number(r.query.mode):1;if(!d.value.find(({id:m})=>m===h))return n.replace({path:r.path});g.value=h}),le(()=>Array.isArray(r.query.mode)&&n.replace({path:r.path})),{selectedMode:g,modes:d}}const ze={class:"mt-20 min-h-screen grid place-items-center text-dark-500 dark:text-light-500"},Be={class:"text-3xl md:text-5xl"},Ie={class:"mt-10 flex justify-center"},$e={class:"p-2 grid grid-cols-3 intaglio"},Ue={class:"flex"},We={class:"counter"},Je={class:"flex items-center justify-center"},Ke=["data-isGameOver"],Xe={class:"flex justify-end"},Pe={class:"counter"},Ye={class:"rows-container intaglio"},Ze=["data-isExploded","onContextmenu","onDblclick","onClick"],et={key:1},tt={key:2},st={key:3},it=Me({setup(s){Se(f=>({"612f73e0":i(C).rows,"4ab2ee4c":i(t).shadow,"613d19ac":i(C).cols,e3d5bed6:i(t).surfaceLight}));const a=fe(),n=he(),{selectedMode:r,modes:d}=He(),{data:g,isLoading:h}=De(r),{COLORS:t,isGameOver:m,isSuccess:x,flagCount:E,initialize:N,meta:C,game:U,withController:Q,time:M}=Te(r),{t:v}=te();function W(f){return f===1?"text-blue-700":f===2?"text-green-700":f===3?"text-red-700":f===4?"text-purple-700":f===5?"text-fuchsia-700":f===6?"text-cyan-600":"text-black"}function X(f){a.push({path:n.path,query:{mode:f}})}function R(f){return(f/1e3).toFixed(2)+" "+v("abbr.seconds")}return(f,F)=>{const P=Ae,l=Ve,e=Oe("client-only"),o=Re;return p(),w(J,null,[S(i(Fe),null,{default:Y(()=>[_("title",null,k(i(v)("minesweeper"))+" | "+k(i(v)("jon_ganebskis_blog")),1)]),_:1}),_("div",ze,[_("h1",Be,k(i(v)("minesweeper")),1),_("div",Ie,[S(l,{"model-value":i(r),"option-label-key":"mode",label:i(v)("mode"),class:"w-72","onUpdate:modelValue":X},{default:Y(()=>[(p(!0),w(J,null,Z(i(d),c=>(p(),Ee(P,{key:c.id,value:c.id,label:c.mode},null,8,["value","label"]))),128))]),_:1},8,["model-value","label"])]),S(e,null,{default:Y(()=>[0<i(C).rows&&0<i(C).cols?(p(),w("div",{key:0,class:"mt-20 flex flex-col items-center justify-center game",onContextmenu:F[1]||(F[1]=K(()=>{},["prevent"]))},[_("div",{class:"p-2 relief",style:Qe({backgroundColor:i(t).surfaceDark})},[_("div",$e,[_("div",Ue,[_("span",We,k((i(C).totalMines-i(E)).toString().padStart(3,"0")),1)]),_("div",Je,[_("button",{class:"node-btn relief player w-10 h-10","data-isGameOver":i(m),"aria-label":"Click to restart the game",onClick:F[0]||(F[0]=(...c)=>i(N)&&i(N)(...c))},k(i(m)&&i(x)?"\u{1F60E}":i(m)&&!i(x)?"\u{1F480}":""),9,Ke)]),_("div",Xe,[_("span",Pe,k(Math.round(i(M)/1e3).toString().padStart(3,"0")),1)])]),_("div",Ye,[(p(!0),w(J,null,Z(i(U),(c,y)=>(p(),w("div",{key:y,class:"row"},[(p(!0),w(J,null,Z(c,(u,b)=>(p(),w("button",{key:b,class:ce(["node-btn",[u.isVeiled&&"relief"]]),"data-isExploded":u.isExploded,onContextmenu:K(()=>i(Q)(()=>u.onRightClick()),["prevent"]),onDblclick:K(()=>i(Q)(()=>u.onDoubleClick()),["prevent"]),onClick:K(()=>i(Q)(()=>u.onLeftClick()),["prevent"])},[u.isVeiled?I("",!0):(p(),w("span",{key:0,class:ce(["font-extrabold",[W(u.hint)]])},k(u.hint===0?"":u.hint),3)),u.isExploded?(p(),w("span",et,"\u{1F4A3}")):I("",!0),u.isFlagged?(p(),w("span",tt,"\u{1F6A9}")):I("",!0),u.isQuestion?(p(),w("span",st,"\u2753")):I("",!0)],42,Ze))),128))]))),128))])],4),S(Le,{class:"mt-2"})],32)):I("",!0)]),_:1}),S(qe,{"is-loading":i(h),data:i(g),formatter:R},null,8,["is-loading","data"]),S(o)])],64)}}});var ut=ke(it,[["__scopeId","data-v-1d9bf3c6"]]);export{ut as default};
