var Pe=Object.defineProperty,Ve=Object.defineProperties;var Fe=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;var be=(e,n,r)=>n in e?Pe(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,U=(e,n)=>{for(var r in n||(n={}))ze.call(n,r)&&be(e,r,n[r]);if(Se)for(var r of Se(n))He.call(n,r)&&be(e,r,n[r]);return e},Le=(e,n)=>Ve(e,Fe(n));import{y as Ze,O as Ge,A as re,h as g,c as b,g as S,_ as K,d as W,u as se,t as M,f as c,e as C,x as J,r as R,p as Q,I as we,a8 as Te,a9 as ye,j as Ye,ad as j,b as Re,o as Je,M as Z,n as he,N as A,ab as je,Q as De,X as We,F as P,i as V,B as Xe,C as Ue,D as Qe,E as qe,ae as Ke,s as ve,w as Ne,k as et,l as tt}from"./app.881a6103.js";import{_ as ot,a as nt}from"./records.fef67989.js";function lt(){return Ze("tetris-records",async()=>(await re.from("tetris-records").select("*, user: user_id (user_name, avatar_url)").order("score",{ascending:!1}).limit(100)).data,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:Ge,retry:!1})}const rt={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},it=S("path",{fill:"currentColor",d:"M24.59 16.59L17 24.17V4h-2v20.17l-7.59-7.58L6 18l10 10l10-10l-1.41-1.41z"},null,-1),at=[it];function st(e,n){return g(),b("svg",rt,at)}var ut={name:"carbon-arrow-down",render:st};const ct={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},ft=S("path",{fill:"currentColor",d:"M16 4L6 14l1.41 1.41L15 7.83V28h2V7.83l7.59 7.58L26 14L16 4z"},null,-1),dt=[ft];function vt(e,n){return g(),b("svg",ct,dt)}var _t={name:"carbon-arrow-up",render:vt};const ht={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},mt=S("path",{fill:"currentColor",d:"m18 6l-1.43 1.393L24.15 15H4v2h20.15l-7.58 7.573L18 26l10-10L18 6z"},null,-1),pt=[mt];function gt(e,n){return g(),b("svg",ht,pt)}var xe={name:"carbon-arrow-right",render:gt};const St={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},bt=S("path",{fill:"currentColor",d:"m14 26l1.41-1.41L7.83 17H28v-2H7.83l7.58-7.59L14 6L4 16l10 10z"},null,-1),Lt=[bt];function It(e,n){return g(),b("svg",St,Lt)}var Oe={name:"carbon-arrow-left",render:It};const wt={class:"h-0 opacity-0"},Tt={class:"grid gap-2"},yt=["aria-label"],Rt=["aria-label"],xt=["aria-label"],Ot=["aria-label"],kt=["aria-label"],Mt=W({setup(e){const{t:n}=se();return(r,v)=>{const d=Oe,p=xe,_=_t,m=ut;return g(),b("div",null,[S("h6",wt,M(c(n)("keyboard_guide")),1),S("ul",Tt,[S("li",null,[S("div",{"aria-label":c(n)("arrow_left_key")},[C(d)],8,yt),J(" : "+M(c(n)("move_block_left")),1)]),S("li",null,[S("div",{"aria-label":c(n)("arrow_right_key")},[C(p)],8,Rt),J(" : "+M(c(n)("move_block_right")),1)]),S("li",null,[S("div",{"aria-label":c(n)("arrow_up_key")},[C(_)],8,xt),J(" : "+M(c(n)("rotate_block")),1)]),S("li",null,[S("div",{"aria-label":c(n)("arrow_down_key")},[C(m)],8,Ot),J(" : "+M(c(n)("move_block_downwards")),1)]),S("li",null,[S("div",{"aria-label":c(n)("space_bar_key"),class:"px-1"},M(c(n)("space_bar")),9,kt),J(" : "+M(c(n)("drop_block")),1)])])])}}});var Ct=K(Mt,[["__scopeId","data-v-475f4e67"]]);const ke=R("READY"),ue=R(!1),ce=R(0),me=R(0),pe=Q(()=>Math.floor(ce.value/10)+1);we(pe,()=>{ge.value=fe()});const ge=R(fe());function fe(){return Math.max(50,500-(pe.value-1)*(ue.value?50:30))}function $t(){ce.value=0,ge.value=fe(),ue.value=!1,me.value=0,ke.value="READY"}function At(e){let n=0;ce.value+=e,e===1?n=40:e===2?n=100:e===3?n=300:n=1200,ue.value,me.value+=n}function N(){return{destroyedRawsCount:ce,setTimeoutMs:ge,gameStatus:ke,isCatHere:ue,level:pe,score:me,computeSetTimeoutMs:fe,resetGameInfo:$t,increaseScore:At}}const{sm:Et,md:Bt}=Te(ye),Pt=Q(()=>Bt.value?32:Et.value?24:20);function Me(){return{nodeSize:Pt}}const Vt={class:"relative flex items-center"},Ft=W({props:{position:null,left:null},setup(e){const n=e;Ye(u=>({"654d2619":y.value,"654d2618":T.value}));const r="111-1-1-11111111",{isCatHere:v,gameStatus:d,level:p}=N(),{nodeSize:_}=Me();j(["ArrowUp","ArrowDown"],I);let m="",h,L;Re(()=>{clearInterval(L),clearTimeout(h)}),we(d,()=>{d.value!=="PLAYING"&&(clearInterval(L),clearTimeout(h))});function I(u){if(u.preventDefault(),d.value==="READY"&&!v.value){if(clearTimeout(h),m+=u.key==="ArrowUp"?1:-1,m!==r)return h=setTimeout(()=>m="",1e3);v.value=!0,s()}}const w=R(!1),T=R("0rem"),y=R("0rem");Je(()=>{T.value="0rem",y.value="0rem"});function o(){T.value=Math.floor((n.position.value[2][1]+1)*_.value+n.left)+"px",y.value=n.position.value[2][0]*_.value+"px"}function s(){L=setInterval(()=>{d.value==="PLAYING"&&(o(),w.value=!0,p.value>2&&setTimeout(o,2e3),p.value>4&&setTimeout(o,2500))},15e3)}return(u,l)=>(g(),b("div",Vt,[c(v)?(g(),b("img",{key:0,src:"https://ijivzwfsihdcvwrntdpe.supabase.co/storage/v1/object/public/tetris-images/paw.png",alt:"",class:Z(["absolute right-full z-10 opacity-0 filter brightness-75",{paw__active:w.value}]),style:he({width:`${c(_)*22}px`}),onAnimationend:l[0]||(l[0]=f=>w.value=!1)},null,38)):A("",!0)]))}});var zt=K(Ft,[["__scopeId","data-v-c7cb5d9a"]]);const Ht={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Zt=S("path",{fill:"currentColor",d:"M28 30H16a2.002 2.002 0 0 1-2-2V16a2.002 2.002 0 0 1 2-2h12a2.002 2.002 0 0 1 2 2v12a2.002 2.002 0 0 1-2 2zM16 16v12h12.001L28 16zM15 2l-1.41 1.41L16.17 6H11a7.008 7.008 0 0 0-7 7v5h2v-5a5.006 5.006 0 0 1 5-5h5.17l-2.58 2.59L15 12l5-5z"},null,-1),Gt=[Zt];function Yt(e,n){return g(),b("svg",Ht,Gt)}var Jt={name:"carbon-rotate-clockwise",render:Yt};const jt={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 32 32"},Dt=S("path",{fill:"currentColor",d:"M23 6v10h5a1 1 0 0 1 .707 1.707l-12 12a1 1 0 0 1-1.414 0l-12-12A1 1 0 0 1 4 16h5V6a2.002 2.002 0 0 1 2-2h10a2.003 2.003 0 0 1 2 2Zm-7 21.586L25.586 18H21V6H11v12H6.414Z"},null,-1),Wt=[Dt];function Xt(e,n){return g(),b("svg",jt,Wt)}var Ut={name:"carbon-arrow-shift-down",render:Xt};const Qt=["aria-label"],qt=["aria-label"],Kt=["aria-label"],Nt=["aria-label"],eo=W({emits:["onTouchArrowRightBtn","onTouchArrowLeftBtn","onTouchArrowDownBtn","onTouchRotateBtn"],setup(e,{emit:n}){const{t:r}=se();return(v,d)=>{const p=Oe,_=xe,m=Ut,h=Jt;return g(),b("div",null,[S("button",{class:"fixed bottom-5 left-5 horizontal-btn","aria-label":c(r)("move_block_left"),onClick:d[0]||(d[0]=L=>n("onTouchArrowLeftBtn",L))},[C(p)],8,Qt),S("button",{class:"fixed bottom-5 right-5 horizontal-btn","aria-label":c(r)("move_block_right"),onClick:d[1]||(d[1]=L=>n("onTouchArrowRightBtn",L))},[C(_)],8,qt),S("button",{class:"fixed bottom-5 left-1/2 transform -translate-x-1/2 horizontal-btn","aria-label":c(r)("move_block_downwards"),onClick:d[2]||(d[2]=L=>n("onTouchArrowDownBtn",L))},[C(m)],8,Kt),S("button",{class:"fixed bottom-25 right-5 horizontal-btn","aria-label":c(r)("rotate_block"),onClick:d[3]||(d[3]=L=>n("onTouchRotateBtn",L))},[C(h)],8,Nt)])}}});var to=K(eo,[["__scopeId","data-v-9a6d88ee"]]),a=(e=>(e[e.WALL=0]="WALL",e[e.BIRTH=1]="BIRTH",e[e.VOID=2]="VOID",e[e.FOSSIL_I=3]="FOSSIL_I",e[e.FOSSIL_J=4]="FOSSIL_J",e[e.FOSSIL_L=5]="FOSSIL_L",e[e.FOSSIL_O=6]="FOSSIL_O",e[e.FOSSIL_S=7]="FOSSIL_S",e[e.FOSSIL_T=8]="FOSSIL_T",e[e.FOSSIL_Z=9]="FOSSIL_Z",e[e.I=10]="I",e[e.J=11]="J",e[e.L=12]="L",e[e.O=13]="O",e[e.S=14]="S",e[e.T=15]="T",e[e.Z=16]="Z",e))(a||{});const{increaseScore:oo}=N(),ie=4,D=12,_e=28,x=R(Ce());function Ce(){return Array.from({length:_e},(e,n)=>n===_e-1?Array.from({length:D},()=>a.WALL):Array.from({length:D},(r,v)=>v===0||v===D-1?a.WALL:n<=ie-1?a.BIRTH:a.VOID))}const ee=R(q()),ae=R(q());function q(){return je(1,[a.I,a.J,a.L,a.O,a.S,a.Z,a.T])[0]}function no(){ee.value=ae.value,ae.value=q()}function lo(){ee.value=q(),ae.value=q(),x.value=Ce()}function ro(e){for(let n=0;n<e.length;n++){const[r,v]=e[n];if(x.value[r][v]!==a.VOID&&x.value[r][v]!==a.BIRTH&&x.value[r][v]!==ee.value)return!0}return!1}function io([e,n]){switch(ee.value){case a.I:x.value[e][n]=a.FOSSIL_I;break;case a.J:x.value[e][n]=a.FOSSIL_J;break;case a.L:x.value[e][n]=a.FOSSIL_L;break;case a.O:x.value[e][n]=a.FOSSIL_O;break;case a.S:x.value[e][n]=a.FOSSIL_S;break;case a.T:x.value[e][n]=a.FOSSIL_T;break;case a.Z:x.value[e][n]=a.FOSSIL_Z;break}}function ao(){const e=[];x.value.forEach((n,r)=>{n.every(v=>v===a.WALL)||n.every(v=>v===a.FOSSIL_I||v===a.FOSSIL_J||v===a.FOSSIL_L||v===a.FOSSIL_O||v===a.FOSSIL_S||v===a.FOSSIL_T||v===a.FOSSIL_Z||v===a.WALL)&&e.push(r)}),e.length!==0&&(oo(e.length),x.value=x.value.filter((n,r)=>!e.includes(r)),x.value=[...x.value.slice(0,ie),...e.map(()=>Array.from({length:D},(n,r)=>r===0||r===D-1?a.WALL:a.VOID)),...x.value.slice(ie)])}function E(){return{TOP_RESERVE:ie,currNode:ee,nextNode:ae,X_SIZE:D,Y_SIZE:_e,nodes:x,resetUseNodes:lo,willCollide:ro,removeNodes:ao,switchNode:no,fossilize:io}}const so={class:"relative w-20 md:w-28 h-20 md:h-28 flex items-center justify-center bg-gray-900 border border-gray-600 rounded-md"},uo={key:0},co={class:"absolute top-0 left-0 w-full h-full object-cover object-left",src:"https://ijivzwfsihdcvwrntdpe.supabase.co/storage/v1/object/public/tetris-images/cat-stare.webp",width:"80",height:"80",alt:""},fo={key:0,class:"grid gap-px"},vo={key:1,class:"grid gap-px grid-cols-2"},_o={key:2,class:"grid gap-px grid-cols-2"},ho={key:3,class:"grid gap-px grid-cols-2"},mo={key:4,class:"grid gap-px grid-cols-3"},po={key:5,class:"grid gap-px grid-cols-3"},go={key:6,class:"grid gap-px grid-cols-3"},So=W({setup(e){const{nextNode:n}=E(),{destroyedRawsCount:r,gameStatus:v,isCatHere:d}=N(),p=Q(()=>{if(!d.value)return!1;const _=r.value%10;return _===1||_===5});return(_,m)=>(g(),b("div",so,[c(v)==="PLAYING"?(g(),b("div",uo,[De(S("img",co,null,512),[[We,c(p)]]),c(n)===c(a).I?(g(),b("div",fo,[(g(),b(P,null,V(4,h=>S("div",{key:h,class:"node-size tetromino-border border-color__tetromino__I"})),64))])):A("",!0),c(n)===c(a).J?(g(),b("div",vo,[(g(),b(P,null,V(6,h=>S("div",{key:h,class:Z(["node-size",{"border-color__tetromino__J tetromino-border":h===5||h%2===0}])},null,2)),64))])):A("",!0),c(n)===c(a).L?(g(),b("div",_o,[(g(),b(P,null,V(6,h=>S("div",{key:h,class:Z(["node-size",{"border-color__tetromino__L tetromino-border":h===6||h%2===1}])},null,2)),64))])):A("",!0),c(n)===c(a).O?(g(),b("div",ho,[(g(),b(P,null,V(4,h=>S("div",{key:h,class:"border-color__tetromino__O node-size tetromino-border"})),64))])):A("",!0),c(n)===c(a).S?(g(),b("div",mo,[(g(),b(P,null,V(6,h=>S("div",{key:h,class:Z(["node-size",{"border-color__tetromino__S tetromino-border":[2,3,4,5].includes(h)}])},null,2)),64))])):A("",!0),c(n)===c(a).T?(g(),b("div",po,[(g(),b(P,null,V(6,h=>S("div",{key:h,class:Z(["node-size",{"border-color__tetromino__T tetromino-border":[2,4,5,6].includes(h)}])},null,2)),64))])):A("",!0),c(n)===c(a).Z?(g(),b("div",go,[(g(),b(P,null,V(6,h=>S("div",{key:h,class:Z(["node-size",{"border-color__tetromino__Z tetromino-border":[1,2,5,6].includes(h)}])},null,2)),64))])):A("",!0)])):A("",!0)]))}});var bo=K(So,[["__scopeId","data-v-43e46289"]]);const Lo=W({props:{rowIdx:null,colIdx:null,node:null,isCatHere:{type:Boolean},isGuide:{type:Boolean}},setup(e){const{TOP_RESERVE:n}=E(),{nodeSize:r}=Me();return(v,d)=>(g(),b("div",{class:Z(["bg-gray-900",[e.node===c(a).VOID?e.isGuide&&!e.isCatHere?"border-color__guide":"":e.node===c(a).I||e.node===c(a).FOSSIL_I?"border-color__tetromino__I":e.node===c(a).J||e.node===c(a).FOSSIL_J?"border-color__tetromino__J":e.node===c(a).L||e.node===c(a).FOSSIL_L?"border-color__tetromino__L":e.node===c(a).O||e.node===c(a).FOSSIL_O?"border-color__tetromino__O":e.node===c(a).S||e.node===c(a).FOSSIL_S?"border-color__tetromino__S":e.node===c(a).T||e.node===c(a).FOSSIL_T?"border-color__tetromino__T":e.node===c(a).Z||e.node===c(a).FOSSIL_Z?"border-color__tetromino__Z":""]]),style:he(U(U({},e.node===c(a).WALL||e.rowIdx<c(n)?{display:"none"}:{width:`${c(r)}px`,height:`${c(r)}px`}),e.node===c(a).VOID?e.isGuide&&!e.isCatHere?{borderWidth:"1px"}:{}:{borderWidth:`${c(r)/2}px`}))},null,6))}});var Io=K(Lo,[["__scopeId","data-v-f8ddccd4"]]);function Ie(e){return[[...e[0]],[...e[1]],[...e[2]],[...e[3]]]}function G(e,n){const{nodes:r,currNode:v,TOP_RESERVE:d,willCollide:p,fossilize:_}=E(),m=R(Ie(e)),h=Q(()=>m.value.map(([s,u])=>[s+1,u])),L=Q(I);function I(){let s=!1,u=0;for(;!s;){u++;for(let l=0;l<m.value.length;l++){const[f,i]=m.value[l];if(!(r.value[f+u][i]===a.BIRTH||r.value[f+u][i]===a.VOID||r.value[f+u][i]===v.value)){s=!0;break}}}return m.value.map(([l,f])=>[l+u-1,f])}function w(){n.value=0,m.value=Ie(e),m.value.forEach(([s,u])=>r.value[s][u]=v.value)}function T(){let s=!1;for(let u=0;u<h.value.length;u++){const[l,f]=h.value[u];if(!(r.value[l][f]===a.BIRTH||r.value[l][f]===a.VOID||r.value[l][f]===v.value)){s=!0;break}}return s?(m.value.forEach(_),!1):(m.value.forEach(([u,l])=>{r.value[u][l]=u<=d-1?a.BIRTH:a.VOID}),h.value.forEach(([u,l])=>{r.value[u][l]=v.value}),m.value=h.value,!0)}function y(){const s=m.value.map(([u,l])=>[u,l+1]);p(s)||(m.value.forEach(([u,l],f)=>{r.value[u][l]=u<=d-1?a.BIRTH:a.VOID,m.value[f]=[u,l+1]}),m.value.forEach(([u,l])=>{r.value[u][l]=v.value}))}function o(){const s=m.value.map(([u,l])=>[u,l-1]);p(s)||(m.value.forEach(([u,l],f)=>{r.value[u][l]=u<=d-1?a.BIRTH:a.VOID,m.value[f]=[u,l-1]}),m.value.forEach(([u,l])=>{r.value[u][l]=v.value}))}return{position:m,nextPosition:h,endPosition:L,prepare:w,fall:T,moveRight:y,moveLeft:o}}function wo(){const e=R(0),{nodes:n,TOP_RESERVE:r,willCollide:v,X_SIZE:d}=E(),p=Object.freeze([[r-2,Math.floor(d/2)],[r-3,Math.floor(d/2)],[r-4,Math.floor(d/2)],[r-1,Math.floor(d/2)]]),{position:_,nextPosition:m,endPosition:h,prepare:L,fall:I,moveRight:w,moveLeft:T}=G(p,e);function y(){let o=0,s=[..._.value];for(;o===0||v(s);){e.value===0?s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0],t[0][1]-1+o]:i===2?[t[0][0],t[0][1]-2+o]:[t[0][0],t[0][1]+1+o]):e.value===1?s=s.map(([l,f],i,t)=>i===0?[t[1][0]-1,t[1][1]+o]:i===1?[l,f+o]:i===2?[t[1][0]+1,t[1][1]+o]:[t[1][0]-2,t[1][1]+o]):e.value===2?s=s.map(([l,f],i,t)=>i===0?[t[1][0],t[1][1]+1+o]:i===1?[l,f+o]:i===2?[t[1][0],t[1][1]-1+o]:[t[1][0],t[1][1]+2+o]):s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0]-1,t[0][1]+o]:i===2?[t[0][0]-2,t[0][1]+o]:[t[0][0]+1,t[0][1]+o]);const u=o>0?1:-1;if(o=-(o+u),o>10)return}_.value.forEach(([u,l])=>{n.value[u][l]=u<=r-1?a.BIRTH:a.VOID}),_.value=[...s],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,_.value.forEach(([u,l])=>{n.value[u][l]=a.I})}return{defaultPosition:p,nextPosition:m,endPosition:h,position:_,shape:e,id:a.I,changeShape:y,moveRight:w,moveLeft:T,prepare:L,fall:I}}function To(){const e=R(0),{nodes:n,TOP_RESERVE:r,willCollide:v,X_SIZE:d}=E(),p=Object.freeze([[r-3,Math.floor(d/2)],[r-2,Math.floor(d/2)],[r-1,Math.floor(d/2)],[r-1,Math.floor(d/2)-1]]),{position:_,nextPosition:m,endPosition:h,prepare:L,fall:I,moveLeft:w,moveRight:T}=G(p,e);function y(){let o=0,s=[..._.value];for(;o===0||v(s);){e.value===0?s=s.map(([l,f],i,t)=>i===0?[t[1][0],t[1][1]+1+o]:i===1?[l,f+o]:i===2?[t[1][0],t[1][1]-1+o]:[t[1][0]-1,t[1][1]-1+o]):e.value===1?s=s.map(([l,f],i,t)=>i===0?[t[1][0]+1,t[1][1]+o]:i===1?[l,f+o]:i===2?[t[1][0]-1,t[1][1]+o]:[t[1][0]-1,t[1][1]+1+o]):e.value===2?s=s.map(([l,f],i,t)=>i===0?[t[1][0],t[1][1]-1+o]:i===1?[l,f+o]:i===2?[t[1][0],t[1][1]+1+o]:[t[1][0]+1,t[1][1]+1+o]):s=s.map(([l,f],i,t)=>i===0?[t[1][0]-1,t[1][1]+o]:i===1?[l,f+o]:i===2?[t[1][0]+1,t[1][1]+o]:[t[1][0]+1,t[1][1]-1+o]);const u=o>0?1:-1;if(o=-(o+u),o>10)return}_.value.forEach(([u,l])=>{n.value[u][l]=u<=r-1?a.BIRTH:a.VOID}),_.value=[...s],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,_.value.forEach(([u,l])=>{n.value[u][l]=a.J})}return{defaultPosition:p,nextPosition:m,endPosition:h,position:_,shape:e,id:a.J,changeShape:y,moveRight:T,moveLeft:w,prepare:L,fall:I}}function yo(){const e=R(0),{nodes:n,TOP_RESERVE:r,willCollide:v,X_SIZE:d}=E(),p=Object.freeze([[r-3,Math.floor(d/2)],[r-2,Math.floor(d/2)],[r-1,Math.floor(d/2)],[r-1,Math.floor(d/2)+1]]),{position:_,nextPosition:m,endPosition:h,prepare:L,fall:I,moveLeft:w,moveRight:T}=G(p,e);function y(){let o=0,s=[..._.value];for(;o===0||v(s);){e.value===0?s=s.map(([l,f],i,t)=>i===0?[t[1][0],t[1][1]-1+o]:i===1?[l,f+o]:i===2?[t[1][0],t[1][1]+1+o]:[t[1][0]-1,t[1][1]+1+o]):e.value===1?s=s.map(([l,f],i,t)=>i===0?[t[1][0]+1,t[1][1]+o]:i===1?[l,f+o]:i===2?[t[1][0]-1,t[1][1]+o]:[t[1][0]-1,t[1][1]-1+o]):e.value===2?s=s.map(([l,f],i,t)=>i===0?[t[1][0],t[1][1]+1+o]:i===1?[l,f+o]:i===2?[t[1][0],t[1][1]-1+o]:[t[1][0]+1,t[1][1]-1+o]):s=s.map(([l,f],i,t)=>i===0?[t[1][0]-1,t[1][1]+o]:i===1?[l,f+o]:i===2?[t[1][0]+1,t[1][1]+o]:[t[1][0]+1,t[1][1]+1+o]);const u=o>0?1:-1;if(o=-(o+u),o>10)return}_.value.forEach(([u,l])=>{n.value[u][l]=u<=r-1?a.BIRTH:a.VOID}),_.value=[...s],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,_.value.forEach(([u,l])=>{n.value[u][l]=a.L})}return{defaultPosition:p,nextPosition:m,endPosition:h,position:_,shape:e,id:a.L,changeShape:y,moveRight:T,moveLeft:w,prepare:L,fall:I}}function Ro(){const e=R(0),{X_SIZE:n,TOP_RESERVE:r}=E(),v=Object.freeze([[r-2,Math.floor(n/2)-1],[r-2,Math.floor(n/2)],[r-1,Math.floor(n/2)-1],[r-1,Math.floor(n/2)]]),{position:d,nextPosition:p,endPosition:_,prepare:m,fall:h,moveLeft:L,moveRight:I}=G(v,e);return{defaultPosition:v,nextPosition:p,endPosition:_,position:d,shape:e,id:a.O,changeShape:()=>{},moveRight:I,moveLeft:L,prepare:m,fall:h}}function xo(){const e=R(0),{nodes:n,TOP_RESERVE:r,willCollide:v,X_SIZE:d}=E(),p=Object.freeze([[r-1,Math.floor(d/2)-1],[r-2,Math.floor(d/2)-1],[r-2,Math.floor(d/2)],[r-1,Math.floor(d/2)-2]]),{position:_,nextPosition:m,endPosition:h,prepare:L,fall:I,moveRight:w,moveLeft:T}=G(p,e);function y(){let o=0,s=[..._.value];for(;o===0||v(s);){e.value===0?s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0],t[0][1]+1+o]:i===2?[t[0][0]+1,t[0][1]+1+o]:[t[0][0]-1,t[0][1]+o]):e.value===1?s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0]+1,t[0][1]+o]:i===2?[t[0][0]+1,t[0][1]-1+o]:[t[0][0],t[0][1]+1+o]):e.value===2?s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0],t[0][1]-1+o]:i===2?[t[0][0]-1,t[0][1]-1+o]:[t[0][0]+1,t[0][1]+o]):s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0]-1,t[0][1]+o]:i===2?[t[0][0]-1,t[0][1]+1+o]:[t[0][0],t[0][1]-1+o]);const u=o>0?1:-1;if(o=-(o+u),o>10)return}_.value.forEach(([u,l])=>{n.value[u][l]=u<=r-1?a.BIRTH:a.VOID}),_.value=[...s],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,_.value.forEach(([u,l])=>{n.value[u][l]=a.S})}return{defaultPosition:p,nextPosition:m,endPosition:h,position:_,shape:e,id:a.S,changeShape:y,moveRight:w,moveLeft:T,prepare:L,fall:I}}function Oo(){const e=R(0),{nodes:n,TOP_RESERVE:r,willCollide:v,X_SIZE:d}=E(),p=Object.freeze([[r-1,Math.floor(d/2)],[r-2,Math.floor(d/2)],[r-1,Math.floor(d/2)-1],[r-1,Math.floor(d/2)+1]]),{position:_,nextPosition:m,endPosition:h,prepare:L,fall:I,moveRight:w,moveLeft:T}=G(p,e);function y(){let o=0,s=[..._.value];for(;o===0||v(s);){e.value===0?s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0],t[0][1]+1+o]:i===2?[t[0][0]-1,t[0][1]+o]:[t[0][0]+1,t[0][1]+o]):e.value===1?s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0]+1,t[0][1]+o]:i===2?[t[0][0],t[0][1]+1+o]:[t[0][0],t[0][1]-1+o]):e.value===2?s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0],t[0][1]-1+o]:i===2?[t[0][0]+1,t[0][1]+o]:[t[0][0]-1,t[0][1]+o]):s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0]-1,t[0][1]+o]:i===2?[t[0][0],t[0][1]-1+o]:[t[0][0],t[0][1]+1+o]);const u=o>0?1:-1;if(o=-(o+u),o>10)return}_.value.forEach(([u,l])=>{n.value[u][l]=u<=r-1?a.BIRTH:a.VOID}),_.value=[...s],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,_.value.forEach(([u,l])=>{n.value[u][l]=a.T})}return{defaultPosition:p,nextPosition:m,endPosition:h,position:_,shape:e,id:a.T,changeShape:y,moveRight:w,moveLeft:T,prepare:L,fall:I}}function ko(){const e=R(0),{nodes:n,TOP_RESERVE:r,willCollide:v,X_SIZE:d}=E(),p=Object.freeze([[r-1,Math.floor(d/2)],[r-2,Math.floor(d/2)],[r-2,Math.floor(d/2)-1],[r-1,Math.floor(d/2)+1]]),{position:_,nextPosition:m,endPosition:h,prepare:L,fall:I,moveRight:w,moveLeft:T}=G(p,e);function y(){let o=0,s=[..._.value];for(;o===0||v(s);){e.value===0?s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0],t[0][1]+1+o]:i===2?[t[0][0]-1,t[0][1]+1+o]:[t[0][0]+1,t[0][1]+o]):e.value===1?s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0]+1,t[0][1]+o]:i===2?[t[0][0]+1,t[0][1]+1+o]:[t[0][0],t[0][1]-1+o]):e.value===2?s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0],t[0][1]-1+o]:i===2?[t[0][0]+1,t[0][1]-1+o]:[t[0][0]-1,t[0][1]+o]):s=s.map(([l,f],i,t)=>i===0?[l,f+o]:i===1?[t[0][0]-1,t[0][1]+o]:i===2?[t[0][0]-1,t[0][1]-1+o]:[t[0][0],t[0][1]+1+o]);const u=o>0?1:-1;if(o=-(o+u),o>10)return}_.value.forEach(([u,l])=>{n.value[u][l]=u<=r-1?a.BIRTH:a.VOID}),_.value=[...s],e.value===0?e.value=1:e.value===1?e.value=2:e.value===2?e.value=3:e.value=0,_.value.forEach(([u,l])=>{n.value[u][l]=a.Z})}return{defaultPosition:p,nextPosition:m,endPosition:h,position:_,shape:e,id:a.Z,changeShape:y,moveRight:w,moveLeft:T,prepare:L,fall:I}}function Mo(){const e=Ue(),{data:n}=Qe();return Xe(async({score:r})=>{if(!n.value)return null;const{data:v}=await re.from("tetris-records").select("*").eq("user_id",n.value.id).order("score",{ascending:!1});if(!v)return null;switch(v.length<=10){case!0:return(await re.from("tetris-records").insert({score:r,user_id:n.value.id}).single()).data;case!1:{const d=v[v.length-1];return d.score>r?null:(await re.from("tetris-records").update({id:d.id,score:r}).single()).data}}},{onSuccess:r=>{if(!n.value)return;const{user_name:v=n.value.email,avatar_url:d=""}=n.value.user_metadata;if(!r)return;const p=e.getQueryData("tetris-records");!p||e.setQueryData("tetris-records",()=>[...p,Le(U({},r),{user:{user_name:v,avatar_url:d}})].sort((_,m)=>m.score-_.score))}})}function Co(){const{t:e}=se(),n=Mo(),{openIssueModal:r}=qe(),{TOP_RESERVE:v,currNode:d,nodes:p,removeNodes:_,switchNode:m,fossilize:h,resetUseNodes:L}=E(),{gameStatus:I,setTimeoutMs:w,score:T,computeSetTimeoutMs:y,resetGameInfo:o}=N(),s=wo(),u=To(),l=yo(),f=Ro(),i=xo(),t=ko(),te=Oo();let H;Re(()=>{clearTimeout(H),ne()});function k(){const O=[s,u,l,f,i,t,te].find(({id:$})=>$===d.value);if(!O)throw Error("Tetromino not found");return O}function Y(){k().prepare(),B(),I.value="PLAYING"}function oe(){n.mutate({score:T.value},{onSettled:()=>{window.alert("Game Over!"),I.value="END"},onError:()=>{r({title:e("record_mutation_failed.title"),content:e("record_mutation_failed.content")})}})}function ne(){L(),o()}function B(){clearTimeout(H),H=setTimeout(()=>{if(!k().fall()){if(clearTimeout(H),_(),!F())return oe();m(),k().prepare()}B()},w.value)}function F(){const O=k().position.value;for(let $=0;$<O.length;$++){const[z]=O[$];if(z<v)return!1}return!0}function de(O){I.value==="PLAYING"&&(O.preventDefault(),k().changeShape())}function X(O){I.value==="PLAYING"&&(O.preventDefault(),k().moveRight())}function $e(O){I.value==="PLAYING"&&(O.preventDefault(),k().moveLeft())}function Ae(O){I.value==="PLAYING"&&(O.preventDefault(),w.value=0,B(),w.value=y())}function Ee(O){if(I.value==="PLAYING"){if(O.preventDefault(),clearTimeout(H),k().position.value.forEach(([$,z])=>{p.value[$][z]=a.VOID}),k().endPosition.value.forEach(([$,z],le)=>{h([$,z]),k().position.value[le][0]=$,k().position.value[le][1]=z}),_(),!F())return oe();m(),k().prepare(),B()}}function Be(O,$){return I.value!=="PLAYING"?!1:!!k().endPosition.value.find(([z,le])=>z===O&&le===$)}return{moveTetrominoToRight:X,moveTetrominoToLeft:$e,moveTetrominoDown:Ae,rotateTetromino:de,dropTetromino:Ee,resetGame:ne,startGame:Y,tetromino:k,validate:F,isGuide:Be,fall:B}}const $o={class:"my-20 text-3xl md:text-5xl text-center"},Ao={class:"flex px-10 sm:pl-32 md:pl-50 xl:pl-64 gap-3 lg:gap-20"},Eo={class:"flex flex-col gap-10"},Bo={key:0},Po={class:"mt-auto"},Ho=W({setup(e){const{lg:n}=Te(ye),{t:r}=se(),{isLoading:v,data:d}=lt(),{nodes:p,TOP_RESERVE:_,X_SIZE:m}=E(),{moveTetrominoToRight:h,moveTetrominoToLeft:L,moveTetrominoDown:I,rotateTetromino:w,dropTetromino:T,resetGame:y,startGame:o,tetromino:s,isGuide:u}=Co(),{gameStatus:l,isCatHere:f,score:i,level:t}=N();j("ArrowRight",h),j("ArrowLeft",L),j("ArrowDown",I),j("ArrowUp",w),j(" ",T);const te=R(null),{left:H}=Ke(te);return(k,Y)=>{const oe=tt,ne=et("client-only");return g(),b(P,null,[S("h1",$o,M(c(r)("tetris")),1),C(zt,{position:c(s)().position,left:c(H)},null,8,["position","left"]),S("div",Ao,[S("div",{ref_key:"tetrisContainerEl",ref:te,class:"grid gap-px shadow-lg bg-gray-700"},[(g(!0),b(P,null,V(c(p),(B,F)=>(g(),b("div",{key:F,style:he(U({},F<c(_)?{display:"none"}:{display:"grid",gap:"1px",gridTemplateColumns:`repeat(${c(m)-2}, 1fr)`}))},[(g(!0),b(P,null,V(B,(de,X)=>(g(),ve(Io,{key:X,rowIdx:F,colIdx:X,"is-guide":c(u)(F,X),node:de,"is-cat-here":c(f)},null,8,["rowIdx","colIdx","is-guide","node","is-cat-here"]))),128))],4))),128))],512),S("div",Eo,[C(bo),S("div",null,M(c(r)("level"))+": "+M(c(t)),1),S("div",null,M(c(r)("score"))+": "+M(c(i)),1),c(l)==="READY"?(g(),b("button",{key:0,class:"py-2 px-3 border border-red-600 rounded",onClick:Y[0]||(Y[0]=(...B)=>c(o)&&c(o)(...B))},[J(M(c(r)("start"))+" ",1),c(f)?(g(),b("span",Bo,"\u{1F408}")):A("",!0)])):A("",!0),c(l)==="END"?(g(),b("button",{key:1,class:"py-2 px-3 border border-red-600 rounded",onClick:Y[1]||(Y[1]=(...B)=>c(y)&&c(y)(...B))},M(c(r)("reset")),1)):A("",!0),S("div",Po,[c(n)?(g(),ve(Ct,{key:0})):(g(),ve(to,{key:1,onOnTouchArrowRightBtn:c(h),onOnTouchArrowLeftBtn:c(L),onOnTouchArrowDownBtn:c(T),onOnTouchRotateBtn:c(w)},null,8,["onOnTouchArrowRightBtn","onOnTouchArrowLeftBtn","onOnTouchArrowDownBtn","onOnTouchRotateBtn"]))])])]),C(nt,{class:"mt-10 text-center"}),C(ot,{"is-loading":c(v),data:c(d)},null,8,["is-loading","data"]),C(ne,null,{default:Ne(()=>[C(oe,{class:"opacity-50"})]),_:1})],64)}}});export{Ho as default};
