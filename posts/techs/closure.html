<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><link rel="icon" href="/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Closure | Jon Ganebski</title><script type="module" async="" crossorigin="" src="/assets/app.0581d125.js"></script><link rel="modulepreload" href="/assets/vendor.55f469e5.js"><style>h2[data-v-87b9ab2c-s]{font-weight:700;font-size:1.875rem;line-height:2.25rem;margin-top:5rem;padding-left:1.25rem;padding-right:1.25rem}p[data-v-87b9ab2c-s]{font-size:.875rem;line-height:1.25rem;margin-top:1.25rem;padding-left:1.25rem;padding-right:1.25rem}@media (min-width:1280px){p[data-v-87b9ab2c-s]{font-size:1.125rem;line-height:1.75rem}}.nav[data-v-4e189ab4]>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.nav[data-v-4e189ab4]{margin-top:1rem}.icon[data-v-4e189ab4]{display:inline-block;font-size:1.125rem;line-height:1.75rem}.recent-post-link[data-v-4e189ab4]{cursor:pointer;display:block;font-size:.875rem;line-height:1.25rem;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap;text-underline-offset:2px;width:100%}.recent-post-link[data-v-4e189ab4]:hover{-webkit-text-decoration-line:underline;text-decoration-line:underline}.nav[data-v-7811c9a0]{display:flex;gap:1.5rem;width:fit-content;transform-origin:right;transform:translate(-100%) rotate(-90deg)}*,:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}*{--tw-ring-inset:var(--tw-empty, );--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59, 130, 246, .5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000}:root{-moz-tab-size:4;-o-tab-size:4;tab-size:4}a{color:inherit;text-decoration:inherit}body{margin:0;font-family:inherit;line-height:inherit}button{font-family:inherit;font-size:100%;line-height:1.15;margin:0;padding:0;line-height:inherit;color:inherit}button{text-transform:none;background-color:transparent;background-image:none}button{-webkit-appearance:button}button{cursor:pointer}html{-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";line-height:1.5}h1,h6,p{margin:0}h1,h6{font-size:inherit;font-weight:inherit}img{border-style:solid;max-width:100%;height:auto}img,svg{display:block;vertical-align:middle}code[class*=language-],pre[class*=language-]{color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,Andale Mono,Ubuntu Mono,Courier New,monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#264f78}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:3rem 1.25rem;padding:1em;overflow:auto;background:#1e1e1e}.token.comment{color:#6a9955}.language-html .language-javascript .token.punctuation,.token.punctuation{color:#d4d4d4}.token.number,.token.tag{color:#b5cea8}.token.builtin,.token.string{color:#ce9178}.token.operator{color:#d4d4d4}.token.keyword{color:#569cd6}.token.function{color:#dcdcaa}.token.class-name{color:#4ec9b0}.token.interpolation{color:#9cdcfe}.token.punctuation.interpolation-punctuation{color:#569cd6}.token.tag{color:#569cd6}.token.tag .token.punctuation{color:gray}code[class*=language-html],pre[class*=language-html]{color:#d4d4d4}.language-html .token.punctuation{color:gray}pre[class*=language-]>code[class*=language-]{position:relative;z-index:1}.bg-light-300{--tw-bg-opacity:1;background-color:rgba(248,249,250,var(--tw-bg-opacity))}.bg-transparent{background-color:transparent}.bg-white{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.bg-red-800{--tw-bg-opacity:1;background-color:rgba(153,27,27,var(--tw-bg-opacity))}.bg-cover{background-size:cover}.flex{display:-webkit-box;display:-ms-flexbox;display:-webkit-flex;display:flex}.grid{display:-ms-grid;display:grid}.hidden{display:none}.flex-col{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;-webkit-flex-direction:column;flex-direction:column}.place-items-center{place-items:center}.items-center{-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;align-items:center}.justify-center{-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center}.justify-between{-webkit-box-pack:justify;-ms-flex-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.font-normal{font-weight:400}.font-bold{font-weight:700}.h-screen{height:100vh}.h-0{height:0}.h-14{height:3.5rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-5xl{font-size:3rem;line-height:1}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.mx-auto{margin-left:auto;margin-right:auto}.mx-4{margin-left:1rem;margin-right:1rem}.mt-32{margin-top:8rem}.mt-20{margin-top:5rem}.mt-22{margin-top:5.5rem}.mt-auto{margin-top:auto}.mb-10{margin-bottom:2.5rem}.mb-20{margin-bottom:5rem}.ml-20{margin-left:5rem}.mt-30{margin-top:7.5rem}.mt-8{margin-top:2rem}.mt-24{margin-top:6rem}.max-w-screen-lg{max-width:1024px}.min-h-screen{min-height:100vh}.min-h-\[32rem\]{min-height:32rem}.px-4{padding-left:1rem;padding-right:1rem}.px-\[30vw\]{padding-left:30vw;padding-right:30vw}.py-\[30vh\]{padding-top:30vh;padding-bottom:30vh}.py-15{padding-top:3.75rem;padding-bottom:3.75rem}.pt-32{padding-top:8rem}.pb-5{padding-bottom:1.25rem}.pb-10{padding-bottom:2.5rem}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{top:0;right:0;bottom:0;left:0}.top-0{top:0}.left-0{left:0}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0/.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);-webkit-box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0/.1),0 4px 6px -4px rgb(0 0 0/.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color);-webkit-box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.text-center{text-align:center}.text-dark-300{--tw-text-opacity:1;color:rgba(45,45,45,var(--tw-text-opacity))}.text-dark-500{--tw-text-opacity:1;color:rgba(31,31,31,var(--tw-text-opacity))}.text-red-500{--tw-text-opacity:1;color:rgba(239,68,68,var(--tw-text-opacity))}.text-light-300{--tw-text-opacity:1;color:rgba(248,249,250,var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgba(255,255,255,var(--tw-text-opacity))}.write-vertical-right{-webkit-writing-mode:vertical-rl;-ms-writing-mode:tb-rl;writing-mode:vertical-rl}.write-orient-upright{-webkit-text-orientation:upright;text-orientation:upright}.w-full{width:100%}.w-14{width:3.5rem}.w-0{width:0}.w-screen{width:100vw}.z-10{z-index:10}.z-50{z-index:50}.gap-10{grid-gap:2.5rem;gap:2.5rem}.gap-3{grid-gap:.75rem;gap:.75rem}.transition-all{-webkit-transition-property:all;-o-transition-property:all;transition-property:all;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);-o-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-duration:.15s;-o-transition-duration:.15s;transition-duration:.15s}.transition-transform{-webkit-transition-property:-webkit-transform;-o-transition-property:transform;transition-property:transform,-webkit-transform;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);-o-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-duration:.15s;-o-transition-duration:.15s;transition-duration:.15s}.duration-300{-webkit-transition-duration:.3s;-o-transition-duration:.3s;transition-duration:.3s}.delay-300{-webkit-transition-delay:.3s;-o-transition-delay:.3s;transition-delay:.3s}@-webkit-keyframes wiggle{0%,to{-webkit-transform:rotate(-1deg);transform:rotate(-1deg)}25%{-webkit-transform:rotate(1deg);transform:rotate(1deg)}50%{-webkit-transform:rotate(-2deg);transform:rotate(-2deg)}75%{-webkit-transform:rotate(1deg);transform:rotate(1deg)}}@media (min-width:640px){.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}}@media (min-width:768px){.md\:text-7xl{font-size:4.5rem;line-height:1}.md\:p-10{padding:2.5rem}.md\:px-28{padding-left:7rem;padding-right:7rem}}@media (min-width:1024px){.lg\:flex{display:-webkit-box;display:-ms-flexbox;display:-webkit-flex;display:flex}.lg\:ml-14{margin-left:3.5rem}.lg\:p-20{padding:5rem}.lg\:text-right{text-align:right}.lg\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}</style><link rel="preload" href="/assets/app.af99282c.css" as="style"></head><body><div id="app" data-server-rendered="true"><!--[--><div class="fixed z-50 top-0 left-0" data-v-5955bf77=""><section class="absolute top-0 left-0 w-screen h-screen px-[30vw] py-[30vh] bg-cover text-light-300 transition-all delay-300 duration-300" style="clip-path:polygon(0 0,0 0,0 0,0 0);opacity:0;background-image:url(/assets/menu-bg.b6f595e2.svg)" data-v-5955bf77=""><div class="mb-20 flex items-center" data-v-5955bf77=""><h1 class="text-5xl" data-v-5955bf77="">Menu</h1><button class="ml-20" data-v-5955bf77=""><svg width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg></button></div><nav class="grid gap-3 text-xl font-normal" data-v-5955bf77=""><a href="/" class="" data-v-5955bf77="">Home</a><a href="/posts/routes" class="" data-v-5955bf77="">Routes</a><a href="/posts/techs" class="" data-v-5955bf77="">Techs</a></nav><div class="mt-30" data-v-5955bf77=""><button data-v-5955bf77="">한국어</button><span data-v-5955bf77=""> / </span><button data-v-5955bf77="">English</button></div></section><section data-v-5955bf77=""><button class="relative w-14 h-14" data-v-5955bf77=""><div class="absolute inset-0 grid place-items-center bg-red-800 transition-transform delay-300 duration-300" style="backface-visibility:hidden;transform-style:preserve-3d;transform:rotateY(0)" data-v-5955bf77=""><svg width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" class="text-xl text-white" data-v-5955bf77=""><path d="M4 6h24v2H4z" fill="currentColor"></path><path d="M4 24h24v2H4z" fill="currentColor"></path><path d="M4 12h24v2H4z" fill="currentColor"></path><path d="M4 18h24v2H4z" fill="currentColor"></path></svg></div><div class="absolute inset-0 grid place-items-center bg-red-800 transition-transform delay-300 duration-300" style="backface-visibility:hidden;transform-style:preserve-3d;transform:rotateY(-180deg)" data-v-5955bf77=""><svg width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" class="text-xl text-white" data-v-5955bf77=""><path d="M24 9.4L22.6 8L16 14.6L9.4 8L8 9.4l6.6 6.6L8 22.6L9.4 24l6.6-6.6l6.6 6.6l1.4-1.4l-6.6-6.6L24 9.4z" fill="currentColor"></path></svg></div></button></section></div><header class="fixed top-0 left-0 z-10 h-screen w-14 pb-10 hidden lg:flex flex-col items-center bg-white dark:bg-dark-500 text-sm text-dark-500 dark:text-light-500 shadow-2xl" data-v-7811c9a0=""><div class="mt-22 w-0 h-0" data-v-7811c9a0=""><nav class="nav" data-v-7811c9a0=""><a href="/posts/techs" class="" data-v-7811c9a0="">Techs</a><a href="/posts/routes" class="" data-v-7811c9a0="">Routes</a><a href="/" class="" data-v-7811c9a0="">Home</a></nav></div><div class="mt-auto grid justify-center" data-v-7811c9a0=""><button class="mb-10 mx-auto text-lg" data-v-7811c9a0=""><svg width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg></button><button data-v-7811c9a0=""><span class="write-vertical-right" data-v-7811c9a0="">한국어</span></button><span class="text-center" data-v-7811c9a0="">- </span><button data-v-7811c9a0=""><span class="text-red-500 write-vertical-right write-orient-upright" data-v-7811c9a0="">en</span></button></div></header><main class="min-h-screen lg:ml-14"><!--[--><!----><div class="md:p-10 lg:p-20" data-v-87b9ab2c=""><article class="py-15 max-w-screen-lg w-full bg-light-300 dark:bg-dark-300 text-dark-300 dark:text-light-300 shadow-lg" data-v-87b9ab2c=""><h1 class="mx-4 text-4xl md:text-7xl font-bold" data-v-87b9ab2c="">Closure</h1><img class="mt-8" src="https://images.pexels.com/photos/5910298/pexels-photo-5910298.jpeg?cs=srgb&amp;dl=pexels-plato-terentev-5910298.jpg&amp;fm=jpg" alt="" data-v-87b9ab2c=""><div class="mt-24" data-v-87b9ab2c=""><!--[--><div class="markdown-body" data-v-87b9ab2c-s=""><p data-v-87b9ab2c-s=""><span class="photo-reference" data-v-87b9ab2c-s="">Plato Terentev 님의 사진, 출처: Pexels</span></p><p data-v-87b9ab2c-s="">얼마 전 있었던 기술면접에서 Closure에 대한 질문이 나왔다. 뭔가 들어본 듯 하면서도 전혀 기억 나는 것이 없어서 모른다고 답변 드릴 수 밖에 없었다. 일단 정의부터 찾아봤는데, 곧바로 이해가 되지는 않았다.</p><h2 data-v-87b9ab2c-s="">클로저의 정의</h2><p data-v-87b9ab2c-s="">클로저(closure)는 내부함수가 외부함수의 맥락(context)에 접근할 수 있는 것을 가르킨다. - 생활코딩</p><p data-v-87b9ab2c-s="">A closure is the combination of a function bundled together (enclosed) with references to its surrounding state (the lexical environment). In other words, a closure gives you access to an outer function’s scope from an inner function. In JavaScript, closures are created every time a function is created, at function creation time. - MDN</p><p data-v-87b9ab2c-s="">번역: 클로저는 함수와 그 함수가 선언될 당시의 lexical environment의 상호작용에 따른 현상 - 정재남, 코어 자바스크립트 p.116</p><h2 data-v-87b9ab2c-s="">이해</h2><p data-v-87b9ab2c-s="">아래처럼 만들면 outer함수와 inner함수가 뭔지 알 수 있을 것이다. inner함수는 다른 함수 내부에 선언된 함수다. 그리고 상대적으로 밖에 있는 함수가 outer함수다. 그리고 inner함수에 name이라는 변수가 없다면 그 다음 스코프인 outer함수 내에서 name을 찾게된다.</p><pre class="language-ts" data-v-87b9ab2c-s=""><code class="language-ts" data-v-87b9ab2c-s=""><span class="token keyword" data-v-87b9ab2c-s="">const</span> <span class="token function-variable function" data-v-87b9ab2c-s="">outer</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
  <span class="token keyword" data-v-87b9ab2c-s="">const</span> name <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token string" data-v-87b9ab2c-s="">'Rice Shower'</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
  <span class="token keyword" data-v-87b9ab2c-s="">const</span> <span class="token function-variable function" data-v-87b9ab2c-s="">inner</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
    <span class="token builtin" data-v-87b9ab2c-s="">console</span><span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">log</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>name<span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
  <span class="token punctuation" data-v-87b9ab2c-s="">}</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
  <span class="token function" data-v-87b9ab2c-s="">inner</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
<span class="token punctuation" data-v-87b9ab2c-s="">}</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

<span class="token function" data-v-87b9ab2c-s="">outer</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// Rice Shower</span>
</code></pre><p data-v-87b9ab2c-s="">좀 더 어려운 이야기: 바로 위 스코프를 검색하게 되는 이유는 inner함수가 선언될 때 형성되는 inner함수의 Lexical Environment의 outerEnvironmentReference가(아… 길다) <code data-v-87b9ab2c-s="">선언 시점</code>의 Lexical Environment(그러므로 outer함수의 Lexical Environment)를 참조하기 때문이다.</p><p data-v-87b9ab2c-s="">여기까진 당연한 소리로 들렸다. 신기한 건 다음부터였다.</p><pre class="language-ts" data-v-87b9ab2c-s=""><code class="language-ts" data-v-87b9ab2c-s=""><span class="token keyword" data-v-87b9ab2c-s="">const</span> <span class="token function-variable function" data-v-87b9ab2c-s="">outer</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
  <span class="token keyword" data-v-87b9ab2c-s="">const</span> name <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token string" data-v-87b9ab2c-s="">'Rice Shower'</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
  <span class="token keyword" data-v-87b9ab2c-s="">const</span> <span class="token function-variable function" data-v-87b9ab2c-s="">inner</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
    <span class="token builtin" data-v-87b9ab2c-s="">console</span><span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">log</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>name<span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
  <span class="token punctuation" data-v-87b9ab2c-s="">}</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
  <span class="token keyword" data-v-87b9ab2c-s="">return</span> inner<span class="token punctuation" data-v-87b9ab2c-s="">;</span>
<span class="token punctuation" data-v-87b9ab2c-s="">}</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

<span class="token keyword" data-v-87b9ab2c-s="">const</span> inner <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token function" data-v-87b9ab2c-s="">outer</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
<span class="token function" data-v-87b9ab2c-s="">inner</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// Rice Shower</span>
</code></pre><p data-v-87b9ab2c-s="">잘 보면 뭔가 이상하다. <code data-v-87b9ab2c-s="">const inner = outer()</code>에서 inner는 console.log(name)을 하는 함수가 됐다. 그런데 어떻게 이미 임무를 완수하고 끝나버린 outer함수의 지역변수인 name을 가져올 수 있는 것인가?</p><p data-v-87b9ab2c-s="">내가 이해한 바로는 위에 어려운 이야기와 관련이 있다. <code data-v-87b9ab2c-s="">선언 시점</code>이 중요한 키워드인데, inner함수가 선언될 당시에는 name변수가 있었고, 이것을 outerEnvironmentReference로 inner함수의 Lexical Environment가 형성됐다. 그러므로 outer함수는 종료됐지만, inner함수의 Lexical Environment는 자신이 태어날 때 name이라는 변수가 있었다는걸 기억하고 있다. 그리고 Garbage Collector는 어떤 값을 참조하는 변수가 하나라도 있다면 수집대상에서 제외하기 때문에 outer함수 종료 후에도 메모리에 남아있게 된다.</p><p data-v-87b9ab2c-s="">MDN에서 Closure를 Combination(조합)이라고 표현하지만 이런 일련의 현상? 작동방식?이라고 일단 이해하는게 일단 편할 지도 모르겠다는 생각이 들었다.</p><pre class="language-ts" data-v-87b9ab2c-s=""><code class="language-ts" data-v-87b9ab2c-s=""><span class="token comment" data-v-87b9ab2c-s="">// 생활코딩 egoing님의 예제를 조금 바꿔봤다.</span>
<span class="token keyword" data-v-87b9ab2c-s="">const</span> <span class="token function-variable function" data-v-87b9ab2c-s="">stable</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span>name<span class="token operator" data-v-87b9ab2c-s="">:</span> <span class="token builtin" data-v-87b9ab2c-s="">string</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
  <span class="token keyword" data-v-87b9ab2c-s="">return</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
    <span class="token function-variable function" data-v-87b9ab2c-s="">getName</span><span class="token operator" data-v-87b9ab2c-s="">:</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
      <span class="token keyword" data-v-87b9ab2c-s="">return</span> name<span class="token punctuation" data-v-87b9ab2c-s="">;</span>
    <span class="token punctuation" data-v-87b9ab2c-s="">}</span><span class="token punctuation" data-v-87b9ab2c-s="">,</span>
    <span class="token function-variable function" data-v-87b9ab2c-s="">setName</span><span class="token operator" data-v-87b9ab2c-s="">:</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span>_name<span class="token operator" data-v-87b9ab2c-s="">:</span> <span class="token builtin" data-v-87b9ab2c-s="">string</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
      name <span class="token operator" data-v-87b9ab2c-s="">=</span> _name<span class="token punctuation" data-v-87b9ab2c-s="">;</span>
    <span class="token punctuation" data-v-87b9ab2c-s="">}</span><span class="token punctuation" data-v-87b9ab2c-s="">,</span>
  <span class="token punctuation" data-v-87b9ab2c-s="">}</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
<span class="token punctuation" data-v-87b9ab2c-s="">}</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

<span class="token keyword" data-v-87b9ab2c-s="">const</span> main <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token function" data-v-87b9ab2c-s="">stable</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token string" data-v-87b9ab2c-s="">'Special Week'</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
<span class="token keyword" data-v-87b9ab2c-s="">const</span> sub <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token function" data-v-87b9ab2c-s="">stable</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token string" data-v-87b9ab2c-s="">'Silence Suzuka'</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

<span class="token builtin" data-v-87b9ab2c-s="">console</span><span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">log</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>main<span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">getName</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// Special Week</span>
<span class="token builtin" data-v-87b9ab2c-s="">console</span><span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">log</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>sub<span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">getName</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// Silence Suzuka</span>

main<span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">setName</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token string" data-v-87b9ab2c-s="">'Tokai Teio'</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

<span class="token builtin" data-v-87b9ab2c-s="">console</span><span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">log</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>main<span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">getName</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// Tokai Teio</span>
<span class="token builtin" data-v-87b9ab2c-s="">console</span><span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">log</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>sub<span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">getName</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// Silence Suzuka</span>
</code></pre><ol data-v-87b9ab2c-s=""><li data-v-87b9ab2c-s=""><p data-v-87b9ab2c-s="">클로저는 객체의 메소드에서도 적용된다. 위에서 stable은 outer함수로, 객체를 반환하고 있다. 이 객체는 메소드 getNAme, setName을 가지고 있다. 이 메소드들은 생성 당시 stable함수에 있던 name을 <code data-v-87b9ab2c-s="">기억</code>한다. (Lexical Environment의 outerEnvironmentReference로)</p></li><li data-v-87b9ab2c-s=""><p data-v-87b9ab2c-s="">동일한 outer 함수 안에서 만들어진 getName과 setName은 생성 당시의 stable함수의 Lexical Environment를 참조했으므로 지역변수 name을 <code data-v-87b9ab2c-s="">공유</code>한다.</p></li><li data-v-87b9ab2c-s=""><p data-v-87b9ab2c-s="">하지만 main과 sub는 name을 공유하지 않는다. 맨 위에서 말했다시피 클로저는 함수 생성시에 형성된다. getName과 setName은 stable함수가 실행될 때 생성되므로, main에서 한 번 sub에서 한 번 따로따로 생성되었다. 그러므로 <code data-v-87b9ab2c-s="">둘의 클로저는 다르며, 독립적</code>이다.</p></li><li data-v-87b9ab2c-s=""><p data-v-87b9ab2c-s="">stable의 지역변수 name은 오로지 getName과 setName에서만 접근이 가능하다. JavaScript는 기본적으로 private한 속성을 지원하지 않는데, 클로저의 이러한 특성을 이용해서 <code data-v-87b9ab2c-s="">private 변수</code>로 활용하도록 응용할 수 있다. (비밀변수, private변수라는 단어는 MDN에서는 찾을 수 없었다. 아마도 편의상 그렇게 부르는 것 같다)</p></li></ol><p data-v-87b9ab2c-s="">'코어 자바스크립트’에서는 '클로저란 어떤 함수 A에서 선언된 변수 a를 참조하는 내부함수 B를 외부로 전달할 경우 A의 실행 컨텍스트가 종료된 이후에도 변수 a가 사라지지 않는 현상’이라고 정리하고 있다.</p><h2 data-v-87b9ab2c-s="">return 없이도 클로저가 발생하는 경우</h2><p data-v-87b9ab2c-s="">위에서는 모두 outer함수가 inner함수를 리턴하거나 inner함수들이 선언된 객체를 리턴하는 경우였다. 하지만 리턴 없이도 클로저가 발생하는 2가지 경우가 있다.</p><ol data-v-87b9ab2c-s=""><li data-v-87b9ab2c-s="">setInterval / setTimeout</li></ol><pre class="language-ts" data-v-87b9ab2c-s=""><code class="language-ts" data-v-87b9ab2c-s=""><span class="token comment" data-v-87b9ab2c-s="">// 코어 자바스크립트에 소개된 예시를 조금 바꿔 봤다.</span>
<span class="token keyword" data-v-87b9ab2c-s="">const</span> <span class="token function-variable function" data-v-87b9ab2c-s="">outer</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
  <span class="token keyword" data-v-87b9ab2c-s="">let</span> a <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token number" data-v-87b9ab2c-s="">0</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
  <span class="token keyword" data-v-87b9ab2c-s="">let</span> intervalId<span class="token operator" data-v-87b9ab2c-s="">:</span> <span class="token builtin" data-v-87b9ab2c-s="">number</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

  <span class="token keyword" data-v-87b9ab2c-s="">const</span> <span class="token function-variable function" data-v-87b9ab2c-s="">inner</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
    <span class="token operator" data-v-87b9ab2c-s="">++</span>a<span class="token punctuation" data-v-87b9ab2c-s="">;</span>
    <span class="token keyword" data-v-87b9ab2c-s="">if</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span>a <span class="token operator" data-v-87b9ab2c-s="">&gt;=</span> <span class="token number" data-v-87b9ab2c-s="">10</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
      <span class="token function" data-v-87b9ab2c-s="">clearInterval</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>intervalId<span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
      <span class="token keyword" data-v-87b9ab2c-s="">return</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
    <span class="token punctuation" data-v-87b9ab2c-s="">}</span>
    <span class="token builtin" data-v-87b9ab2c-s="">console</span><span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">log</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>a<span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
  <span class="token punctuation" data-v-87b9ab2c-s="">}</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

  intervalId <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token function" data-v-87b9ab2c-s="">setInterval</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>inner<span class="token punctuation" data-v-87b9ab2c-s="">,</span> <span class="token number" data-v-87b9ab2c-s="">1000</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
<span class="token punctuation" data-v-87b9ab2c-s="">}</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

<span class="token function" data-v-87b9ab2c-s="">outer</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// 1 2 3 4 5 6 7 8 9</span>
<span class="token comment" data-v-87b9ab2c-s="">// outer함수는 종료됐고 inner함수를 리턴하지도 않았지만,</span>
<span class="token comment" data-v-87b9ab2c-s="">// setInterval의 콜백함수인 inner함수는 변수 a를 계속 사용하고 있다.</span>
</code></pre><ol start="2" data-v-87b9ab2c-s=""><li data-v-87b9ab2c-s="">addEventListener</li></ol><pre class="language-html" data-v-87b9ab2c-s=""><code class="language-html" data-v-87b9ab2c-s=""><span class="token comment" data-v-87b9ab2c-s="">&lt;!-- 코어 자바스크립트에 소개된 예시를 조금 바꿔 봤다. --&gt;</span>
<span class="token tag" data-v-87b9ab2c-s=""><span class="token tag" data-v-87b9ab2c-s=""><span class="token punctuation" data-v-87b9ab2c-s="">&lt;</span>body</span><span class="token punctuation" data-v-87b9ab2c-s="">&gt;</span></span>
  <span class="token tag" data-v-87b9ab2c-s=""><span class="token tag" data-v-87b9ab2c-s=""><span class="token punctuation" data-v-87b9ab2c-s="">&lt;</span>div</span><span class="token punctuation" data-v-87b9ab2c-s="">&gt;</span></span>
    <span class="token tag" data-v-87b9ab2c-s=""><span class="token tag" data-v-87b9ab2c-s=""><span class="token punctuation" data-v-87b9ab2c-s="">&lt;</span>button</span><span class="token punctuation" data-v-87b9ab2c-s="">&gt;</span></span>Click<span class="token tag" data-v-87b9ab2c-s=""><span class="token tag" data-v-87b9ab2c-s=""><span class="token punctuation" data-v-87b9ab2c-s="">&lt;/</span>button</span><span class="token punctuation" data-v-87b9ab2c-s="">&gt;</span></span>
  <span class="token tag" data-v-87b9ab2c-s=""><span class="token tag" data-v-87b9ab2c-s=""><span class="token punctuation" data-v-87b9ab2c-s="">&lt;/</span>div</span><span class="token punctuation" data-v-87b9ab2c-s="">&gt;</span></span>
  <span class="token tag" data-v-87b9ab2c-s=""><span class="token tag" data-v-87b9ab2c-s=""><span class="token punctuation" data-v-87b9ab2c-s="">&lt;</span>script</span><span class="token punctuation" data-v-87b9ab2c-s="">&gt;</span></span><span class="token script" data-v-87b9ab2c-s=""><span class="token language-javascript" data-v-87b9ab2c-s="">
    <span class="token keyword" data-v-87b9ab2c-s="">const</span> <span class="token function-variable function" data-v-87b9ab2c-s="">outer</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
      <span class="token keyword" data-v-87b9ab2c-s="">let</span> count <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token number" data-v-87b9ab2c-s="">0</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
      <span class="token keyword" data-v-87b9ab2c-s="">const</span> button <span class="token operator" data-v-87b9ab2c-s="">=</span> document<span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">querySelector</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token string" data-v-87b9ab2c-s="">'button'</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
      <span class="token keyword" data-v-87b9ab2c-s="">if</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token operator" data-v-87b9ab2c-s="">!</span>button<span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token keyword" data-v-87b9ab2c-s="">return</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

      <span class="token keyword" data-v-87b9ab2c-s="">const</span> <span class="token function-variable function" data-v-87b9ab2c-s="">inner</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
        <span class="token operator" data-v-87b9ab2c-s="">++</span>count<span class="token punctuation" data-v-87b9ab2c-s="">;</span>
        console<span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">log</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token template-string" data-v-87b9ab2c-s=""><span class="token template-punctuation string" data-v-87b9ab2c-s="">`</span><span class="token interpolation" data-v-87b9ab2c-s=""><span class="token interpolation-punctuation punctuation" data-v-87b9ab2c-s="">${</span>count<span class="token interpolation-punctuation punctuation" data-v-87b9ab2c-s="">}</span></span><span class="token string" data-v-87b9ab2c-s=""> times clicked</span><span class="token template-punctuation string" data-v-87b9ab2c-s="">`</span></span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
      <span class="token punctuation" data-v-87b9ab2c-s="">}</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

      button<span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">addEventListener</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token string" data-v-87b9ab2c-s="">'click'</span><span class="token punctuation" data-v-87b9ab2c-s="">,</span> inner<span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>
    <span class="token punctuation" data-v-87b9ab2c-s="">}</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

    <span class="token function" data-v-87b9ab2c-s="">outer</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// 버튼 클릭 시: 1 times clicked, 2 times clicked, 3 times cilcked, ...</span>
    <span class="token comment" data-v-87b9ab2c-s="">// outer함수는 종료됐고 inner함수를 리턴하지도 않았지만,</span>
    <span class="token comment" data-v-87b9ab2c-s="">// addEventListener의 콜백함수인 inner함수는 변수 count를 계속 사용하고 있다.</span>
  </span></span><span class="token tag" data-v-87b9ab2c-s=""><span class="token tag" data-v-87b9ab2c-s=""><span class="token punctuation" data-v-87b9ab2c-s="">&lt;/</span>script</span><span class="token punctuation" data-v-87b9ab2c-s="">&gt;</span></span>
<span class="token tag" data-v-87b9ab2c-s=""><span class="token tag" data-v-87b9ab2c-s=""><span class="token punctuation" data-v-87b9ab2c-s="">&lt;/</span>body</span><span class="token punctuation" data-v-87b9ab2c-s="">&gt;</span></span>
</code></pre><h2 data-v-87b9ab2c-s="">자주 하는 실수</h2><p data-v-87b9ab2c-s="">MDN에서는 클로저와 관련해서 범할 수 있는 실수에 대해서 언급하고 있다. 하지만 요즘은 for loop를 만들 때 block scope를 가진 let을 사용하므로 별 의미는 없다고 볼 수 있다. 그래도 클로저를 이해하는데 중요하다고 생각한다.</p><pre class="language-ts" data-v-87b9ab2c-s=""><code class="language-ts" data-v-87b9ab2c-s=""><span class="token keyword" data-v-87b9ab2c-s="">const</span> arr<span class="token operator" data-v-87b9ab2c-s="">:</span> <span class="token builtin" data-v-87b9ab2c-s="">any</span><span class="token punctuation" data-v-87b9ab2c-s="">[</span><span class="token punctuation" data-v-87b9ab2c-s="">]</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">[</span><span class="token punctuation" data-v-87b9ab2c-s="">]</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

<span class="token keyword" data-v-87b9ab2c-s="">for</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token keyword" data-v-87b9ab2c-s="">var</span> i <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token number" data-v-87b9ab2c-s="">0</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> i <span class="token operator" data-v-87b9ab2c-s="">&lt;</span> <span class="token number" data-v-87b9ab2c-s="">5</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> i<span class="token operator" data-v-87b9ab2c-s="">++</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
  <span class="token comment" data-v-87b9ab2c-s="">// 여기서 let을 쓰면 0 1 2 3 4 가 출력된다.</span>
  <span class="token comment" data-v-87b9ab2c-s="">// 하지만 var를 쓰면 아래처럼 5 5 5 5 5가 출력된다.</span>
  arr<span class="token punctuation" data-v-87b9ab2c-s="">[</span>i<span class="token punctuation" data-v-87b9ab2c-s="">]</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span> i<span class="token punctuation" data-v-87b9ab2c-s="">;</span>
<span class="token punctuation" data-v-87b9ab2c-s="">}</span>

<span class="token keyword" data-v-87b9ab2c-s="">for</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token keyword" data-v-87b9ab2c-s="">var</span> j <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token number" data-v-87b9ab2c-s="">0</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> j <span class="token operator" data-v-87b9ab2c-s="">&lt;</span> arr<span class="token punctuation" data-v-87b9ab2c-s="">.</span>length<span class="token punctuation" data-v-87b9ab2c-s="">;</span> j<span class="token operator" data-v-87b9ab2c-s="">++</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
  <span class="token builtin" data-v-87b9ab2c-s="">console</span><span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">log</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>arr<span class="token punctuation" data-v-87b9ab2c-s="">[</span>j<span class="token punctuation" data-v-87b9ab2c-s="">]</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// 5 5 5 5 5</span>
<span class="token punctuation" data-v-87b9ab2c-s="">}</span>
</code></pre><p data-v-87b9ab2c-s="">여기서 내가 이해한 바를 써보자면, var는 function scope를 갖는데 for문은 function scope가 아니다. 그래서 이런게 가능하다.</p><pre class="language-ts" data-v-87b9ab2c-s=""><code class="language-ts" data-v-87b9ab2c-s=""><span class="token keyword" data-v-87b9ab2c-s="">for</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token keyword" data-v-87b9ab2c-s="">var</span> i <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token number" data-v-87b9ab2c-s="">0</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> i <span class="token operator" data-v-87b9ab2c-s="">&lt;</span> <span class="token number" data-v-87b9ab2c-s="">5</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> i<span class="token operator" data-v-87b9ab2c-s="">++</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
  <span class="token comment" data-v-87b9ab2c-s="">// do something</span>
<span class="token punctuation" data-v-87b9ab2c-s="">}</span>
<span class="token builtin" data-v-87b9ab2c-s="">console</span><span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">log</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>i<span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// 5</span>
</code></pre><p data-v-87b9ab2c-s="">let은 block scope이므로 위처럼 for문 밖에서 i로 접근이 불가능하다.</p><pre class="language-ts" data-v-87b9ab2c-s=""><code class="language-ts" data-v-87b9ab2c-s=""><span class="token keyword" data-v-87b9ab2c-s="">for</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token keyword" data-v-87b9ab2c-s="">let</span> i <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token number" data-v-87b9ab2c-s="">0</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> i <span class="token operator" data-v-87b9ab2c-s="">&lt;</span> <span class="token number" data-v-87b9ab2c-s="">5</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> i<span class="token operator" data-v-87b9ab2c-s="">++</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
  <span class="token comment" data-v-87b9ab2c-s="">// do something</span>
<span class="token punctuation" data-v-87b9ab2c-s="">}</span>
<span class="token builtin" data-v-87b9ab2c-s="">console</span><span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">log</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>i<span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// Error</span>
</code></pre><p data-v-87b9ab2c-s="">그러므로 var를 썼다면 for loop 안에서 선언되는 함수들의 outerEnvironmentReference는 모두 전역환경(?)을 참조하게 된다. 그리고 이 전역환경에서 i는 5로 변화한다. 그렇기 때문에 의도했던 0 1 2 3 4가 아니라, 5 5 5 5 5가 출력되는 것이다. 하지만 let은 block scope를 가지므로 for loop 안에서 선언되는 함수들은 i가 각기 다를 때의 환경을 참조하게 된다.<br data-v-87b9ab2c-s="">정리하자면 var를 썼을 때에는 모두 같은 i를 참조하며, 그 i는 5로 변화했기에 모두 5를 출력한다. let을 썼을 때에는 각기 다른 i를 참조했기 때문에 그에 대응해서 0 1 2 3 4를 출력한다.</p><p data-v-87b9ab2c-s="">그렇다면 var를 쓸 때 각기 다른 환경을 참조하게끔 하는 방법은 무엇인가? 사실 이것이 MDN에서 힘줘서 설명하고 있는 부분이며, let을 쓰고 있는 요즘은 그리 와닿지는 않는 부분이다. 하지만 let을 쓰는건 클로저를 응용하는 것과는 상관이 없는 것이라, 클로저를 알기 위해서는 봐 둘 필요가 있다.</p><p data-v-87b9ab2c-s="">결론을 바로 보면 이렇다.</p><pre class="language-ts" data-v-87b9ab2c-s=""><code class="language-ts" data-v-87b9ab2c-s=""><span class="token keyword" data-v-87b9ab2c-s="">const</span> arr<span class="token operator" data-v-87b9ab2c-s="">:</span> <span class="token builtin" data-v-87b9ab2c-s="">any</span><span class="token punctuation" data-v-87b9ab2c-s="">[</span><span class="token punctuation" data-v-87b9ab2c-s="">]</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">[</span><span class="token punctuation" data-v-87b9ab2c-s="">]</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span>

<span class="token keyword" data-v-87b9ab2c-s="">for</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token keyword" data-v-87b9ab2c-s="">var</span> i <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token number" data-v-87b9ab2c-s="">0</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token generic-function" data-v-87b9ab2c-s=""><span class="token function" data-v-87b9ab2c-s="">i</span> <span class="token generic class-name" data-v-87b9ab2c-s=""><span class="token operator" data-v-87b9ab2c-s="">&lt;</span> <span class="token number" data-v-87b9ab2c-s="">5</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> i<span class="token operator" data-v-87b9ab2c-s="">++</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
  arr<span class="token punctuation" data-v-87b9ab2c-s="">[</span>i<span class="token punctuation" data-v-87b9ab2c-s="">]</span> <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span>
    <span class="token punctuation" data-v-87b9ab2c-s="">(</span>x<span class="token operator" data-v-87b9ab2c-s="">:</span> <span class="token builtin" data-v-87b9ab2c-s="">number</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span></span></span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token operator" data-v-87b9ab2c-s="">=&gt;</span>
      x
  <span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>i<span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// arr[i] = () =&gt; i 에서 변경</span>
<span class="token punctuation" data-v-87b9ab2c-s="">}</span>

<span class="token keyword" data-v-87b9ab2c-s="">for</span> <span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token keyword" data-v-87b9ab2c-s="">var</span> j <span class="token operator" data-v-87b9ab2c-s="">=</span> <span class="token number" data-v-87b9ab2c-s="">0</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> j <span class="token operator" data-v-87b9ab2c-s="">&lt;</span> arr<span class="token punctuation" data-v-87b9ab2c-s="">.</span>length<span class="token punctuation" data-v-87b9ab2c-s="">;</span> j<span class="token operator" data-v-87b9ab2c-s="">++</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span> <span class="token punctuation" data-v-87b9ab2c-s="">{</span>
  <span class="token builtin" data-v-87b9ab2c-s="">console</span><span class="token punctuation" data-v-87b9ab2c-s="">.</span><span class="token function" data-v-87b9ab2c-s="">log</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span>arr<span class="token punctuation" data-v-87b9ab2c-s="">[</span>j<span class="token punctuation" data-v-87b9ab2c-s="">]</span><span class="token punctuation" data-v-87b9ab2c-s="">(</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">)</span><span class="token punctuation" data-v-87b9ab2c-s="">;</span> <span class="token comment" data-v-87b9ab2c-s="">// 0 1 2 3 4</span>
<span class="token punctuation" data-v-87b9ab2c-s="">}</span>
</code></pre><p data-v-87b9ab2c-s="">내가 이해한 바로는 이렇게 고치면 <code data-v-87b9ab2c-s="">() =&gt; x</code>함수는 전역환경이 아니라 <code data-v-87b9ab2c-s="">(x: number) =&gt; () =&gt; x</code> 이 함수의 LexicalEnvironment를 참조하게 된다. 처음으로 돌아가서 outer함수와 inner함수를 보고 오면 그 관계와 똑같다는걸 알 수 있다.</p><hr data-v-87b9ab2c-s=""><p data-v-87b9ab2c-s="">참고자료</p><p data-v-87b9ab2c-s=""><a href="https://opentutorials.org/course/743/6544" target="_blank" data-v-87b9ab2c-s="">https://opentutorials.org/course/743/6544</a><br data-v-87b9ab2c-s=""><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" target="_blank" data-v-87b9ab2c-s="">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures</a><br data-v-87b9ab2c-s="">코어 자바스크립트, 정재남 저</p></div><!--]--></div></article></div><!----><!----><!--]--></main><footer class="min-h-[32rem] mt-32 pt-32 pb-5 px-4 md:px-28 flex flex-col justify-between bg-transparent text-dark-500 dark:text-light-500" data-v-4e189ab4=""><div class="w-full max-w-screen-lg mx-auto grid sm:grid-cols-2 lg:grid-cols-3 gap-10" data-v-4e189ab4=""><div data-v-4e189ab4=""><h6 data-v-4e189ab4=""><svg width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" class="icon" data-v-4e189ab4=""><path d="M27.562 26L17.17 8.928l2.366-3.888L17.828 4L16 7.005L14.17 4l-1.708 1.04l2.366 3.888L4.438 26H2v2h28v-2zM16 10.85L25.22 26H17v-8h-2v8H6.78z" fill="currentColor"></path></svg></h6><nav class="nav" data-v-4e189ab4=""><!--[--><a href="/posts/routes/2018-05-31T2018-06-06" class="recent-post-link" data-v-4e189ab4="">Ulaanbaatar ~ Tsetserleg</a><a href="/posts/routes/2018-05-19T2018-05-28" class="recent-post-link" data-v-4e189ab4="">The Mongolian Wind</a><a href="/posts/routes/2018-05-13T2018-05-18" class="recent-post-link" data-v-4e189ab4="">Good bye, China</a><a href="/posts/routes/2018-05-06T2018-05-12" class="recent-post-link" data-v-4e189ab4="">Happy and Unhappy</a><a href="/posts/routes/2018-05-03T2018-05-05" class="recent-post-link" data-v-4e189ab4="">The First Day of the Bike Trip</a><!--]--></nav></div><div data-v-4e189ab4=""><h6 data-v-4e189ab4=""><svg width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" class="icon" data-v-4e189ab4=""><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg></h6><nav class="nav" data-v-4e189ab4=""><!--[--><a aria-current="page" href="/posts/techs/closure" class="router-link-active router-link-exact-active recent-post-link" data-v-4e189ab4="">Closure</a><a href="/posts/techs/event-listerners" class="recent-post-link" data-v-4e189ab4="">Event Listener</a><a href="/posts/techs/big-o-notation" class="recent-post-link" data-v-4e189ab4="">Big O Notation</a><a href="/posts/techs/baby-postgres" class="recent-post-link" data-v-4e189ab4="">My simple and small PostgreSQL commands</a><a href="/posts/techs/deep-copy" class="recent-post-link" data-v-4e189ab4="">Shallow copy and deep copy</a><!--]--></nav></div><div class="lg:text-right" data-v-4e189ab4=""><h6 data-v-4e189ab4=""><svg width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 32 32" class="icon" data-v-4e189ab4=""><path d="M29.25 6.76a6 6 0 0 0-8.5 0l1.42 1.42a4 4 0 1 1 5.67 5.67l-8 8a4 4 0 1 1-5.67-5.66l1.41-1.42l-1.41-1.42l-1.42 1.42a6 6 0 0 0 0 8.5A6 6 0 0 0 17 25a6 6 0 0 0 4.27-1.76l8-8a6 6 0 0 0-.02-8.48z" fill="currentColor"></path><path d="M4.19 24.82a4 4 0 0 1 0-5.67l8-8a4 4 0 0 1 5.67 0A3.94 3.94 0 0 1 19 14a4 4 0 0 1-1.17 2.85L15.71 19l1.42 1.42l2.12-2.12a6 6 0 0 0-8.51-8.51l-8 8a6 6 0 0 0 0 8.51A6 6 0 0 0 7 28a6.07 6.07 0 0 0 4.28-1.76l-1.42-1.42a4 4 0 0 1-5.67 0z" fill="currentColor"></path></svg></h6><nav class="nav" data-v-4e189ab4=""><a class="recent-post-link" href="https://github.com/jonganebski" target="_blank" rel="noopener noreferrer" data-v-4e189ab4="">Github</a><a class="recent-post-link" href="https://jinseokbang.com" target="_blank" rel="noopener noreferrer" data-v-4e189ab4="">Portfolio</a></nav></div></div><div class="mt-20 text-center text-sm" data-v-4e189ab4=""><p data-v-4e189ab4="">Built with Vue</p><p data-v-4e189ab4="">2022 © Jon Ganebski</p></div></footer><!--]--></div><link rel="stylesheet" href="/assets/app.af99282c.css"></body></html>